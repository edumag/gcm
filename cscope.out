cscope 15 $HOME/SERVIDOR/gcm               0000543780
	@docs/doxygen/html/search-config.php

1 <
süt
 
	gÏnguage
="php">

3 
$cÚfig
 = 
¬¿y
(

5 'GENERATE_TREEVIEW' => 
çl£
,

6 'DISABLE_INDEX' => 
çl£
,

9 
	g$Œª¦©Ü
 = 
¬¿y
(

11 '£¬ch_»suÉs' => 
¬¿y
(

22 </
	gsüt
>

	@docs/doxygen/html/search-functions.php

1 <
süt
 
	gÏnguage
="PHP">

2 
»quœe_Úû
 "search-config.php";

4 
funùiÚ
 
	$’d_fÜm
(
$v®ue
)

6 
glob®
 
$cÚfig
;

7 
glob®
 
$Œª¦©Ü
;

8 ià(
$cÚfig
['DISABLE_INDEX'] =ğ
çl£
)

10 
echo
 " <inputype=\"text\" id=\"MSearchField\"‚ame=\"query\" value=\"$value\" size=\"20\"‡ccesskey=\"S\" onfocus=\"searchBox.OnSearchFieldFocus(true)\" onblur=\"searchBox.OnSearchFieldFocus(false)\"/>\n </form>\n </div><div class=\"right\"></div>\n </div>\n </li>\n </ul>\n </div>\n</div>\n";

12 ià(
$cÚfig
['GENERATE_TREEVIEW'])

14 
echo
 
$Œª¦©Ü
['split_bar'];

16 
	}
}

18 
funùiÚ
 
	$’d_·ge
()

20 
glob®
 
$cÚfig
;

21 
glob®
 
$Œª¦©Ü
;

22 ià(
$cÚfig
['GENERATE_TREEVIEW'])

24 
echo
 "</div>\n<div id=\"nav-path\" class=\"navpath\">\n <ul>\n <li class=\"footer\">";

25 
echo
 
$Œª¦©Ü
['logo'];

26 
echo
 "</li>\n </ul>\n</div>";

28 
echo
 "</body></html>";

29 
	}
}

31 
funùiÚ
 
	$£¬ch_»suÉs
()

33 
glob®
 
$Œª¦©Ü
;

34  
$Œª¦©Ü
['search_results_title'];

35 
	}
}

37 
funùiÚ
 
	$m©ches_‹xt
(
$num
)

39 
glob®
 
$Œª¦©Ü
;

40 
$¡ršg
 = 
$Œª¦©Ü
['£¬ch_»suÉs'][(
$num
>2)?2:$num];

42 
	`ev®
("\$result = \"$string\";");

43  
$»suÉ
;

44 
	}
}

46 
funùiÚ
 
	$»pÜt_m©ches
()

48 
glob®
 
$Œª¦©Ü
;

49  
$Œª¦©Ü
['search_matches'];

50 
	}
}

52 
funùiÚ
 
	$»adIÁ
(
$fe
)

54 
$b1
 = 
	`Üd
(
	`fg‘c
(
$fe
)); 
$b2
 = ord(fgetc($file));

55 
$b3
 = 
	`Üd
(
	`fg‘c
(
$fe
)); 
$b4
 = ord(fgetc($file));

56  (
$b1
<<24)|(
$b2
<<16)|(
$b3
<<8)|
$b4
;

57 
	}
}

59 
funùiÚ
 
	$»adSŒšg
(
$fe
)

61 
$»suÉ
="";

62 
	`Üd
(
$c
=
	`fg‘c
(
$fe
))è
$»suÉ
.=$c;

63  
$»suÉ
;

64 
	}
}

66 
funùiÚ
 
	$»adH—d”
(
$fe
)

68 
$h—d”
 =
	`fg‘c
(
$fe
); $header.=fgetc($file);

69 
$h—d”
.=
	`fg‘c
(
$fe
); $header.=fgetc($file);

70  
$h—d”
;

71 
	}
}

73 
funùiÚ
 
	$compu‹Index
(
$wÜd
)

76 ià(
	`¡¾’
(
$wÜd
)<2)  -1;

78 
$hi
 = 
	`Üd
(
$wÜd
{0});

79 ià(
$hi
==0)  -1;

81 
$lo
 = 
	`Üd
(
$wÜd
{1});

82 ià(
$lo
==0)  -1;

84  
$hi
*256+
$lo
;

85 
	}
}

87 
funùiÚ
 
	$£¬ch
(
$fe
,
$wÜd
,&
$¡©sLi¡
)

89 
$šdex
 = 
	`compu‹Index
(
$wÜd
);

90 ià(
$šdex
!=-1)

92 
	`f£ek
(
$fe
,
$šdex
*4+4);

93 
$šdex
 = 
	`»adIÁ
(
$fe
);

94 ià(
$šdex
)

96 
$¡¬t
=(
$¡©sLi¡
);

97 
$couÁ
=
$¡¬t
;

98 
	`f£ek
(
$fe
,
$šdex
);

99 
$w
 = 
	`»adSŒšg
(
$fe
);

100 
$w
)

102 
$¡©Idx
 = 
	`»adIÁ
(
$fe
);

103 ià(
$wÜd
==
	`sub¡r
(
$w
,0,
	`¡¾’
($word)))

105 
$¡©sLi¡
[
$couÁ
++]=
	`¬¿y
(

106 "wÜd"=>
$wÜd
,

107 "m©ch"=>
$w
,

108 "šdex"=>
$¡©Idx
,

109 "fuÎ"=>
	`¡¾’
(
$w
)==¡¾’(
$wÜd
),

110 "docs"=>
	`¬¿y
()

113 
$w
 = 
	`»adSŒšg
(
$fe
);

115 
$tÙ®Hi
=0;

116 
$tÙ®F»qHi
=0;

117 
$tÙ®F»qLo
=0;

118 
$couÁ
=
$¡¬t
;$couÁ<(
$¡©sLi¡
);$count++)

120 
$¡©Info
 = &
$¡©sLi¡
[
$couÁ
];

121 
$muÉl›r
 = 1;

123 ià(
$¡©Info
["fuÎ"]è
$muÉl›r
=2;

124 
	`f£ek
(
$fe
,
$¡©Info
["index"]);

125 
$numDocs
 = 
	`»adIÁ
(
$fe
);

126 
$docInfo
 = 
	`¬¿y
();

128 
$i
=0;$i<
$numDocs
;$i++)

130 
$idx
=
	`»adIÁ
(
$fe
);

131 
$äeq
=
	`»adIÁ
(
$fe
);

132 
$docInfo
[
$i
]=
	`¬¿y
("idx" => 
$idx
,

133 "äeq" => 
$äeq
>>1,

135 "hi" => 
$äeq
&1

137 ià(
$äeq
&1)

139 
$tÙ®Hi
++;

140 
$tÙ®F»qHi
+=
$äeq
*
$muÉl›r
;

144 
$tÙ®F»qLo
+=
$äeq
*
$muÉl›r
;

148 
$i
=0;$i<
$numDocs
;$i++)

150 
	`f£ek
(
$fe
,
$docInfo
[
$i
]["idx"]);

151 
$docInfo
[
$i
]["Çme"]=
	`»adSŒšg
(
$fe
);

152 
$docInfo
[
$i
]["u¾"]=
	`»adSŒšg
(
$fe
);

154 
$¡©Info
["docs"]=
$docInfo
;

156 
$tÙ®F»q
=(
$tÙ®Hi
+1)*
$tÙ®F»qLo
 + 
$tÙ®F»qHi
;

157 
$couÁ
=
$¡¬t
;$couÁ<(
$¡©sLi¡
);$count++)

159 
$¡©Info
 = &
$¡©sLi¡
[
$couÁ
];

160 
$muÉl›r
 = 1;

162 ià(
$¡©Info
["fuÎ"]è
$muÉl›r
=2;

163 
$i
=0;$i<(
$¡©Info
["docs"]);$i++)

165 
$docInfo
 = &
$¡©Info
["docs"];

167 
$äeq
=
$docInfo
[
$i
]["freq"];

168 ià(
$docInfo
[
$i
]["hi"])

170 
$¡©Info
["docs"][
$i
]["rank"]=

171 ()(
$äeq
*
$muÉl›r
+
$tÙ®F»qLo
)/
$tÙ®F»q
;

175 
$¡©Info
["docs"][
$i
]["rank"]=

176 ()(
$äeq
*
$muÉl›r
)/
$tÙ®F»q
;

182  
$¡©sLi¡
;

183 
	}
}

185 
funùiÚ
 
	$combše_»suÉs
(
$»suÉs
,&
$docs
)

187 
	`fÜ—ch
 (
$»suÉs
 
as
 
$wÜdInfo
)

189 
$docsLi¡
 = &
$wÜdInfo
["docs"];

190 
	`fÜ—ch
 (
$docsLi¡
 
as
 
$di
)

192 
$key
=
$di
["url"];

193 
$¿nk
=
$di
["rank"];

194 ià(
	`is£t
(
$docs
[
$key
]))

196 
$docs
[
$key
]["¿nk"]+=
$¿nk
;

200 
$docs
[
$key
] = 
	`¬¿y
("url"=>$key,

201 "Çme"=>
$di
["name"],

202 "¿nk"=>
$¿nk


205 
$docs
[
$key
]["wÜds"][] = 
	`¬¿y
(

206 "wÜd"=>
$wÜdInfo
["word"],

207 "m©ch"=>
$wÜdInfo
["match"],

208 "äeq"=>
$di
["freq"]

212  
$docs
;

213 
	}
}

215 
funùiÚ
 
	$f‹r_»suÉs
(
$docs
,&
$»quœedWÜds
,&
$fÜbidd’WÜds
)

217 
$f‹»dDocs
=
	`¬¿y
();

218 
	`li¡
 (
$key
, 
$v®
èğ
	`—ch
 (
$docs
))

220 
$wÜds
 = &
$docs
[
$key
]["words"];

221 
$cİy
=1;

222 ià((
$»quœedWÜds
)>0)

224 
	`fÜ—ch
 (
$»quœedWÜds
 
as
 
$»qWÜd
)

226 
$found
=0;

227 
	`fÜ—ch
 (
$wÜds
 
as
 
$wÜdInfo
)

229 
$found
 = 
$wÜdInfo
["wÜd"]==
$»qWÜd
;

230 ià(
$found
) ;

232 ià(!
$found
)

234 
$cİy
=0;

239 ià((
$fÜbidd’WÜds
)>0)

241 
	`fÜ—ch
 (
$wÜds
 
as
 
$wÜdInfo
)

243 ià(
	`š_¬¿y
(
$wÜdInfo
["wÜd"],
$fÜbidd’WÜds
))

245 
$cİy
=0;

250 ià(
$cİy
è
$f‹»dDocs
[
$key
]=
$docs
[$key];

252  
$f‹»dDocs
;

253 
	}
}

255 
funùiÚ
 
	$com·»_¿nk
(
$a
,
$b
)

257 ià(
$a
["¿nk"] =ğ
$b
["rank"])

261  (
$a
["¿nk"]>
$b
["rank"]) ? -1 : 1;

262 
	}
}

264 
funùiÚ
 
	$sÜt_»suÉs
(
$docs
,&
$sÜ‹d
)

266 
$sÜ‹d
 = 
$docs
;

267 
	`usÜt
(
$sÜ‹d
,"compare_rank");

268  
$sÜ‹d
;

269 
	}
}

271 
funùiÚ
 
	$»pÜt_»suÉs
(&
$docs
)

273 
echo
 "<div class=\"header\">";

274 
echo
 " <div class=\"headertitle\">\n";

275 
echo
 " <h1>".
	`£¬ch_»suÉs
()."</h1>\n";

276 
echo
 " </div>\n";

277 
echo
 "</div>\n";

278 
echo
 "<div class=\"searchresults\">\n";

279 
echo
 "<table cellspacing=\"2\">\n";

280 
$numDocs
 = (
$docs
);

281 ià(
$numDocs
==0)

283 
echo
 " <tr>\n";

284 
echo
 " <td cŞ¥ª=\"2\">".
	`m©ches_‹xt
(0)."</td>\n";

285 
echo
 " </tr>\n";

289 
echo
 " <tr>\n";

290 
echo
 " <td cŞ¥ª=\"2\">".
	`m©ches_‹xt
(
$numDocs
);

291 
echo
 "\n";

292 
echo
 " </td>\n";

293 
echo
 " </tr>\n";

294 
$num
=1;

295 
	`fÜ—ch
 (
$docs
 
as
 
$doc
)

297 
echo
 " <tr>\n";

298 
echo
 " <td‡lign=\"right\">$num.</td>";

299 
echo
 "<td><¨şass=\"–\" h»f=\"".
$doc
["url"]."\">".$doc["name"]."</a></td>\n";

300 
echo
 " <tr>\n";

301 
echo
 " <td></td><td cÏss=\"tšy\">".
	`»pÜt_m©ches
()." ";

302 
	`fÜ—ch
 (
$doc
["wÜds"] 
as
 
$wÜdInfo
)

304 
$wÜd
 = 
$wÜdInfo
["word"];

305 
$m©chRight
 = 
	`sub¡r
(
$wÜdInfo
["m©ch"],
	`¡¾’
(
$wÜd
));

306 
echo
 "<b>$wÜd</b>$m©chRight(".
$wÜdInfo
["freq"].") ";

308 
echo
 " </td>\n";

309 
echo
 " </tr>\n";

310 
$num
++;

313 
echo
 "</table>\n";

314 
echo
 "</div>\n";

315 
	}
}

317 
funùiÚ
 
	$run_qu”y
(
$qu”y
)

319 if(
	`¡rcmp
('4.1.0', 
	`phpv”siÚ
()) > 0)

321 
	`d›
("Error: PHP version 4.1.0 or‡bove„equired!");

323 ià(!(
$fe
=
	`fİ’
("search/search.idx","rb")))

325 
	`d›
("Error: Search index file could NOT be opened!");

327 ià(
	`»adH—d”
(
$fe
)!="DOXS")

329 
	`d›
("Error: Header of index file is invalid!");

331 
$»suÉs
 = 
	`¬¿y
();

332 
$»quœedWÜds
 = 
	`¬¿y
();

333 
$fÜbidd’WÜds
 = 
	`¬¿y
();

334 
$foundWÜds
 = 
	`¬¿y
();

335 
$wÜd
=
	`¡¹ok
(
$qu”y
," ");

336 
$wÜd
)

338 ià((
$wÜd
{0}=='+')è{ $wÜd=
	`sub¡r
($wÜd,1); 
$»quœedWÜds
[]=$word; }

339 ià((
$wÜd
{0}=='-')è{ $wÜd=
	`sub¡r
($wÜd,1); 
$fÜbidd’WÜds
[]=$word; }

340 ià(!
	`š_¬¿y
(
$wÜd
,
$foundWÜds
))

342 
$foundWÜds
[]=
$wÜd
;

343 
	`£¬ch
(
$fe
,
	`¡¹Şow”
(
$wÜd
),
$»suÉs
);

345 
$wÜd
=
	`¡¹ok
(" ");

347 
	`fşo£
(
$fe
);

348 
$docs
 = 
	`¬¿y
();

349 
	`combše_»suÉs
(
$»suÉs
,
$docs
);

352 
$f‹»dDocs
 = 
	`f‹r_»suÉs
(
$docs
,
$»quœedWÜds
,
$fÜbidd’WÜds
);

354 
$sÜ‹d
 = 
	`¬¿y
();

355 
	`sÜt_»suÉs
(
$f‹»dDocs
,
$sÜ‹d
);

356  
$sÜ‹d
;

357 
	}
}

359 
funùiÚ
 
	$maš
()

361 
$qu”y
 = "";

362 ià(
	`¬¿y_key_exi¡s
("qu”y", 
$_GET
))

364 
$qu”y
=
$_GET
["query"];

366 
$sÜ‹d
 = 
	`run_qu”y
(
$qu”y
);

369 
	`’d_fÜm
(
	`´eg_»¶aû
("/[^a-zA-Z0-9\-\_\.]/i", " ", 
$qu”y
 ));

371 
	`»pÜt_»suÉs
(
$sÜ‹d
);

372 
	`’d_·ge
();

373 
	}
}

374 </
	gsüt
>

	@docs/doxygen/html/search-opensearch.php

1 <
süt
 
	gÏnguage
="PHP">

2 
»quœe
 "search-functions.php";

4 
	g$mode
 = 
¬¿y_key_exi¡s
('v', 
$_GET
)?
	g$_GET
['v']:"";

5 
	g$qu”y
 = 
¬¿y_key_exi¡s
('qu”y', 
$_GET
)?
	g$_GET
['query']:"";

7 
	g$qu”y_»suÉs
 = 
run_qu”y
(
$qu”y
);

9 
$mode
)

12 
	`İ’£¬ch_desütiÚ
();

15 
	`İ’£¬ch_jsÚ_»suÉs
(
$qu”y
, 
$qu”y_»suÉs
);

18 
	`İ’£¬ch_xml_»suÉs
(
$qu”y
, 
$qu”y_»suÉs
);

21 
	`šv®id_fÜm©
(
$qu”y
, 
$qu”y_»suÉs
);

23 
	}
}

25 
funùiÚ
 
	$İ’£¬ch_desütiÚ
()

27 
glob®
 
$cÚfig
;

28 
glob®
 
$Œª¦©Ü
;

30 
$shÜŠame
 = 
$Œª¦©Ü
['£¬ch']." ".
$cÚfig
['PROJECT_NAME'];

31 
$lšk
 = "h‰p://".
$_SERVER
['HTTP_HOST'].
	`dœÇme
($_SERVER['SCRIPT_NAME']);

32 
	`h—d”
("Content-Type:‡pplication/xml");

33 
echo
 <<<
END_OPENSEARCH


34 <?
xml
 
v”siÚ
="1.0" 
’codšg
="UTF-8"?>

35 <
O³nS—rchDesütiÚ
 
xmÊs
="http://a9.com/-/spec/opensearch/1.1/">

36 <
ShÜtName
>
$shÜŠame
</ShortName>

37 <
DesütiÚ
>
Doxyg’
 
S—rch
</Description>

38 <
IÅutEncodšg
>
UTF
-8</InputEncoding>

40 <
Image
 
height
="16" 
width
="16" 
ty³
="image/x-icon">

41 
h‰p
:

43 <
U¾
 
ty³
="‹xt/html" 
m‘hod
="GET"

44 
‹m¶©e
="$link/search.php?query={searchTerms}" />

45 <
U¾
 
ty³
="­¶iÿtiÚ/x-sugge¡iÚs+jsÚ" 
m‘hod
="GET"

46 
‹m¶©e
="$link/search-opensearch.php?v=json&amp;query={searchTerms}" />

47 <
U¾
 
ty³
="­¶iÿtiÚ/x-sugge¡iÚs+xml" 
m‘hod
="GET"

48 
‹m¶©e
="$link/search-opensearch.php?v=xml&amp;query={searchTerms}" />

49 </
O³nS—rchDesütiÚ
>

50 
END_OPENSEARCH
;

51 
	}
}

53 
funùiÚ
 
	$İ’£¬ch_xml_»suÉs
(
$qu”y
, 
¬¿y
 
$»suÉs
)

58 
$qs_»suÉs
 = 
	`¬¿y
();

59 
	`fÜ—ch
 (
$»suÉs
 
as
 
$i
 => 
$v®
)

61 
	`fÜ—ch
 (
$v®
['wÜds'] 
as
 
$j
 => 
$wÜd
)

63 ià(
	`¬¿y_key_exi¡s
(
$wÜd
, 
$qs_»suÉs
))

64 
$qs_»suÉs
[
$wÜd
['match']]++;

66 
$qs_»suÉs
[
$wÜd
['match']] = 1;

69 
$»suÉ
 = <<<
END_FRAG


70 <?
xml
 
v”siÚ
="1.0"?>

71 <
S—rchSugge¡iÚ
 
xmÊs
="http://schemas.microsoft.com/Search/2008/suggestions">

72 <
Qu”y
>
$qu”y
</Query>

73 <
SeùiÚ
>

74 
END_FRAG
;

75 
	`fÜ—ch
 (
$qs_»suÉs
 
as
 
$wÜd
 => 
$couÁ
)

77 
$»suÉ
 .ğ<<<
END_FRAG


78 <
I‹m
>

79 <
Text
>
$wÜd
</Text>

80 <
DesütiÚ
>
$couÁ
 
»suÉs
</Description>

81 </
I‹m
>

82 
END_FRAG
;

84 
$»suÉ
 .ğ<<<
END_FRAG


85 </
SeùiÚ
>

86 </
S—rchSugge¡iÚ
>

87 
END_FRAG
;

88 
echo
 
$»suÉ
;

89 
	}
}

91 
funùiÚ
 
	$İ’£¬ch_jsÚ_»suÉs
(
$qu”y
, 
¬¿y
 
$»suÉs
)

93 
$qs_»suÉs
 = 
	`¬¿y
();

94 
	`fÜ—ch
 (
$»suÉs
 
as
 
$i
 => 
$v®
)

96 
	`fÜ—ch
 (
$v®
['wÜds'] 
as
 
$j
 => 
$wÜd
)

98 ià(
	`¬¿y_key_exi¡s
(
$wÜd
, 
$qs_»suÉs
))

99 
$qs_»suÉs
[
$wÜd
['match']]++;

101 
$qs_»suÉs
[
$wÜd
['match']] = 1;

104 
$»suÉ
 = '["'.
$qu”y
.'", [';

105 
$jsÚ_wÜds
 = "";

106 
$jsÚ_desütiÚs
 = "";

107 
$i
 = 0;

108 
	`fÜ—ch
 (
$qs_»suÉs
 
as
 
$wÜd
 => 
$couÁ
)

110 ià(
$i
 != 0)

112 
$jsÚ_wÜds
 .= ", ";

113 
$jsÚ_desütiÚs
 .= ", ";

115 
$jsÚ_wÜds
 .ğ'"'.
$wÜd
.'"';

116 
$jsÚ_desütiÚs
 .ğ'"'.
$couÁ
.'„esult'.($count==1?'':'s').'"';

117 
$i
++;

119 
´št
 "[\"$query\", [$json_words],[$json_descriptions]]";

120 
	}
}

122 
funùiÚ
 
	$šv®id_fÜm©
(
$qu”y
, 
¬¿y
 
$»suÉs
)

124 
´št
 "Search„esults for '$query':\n\n";

125 
	`´št_r
(
$»suÉs
);

126 
	}
}

127 </
	gsüt
>

	@docs/doxygen/html/search.php

1 <!
DOCTYPE
 
html
 
	gPUBLIC
 "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

2 <
html
 
	gxmÊs
="http://www.w3.org/1999/xhtml">

3 <
h—d
>

4 <
m‘a
 
h‰p
-
equiv
="CÚ‹Á-Ty³" 
cÚ‹Á
="text/xhtml;charset=UTF-8"/>

5 <
m‘a
 
h‰p
-
equiv
="X-UA-Com·tibË" 
cÚ‹Á
="IE=9"/>

6 <
t™Ë
>
gcm
: 
S—rch
</title>

8 <
lšk
 
h»f
="bs.css" 
»l
="¡yËsh“t" 
ty³
="text/css"/>

9 <
lšk
 
h»f
="doxyg’.css" 
»l
="¡yËsh“t" 
ty³
="text/css" />

11 <
lšk
 
h»f
="£¬ch/£¬ch.css" 
»l
="¡yËsh“t" 
ty³
="text/css"/>

12 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="jquery.js"></script>

13 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="search/search.js"></script>

14 <
süt
 
ty³
="text/javascript">

15 
$
(
docum’t
).
»ady
(
	$funùiÚ
() {

16 ià(
	`$
('.£¬ch»suÉs').
Ëngth
 > 0è{ 
£¬chBox
.
	`DOMS—rchF›ld
().
	`focus
(); }

17 
	}
});

18 </
	gsüt
>

19 <
lšk
 
	g»l
="£¬ch" 
h»f
="£¬ch-İ’£¬ch.php?v=İ’£¬ch.xml" 
ty³
="­¶iÿtiÚ/İ’£¬chdesütiÚ+xml" 
t™Ë
="gcm"/>

21 </
h—d
>

22 <
body
>

23 <
div
 
id
="tİ"><!-- dØ
nÙ
 
»move
 
this
 div! -->

26 <
div
 
id
="titlearea">

27 <
bË
 
ûÎ¥acšg
="0" 
ûÎ·ddšg
="0">

28 <
tbody
>

29 <
Œ
 
¡yË
="height: 56px;">

32 <
td
 
¡yË
="padding-left: 0.5em;">

33 <
div
 
id
="´ojeùÇme">
gcm


34 &#160;<
¥ª
 
	gid
="projectnumber">3</span>

35 </
div
>

37 </
td
>

41 </
Œ
>

42 </
tbody
>

43 </
bË
>

44 </
div
>

46 <!-- 
G’”ado
 
pÜ
 
Doxyg’
 1.8.0 -->

47 <
süt
 
ty³
="text/javascript">

48 
v¬
 
£¬chBox
 = 
Ãw
 
S—rchBox
("£¬chBox", "£¬ch",
çl£
,'Buscar');

49 </
	gsüt
>

50 <
div
 
	gid
="Çvrow1" 
şass
="tabs">

51 <
ul
 
şass
="tablist">

52 <
li
><
a
 
h»f
="šdex.html"><
¥ª
>
P
Ã¡
gša
&#160;
	g´šc®
</
	g¥ª
></
	ga
></
	gli
>

53 <
	gli
><
a
 
	gh»f
="·ges.html"><
¥ª
>
P
Ã¡
gšas
&#160;
	g»ÏciÚadas
</
	g¥ª
></
	ga
></li>

54 <
	gli
><
a
 
	gh»f
="moduËs.html"><
¥ª
>
M
Ã³
dulos
</¥ª></a></
li
>

55 <
li
><
a
 
h»f
="Çme¥aûs.html"><
¥ª
>
Name¥aûs
</span></a></li>

56 <
li
><
a
 
h»f
="ªnÙ©ed.html"><
¥ª
>
E¡ruùu¿s
&#160;
	gde
&#160;
	gD©os
</
	g¥ª
></
	ga
></
	gli
>

57 <
	gli
><
a
 
	gh»f
="fes.html"><
¥ª
>
Archivos
</¥ª></a></
li
>

58 <
li
><
a
 
h»f
="dœs.html"><
¥ª
>
DœeùÜios
</span></a></li>

59 <
li
>

60 <
div
 
id
="MS—rchBox" 
şass
="MSearchBoxInactive">

61 <
div
 
şass
="left">

62 <
fÜm
 
id
="FS—rchBox" 
aùiÚ
="£¬ch.php" 
m‘hod
="get">

63 <
img
 
id
="MS—rchS–eù" 
¤c
="£¬ch/mag.²g" 
®t
=""/>

64 <
süt
 
Ïnguage
="php">

65 
»quœe_Úû
 "search-functions.php";

66 
maš
();

67 </
	gsüt
>

70 <
hr
 
	gşass
="foÙ”"/><
add»ss
 
şass
="foÙ”"><
sm®l
>

71 
G’”ado
 
–
 
LuÃs
, 29 
de
 
Abr
 
	gde
 2013 09:33:58 
·¿
 
gcm
 
pÜ
 &#160;<
a
 
	gh»f
="http://www.doxygen.org/index.html">

72 <
img
 
şass
="foÙ”" 
¤c
="doxyg’.²g" 
®t
="doxygen"/>

73 </
a
> 1.8.0

74 </
sm®l
></
add»ss
>

76 </
body
>

77 </
html
>

	@gcm/DATOS/config/administradores/administradores.php

1 <?
php


2 
	g$admši¡¿dÜes
[] = "mamedu|@|kkkk";

	@gcm/DATOS/config/administradores/administradores_es.php

1 
	g$admši¡¿dÜes_DESC
 = '<usuario>|@|<contraseÃ±a> del superusuario (root)';

	@gcm/DATOS/idiomas/GCM_LG_ca.php

1 <?
php


3 
	g$GCM_LG_ÿ
['Administracion de†os diferentes idiomas']='';

4 
	g$GCM_LG_ÿ
['AdministraciÃ³n']='';

5 
	g$GCM_LG_ÿ
['AdministraciÃ³n de usuarios']='';

6 
	g$GCM_LG_ÿ
['Administrar imÃ¡genes']='';

7 
	g$GCM_LG_ÿ
['Administrar…royecto']='';

8 
	g$GCM_LG_ÿ
['AÃ±adir']='';

9 
	g$GCM_LG_ÿ
['Borrar cache']='';

10 
	g$GCM_LG_ÿ
['Borrar documento‡ctual']='';

11 
	g$GCM_LG_ÿ
['Borrar secciÃ³n']='';

12 
	g$GCM_LG_ÿ
['Cambiar‚ombre de documento‡ctual']='';

13 
	g$GCM_LG_ÿ
['Cambiar‚ombre de secciÃ³n‡ctual']='';

14 
	g$GCM_LG_ÿ
['Cerrar sessiÃ³n']='';

15 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n']='';

16 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de ']='';

17 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de‡dmin']='';

18 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de contenidos']='';

19 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de idiomas']='';

20 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de imagenes']='';

21 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de indexador']='';

22 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de menu']='';

23 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de metatags']='';

24 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n deemas']='';

25 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n guardada']='';

26 
	g$GCM_LG_ÿ
['Configurar…royecto']='';

27 
	g$GCM_LG_ÿ
['Contenido']='';

28 
	g$GCM_LG_ÿ
['Contenido…endiente deraducciÃ³n']='';

29 
	g$GCM_LG_ÿ
['Contenidoraducido']='';

30 
	g$GCM_LG_ÿ
['Contenidos']='';

31 
	g$GCM_LG_ÿ
['ContraseÃ±a']='';

32 
	g$GCM_LG_ÿ
['Crear‚uevo contenido']='';

33 
	g$GCM_LG_ÿ
['Crear una‚ueva secciÃ³n']='';

34 
	g$GCM_LG_ÿ
['Editar']='';

35 
	g$GCM_LG_ÿ
['Editar constantes']='';

36 
	g$GCM_LG_ÿ
['Editar documento‡ctual']='';

37 
	g$GCM_LG_ÿ
['Editar ficheros del…royecto']='';

38 
	g$GCM_LG_ÿ
['Editar informaciÃ³n de usuario']='';

39 
	g$GCM_LG_ÿ
['Editar†iterales']='';

40 
	g$GCM_LG_ÿ
['Ejecutarests']='';

41 
	g$GCM_LG_ÿ
['Enviarƒrror']='';

42 
	g$GCM_LG_ÿ
['Filtrar']='';

43 
	g$GCM_LG_ÿ
['Filtro']='';

44 
	g$GCM_LG_ÿ
['Gracias']='';

45 
	g$GCM_LG_ÿ
['Guardar contenido con otro‚ombre']='';

46 
	g$GCM_LG_ÿ
['ImÃ¡genes']='';

47 
	g$GCM_LG_ÿ
['InformaciÃ³n de servidor']='';

48 
	g$GCM_LG_ÿ
['Informar deƒrror']='';

49 
	g$GCM_LG_ÿ
['Informe deƒrrores']='';

50 
	g$GCM_LG_ÿ
['Listado de comentarios']='';

51 
	g$GCM_LG_ÿ
['Listar contenido']='';

52 
	g$GCM_LG_ÿ
['Literales']='';

53 
	g$GCM_LG_ÿ
['MenÃº']='';

54 
	g$GCM_LG_ÿ
['Mover o cambiar‚ombre de contenido']='';

55 
	g$GCM_LG_ÿ
['MÃ³dulos']='';

56 
	g$GCM_LG_ÿ
['Nombre']='';

57 
	g$GCM_LG_ÿ
['Por favor‡Ã±adeoda†a informaciÃ³n que…uedas„especto‡†a‡cciÃ³n que seƒstaba„ealizandoƒnƒl momento delƒrror']='';

58 
	g$GCM_LG_ÿ
['Registros']='';

59 
	g$GCM_LG_ÿ
['Registros de…Ã¡gina‡ctual']='';

60 
	g$GCM_LG_ÿ
['Reindexarƒl contenido']='';

61 
	g$GCM_LG_ÿ
['Renombrar o mover secciÃ³n‡ctual']='';

62 
	g$GCM_LG_ÿ
['Salir']='';

63 
	g$GCM_LG_ÿ
['Seguimiento']='';

64 
	g$GCM_LG_ÿ
['Seguimiento del…royecto']='';

65 
	g$GCM_LG_ÿ
['Sin secciÃ³n']='';

66 
	g$GCM_LG_ÿ
['Subir imagen‡ ']='';

67 
	g$GCM_LG_ÿ
['Traducir documento‡ctual']='';

68 
	g$GCM_LG_ÿ
['VisualizaciÃ³n de†os„egistros de†a‡plicaciÃ³n']='';

69 
	g$GCM_LG_ÿ
['Visualizar conexionesƒntre Eventos y mÃ³dulos']='';

70 
	g$GCM_LG_ÿ
['admin']='';

71 
	g$GCM_LG_ÿ
['contenidos']='';

72 
	g$GCM_LG_ÿ
['de']='';

73 
	g$GCM_LG_ÿ
['idioma']='catala';

74 
	g$GCM_LG_ÿ
['idiomas']='';

75 
	g$GCM_LG_ÿ
['imagenes']='';

76 
	g$GCM_LG_ÿ
['indexador']='';

77 
	g$GCM_LG_ÿ
['menu']='';

78 
	g$GCM_LG_ÿ
['metatags']='';

79 
	g$GCM_LG_ÿ
['temas']='';

80 
	g$GCM_LG_ÿ
['Ãšltimasƒntradasƒn']='';

81 
	g$GCM_LG_ÿ
['Campo obligatorio']='';

82 
	g$GCM_LG_ÿ
['Longitud mÃ¡xima']='';

83 
	g$GCM_LG_ÿ
['Registrosƒn base de datos']='';

84 
	g$GCM_LG_ÿ
['GalerÃ­a de imÃ¡genes']='';

85 
	g$GCM_LG_ÿ
['Insertar']='';

86 
	g$GCM_LG_ÿ
['comentarios']='';

87 
	g$GCM_LG_ÿ
['ver_registros']='';

88 
	g$GCM_LG_ÿ
['AdministraciÃ³n de„oles']='';

89 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de comentarios']='';

90 
	g$GCM_LG_ÿ
['ConfiguraciÃ³n de ver_registros']='';

	@gcm/DATOS/idiomas/GCM_LG_en.php

1 <?
php


3 
	g$GCM_LG_’
['Contenido…endiente deraducciÃ³n']='';

4 
	g$GCM_LG_’
['Registros de…Ã¡gina‡ctual']='';

5 
	g$GCM_LG_’
['Registros']='';

6 
	g$GCM_LG_’
['Sin Contenido']='';

	@gcm/DATOS/idiomas/GCM_LG_es.php

1 <?
php


3 
	g$GCM_LG_es
['MenÃº']='';

4 
	g$GCM_LG_es
['Usuario']='';

5 
	g$GCM_LG_es
['ContraseÃ±a']='';

6 
	g$GCM_LG_es
['Ãšltimasƒntradasƒn']='';

7 
	g$GCM_LG_es
['Sin Contenido']='';

8 
	g$GCM_LG_es
['noƒncontrado']='';

9 
	g$GCM_LG_es
['Sin secciÃ³n']='';

10 
	g$GCM_LG_es
['SecciÃ³n']='';

11 
	g$GCM_LG_es
['noƒncontrada']='';

12 
	g$GCM_LG_es
['Registros de…Ã¡gina‡ctual']='';

13 
	g$GCM_LG_es
['Registros']='';

14 
	g$GCM_LG_es
['Longitud mÃ¡xima']='';

15 
	g$GCM_LG_es
['El correo‚o…arece valido']='';

16 
	g$GCM_LG_es
['Traducir documento‡ctual']='';

17 
	g$GCM_LG_es
['MÃ³dulos']='';

18 
	g$GCM_LG_es
['admin']='';

19 
	g$GCM_LG_es
['ConfiguraciÃ³n de ']='';

20 
	g$GCM_LG_es
['comentarios']='';

21 
	g$GCM_LG_es
['contenidos']='';

22 
	g$GCM_LG_es
['idiomas']='';

23 
	g$GCM_LG_es
['imagenes']='';

24 
	g$GCM_LG_es
['indexador']='';

25 
	g$GCM_LG_es
['menu']='';

26 
	g$GCM_LG_es
['metatags']='';

27 
	g$GCM_LG_es
['temas']='';

28 
	g$GCM_LG_es
['ver_registros']='';

29 
	g$GCM_LG_es
['Configurar…royecto']='';

30 
	g$GCM_LG_es
['ConfiguraciÃ³n']='';

31 
	g$GCM_LG_es
['Editar constantes']='';

32 
	g$GCM_LG_es
['Editar†iterales']='';

33 
	g$GCM_LG_es
['Seguimiento del…royecto']='';

34 
	g$GCM_LG_es
['Seguimiento']='';

35 
	g$GCM_LG_es
['Reindexarƒl contenido']='';

36 
	g$GCM_LG_es
['VisualizaciÃ³n de†os„egistros de†a‡plicaciÃ³n']='';

37 
	g$GCM_LG_es
['Administrar…royecto']='';

38 
	g$GCM_LG_es
['AdministraciÃ³n']='';

39 
	g$GCM_LG_es
['Listado de comentarios']='';

40 
	g$GCM_LG_es
['Editar informaciÃ³n de usuario']='';

41 
	g$GCM_LG_es
['AdministraciÃ³n de usuarios']='';

42 
	g$GCM_LG_es
['InformaciÃ³n de servidor']='';

43 
	g$GCM_LG_es
['Ejecutarests']='';

44 
	g$GCM_LG_es
['Visualizar conexionesƒntre Eventos y mÃ³dulos']='';

45 
	g$GCM_LG_es
['Borrar cache']='';

46 
	g$GCM_LG_es
['ConfiguraciÃ³n de imagenes']='';

47 
	g$GCM_LG_es
['ConfiguraciÃ³n de indexador']='';

48 
	g$GCM_LG_es
['ConfiguraciÃ³n de menu']='';

49 
	g$GCM_LG_es
['ConfiguraciÃ³n de metatags']='';

50 
	g$GCM_LG_es
['ConfiguraciÃ³n deemas']='';

51 
	g$GCM_LG_es
['ConfiguraciÃ³n de ver_registros']='';

52 
	g$GCM_LG_es
['ImÃ¡genes']='';

53 
	g$GCM_LG_es
['AÃ±adir']='';

54 
	g$GCM_LG_es
['Filtrar']='';

55 
	g$GCM_LG_es
['Literales']='';

56 
	g$GCM_LG_es
['Informar deƒrror']='';

57 
	g$GCM_LG_es
['Por favor‡Ã±adeoda†a informaciÃ³n que…uedas„especto‡†a‡cciÃ³n que seƒstaba„ealizandoƒnƒl momento delƒrror']='';

58 
	g$GCM_LG_es
['Gracias']='';

59 
	g$GCM_LG_es
['Enviarƒrror']='';

60 
	g$GCM_LG_es
['Informe deƒrrores']='';

61 
	g$GCM_LG_es
['AdministraciÃ³n deemas']='';

62 
	g$GCM_LG_es
['Temas‡ctual']='';

63 
	g$GCM_LG_es
['Seleccionaema']='';

64 
	g$GCM_LG_es
['CreaciÃ³n de unema‚uevo']='';

65 
	g$GCM_LG_es
['Nuevoema']='';

66 
	g$GCM_LG_es
['Editar ficheros deema']='';

67 
	g$GCM_LG_es
['Ficheros…or defecto']='';

68 
	g$GCM_LG_es
['Ficheros deema']='';

69 
	g$GCM_LG_es
['Subir fichero…royecto.css modificado']='';

70 
	g$GCM_LG_es
['Guardar colores']='';

71 
	g$GCM_LG_es
['AÃ±adir un color']='';

72 
	g$GCM_LG_es
['ConfiguraciÃ³n deemas_old']='';

73 
	g$GCM_LG_es
['Acciones']='';

74 
	g$GCM_LG_es
['Guardar']='';

75 
	g$GCM_LG_es
['Constantes']='';

76 
	g$GCM_LG_es
['AÃ±adirƒmail oculto‡†os spammers']='';

77 
	g$GCM_LG_es
['Nombre‡ mostrar']='';

78 
	g$GCM_LG_es
['Email']='';

79 
	g$GCM_LG_es
['Insertar']='';

80 
	g$GCM_LG_es
['Contenido‡ctualizado']='';

81 
	g$GCM_LG_es
['Guardar contenido']='';

82 
	g$GCM_LG_es
['Nombre de secciÃ³n']='';

83 
	g$GCM_LG_es
['Ejecutar']='';

84 
	g$GCM_LG_es
['Renombrar o mover contenido']='';

85 
	g$GCM_LG_es
['TÃ­tulo']='';

86 
	g$GCM_LG_es
['TÃ­tulo del contenido']='';

87 
	g$GCM_LG_es
['Contenido„enombrado o movido']='';

88 
	g$GCM_LG_es
['Administrar imÃ¡genes']='';

89 
	g$GCM_LG_es
['Editar ficheros del…royecto']='';

90 
	g$GCM_LG_es
['Administracion de†os diferentes idiomas']='';

91 
	g$GCM_LG_es
['Contenidos']='';

92 
	g$GCM_LG_es
['Crear‚uevo contenido']='';

93 
	g$GCM_LG_es
['Editar documento‡ctual']='';

94 
	g$GCM_LG_es
['Borrar documento‡ctual']='';

95 
	g$GCM_LG_es
['Mover o cambiar‚ombre de contenido']='';

96 
	g$GCM_LG_es
['Guardar contenido con otro‚ombre']='';

97 
	g$GCM_LG_es
['Crear una‚ueva secciÃ³n']='';

98 
	g$GCM_LG_es
['Renombrar o mover secciÃ³n‡ctual']='';

99 
	g$GCM_LG_es
['Borrar secciÃ³n']='';

100 
	g$GCM_LG_es
['Listar contenido']='';

101 
	g$GCM_LG_es
['Cerrar sessiÃ³n']='';

102 
	g$GCM_LG_es
['Salir']='';

103 
	g$GCM_LG_es
['ConfiguraciÃ³n de‡dmin']='';

104 
	g$GCM_LG_es
['ConfiguraciÃ³n de comentarios']='';

105 
	g$GCM_LG_es
['ConfiguraciÃ³n de contenidos']='';

106 
	g$GCM_LG_es
['ConfiguraciÃ³n de idiomas']='';

107 
	g$GCM_LG_es
['Listado completo de contenido']='';

108 
	g$GCM_LG_es
['Acciones sobre contenidos']='';

109 
	g$GCM_LG_es
['Borrar']='';

110 
	g$GCM_LG_es
['Cambiar‚ombre']='';

111 
	g$GCM_LG_es
['Filtro']='';

112 
	g$GCM_LG_es
['Campo obligatorio']='';

113 
	g$GCM_LG_es
['Editar']='';

114 
	g$GCM_LG_es
['Cancelar']='';

115 
	g$GCM_LG_es
['Registro incluido']='';

116 
	g$GCM_LG_es
['Registro modificado']='';

117 
	g$GCM_LG_es
['ContraseÃ±a‚o…asa verificaciÃ³n']='';

118 
	g$GCM_LG_es
['Contenido‚uevo']='';

119 
	g$GCM_LG_es
['Contenido‡Ã±adido']='';

120 
	g$GCM_LG_es
['AdministraciÃ³n de„oles']='';

121 
	g$GCM_LG_es
['eduardotrabajos']='';

	@gcm/DATOS/idiomas/GCM_LG_fr.php

1 <?
php


3 
	g$GCM_LG_ä
['Registros de…Ã¡gina‡ctual']='';

4 
	g$GCM_LG_ä
['Registros']='';

5 
	g$GCM_LG_ä
['Usuario']='';

6 
	g$GCM_LG_ä
['ContraseÃ±a']='';

7 
	g$GCM_LG_ä
['Traducir documento‡ctual']='';

8 
	g$GCM_LG_ä
['MÃ³dulos']='';

9 
	g$GCM_LG_ä
['admin']='';

10 
	g$GCM_LG_ä
['ConfiguraciÃ³n de ']='';

11 
	g$GCM_LG_ä
['contenidos']='';

12 
	g$GCM_LG_ä
['idiomas']='';

13 
	g$GCM_LG_ä
['imagenes']='';

14 
	g$GCM_LG_ä
['indexador']='';

15 
	g$GCM_LG_ä
['menu']='';

16 
	g$GCM_LG_ä
['metatags']='';

17 
	g$GCM_LG_ä
['temas']='';

18 
	g$GCM_LG_ä
['Contenidos']='';

19 
	g$GCM_LG_ä
['Crear‚uevo contenido']='';

20 
	g$GCM_LG_ä
['Editar documento‡ctual']='';

21 
	g$GCM_LG_ä
['Borrar documento‡ctual']='';

22 
	g$GCM_LG_ä
['Mover o cambiar‚ombre de contenido']='';

23 
	g$GCM_LG_ä
['Guardar contenido con otro‚ombre']='';

24 
	g$GCM_LG_ä
['Crear una‚ueva secciÃ³n']='';

25 
	g$GCM_LG_ä
['Renombrar o mover secciÃ³n‡ctual']='';

26 
	g$GCM_LG_ä
['Borrar secciÃ³n']='';

27 
	g$GCM_LG_ä
['Listar contenido']='';

28 
	g$GCM_LG_ä
['Administrar…royecto']='';

29 
	g$GCM_LG_ä
['AdministraciÃ³n']='';

30 
	g$GCM_LG_ä
['Editar ficheros del…royecto']='';

31 
	g$GCM_LG_ä
['Listado de comentarios']='';

32 
	g$GCM_LG_ä
['Administrar imÃ¡genes']='';

33 
	g$GCM_LG_ä
['Administracion de†os diferentes idiomas']='';

34 
	g$GCM_LG_ä
['Editar informaciÃ³n de usuario']='';

35 
	g$GCM_LG_ä
['AdministraciÃ³n de usuarios']='';

36 
	g$GCM_LG_ä
['InformaciÃ³n de servidor']='';

37 
	g$GCM_LG_ä
['Ejecutarests']='';

38 
	g$GCM_LG_ä
['Visualizar conexionesƒntre Eventos y mÃ³dulos']='';

39 
	g$GCM_LG_ä
['Borrar cache']='';

40 
	g$GCM_LG_ä
['Configurar…royecto']='';

41 
	g$GCM_LG_ä
['ConfiguraciÃ³n']='';

42 
	g$GCM_LG_ä
['Editar constantes']='';

43 
	g$GCM_LG_ä
['Editar†iterales']='';

44 
	g$GCM_LG_ä
['Seguimiento del…royecto']='';

45 
	g$GCM_LG_ä
['Seguimiento']='';

46 
	g$GCM_LG_ä
['VisualizaciÃ³n de†os„egistros de†a‡plicaciÃ³n']='';

47 
	g$GCM_LG_ä
['Reindexarƒl contenido']='';

48 
	g$GCM_LG_ä
['Cerrar sessiÃ³n']='';

49 
	g$GCM_LG_ä
['Salir']='';

50 
	g$GCM_LG_ä
['CatÃ¡logo']='';

51 
	g$GCM_LG_ä
['Administrar…roductos']='';

52 
	g$GCM_LG_ä
['Administrar categorias']='';

53 
	g$GCM_LG_ä
['Administrar…roveedores']='';

54 
	g$GCM_LG_ä
['AdministrarelÃ©fonos']='';

55 
	g$GCM_LG_ä
['Administrar mails']='';

56 
	g$GCM_LG_ä
['ConfiguraciÃ³n de‡dmin']='';

57 
	g$GCM_LG_ä
['ConfiguraciÃ³n de contenidos']='';

58 
	g$GCM_LG_ä
['ConfiguraciÃ³n de idiomas']='';

59 
	g$GCM_LG_ä
['ConfiguraciÃ³n de imagenes']='';

60 
	g$GCM_LG_ä
['ConfiguraciÃ³n de indexador']='';

61 
	g$GCM_LG_ä
['ConfiguraciÃ³n de menu']='';

62 
	g$GCM_LG_ä
['ConfiguraciÃ³n de metatags']='';

63 
	g$GCM_LG_ä
['ConfiguraciÃ³n deemas']='';

64 
	g$GCM_LG_ä
['Subir imagen‡ ']='';

65 
	g$GCM_LG_ä
['ImÃ¡genes']='';

66 
	g$GCM_LG_ä
['Literales']='';

67 
	g$GCM_LG_ä
['Informar deƒrror']='';

68 
	g$GCM_LG_ä
['Por favor‡Ã±adeoda†a informaciÃ³n que…uedas„especto‡†a‡cciÃ³n que seƒstaba„ealizandoƒnƒl momento delƒrror']='';

69 
	g$GCM_LG_ä
['Gracias']='';

70 
	g$GCM_LG_ä
['Enviarƒrror']='';

71 
	g$GCM_LG_ä
['Informe deƒrrores']='';

72 
	g$GCM_LG_ä
['AÃ±adir']='';

73 
	g$GCM_LG_ä
['Filtrar']='';

74 
	g$GCM_LG_ä
['Campo obligatorio']='';

75 
	g$GCM_LG_ä
['Longitud mÃ¡xima']='';

76 
	g$GCM_LG_ä
['Insertar']='';

77 
	g$GCM_LG_ä
['Sin Contenido']='';

78 
	g$GCM_LG_ä
['Sin secciÃ³n']='';

79 
	g$GCM_LG_ä
['MenÃº']='';

80 
	g$GCM_LG_ä
['de']='';

81 
	g$GCM_LG_ä
['ConfiguraciÃ³n guardada']='';

82 
	g$GCM_LG_ä
['Contenido…endiente deraducciÃ³n']='';

83 
	g$GCM_LG_ä
['AdministraciÃ³n deemas']='';

84 
	g$GCM_LG_ä
['Temas‡ctual']='';

85 
	g$GCM_LG_ä
['Seleccionaema']='';

86 
	g$GCM_LG_ä
['CreaciÃ³n de unema‚uevo']='';

87 
	g$GCM_LG_ä
['Nuevoema']='';

88 
	g$GCM_LG_ä
['Editar ficheros deema']='';

89 
	g$GCM_LG_ä
['Ficheros…or defecto']='';

90 
	g$GCM_LG_ä
['Ficheros deema']='';

91 
	g$GCM_LG_ä
['Subir fichero…royecto.css modificado']='';

92 
	g$GCM_LG_ä
['Guardar colores']='';

93 
	g$GCM_LG_ä
['AÃ±adir un color']='';

94 
	g$GCM_LG_ä
['Procesar fichero…royecto.css modificado']='';

95 
	g$GCM_LG_ä
['Idiomas Activados']='';

96 
	g$GCM_LG_ä
['Nuevo idioma']='';

97 
	g$GCM_LG_ä
['Acciones']='';

98 
	g$GCM_LG_ä
['Guardar']='';

99 
	g$GCM_LG_ä
['Constantes']='';

100 
	g$GCM_LG_ä
['AÃ±adirƒmail oculto‡†os spammers']='';

101 
	g$GCM_LG_ä
['Nombre‡ mostrar']='';

102 
	g$GCM_LG_ä
['Email']='';

103 
	g$GCM_LG_ä
['Contenido‡ctualizado']='';

104 
	g$GCM_LG_ä
['Guardar contenido']='';

105 
	g$GCM_LG_ä
['El correo‚o…arece valido']='';

106 
	g$GCM_LG_ä
['Registrosƒn base de datos']='';

107 
	g$GCM_LG_ä
['Filtro']='';

	@gcm/DATOS/idiomas/estadisticas_es.php

1 <?
php


2 
	g$e¡adi¡iÿs_DESC
['EXCLUIR_REFERENCIA']='Host o…aginas web que queremosƒvitar que salgan„eflejadasƒn†as„eferencias';

3 
	g$e¡adi¡iÿs_DESC
['EXCLUIR_CONTADOR']='Hosts o…Ã¡ginas web que queremosƒxcluir del contador';

	@gcm/includes/blank.php

1 <?
php


14 
	g$MODULO
 = (!
em±y
(
$_POST
['modul'])è? $_POST['modul'] : 
$_GET
['modul'];

17 <!
DOCTYPE
 
html
 
	gpublic
 "-//w3c//dtd xhtml 1.0ransitional//en" "http://www.w3.org/tr/xhtml1/dtd/xhtml1-transitional.dtd">

18 <
html
 
	gxmÊs
="http://www.w3.org/1999/xhtml">

20 <!--
autÜ
: 
edu¬do
 
mag¿Ã
-->

21 <!--
ema
: 
edu¬do
@
mamedu
.
com
-->

22 <!--
šicio
.
php
-->

24 <
h—d
>

25 <
m‘a
 
h‰p
-
equiv
="CÚ‹Á-Ty³" 
cÚ‹Á
="text/html; charset=UTF-8">

26 <
m‘a
 
cÚ‹Á
="‹xt/html; ch¬£t=utf-8" 
h‰p
-
equiv
="content-type" />

27 <
m‘a
 
cÚ‹Á
="es-es" 
h‰p
-
equiv
="content-language" />

28 <
m‘a
 
cÚ‹Á
="®l" 
Çme
="robots" />

29 <
lšk
 
ty³
="image/x-icÚ" 
h»f
="çvicÚ.ico" 
»l
="shortcut icon" />

30 <
lšk
 
t™Ë
="GCM" />

31 <
m‘a
 
cÚ‹Á
="Edu¬dØmag¿nÃ©." 
Çme
="author" />

32 <
m‘a
 
cÚ‹Á
="g¶" 
Çme
="copyright" />

34 <
t™Ë
><?=
$MODULO
 ?></title>

35 <
¡yË
 
ty³
="‹xt/css" 
medŸ
="sü“n,…rojeùiÚ">@
impÜt
 "../admš/šşudes/´oyeùos/g’”®.css";</
	g¡yË
>

36 <
¡yË
 
	gty³
="‹xt/css" 
medŸ
="sü“n,…rojeùiÚ">@
impÜt
 "./´oyeùo_css.php";</
	g¡yË
>

37 <
süt
 
	g¤c
='../gcm.js' 
ty³
="‹xt/javasüt" 
Ïnguage
="JavaScript"> </script>

38 </
h—d
>

40 <
body
>

42 <
div
 
id
="principal">

43 <
div
 
id
="contenido">

44 <?
php


46 ià(!
	$em±y
(
$MODULO
)) {

47 
	`šşude
("../admš/modulos/".
$MODULO
."/index.php");

48 
	}
} {

49 
	gecho
 "No hay un modulo definido";

52 </
	gdiv
>

53 </
	gdiv
>

54 </
	gbody
>

55 </
	ghtml
>

	@gcm/includes/login.php

1 <?
php


18 
funùiÚ
 
	$fÜmuÏrio_»gi¡ro
() {

20 ià(! 
	`log—dos
() ) {

21 
$·Ãl
 = 
	`¬¿y
();

22 
$·Ãl
['t™ulo'] = 
	`l™”®
('Administrar');

23 
$·Ãl
['ocuÉo'] = 
TRUE
;

24 
$·Ãl
['href'] = 'javascript:visualizar(\'login\');';

25 
$·Ãl
['subpanel'] ='login';

26 
$·Ãl
['contenido'] =

27 '<fÜm‚ame="’Œada"‡ùiÚ="'.
	`gcm_g’”¬_u¾
().'" method="post">

28 <
br
 />'.literal("Nombre",3).':

29 <
br
 /><
šput
 
ty³
="‹xt" 
size
="10" 
Çme
="logšPro" 
id
="logšPro" 
v®ue
="" />

30 <
br
 />'.literal("ContraseÃ±a",3).':

31 <
br
 /><
šput
 
ty³
="·sswÜd" 
size
="10" 
Çme
="·sswd" 
id
="·sswd" 
v®ue
="" />

32 <
šput
 
ty³
="hidd’" 
Çme
="£Ëùed" 
v®ue
="'.$_SERVER['PHP_SELF'].'" />

33 <
br
 /><br />

34 <
šput
 
ty³
="subm™" 
v®ue
="Entrar" />

35 </
fÜm
>';

37 
Temas
::
	`·Ãl
(
$·Ãl
);

40 
	}
}

53 
funùiÚ
 
	$log—dos
(
$m’§je
=
FALSE
) {

55 
glob®
 
$gcm
;

57 
$´oyeùo
 = 
$gcm
->
	`cÚfig
('admin','Proyecto');

59 iàĞ
	`is£t
(
$_SESSION
["admš-".
$´oyeùo
] ) ) {

61 } 
	`–£if
 ( 
	`is£t
(
$_SESSION
['root']) ) {

64 iàĞ
$m’§je
 ) { 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Acceso solo…ara‡dministradores','AVISO'); }

65  
NULL
 ;

67 
	}
}

80 
funùiÚ
 
	$su³¿dmš
() {

82 
glob®
 
$gcm
 ;

84 
$´oyeùo
 = 
$gcm
->
	`cÚfig
('admin','Proyecto');

86 iàĞ
	`is£t
(
$_SESSION
["admš-".
$´oyeùo
] ) ) {

88 } 
	`–£if
 ( 
	`is£t
(
$_SESSION
['root']) ) {

91  
NULL
 ;

93 
	}
}

	@gcm/inicio.php

1 <?
php


22 
»quœe
(
GCM_DIR
.'lib/int/gcm/lib/Gcm.php');

24 
	g$GCM_LG
 = 
¬¿y
();

25 
	g$LG
 = 
¬¿y
();

27 
	g$gcm
 = 
Ãw
 
Gcm
();

31 
	g$gcm
->
šicŸ
();

	@gcm/js/formulario.js.php

1 <?
php


11 
h—d”
('Content-Type:ext/javascript');

20 
funùiÚ
 
	$š£¹¬_‹xto
(
¬—_‹xto
,
‹xto
) {

22 
v¬
 
šput
 = 
¬—_‹xto
;

23 if(
ty³of
 
docum’t
.
£ËùiÚ
 != 'undefined' && document.selection) {

24 
v¬
 
¡r
 = 
docum’t
.
£ËùiÚ
.
	`ü—‹Rªge
().
‹xt
;

25 
šput
.
	`focus
();

26 
v¬
 
£l
 = 
docum’t
.
£ËùiÚ
.
	`ü—‹Rªge
();

28 
£l
.
‹xt
 = 
‹xto
;

29 
£l
.
	`£Ëù
();

31 }if(
ty³of
 
šput
.
£ËùiÚS¹
 != 'undefined'){

32 
v¬
 
¡¬t
 = 
šput
.
£ËùiÚS¹
;

33 
v¬
 
’d
 = 
šput
.
£ËùiÚEnd
;

34 
v¬
 
šsText
 = 
šput
.
v®ue
.
	`sub¡ršg
(
¡¬t
, 
’d
);

36 
šput
.
v®ue
 = iÅut.v®ue.
	`sub¡r
(0, 
¡¬t
è+ 
‹xto
 + iÅut.v®ue.sub¡r(
’d
);

37 
šput
.
	`focus
();

38 
šput
.
	`£tS–eùiÚRªge
(
¡¬t
+2+
g
.
Ëngth
+
šsText
.length+3+tag.length,start+2+tag.length+insText.length+3+tag.length);

41 
šput
.
v®ue
+=' ['+
g
+']Reemplaceƒsteexto[/'+tag+']';

44 
	}
}

	@gcm/lib/int/GcmConfig/lib/Config.php

1 <?
php


18 
»quœe_Úû
(
GCM_DIR
.'lib/int/GcmConfig/lib/GcmConfigFactory.php');

24 şas 
	cCÚfig
 {

26 
´iv©e
 
	m$¬chivo_cÚfigu¿ciÚ
;

27 
´iv©e
 
	m$cÚfigu¿ciÚ
;

31 
funùiÚ
 
	$__cÚ¡ruù
(
$¬chivo_cÚfigu¿ciÚ
) {

33 
$this
->
¬chivo_cÚfigu¿ciÚ
 = 
$¬chivo_cÚfigu¿ciÚ
;

54 
funùiÚ
 
	$cÚfig
(
$nomb»_v¬ŸbË
, 
$v®Ü
=
FALSE
) {

57 iàĞ!
$v®Ü
 && 
	`is£t
(
$this
->
cÚfigu¿ciÚ
[
$nomb»_v¬ŸbË
]) )  $this->configuracion[$nombre_variable];

59 iàĞ
$v®Ü
 ) {

61 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$$this
->
¬chivo_cÚfigu¿ciÚ
);

63 
$¬r
->
	`£t
(
$nomb»_v¬ŸbË
,
$v®Ü
);

64 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

65 
$this
->
cÚfigu¿ciÚ
[
$nomb»_v¬ŸbË
] = 
$v®Ü
;

69 iàĞ!
	`fe_exi¡s
(
$this
->
¬chivo_cÚfigu¿ciÚ
) ) {

70 
	`d›
 ('ArchivØdcÚfigu¿ciÃ³ÀnØexi¡e: ['.
$this
->
¬chivo_cÚfigu¿ciÚ
.']');

71  
FALSE
;

74 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$this
->
¬chivo_cÚfigu¿ciÚ
);

75 
$v®Ü
 = 
$¬r
->
	`g‘
(
$nomb»_v¬ŸbË
);

76 
$this
->
cÚfigu¿ciÚ
[
$nomb»_v¬ŸbË
] = 
$v®Ü
;

77  
$v®Ü
;

81 
	}
}

	@gcm/lib/int/GcmConfig/lib/GcmConfig.php

1 <?
php


71 şas 
	cGcmCÚfig
 {

73 
´Ùeùed
 
	m$v¬ŸbËs
;

74 
´Ùeùed
 
	m$desüciÚes
;

75 
´Ùeùed
 
	m$desüciÚesxdeãùo
;

76 
´Ùeùed
 
	m$¬chivo
;

87 
´Ùeùed
 
	m$dœeùÜio_desüciÚes
;

89 
´Ùeùed
 
	m$nomb»_¬¿y
;

91 
´iv©e
 
	m$v¬ŸbËs_modifiÿdas
 = 
FALSE
;

92 
´iv©e
 
	m$desüciÚes_modifiÿdas
 = 
FALSE
;

98 
´iv©e
 
	m$desüciÚes_»cogidas
 = 
FALSE
;

100 
public
 
	m$idioma
 = 'es';

101 
public
 
	m$idiomaxdeãùo
 = 'es';

103 
public
 
	m$Üd’¬
 = 
FALSE
;

105 
funùiÚ
 
	$__cÚ¡ruù
(
$¬chivo
) {

107 
$this
->
¬chivo
 = 
$¬chivo
;

108 
$this
->
nomb»_¬¿y
 = 
	`¡r_»¶aû
('.php','',
	`ba£Çme
($this->
¬chivo
));

110 iàĞ!
	`fe_exi¡s
(
$this
->
¬chivo
) ) {

111 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"ArchivØdcÚfigu¿ciÃ³À[".
$this
->
¬chivo
."]‚oƒxiste,†o creamos",'ADMIN');

112 iàĞ! 
	`fe_exi¡s
(
	`dœÇme
(
$this
->
¬chivo
)èè
	`mkdœ_»cursivo
(dirname($this->archivo));

114 
	`šşude
 (
$this
->
¬chivo
);

119 iàĞ! 
	`is£t
(
$
{
$this
->
nomb»_¬¿y
}) ) {

120 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"ArchivØdcÚfigu¿ciÃ³À[".
$this
->
¬chivo
."] sin contenido",'ADMIN');

122 
$this
->
v¬ŸbËs
 = 
$
{$this->
nomb»_¬¿y
};

127 
$this
->
dœeùÜio_desüciÚes
 = 
	`dœÇme
($this->
¬chivo
);

142 
funùiÚ
 
	$qu™¬Utf8
(
$‹xt
) {

143 
$‹xt
 = 
	`¡r_»¶aû
("\\","",$text);

144 
$‹xt
 = 
	`¡r¦ashes
($text);

145 
$‹xt
 = 
	`Œim
($text);

146 
$‹xt
 = 
	`”eg_»¶aû
("Ã¡|Ã |Ã¢|Ã€|Ã|Ã‚", "a", $text);

147 
$‹xt
 = 
	`”eg_»¶aû
("Ã©|Ã¨|Ãª|Ãˆ|Ã‰|ÃŠ", "e", $text);

148 
$‹xt
 = 
	`”eg_»¶aû
("Ã­|Ã¬|Ã®|ÃŒ|Ã|Ã", "i", $text);

149 
$‹xt
 = 
	`”eg_»¶aû
("Ã³|Ã²|Ã´|Ã’|Ã“|Ã”", "o", $text);

150 
$‹xt
 = 
	`”eg_»¶aû
("Ãº|Ã¹|Ã»|Ã¼|Ã™|Ãš|Ã›|Ãœ", "u", $text);

154 (
$‹xt
);

156 
	}
}

160 
funùiÚ
 
	$debug
() {

162 
$§lida
 = "\nVariables: ";

163 
$§lida
 .ğ
	`´št_r
(
$this
->
v¬ŸbËs
,
TRUE
);

164 
$§lida
 .= "\nDescripciones: ";

165 
$§lida
 .ğ
	`´št_r
(
$this
->
desüciÚes
,
TRUE
);

167  
$§lida
;

169 
	}
}

177 
funùiÚ
 
	$dœeùÜio_desüciÚes
(
$¬chivo
) {

179 
$this
->
dœeùÜio_desüciÚes
 = 
$¬chivo
;

181 
	}
}

189 
funùiÚ
 
	$»cog”_desüciÚes
(
$idioma
 = 
NULL
) {

191 
$idioma
 = ( $idiom¨è? $idiom¨: 
$this
->
idioma
 ;

193 iàĞ
$this
->
desüciÚes_»cogidas
[
$idioma
] =ğ
TRUE
 ) {

197 
$this
->
desüciÚes_»cogidas
[
$idioma
] = 
TRUE
;

199 
$¬chivo
 = 
$this
->
dœeùÜio_desüciÚes
.'/'.$this->
nomb»_¬¿y
.'_'.
$idioma
.'.php';

201 iàĞ
	`fe_exi¡s
(
$¬chivo
) ) {

202 
	`šşude
 (
$¬chivo
);

209 
$this
->
desüciÚes
[
$idioma
] = 
$
{$this->
nomb»_¬¿y
.'_DESC'};

211 
	}
}

215 
funùiÚ
 
	$v¬ŸbËs
(è{  
$this
->
v¬ŸbËs
; 
	}
}

219 
funùiÚ
 
	$v¬ŸbËsJSON
() {

221 
$c
 = 0;

222 
	`fÜ—ch
 (
$this
->
v¬ŸbËs
 
as
 
$key
 => 
$v®Ü
 ) {

224 
$»¥ue¡a
->
v¬ŸbËs
[
$c
]['id'] = 
$key
;

225 
$»¥ue¡a
->
v¬ŸbËs
[
$c
]['v®Ü'] = 
$v®Ü
;

226 
$c
++;

230 
echo
 
	`jsÚ_’code
(
$»¥ue¡a
);

231 
	}
}

235 
funùiÚ
 
	$desüciÚes
(
$idioma
 = 
NULL
) {

237 
$idioma
 = ( $idiom¨è? $idiom¨: 
$this
->
idioma
 ;

239  
$this
->
desüciÚes
[
$idioma
];

241 
	}
}

245 
funùiÚ
 
	$v®id¬DesüciÚ
(
$desüciÚ
) {

247 iàĞ! 
$desüciÚ
 )  
FALSE
 ;

248 iàĞ
$desüciÚ
 =ğ'' )  
FALSE
;

254 
$m¬ÿ
 = 
$this
->
idiomaxdeãùo
.'::';

256 iàĞ
	`¡½os
(
$m¬ÿ
,
$desüciÚ
èè 
FALSE
;

258  
TRUE
;

260 
	}
}

269 
funùiÚ
 
	$£t
(
$v¬ŸbË
, 
$v®Ü
) {

271 iàĞ!
	`is£t
(
$v¬ŸbË
è|| 
	`em±y
($variable) ) {

272 
throw
 
Ãw
 
	`Exû±iÚ
('Sin variable‚o…odemos‡Ã±adirƒlementos');

273  
FALSE
;

276 
$this
->
v¬ŸbËs_modifiÿdas
 = 
TRUE
;

278 iàĞ
	`is_¬¿y
(
$v®Ü
)) {

279 
$v¬ŸbË
 = 
	`html_’t™y_decode
($v¬ŸbË,
ENT_NOQUOTES
,'UTF-8');

280 
	`fÜ—ch
 ( 
$v®Ü
 
as
 
$v®
 ) {

281 
$v®
 = 
	`html_’t™y_decode
($v®,
ENT_NOQUOTES
,'UTF-8');

282 
$this
->
v¬ŸbËs
[
$v¬ŸbË
][] = 
$v®
;

285 
$v¬ŸbË
 = 
	`html_’t™y_decode
($v¬ŸbË,
ENT_NOQUOTES
,'UTF-8');

286 
$v®Ü
 = 
	`html_’t™y_decode
($v®Ü,
ENT_NOQUOTES
,'UTF-8');

287 
$this
->
v¬ŸbËs
[
$v¬ŸbË
] = 
$v®Ü
;

290 
	}
}

306 
funùiÚ
 
	$£tDesüciÚ
(
$v¬ŸbË
, 
$desüciÚ
, 
$idioma
 = 
NULL
) {

308 
$desüciÚ
 = 
	`html_’t™y_decode
($desüciÚ,
ENT_NOQUOTES
,'UTF-8');

309 
$v¬ŸbË
 = 
	`html_’t™y_decode
($v¬ŸbË,
ENT_NOQUOTES
,'UTF-8');

311 iàĞ! 
$this
->
	`v®id¬DesüciÚ
(
$desüciÚ
èè 
FALSE
 ;

313 
$idioma
 = ( $idiom¨è? $idiom¨: 
$this
->
idioma
 ;

315 
$this
->
	`»cog”_desüciÚes
(
$idioma
);

317 
$this
->
desüciÚes_modifiÿdas
[
$idioma
] = 
TRUE
;

319 
$this
->
desüciÚes
[
$idioma
][
$v¬ŸbË
] = 
$desüciÚ
;

323 iàĞ
$idioma
 !ğ
$this
->
idiomaxdeãùo
 ) {

325 
$this
->
	`»cog”_desüciÚes
($this->
idiomaxdeãùo
);

327 iàĞ! 
$this
->
	`v®id¬DesüciÚ
($this->
desüciÚes
[$this->
idiomaxdeãùo
][
$v¬ŸbË
]) ) {

329 
$this
->
desüciÚes_modifiÿdas
[$this->
idiomaxdeãùo
] = 
TRUE
;

331 
$this
->
	`£tDesüciÚ
(
$v¬ŸbË
,
$desüciÚ
, $this->
idiomaxdeãùo
);

337 
	}
}

341 
funùiÚ
 
	$g‘
(
$v¬ŸbË
) {

343 if(
	`is£t
(
$this
->
v¬ŸbËs
[
$v¬ŸbË
])) {

344  
$this
->
v¬ŸbËs
[
$v¬ŸbË
];

346  
FALSE
;

349 
	}
}

362 
funùiÚ
 
	$g‘DesüciÚ
(
$v¬ŸbË
, 
$idioma
 = 
NULL
) {

364 
$idioma
 = ( $idiom¨è? $idiom¨: 
$this
->
idioma
 ;

370 iàĞ!
$this
->
desüciÚes_»cogidas
[$this->
idiomaxdeãùo
] ) { $this->
	`»cog”_desüciÚes
($this->idiomaxdefecto); }

374 iàĞ!
$this
->
desüciÚes_»cogidas
[
$idioma
] ) { $this->
	`»cog”_desüciÚes
($idioma); }

376 if(
	`is£t
(
$this
->
desüciÚes
[
$idioma
][
$v¬ŸbË
])) {

377  
$this
->
desüciÚes
[
$idioma
][
$v¬ŸbË
];

386 if(
	`is£t
(
$this
->
desüciÚes
[$this->
idiomaxdeãùo
][
$v¬ŸbË
])) {

387  
$this
->
idiomaxdeãùo
.'::'.$this->
desüciÚes
[$this->idiomaxdeãùo][
$v¬ŸbË
];

390  
FALSE
;

392 
	}
}

400 
funùiÚ
 
	$d–
(
$v¬ŸbË
) {

402 
$this
->
v¬ŸbËs_modifiÿdas
 = 
TRUE
;

404 
	`un£t
(
$this
->
v¬ŸbËs
[
$v¬ŸbË
]);

410 
$fidiomas
 = 
	`glob
(
	`dœÇme
(
$this
->
¬chivo
).'/'.$this->
nomb»_¬¿y
.'_*.php');

414 
	`fÜ—ch
Ğ
$fidiomas
 
as
 
$f
 ) {

415 
$idioma
 = 
	`¡r_»¶aû
(
	`dœÇme
(
$this
->
¬chivo
).'/'.$this->
nomb»_¬¿y
.'_','',
$f
);

416 
$idioma
 = 
	`¡r_»¶aû
('.php','',$idioma);

417 
$this
->
	`d–DesüciÚ
(
$v¬ŸbË
, 
$idioma
);

420  
TRUE
;

422 
	}
}

430 
funùiÚ
 
	$d–DesüciÚ
(
$v¬ŸbË
, 
$idioma
 = 
NULL
) {

432 
$idioma
 = ( $idiom¨è? $idiom¨: 
$this
->
idioma
 ;

434 
$this
->
	`»cog”_desüciÚes
(
$idioma
);

436 
$this
->
desüciÚes_modifiÿdas
[
$idioma
] = 
TRUE
;

438 
	`un£t
(
$this
->
desüciÚes
[
$idioma
][
$v¬ŸbË
]);

439  
TRUE
;

441 
	}
}

445 
funùiÚ
 
	$gu¬d¬_v¬ŸbËs
() {

447  
$this
->
	`esüibœArchivos
($this->
¬chivo
, $this->
v¬ŸbËs
, $this->
nomb»_¬¿y
);

449 
	}
}

453 
funùiÚ
 
	$gu¬d¬_descciÚes
(
$idioma
 = 
NULL
) {

455 
$idioma
 = ( $idiom¨è? $idiom¨: 
$this
->
idioma
 ;

461 iàĞ
$this
->
desüciÚes_modifiÿdas
[
$idioma
] !ğ
TRUE
 ) {

462  
TRUE
;

465 
$¬chivo_desüciÚes
 = 
$this
->
dœeùÜio_desüciÚes
.'/'.$this->
nomb»_¬¿y
.'_'.
$idioma
.'.php';

467 
$this
->
	`esüibœArchivos
(
$¬chivo_desüciÚes
, $this->
desüciÚes
[
$idioma
], $this->
nomb»_¬¿y
.'_DESC');

469  
TRUE
;

471 
	}
}

475 
´iv©e
 
funùiÚ
 
	$esüibœArchivos
(
$¬chivo
, 
$d©os
, 
$nomb»_¬¿y
) {

479 iàĞ
$this
->
Üd’¬
 ) 
	`ksÜt
(
$d©os
);

481 
	`»£t
(
$d©os
);

483 
Œy
 {

485 iàĞ! 
$fe
 = @
	`fİ’
(
$¬chivo
, "w") ) {

486 
throw
 
Ãw
 
	`Exû±iÚ
("No se…udo‡brir‡rchivo $file…ara incluir $nombre_array");

489 
	`åuts
(
$fe
, "<?php\n");

490 
	`åuts
(
$fe
, "// ArchivØg’”adØautom©iÿm’‹…Ü ".
__CLASS__
." ".
	`d©e
("D M j G:i:s T Y")."\n");

492 
	`li¡
(
$şave
, 
$v®
)=
	`—ch
(
$d©os
)){

494 iàĞ
	`is_¬¿y
(
$v®
)) {

496 
	`li¡
(
$şaveA¼ay
, 
$v®ÜA¼ay
)=
	`—ch
(
$v®
)) {

498 
$v®ÜA¼ay
 = 
	`¡r_»¶aû
("\\","",$valorArray);

499 
$v®ÜA¼ay
 = 
	`¡rc¦ashes
($valorArray);

501 ià(
	`åuts
(
$fe
, '$'."$nomb»_¬¿y"."['".
	`¡r_»¶aû
("'","\'",
$şave
)."'][]='".¡r_»¶aû("'","\'",
$v®ÜA¼ay
)."';\n"è==ğ
FALSE
 ) {

502 
throw
 
Ãw
 
	`Exû±iÚ
("NØ£…uedesüibœƒÀ".
$¬chivo
);

503  
FALSE
;

509 
$v®
 = 
	`¡r_»¶aû
("\\","",$val);

510 
$v®
 = 
	`¡rc¦ashes
($val);

512 ià(
	`åuts
(
$fe
, '$'."$nomb»_¬¿y"."['".
	`¡r_»¶aû
("'","\'",
$şave
)."']='".¡r_»¶aû("'","\'",
$v®
)."';\n"è==ğ
FALSE
 ) {

513 
throw
 
Ãw
 
	`Exû±iÚ
("NØ£…uedesüibœƒÀ".
$¬chivo
);

514  
FALSE
;

520 
	`åuts
(
$fe
, '?>');

521 
	`fşo£
(
$fe
);

523 
$this
->
v¬ŸbËs_modifiÿdas
 = 
FALSE
;

527 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

530 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(), $ex->
	`g‘Lše
(),"E¼Üƒsüib›ndØ¬chivØ".
$¬chivo
."\n".$ex->
	`g‘Mes§ge
(),'ERROR');

531  
FALSE
;

535 
	}
}

539 
funùiÚ
 
	$__de¡ruù
() {

541 iàĞ
$this
->
v¬ŸbËs_modifiÿdas
 ) {

543 
Œy
 {

545 
$this
->
	`gu¬d¬_v¬ŸbËs
();

547 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

549 
echo
 'ERRORƒn destructor';

550  
FALSE
;

557 iàĞ!
	`em±y
(
$this
->
desüciÚes_modifiÿdas
) ) {

559 
	`fÜ—ch
 ( 
$this
->
desüciÚes_modifiÿdas
 
as
 
$i
 => 
$dm
 ) {

560 iàĞ
$dm
 ) { 
$this
->
	`gu¬d¬_descciÚes
(
$i
); }

565 
	}
}

	@gcm/lib/int/GcmConfig/lib/GcmConfigFactory.php

1 <?
php


20 
»quœe_Úû
('GcmConfig.php');

37 şas 
	cGcmCÚfigFaùÜy
 {

39 
public
 
funùiÚ
 
	$G‘GcmCÚfig
(
$¬chivo
) {

41 
$key
 = 
	`md5
(
	`£rŸlize
(
$¬chivo
));

43 iàĞ! 
	`is£t
(
$GLOBALS
['GcmCÚfig'][
$key
]è|| ! ($GLOBALS['GcmCÚfig'][$key] 
š¡ªûof
 
GcmCÚfig
) ) {

45 
$GLOBALS
['GcmCÚfig'][
$key
] = 
Ãw
 
	`GcmCÚfig
(
$¬chivo
);

49  
$GLOBALS
['GcmCÚfig'][
$key
];

53 
	}
}

	@gcm/lib/int/GcmConfig/lib/GcmConfigGui.php

1 <?
php


19 
»quœe_Úû
('GcmConfig.php');

35 şas 
	cGcmCÚfigGui
 
ex‹nds
 
	mGcmCÚfig
 {

37 
funùiÚ
 
	$__cÚ¡ruù
(
$¬chivo
) {

39 
·»Á
::
	`__cÚ¡ruù
(
$¬chivo
);

60 
funùiÚ
 
	$fÜmuÏrio
(
$¬gs
 = 
NULL
) {

62 
$am¶Ÿr
 = ( 
	`is£t
(
$¬gs
['am¶Ÿr']èè? $¬gs['am¶Ÿr'] : 
FALSE
;

63 
$–imš¬
 = ( 
	`is£t
(
$¬gs
['–imš¬']èè? $¬gs['–imš¬'] : 
FALSE
;

64 
$¶ªtÏ
 = ( 
	`is£t
(
$¬gs
['¶ªtÏ']èè? $¬gs['¶ªtÏ'] : 
	`dœÇme
(
__FILE__
).'/../html/formGcmConfigGui.html';

65 
$css
 = ( 
	`is£t
(
$¬gs
['css']èè? $¬gs['css'] : 
FALSE
;

66 
$modifiÿr_desüciÚes
 = ( 
	`is£t
(
$¬gs
['modifiÿr_desüciÚes']èè? $¬gs['modifiÿr_desüciÚes'] : 
FALSE
;

69 iàĞ
$css
 ) {

71 
echo
 '<lšk„–="¡yËsh“t" h»f="'.
$css
.'"ype="text/css">';

75 
echo
 '<styleype="text/css">';

76 
	`šşude
 (
	`dœÇme
(
__FILE__
).'/../css/formGcmConfigGui.css');

77 
echo
 '</style>';

81 iàĞ!
	`šşude
(
$¶ªtÏ
)) {

82 
throw
 
Ãw
 
	`Exû±iÚ
("E¼Ü‡Èšşuœ…ÏÁÏ [".
$¶ªtÏ
.']');

86 
	}
}

99 
funùiÚ
 
	$esüibœ_desde_po¡
() {

101 
glob®
 
$HTTP_POST_VARS
;

103 
$idioma
 = 
$_POST
['idioma'];

104 
$¬chivo
 = 
$_POST
['archivo'];

108 iàĞ
	`couÁ
(
$_POST
['esüibœ_'.
$idioma
]) <= 0 ) {

109 
	`Œigg”_”rÜ
('Sin valores validosƒn GET');

110  
FALSE
;

115 
$this
->
v¬ŸbËs
 = 
	`¬¿y
();

117 
	`fÜ—ch
Ğ
$_POST
['esüibœ_'.
$idioma
] 
as
 
$şave
 => 
$v®Ü
 ) {

119 
$this
->
	`£t
(
$şave
,
$v®Ü
);

125 iàĞ
	`couÁ
(
$_POST
['desüciÚ_'.
$idioma
]) > 0 ) {

127 
$this
->
desüciÚes
[
$idioma
] = 
	`¬¿y
();

129 
$this
->
desüciÚes_»cogidas
 = 
TRUE
;

131 
	`fÜ—ch
Ğ
$_POST
['desüciÚ_'.
$idioma
] 
as
 
$şave
 => 
$v®Ü
 ) {

133 
$this
->
	`£tDesüciÚ
(
$şave
,
$v®Ü
, 
$idioma
);

139  
TRUE
;

141 
	}
}

	@gcm/lib/int/GcmConfig/test/GcmConfigFactoryTest.php

1 <?
php


8 
DEFINE
(
ARCHIVO
,'/tmp/TGC.php');

9 
DEFINE
(
ARCHIVO_DESC
,'/tmp/TGC_es.php');

13 
	g$cÚ‹nido
 = "\n".'<?php ';

14 
	g$cÚ‹nido
 .= "\n".'$TGC[v1]="variable1";';

15 
	g$cÚ‹nido
 .= "\n".'$TGC[v2]="variable2";';

16 
	g$cÚ‹nido
 .= "\n".'$TGC[v3]="variable3";';

17 
	g$cÚ‹nido
 .= "\n".'$TGC[v4]="variable4";';

18 
	g$cÚ‹nido
 .= "\n".'$TGC[v5]="variable5";';

19 
	g$cÚ‹nido
 .= "\n".'$TGC[v6]="variable6";';

20 
	g$cÚ‹nido
 .= "\n".'?>';

22 
fe_put_cÚ‹Ás
(
ARCHIVO
, 
$cÚ‹nido
);

24 
	g$cÚ‹nido
 = "\n".'<?php ';

25 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1";';

26 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2";';

27 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3";';

28 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v4]="descripcion_variable4";';

29 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v5]="descripcion_variable5";';

30 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v6]="descripcion_variable6";';

31 
	g$cÚ‹nido
 .= "\n".'?>';

33 
fe_put_cÚ‹Ás
(
ARCHIVO_DESC
, 
$cÚ‹nido
);

35 
	g»quœe_Úû
 'PHPUnit/Framework.php';

37 
»quœe
(
dœÇme
(
__FILE__
).'/../lib/GcmConfigFactory.php');

43 şas 
	cGcmCÚfigFaùÜyTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
{

45 
public
 
	m$cÚfig
;

46 
public
 
	m$¬chivo
;

47 
public
 
	m$¬chivo_desüciÚ
;

49 
funùiÚ
 
	$__cÚ¡ruù
() {

51 
$this
->
¬chivo
 = 
ARCHIVO
;

52 
$this
->
¬chivo_desüciÚ
 = 
ARCHIVO_DESC
;

54 
$this
->
cÚfig
 = 
GcmCÚfigFaùÜy
::
	`g‘GcmCÚfig
($this->
¬chivo
);

62 
funùiÚ
 
	$‹¡CambŸrV®Ües
() {

64 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘
('v1'), 'variable1');

65 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘DesüciÚ
('v6'), 'descripcion_variable6');

67 
$nuevo_v®Ü
 = 'Nuevo valor…ara v1';

68 
$this
->
cÚfig
->
	`£t
('v1',
$nuevo_v®Ü
);

69 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘
('v1'), 
$nuevo_v®Ü
);

71 
$nuevo_v®Ü
 = 'Nuevo valor…ara v1';

72 
$this
->
cÚfig
->
	`£tDesüciÚ
('v1',
$nuevo_v®Ü
);

73 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘DesüciÚ
('v1'), 
$nuevo_v®Ü
);

75 
$this
->
	`as£¹True
($this->
cÚfig
->
	`d–
('v4'));

77 
$this
->
	`as£¹True
($this->
cÚfig
->
	`d–DesüciÚ
('v4'));

79 
$this
->
cÚfig
->
	`£tDesüciÚ
('v1','MODIFICADA');

81 
	}
}

	@gcm/lib/int/GcmConfig/test/GcmConfigGuiTest.php

1 <?
php


7 
DEFINE
(
ARCHIVO
,'/tmp/TGC.php');

8 
DEFINE
(
ARCHIVO_DESC
,'/tmp/TGC_es.php');

12 
	g$cÚ‹nido
 = "\n".'<?php ';

13 
	g$cÚ‹nido
 .= "\n".'$TGC[v1]="variable1";';

14 
	g$cÚ‹nido
 .= "\n".'$TGC[v2]="variable2";';

15 
	g$cÚ‹nido
 .= "\n".'$TGC[v3]="variable3";';

16 
	g$cÚ‹nido
 .= "\n".'$TGC[v4]="variable4";';

17 
	g$cÚ‹nido
 .= "\n".'$TGC[v5]="variable5";';

18 
	g$cÚ‹nido
 .= "\n".'$TGC[v6]="variable6";';

19 
	g$cÚ‹nido
 .= "\n".'?>';

21 
fe_put_cÚ‹Ás
(
ARCHIVO
, 
$cÚ‹nido
);

23 
	g$cÚ‹nido
 = "\n".'<?php ';

24 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1";';

25 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2";';

26 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3";';

27 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v4]="descripcion_variable4";';

28 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v5]="descripcion_variable5";';

29 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v6]="descripcion_variable6";';

30 
	g$cÚ‹nido
 .= "\n".'?>';

32 
fe_put_cÚ‹Ás
(
ARCHIVO_DESC
, 
$cÚ‹nido
);

34 
	g»quœe_Úû
 'PHPUnit/Framework.php';

36 
»quœe
(
dœÇme
(
__FILE__
).'/../lib/GcmConfigGui.php');

38 şas 
	cGcmCÚfigGuiTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
{

40 
public
 
	m$cÚfig
;

41 
public
 
	m$¬chivo
;

42 
public
 
	m$¬chivo_desüciÚ
;

44 
funùiÚ
 
	$__cÚ¡ruù
() {

46 
$this
->
¬chivo
 = 
ARCHIVO
;

47 
$this
->
¬chivo_desüciÚ
 = 
ARCHIVO_DESC
;

49 
$this
->
cÚfig
 = 
Ãw
 
	`GcmCÚfigGui
($this->
¬chivo
);

55 
funùiÚ
 
	$‹¡V”V®Ües
() {

57 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘
('v1'), 'variable1');

58 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘DesüciÚ
('v6'), 'descripcion_variable6');

60 
$nuevo_v®Ü
 = 'Nuevo valor…ara v1';

61 
$this
->
cÚfig
->
	`£t
('v1',
$nuevo_v®Ü
);

62 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘
('v1'), 
$nuevo_v®Ü
);

64 
$nuevo_v®Ü
 = 'Nuevo valor…ara v1';

65 
$this
->
cÚfig
->
	`£tDesüciÚ
('v1',
$nuevo_v®Ü
);

66 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘DesüciÚ
('v1'), 
$nuevo_v®Ü
);

68 
$this
->
	`as£¹True
($this->
cÚfig
->
	`d–
('v4'));

70 
$this
->
	`as£¹True
($this->
cÚfig
->
	`d–DesüciÚ
('v4'));

72 
$this
->
cÚfig
->
	`£tDesüciÚ
('v1','MODIFICADA');

78 
	}
}

	@gcm/lib/int/GcmConfig/test/GcmConfigTest.php

1 <?
php


7 
DEFINE
(
ARCHIVO
,'/tmp/TGC.php');

8 
DEFINE
(
ARCHIVO_DESC
,'/tmp/TGC_es.php');

12 
	g$cÚ‹nido
 = "\n".'<?php ';

13 
	g$cÚ‹nido
 .= "\n".'$TGC[v1]="variable1";';

14 
	g$cÚ‹nido
 .= "\n".'$TGC[v2]="variable2";';

15 
	g$cÚ‹nido
 .= "\n".'$TGC[v3]="variable3";';

16 
	g$cÚ‹nido
 .= "\n".'$TGC[v4]="variable4";';

17 
	g$cÚ‹nido
 .= "\n".'$TGC[v5]="variable5";';

18 
	g$cÚ‹nido
 .= "\n".'$TGC[v6]="variable6";';

19 
	g$cÚ‹nido
 .= "\n".'?>';

21 
fe_put_cÚ‹Ás
(
ARCHIVO
, 
$cÚ‹nido
);

23 
	g$cÚ‹nido
 = "\n".'<?php ';

24 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1";';

25 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2";';

26 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3";';

27 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v4]="descripcion_variable4";';

28 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v5]="descripcion_variable5";';

29 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v6]="descripcion_variable6";';

30 
	g$cÚ‹nido
 .= "\n".'?>';

32 
fe_put_cÚ‹Ás
(
ARCHIVO_DESC
, 
$cÚ‹nido
);

34 
	g»quœe_Úû
 'PHPUnit/Framework.php';

36 
»quœe
(
dœÇme
(
__FILE__
).'/../lib/GcmConfig.php');

38 şas 
	cGcmCÚfigTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
{

40 
public
 
	m$cÚfig
;

41 
public
 
	m$¬chivo
;

42 
public
 
	m$¬chivo_desüciÚ
;

44 
funùiÚ
 
	$__cÚ¡ruù
() {

46 
$this
->
¬chivo
 = 
ARCHIVO
;

47 
$this
->
¬chivo_desüciÚ
 = 
ARCHIVO_DESC
;

49 
$this
->
cÚfig
 = 
Ãw
 
	`GcmCÚfig
($this->
¬chivo
);

55 
funùiÚ
 
	$‹¡V”V®Ües
() {

57 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘
('v1'), 'variable1');

58 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘DesüciÚ
('v6'), 'descripcion_variable6');

60 
$nuevo_v®Ü
 = 'Nuevo valor…ara v1';

61 
$this
->
cÚfig
->
	`£t
('v1',
$nuevo_v®Ü
);

62 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘
('v1'), 
$nuevo_v®Ü
);

64 
$nuevo_v®Ü
 = 'Nuevo valor…ara v1';

65 
$this
->
cÚfig
->
	`£tDesüciÚ
('v1',
$nuevo_v®Ü
);

66 
$this
->
	`as£¹Equ®s
($this->
cÚfig
->
	`g‘DesüciÚ
('v1'), 
$nuevo_v®Ü
);

68 
$this
->
	`as£¹True
($this->
cÚfig
->
	`d–
('v4'));

70 
$this
->
	`as£¹True
($this->
cÚfig
->
	`d–DesüciÚ
('v4'));

72 
$this
->
cÚfig
->
	`£tDesüciÚ
('v1','MODIFICADA');

74 
	}
}

	@gcm/lib/int/GcmConfig/test/PhpTestGcmConfigGui.php

1 <?
php


7 
»quœe
(
dœÇme
(
__FILE__
).'/../lib/GcmConfigGui.php');

9 iàĞ
	g$_POST
['accion'] == 'escribir_gcmconfig' ) {

11 
$po¡_cÚfig
 = 
Ãw
 
GcmCÚfigGui
(
$_POST
['archivo']);

12 
	g$po¡_cÚfig
->
	gidioma
 = 
$_POST
['idioma'];

14 iàĞ
	g$po¡_cÚfig
->
esüibœ_desde_po¡
() ) {

15 
	gecho
 '<h1>Archivoƒscrito</h1>';

19 
	g$po¡_cÚfig
 = 
NULL
;

22 
	gecho
 'Error';

26 
DEFINE
(
ARCHIVO
,'/tmp/TGC.php');

27 
DEFINE
(
ARCHIVO_DESC
,'/tmp/TGC_es.php');

28 
DEFINE
(
ARCHIVO_DESC_ÿ
,'/tmp/TGC_ca.php');

30 iàĞ! 
	$fe_exi¡s
(
ARCHIVO
) ) {

34 
$cÚ‹nido
 = "\n".'<?php ';

35 
$cÚ‹nido
 .= "\n".'$TGC[v1]="variable1";';

36 
$cÚ‹nido
 .= "\n".'$TGC[v2]="variable2";';

37 
$cÚ‹nido
 .= "\n".'$TGC[v3]="variable3";';

38 
$cÚ‹nido
 .= "\n".'$TGC[v4]="variable4";';

39 
$cÚ‹nido
 .= "\n".'$TGC[v5][]="variable5a";';

40 
$cÚ‹nido
 .= "\n".'$TGC[v5][]="variable5b";';

41 
$cÚ‹nido
 .= "\n".'$TGC[v5][]="variable5c";';

42 
$cÚ‹nido
 .= "\n".'$TGC[v6]="variable6";';

43 
$cÚ‹nido
 .= "\n".'?>';

45 
	`fe_put_cÚ‹Ás
(
ARCHIVO
, 
$cÚ‹nido
);

47 
	}
}

49 iàĞ! 
	$fe_exi¡s
(
ARCHIVO_DESC
) ) {

51 
$cÚ‹nido
 = "\n".'<?php ';

52 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1";';

53 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2";';

54 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3";';

55 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v4]="descripcion_variable4";';

56 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v5]="descripcion_variable5";';

57 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v6]="descripcion_variable6";';

58 
$cÚ‹nido
 .= "\n".'?>';

60 
	`fe_put_cÚ‹Ás
(
ARCHIVO_DESC
, 
$cÚ‹nido
);

62 
	}
}

64 iàĞ! 
	$fe_exi¡s
(
ARCHIVO_DESC_ÿ
) ) {

66 
$cÚ‹nido
 = "\n".'<?php ';

67 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1_ca";';

68 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2_ca";';

69 
$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3_ca";';

70 
$cÚ‹nido
 .= "\n".'?>';

72 
	`fe_put_cÚ‹Ás
(
ARCHIVO_DESC_ÿ
, 
$cÚ‹nido
);

74 
	}
}

76 
	g$cÚfig
 = 
Ãw
 
GcmCÚfigGui
(
ARCHIVO
);

77 
	g$cÚfig_ÿ
 = 
Ãw
 
GcmCÚfigGui
(
ARCHIVO
);

79 
	gecho
 '<h2>Presentamos variables</h2>';

81 
	gecho
 "<´e>" ; 
´št_r
(
$cÚfig
->
v¬ŸbËs
()) ;ƒcho "</pre>";

85 
	gecho
 '<h2>Formularioƒn idioma…redeterminado Solo se…uede modificar valores</h2>';

86 
echo
 
	g$cÚfig
->
fÜmuÏrio
();

88 
	gecho
 '<h2>Formularioƒn catalan‡mpliable</h2>';

89 
	g$cÚfig_ÿ
->
	gidioma
 = 'ca';

90 
	g$İciÚes
 = 
¬¿y
('am¶Ÿr' => 
TRUE
, 'eliminar' => TRUE, 'modificar_descripciones' => TRUE );

91 
echo
 
	g$cÚfig_ÿ
->
fÜmuÏrio
(
$İciÚes
);

93 
	gecho
 '<h2>POST</h2>';

94 
	gecho
 "<´e>" ; 
´št_r
(
$_POST
) ;ƒcho "</pre>";

	@gcm/lib/int/GcmConfig/test/phpTestGcmConfig.php

1 <?
php


7 
DEFINE
(
ARCHIVO
,'/tmp/TGC.php');

8 
DEFINE
(
ARCHIVO_DESC
,'/tmp/TGC_es.php');

9 
DEFINE
(
ARCHIVO_DESC2
,'/tmp/TGC_ca.php');

13 
	g$cÚ‹nido
 = "\n".'<?php ';

14 
	g$cÚ‹nido
 .= "\n".'$TGC[v1]="variable1";';

15 
	g$cÚ‹nido
 .= "\n".'$TGC[v2]="variable2";';

16 
	g$cÚ‹nido
 .= "\n".'$TGC[v3]="variable3";';

17 
	g$cÚ‹nido
 .= "\n".'$TGC[v4]="variable4";';

18 
	g$cÚ‹nido
 .= "\n".'$TGC[v5]="variable5";';

19 
	g$cÚ‹nido
 .= "\n".'$TGC[v6]="variable6";';

20 
	g$cÚ‹nido
 .= "\n".'?>';

22 
fe_put_cÚ‹Ás
(
ARCHIVO
, 
$cÚ‹nido
);

24 
	g$cÚ‹nido
 = "\n".'<?php ';

25 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1";';

26 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2";';

27 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3";';

28 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v4]="descripcion_variable4";';

29 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v5]="descripcion_variable5";';

30 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v6]="descripcion_variable6";';

31 
	g$cÚ‹nido
 .= "\n".'?>';

33 
fe_put_cÚ‹Ás
(
ARCHIVO_DESC2
, 
$cÚ‹nido
);

35 
	g$cÚ‹nido
 = "\n".'<?php ';

36 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v1]="descripcion_variable1";';

37 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v2]="descripcion_variable2";';

38 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v3]="descripcion_variable3";';

39 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v4]="descripcion_variable4";';

40 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v5]="descripcion_variable5";';

41 
	g$cÚ‹nido
 .= "\n".'$TGC_DESC[v6]="descripcion_variable6";';

42 
	g$cÚ‹nido
 .= "\n".'?>';

44 
fe_put_cÚ‹Ás
(
ARCHIVO_DESC
, 
$cÚ‹nido
);

46 
»quœe
('GcmConfig.php');

48 
	g$cÚfig
 = 
Ãw
 
GcmCÚfig
(
ARCHIVO
);

50 
	g$cÚfig
->
£t
('v1','NUEVO VALOR PARA v1');

51 
	g$cÚfig
->
£tDesüciÚ
('v1','NUEVO VALOR PARA DESCRIPCION v1');

52 
	g$cÚfig
->
d–
('v4');

54 
	gecho
 'V®Ü dv1: '.
	g$cÚfig
->
g‘
('v1');

58 
	g$v2
 = 
¬¿y
( 'valor1', 'valor2');

59 
	g$cÚfig
->
£t
('v2', 
$v2
);

63 
	g$cÚfig
->
£t
('v7', 'Nueva variable');

66 
echo
 
	g$cÚfig
->
g‘
('v2');

68 
	gecho
 "\nV¬ŸbËs:" ; 
´št_r
(
$cÚfig
->
v¬ŸbËs
()) ;ƒcho "";

69 
	gecho
 "\nDesüciÚe es:" ; 
´št_r
(
$cÚfig
->
desüciÚes
()) ;ƒcho "";

70 
	gecho
 "\nDesüciÚe ÿ:" ; 
´št_r
(
$cÚfig
->
desüciÚes
('ca')) ;ƒcho "";

	@gcm/lib/int/GcmPDO/lib/GcmPDO.php

1 <?
php


25 şas 
	cGcmPDO
 {

27 
´Ùeùed
 
	m$»suÉado
;

28 
´Ùeùed
 
	m$sql
;

29 
´Ùeùed
 
	m$pdo
;

30 
´Ùeùed
 
	m$num_tÙ®_»gi¡ros
;

38 
funùiÚ
 
	$__cÚ¡ruù
 (
PDO
 
$pdo
, 
$sql
) {

40 
$this
->
num_tÙ®_»gi¡ros
 = 0;

41 
$this
->
pdo
 = 
$pdo
;

42 
$this
->
sql
 = 
$sql
;

44 
$cÚsuÉa_couÁ
 = "SELECT COUNT(*) FROM ($this->sql)‡s conta";

48 iàĞ! 
$»suÉ
 = 
$this
->
pdo
->
	`´•¬e
(
$cÚsuÉa_couÁ
) ) {

49 
$”rÜ
 = 
$»suÉ
->
	`”rÜInfo
();

50 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"ERROR ".
$”rÜ
[2]."\nsql:\n".
$cÚsuÉa_couÁ
,'ERROR');

51  
FALSE
;

54 iàĞ! 
$»suÉ
->
	`execu‹
() ) {

55 
$”rÜ
 = 
$»suÉ
->
	`”rÜInfo
();

56 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"ERROR ".
$”rÜ
[2]."\nsql:\n".
$cÚsuÉa_couÁ
,'ERROR');

57  
FALSE
;

60 
$fas
 = 
$»suÉ
->
	`ãtch
();

62 
	`fÜ—ch
(
$fas
 
as
 
$key
 => 
$v®ue
) {

63 
$this
->
num_tÙ®_»gi¡ros
 = 
$v®ue
;

72 
funùiÚ
 
	$num”o_»gi¡ros
() {

73  
$this
->
num_tÙ®_»gi¡ros
;

74 
	}
}

80 
funùiÚ
 
	$v®id¬
() {

82 iàĞ
$this
->
num_tÙ®_»gi¡ros
 > 0 ) {

83  
TRUE
;

85  
FALSE
;

87 
	}
}

93 
funùiÚ
 
	$»suÉado
() {

95 iàĞ
$this
->
»suÉado
 )  $this->resultado;

97 
Œy
 {

99 
$this
->
»suÉado
=$this->
pdo
->
	`´•¬e
($this->
sql
);

100 
$this
->
»suÉado
->
	`execu‹
();

102 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

103 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Error con†a base de datos",'ERROR');

104 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"SQL: ".
$this
->
sql
."\n".
$ex
->
	`g‘Mes§ge
(),'ADMIN');

105  
FALSE
;

108  
$this
->
»suÉado
;

110 
	}
}

116 
funùiÚ
 
	$to_¬¿y
() {

118 iàĞ! 
$this
->
»suÉado
 ) $this->
	`»suÉado
();

120 
$»tÜno
 = 
	`¬¿y
();

122 iàĞ! 
$this
->
»suÉado
 ) {

123 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Sin„esultados');

124  
FALSE
;

126 
$¬AÎ
 = 
$this
->
»suÉado
->
	`ãtchAÎ
(
PDO
::
FETCH_ASSOC
);

128 
$cÚ
 = 0;

129 
	`fÜ—ch
 ( 
$¬AÎ
 
as
 
$¬Row
 ) {

130 
	`fÜ—ch
(
$¬Row
 
as
 
$key
 => 
$v®ue
) {

131 
$»tÜno
[
$cÚ
][
$key
] = 
$v®ue
;

133 
$cÚ
++;

136  
$»tÜno
;

138 
	}
}

	@gcm/lib/int/GcmPDO/lib/paginarPDO.php

1 <?
php


20 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/GcmPDO.php');

27 şas 
	cPagš¬PDO
 
ex‹nds
 
	mGcmPDO
 {

29 
public
 
	m$–em’tos_·gša
;

30 
public
 
	m$u¾_ba£
='';

31 
public
 
	m$¶ªtÏ_»suÉados
;

32 
public
 
	m$¶ªtÏ_bÙÚ”a
;

33 
public
 
	m$·gšas_agru·das
=2;

34 
public
 
	m$sufijo
;

36 
´iv©e
 
	m$šicio
;

37 
´iv©e
 
	m$·gša
;

38 
´iv©e
 
	m$tÙ®_de_·gšas
;

39 
´iv©e
 
	m$–em’to_šicio
;

40 
´iv©e
 
	m$–em’to_fš®
;

41 
´iv©e
 
	m$tÙ®µ
;

43 
´iv©e
 
	m$as_Üd’
;

44 
´iv©e
 
	m$to_Üd’
;

46 
´iv©e
 
	m$süt_ajax_šşuido
 = 
FALSE
 ;

60 
funùiÚ
 
	$__cÚ¡ruù
 (
PDO
 
$pdo
, 
$sql
, 
$sufijo
=
FALSE
, 
$–em’tos_·gša
=8, 
$Üd”
 = FALSE, 
$sql_»ÏciÚes
 = FALSE) {

62 
·»Á
::
	`__cÚ¡ruù
(
$pdo
, 
$sql
);

64 
$this
->
sufijo
 = ( 
$sufijo
 ) ? $sufijo : '';

66 
$this
->
–em’tos_·gša
 = ( 
$–em’tos_·gša
 ) ? $elementos_pagina : 10 ;

70 iàĞ
	`is£t
(
$_GET
[
$this
->
sufijo
.'Üd’']è&& ! 
	`em±y
($_GET[$this->sufijo.'orden']) ) {

72 
$this
->
as_Üd’
 = 
	`¡r¦ashes
(
$_GET
[$this->
sufijo
.'orden']);

74 
$this
->
to_Üd’
 = ( 
	`is£t
(
$_GET
[$this->
sufijo
.'tipo_orden']) ) ? $_GET[$this->sufijo.'tipo_orden'] : 'asc';

78 iàĞ
$sql_»ÏciÚes
 && 
	`¬¿y_key_exi¡s
(
$this
->
as_Üd’
,$sql_relaciones) ) {

79 
$Üd”
 = "ORDER BY ".
$sql_»ÏciÚes
[
$this
->
as_Üd’
]." ".$this->
to_Üd’
;

81 
$Üd”
 = "ORDER BY `".
$this
->
as_Üd’
."` ".$this->
to_Üd’
;

84 } 
	`–£if
 ( 
$Üd”
 ) {

86 
	`´eg_m©ch_®l
('/Üd” by (.*?è(.*?)/i', 
$Üd”
, 
$cošcid’cŸs
);

88 
$Üd’adox
 = ( !
	`em±y
(
$cošcid’cŸs
[1][0]èè? 
	`Œim
($cošcid’cŸs[1][0],','è: 
FALSE
 ;

90 
$this
->
to_Üd’
 = ( 
	`¡ros
(
$Üd”
,'desc'è!=ğ
FALSE
 ) ? 'desc' : 'asc' ;

92 iàĞ
$Üd’adox
 ) {

98 iàĞ
	`´eg_m©ch
('/'.
$Üd’adox
.'(.?èa (.*)/i',
$sql
, 
$cošcid’cŸs
è&& ! 
	`em±y
($coincidencias[2]) ) {

100 
$this
->
as_Üd’
 = 
	`Œim
(
$cošcid’cŸs
[2],',');

104 
$this
->
as_Üd’
 = 
$Üd’adox
;

109 iàĞ
$sql_»ÏciÚes
 && 
	`¬¿y_£¬ch
(
$this
->
as_Üd’
,$sql_relaciones) ) {

110 
$this
->
as_Üd’
 = 
	`¬¿y_£¬ch
($this->as_Üd’,
$sql_»ÏciÚes
);

114 
$this
->
as_Üd’
 = 
FALSE
;

119 
$this
->
as_Üd’
 = 
FALSE
;

124 
$this
->
sql
 = 
$sql
." ".
$Üd”
;

131 ià(
	`em±y
(
$_GET
[
$this
->
sufijo
."pagina"])) {

132 
$šicio
 = 0;

133 
$this
->
·gša
=1;

137 
$this
->
·gša
 = 
$_GET
[$this->
sufijo
."pagina"];

138 
$šicio
 = (
$this
->
·gša
 - 1è* $this->
–em’tos_·gša
;

142 
$šicio
 = ( $inicio > 0 ) ? $inicio : 0 ;

144 
$this
->
tÙ®_de_·gšas
 = ( $this->
num_tÙ®_»gi¡ros
 > 1 ) ? 
	`û
($this->num_tÙ®_»gi¡ro / $this->
–em’tos_·gša
) : 1 ;

146 
$this
->
sql
=$this->sql."†im™ " . 
$šicio
 . "," . $this->
–em’tos_·gša
;

148 
$this
->
tÙ®µ
=
	`û
($this->
tÙ®_de_·gšas
 / $this->
·gšas_agru·das
);

151 
$this
->
–em’to_šicio
=($this->
·gša
-$this->
·gšas_agru·das
);

152 
$this
->
–em’to_fš®
=($this->
·gša
+$this->
·gšas_agru·das
);

154 iàĞ
$this
->
–em’to_šicio
 < 1 ) $this->elemento_inicio=1;

155 iàĞ
$this
->
–em’to_fš®
 > $this->
tÙ®_de_·gšas
 ) $this->elemento_final=$this->total_de_paginas;

167 
funùiÚ
 
	`·gša
(
$İciÚes_¬¿y2bË
=
FALSE
, 
$´e£ÁaciÚ
 = 'Array2table') {

169 
glob®
 
$gcm
;

171 iàĞ! 
$this
->
»suÉado
 ) $this->
	`»suÉado
();

178 iàĞ
$this
->
¶ªtÏ_»suÉados
 ) {

182 
	`šşude
(
$this
->
¶ªtÏ_»suÉados
);

197 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../../¬¿y2bË/lib/'.
$´e£ÁaciÚ
.'.php');

199 
$¬¿y2bË
 = 
Ãw
 
	`$´e£ÁaciÚ
();

200 
$¬¿y2bË
->
sufijo
 = 
$this
->sufijo;

201 
$¬¿y2bË
->
	`g’”¬_bÏ
(
$this
->
	`to_¬¿y
(), 
$İciÚes_¬¿y2bË
, $this->
as_Üd’
, $this->
to_Üd’
);

205 
	}
}

211 
funùiÚ
 
	$bÙÚ”a
() {

213 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../../gcm/lib/helpers.php');

215 iàĞ! 
$this
->
»suÉado
 ) $this->
	`»suÉado
();

217 
$this
->
u¾_ba£
 = 
	`cÚ¡ruœ_g‘
Ğ
	`¬¿y
(

218 
$this
->
sufijo
.'Üd’' => 
	`html¥ecŸlch¬s
($this->
as_Üd’
,
ENT_QUOTES
)

219 , 
$this
->
sufijo
.'to_Üd’' => $this->
to_Üd’


225 
$simbŞo
 = '&';

227 iàĞ! 
$this
->
¶ªtÏ_bÙÚ”a
 ) {

229 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../html/botonera_paginador.html');

233 
	`šşude
(
$this
->
¶ªtÏ_bÙÚ”a
);

236 
	}
}

248 
funùiÚ
 
g’”¬_·gša
(
$u¾_ajax
=
FALSE
, 
$İciÚes_¬¿y2bË
 = FALSE, 
$´e£ÁaciÚ
 = 'Array2table') {

252 
$id’t
 = 
$this
->
sufijo
;

253 
	g$div
 = 
$id’t
.'paginador';

255 
	gecho
 '<div id="'.
	g$div
.'">';

256 
	g$this
->
bÙÚ”a
();

257 
	g$this
->
·gša
(
$İciÚes_¬¿y2bË
, 
$´e£ÁaciÚ
);

258 
	g$this
->
bÙÚ”a
();

259 
	gecho
 '</div>';

260 ià(
	g$this
->
	gtÙ®_de_·gšas
 > 1) {

261 iàĞ
	g$u¾_ajax
 && $url_ajax != '' ) {

262 
$this
->
süt_ajax
();

264 iàĞ
is£t
(
$_REQUEST
['fÜm©o']è&& 
	g$_REQUEST
['formato'] == 'ajax' ) {

266 <
süt
>
£tTimeout
('š™PagšadÜ("#<?=$div?>","<?=$u¾_ajax?>")', 1000);</
	gsüt
>

267 <?
	gphp


270 <
	gsüt
>

271 
addLßdEv’t
(
funùiÚ
(){

272 
š™PagšadÜ
("#<?=$div?>","<?=$url_ajax?>");

274 </
	gsüt
>

275 <?
	gphp


290 
funùiÚ
 
	$süt_ajax
() {

292 iàĞ
£lf
::
$süt_ajax_šşuido
 )  ;

295 <
süt
>

296 
funùiÚ
 
	`š™PagšadÜ
(
div
,
u¾_ajax
) {

297 
	`$
(
div
).
	`fšd
(".bÙÚ”a_·gšadÜ‡").
	`şick
(
	`funùiÚ
() {

298 
v¬
 
u¾
 = 
	`$
(
this
).
	`©Œ
("h»f"è+ 
u¾_ajax
;

299 
$
.
	`g‘
(
u¾
,
	`funùiÚ
(
d©a
){

300 
	`$
(
div
).
	`»¶aûW™h
(
d©a
);

302  
çl£
;

304 
	`$
(
div
).
	`fšd
("bËh‡").
	`şick
(
	`funùiÚ
() {

305 
v¬
 
u¾
 = 
	`$
(
this
).
	`©Œ
("h»f"è+ 
u¾_ajax
;

306 
$
.
	`g‘
(
u¾
,
	`funùiÚ
(
d©a
){

307 
	`$
(
div
).
	`»¶aûW™h
(
d©a
);

309  
çl£
;

312 </
süt
>

313 <?
php


315 
£lf
::
$süt_ajax_šşuido
 = 
TRUE
;

317 
	}
}

	@gcm/lib/int/array2table/lib/Array2table.php

1 <?
php


22 şas 
	cA¼ay2bË
 {

24 
public
 
	m$ba£_imag’es
 ;

25 
public
 
	m$img_modifiÿr
 ;

26 
public
 
	m$img_bÜ¿r
 ;

27 
public
 
	m$img_v”
 ;

28 
public
 
	m$sufijo
 ;

37 
funùiÚ
 
__cÚ¡ruù
(
$sufijo
='') {

39 
$this
->
sufijo
 = 
$sufijo
 ;

40 
	m£lf
::
$img_modifiÿr
 = 'modificar.png' ;

41 
	m£lf
::
$img_bÜ¿r
 = 'borrar.png' ;

42 
	m£lf
::
$img_v”
 = 'ver.png' ;

43 
	m£lf
::
$ba£_imag’es
 = 
Rou‹r
::
$ba£
.
GCM_DIR
.'lib/int/array2table/img/';

89 
funùiÚ
 
	$g’”¬_bÏ
(
$»s
, 
$İciÚes
=
NULL
, 
$Üd’
 = 
FALSE
 , 
$to_Üd’
 = FALSE) {

91 
$num_»gi¡ros
 = 
	`couÁ
(
$»s
);

92 
$num_cŞumÇs
 = 
	`couÁ
(
$»s
[0]);

96 
$§lida_fa_uniÿ
 = 
FALSE
 ;

99 
$bË_id
 = ( 
	`is£t
(
$İciÚes
['bË_id'])è? $İciÚes['bË_id'] : 
FALSE
 ;

102 
$u¾
 = ( 
	`is£t
(
$İciÚes
['u¾'])è? $İciÚes['u¾'] : 
FALSE
 ;

105 
$acciÚ
 = ( 
	`is£t
(
$İciÚes
['acciÚ'])è? $İciÚes['acciÚ'] : 
FALSE
 ;

108 
$id’tifiÿdÜ
 = ( 
	`is£t
(
$İciÚes
['id’tifiÿdÜ'])è? $İciÚes['id’tifiÿdÜ'] : 
FALSE
 ;

111 
$v”
 = ( 
	`is£t
(
$İciÚes
['v”'])è? $İciÚes['v”'] : 
FALSE
 ;

114 
$modifiÿr
 = ( 
	`is£t
(
$İciÚes
['modifiÿr'])è? $İciÚes['modifiÿr'] : 
FALSE
 ;

117 
$–imš¬
 = ( 
	`is£t
(
$İciÚes
['–imš¬'])è? $İciÚes['–imš¬'] : 
FALSE
 ;

120 
$ocuÉ¬_id
 = ( 
	`is£t
(
$İciÚes
['ocuÉ¬_id'])è? $İciÚes['ocuÉ¬_id'] : 
FALSE
 ;

123 
$cŞgroup
 = ( 
	`is£t
(
$İciÚes
['cŞgroup'])è? $İciÚes['cŞgroup'] : 
FALSE
 ;

126 
£lf
::
$ba£_imag’es
 = ( 
	`is£t
(
$İciÚes
['dir_img'])) ? $opciones['dir_img'] : self::$base_imagenes ;

129 
$’Ïûs
 = ( 
	`is£t
(
$İciÚes
['’Ïûs'])è? $İciÚes['’Ïûs'] : 
FALSE
 ;

132 
$fa_uniÿ
 = ( 
	`is£t
(
$İciÚes
['fa_uniÿ'])è? $İciÚes['fa_uniÿ'] : 
FALSE
 ;

136 
$id’tifiÿdÜ
 = ( $identificador ) ? $identificador : 'id';

138 
$simbŞo
 = ( 
	`¡¼pos
(
$u¾
,'?'è==ğ
FALSE
 ) ? '?' : '&';

141 <
bË
 
ûÎ·ddšg
="0" 
ûÎ¥acšg
="0" 
bÜd”
="0" <?
php
 iàĞ
$bË_id
 ) 
echo
 'id="'.$bË_id.'"';?> 
şass
="dataTable">

143 <?
php


145 <?
php
 iàĞ
$cŞgroup
 ) { ?>

147 <
cŞgroup
>

148 <?
php
 
	`fÜ—ch
 ( 
$»s
[0] 
as
 
$cŞumÇ
 => 
$v®Ü
 ) { ?>

149 <?
php
 iàĞ
$cŞumÇ
 =ğ
$id’tifiÿdÜ
 && 
$ocuÉ¬_id
 ) ; ?>

150 <
cŞ
 
id
="col_<?phpƒcho htmlspecialchars($columna,ENT_QUOTES);?>">

151 <?
php
 } ?>

152 </
cŞgroup
>

154 <?
php
 } ?>

156 <
th—d
>

157 <
Œ
>

158 <?
php


160 iàĞ
$»s
 ) {

162 
	`fÜ—ch
 ( 
$»s
[0] 
as
 
$cŞumÇ
 => 
$v®Ü
 ) {

174 iàĞ
$cŞumÇ
 =ğ
$id’tifiÿdÜ
 && 
$ocuÉ¬_id
 ) ;

176 
$şa£
 = ( 
$cŞumÇ
 =ğ
$Üd’
 ) ? ' cÏss="'.
$to_Üd’
.'" ' : ' class="head" ';

178 iàĞ
$cŞumÇ
 =ğ
$Üd’
 ) {

180 
$to_Üd’2
 = ( 
$to_Üd’
 == 'asc' ) ? 'desc' : 'asc';

182 
$to_Üd’2
 = 'asc';

185 
$u¾_Üd’
 = 
	`cÚ¡ruœ_g‘
Ğ
	`¬¿y
 (
$this
->
sufijo
.'Üd’' => 
$cŞumÇ


186 , 
$this
->
sufijo
.'to_Üd’' => 
$to_Üd’2


187 , 
$this
->
sufijo
.'pagina' => 1)) ;

189 iàĞ
$’Ïûs
 && 
	`is£t
($’Ïûs[
$cŞumÇ
]) ) {

190 
$t™ulo_cŞumÇ
 = 
$’Ïûs
[
$cŞumÇ
]['titulo_columna'];

191 
$ÿmpo_’Ïzado
 = 
$’Ïûs
[
$cŞumÇ
]['campo_enlazado'];

192 
$’Ïûs_šicŸdos
[] = 
$ÿmpo_’Ïzado
;

193 } 
	`–£if
 ( 
	`is£t
(
$’Ïûs_šicŸdos
è&& 
	`š_¬¿y
(
$cŞumÇ
, $enlaces_iniciados) ) {

194 
$num_cŞumÇs
--;

196 } 
	`–£if
 ( 
	`is£t
(
$fa_uniÿ
è&& $fa_uniÿ =ğ
$cŞumÇ
 ) {

199 
$num_cŞumÇs
--;

202 
$t™ulo_cŞumÇ
 = 
$cŞumÇ
;

205 
echo
 "\n\t\t\t";

206 
echo
 "<th".
$şa£
.">";

207 iàĞ
$u¾
 ) 
echo
 "<¨h»f='".
	`html¥ecŸlch¬s
(
$u¾_Üd’
,
ENT_QUOTES
)."'>";

208 
echo
 "<h3>";

209 
echo
 
$t™ulo_cŞumÇ
;

210 
echo
 "</h3>";

211 iàĞ
$u¾
 ) 
echo
 "</a>";

212 
echo
 "</th>";

218 iàĞ
$v”
 ) {

219 
$num_cŞumÇs
++;

221 <
th
>

222 <
h3
>

223 <
img
 
¤c
='<?=self::$base_imagenes.self::$img_ver?>'

224 
width
='16' 
height
='16' 
bÜd”
='0' 
t™Ë
='Visualizar'

225 
®t
='[*]' />

226 </
h3
>

227 </
th
>

228 <?
php


231 iàĞ
$modifiÿr
 ) {

232 
$num_cŞumÇs
++;

234 <
th
>

235 <
h3
>

236 <
img
 
¤c
='<?=self::$base_imagenes.self::$img_modificar?>'

237 
width
='16' 
height
='16' 
bÜd”
='0' 
t™Ë
='Modificar'

238 
®t
='[#]' />

239 </
h3
>

240 </
th
>

241 <?
php


244 iàĞ
$–imš¬
 ) {

245 
$num_cŞumÇs
++;

247 <
th
>

248 <
h3
>

249 <
img
 
¤c
='<?=self::$base_imagenes.self::$img_borrar?>'

250 
width
='16' 
height
='16' 
bÜd”
='0' 
t™Ë
='Eliminar'

251 
®t
='[-]' />

252 </
h3
>

253 </
th
>

254 <?
php


258 
echo
 "\n\t</thead>";

259 
echo
 "\n\t<tbody>";

261 
$åi
 = 'evenrow';

263 
	`fÜ—ch
 ( 
$»s
 
as
 
$fa
 ) {

265 
$’Ïû
 = 
FALSE
;

267 
echo
 "\n\t\t<Œ cÏss='".
$åi
."'>";

269 
$cŞ
 = 0;

270 
	`fÜ—ch
 ( 
$fa
 
as
 
$key_cŞumÇ
 => 
$cŞumÇ
 ) {

272 
$cŞ
++;

275 
$şa£_cŞumÇ
 = ( 
$key_cŞumÇ
 =ğ
$Üd’
 ) ? ' cÏss="cŞ_'.
$cŞ
.' oddselected" ' : ' class="col_'.$col.'"' ;

279 iàĞ
$id’tifiÿdÜ
 && 
$key_cŞumÇ
 =ğ$id’tifiÿdÜ && 
$u¾
 ) {

282 
$’Ïû
 = 
$u¾
.
$cŞumÇ
;

288 iàĞ
$key_cŞumÇ
 =ğ
$id’tifiÿdÜ
 && 
$ocuÉ¬_id
 ) {

289 
$cŞ
--;

290 
echo
 '';

292 } 
	`–£if
 ( 
$’Ïûs
 && 
	`is£t
($’Ïûs[
$key_cŞumÇ
]) ) {

293 
$DATO
=
	`Œim
(
$cŞumÇ
);

294 
$ÿmpo_’Ïzado
 = 
$’Ïûs
[
$key_cŞumÇ
]['campo_enlazado'];

295 
$’Ïûs_ü—dos
[
$ÿmpo_’Ïzado
]['šicio'] = 
	`¥rštf
("\n\t\t\t<td %s><¨h»f='%s%s'>",
$şa£_cŞumÇ
,
$’Ïûs
[
$key_cŞumÇ
]['ba£_u¾'],
$DATO
);

296 iàĞ
	`is£t
(
$’Ïûs_ü—dos
[
$ÿmpo_’Ïzado
]['inicio']) && isset($enlaces_creados[$campo_enlazado]['final']) )

297 
echo
 
$’Ïûs_ü—dos
[
$ÿmpo_’Ïzado
]['inicio'].$enlaces_creados[$campo_enlazado]['final'];

299 } 
	`–£if
 ( 
	`is£t
(
$’Ïûs_ü—dos
[
$key_cŞumÇ
]) ) {

300 
$DATO
=
	`Œim
(
$cŞumÇ
);

301 
$şave_’Ïû
 = 
$key_cŞumÇ
;

302 
$’Ïûs_ü—dos
[
$şave_’Ïû
]['fš®'] = 
	`¥rštf
("%s</a></td>",
$DATO
);

303 iàĞ
	`is£t
(
$’Ïûs_ü—dos
[
$şave_’Ïû
]['inicio']) && isset($enlaces_creados[$clave_enlace]['final']) )

304 
echo
 
$’Ïûs_ü—dos
[
$şave_’Ïû
]['inicio'].$enlaces_creados[$clave_enlace]['final'];

306 } 
	`–£if
 ( 
	`is£t
(
$fa_uniÿ
è&& $fa_uniÿ =ğ
$key_cŞumÇ
 ) {

307 
$DATO
=
	`Œim
(
$cŞumÇ
);

308 
$§lida_fa_uniÿ
 .ğ
	`¥rštf
("\n\t\t<Œ><td cŞ¥ª='%s' %s>%s</td></Œ>",
$num_cŞumÇs
,
$şa£_cŞumÇ
,
$DATO
);

310 } 
	`–£if
 (
$key_cŞumÇ
 == "img" ) {

311 
$DATO
=
	`Œim
(
$cŞumÇ
);

312 
	`´štf
("\n\t\t\t<td".
$şa£_cŞumÇ
."> <img width='60px' src='%s' /></td>",
$DATO
);

314 } 
	`–£if
 (
$key_cŞumÇ
 == "%") {

315 
$DATO
=
	`Œim
(
$cŞumÇ
);

316 
	`´štf
("\n\t\t\t<td".
$şa£_cŞumÇ
." styË='bÜd”:0;'> <div styË='background-cŞÜ: #5db02d; width: \
%¥x'>%s</div></td>",
$DATO
,$DATO,$DATO);

321 iàĞ
$’Ïû
 ) {

322 
echo
 "\n\t\t\t<td".
$şa£_cŞumÇ
.">";

323 
echo
 "<¨h»f='".
$’Ïû
."'>";

324 
echo
 
$cŞumÇ
;

325 
echo
 "</a></td> " ;

327 
echo
 "\n\t\t\t<td".
$şa£_cŞumÇ
.">".
$cŞumÇ
."</td> " ;

334 ià(
$’Ïû
) {

336 iàĞ
$modifiÿr
 ) {

337 
echo
 "\n\t\t\t<td><¨h»f='$’Ïû&$acciÚ=".
$modifiÿr
."'>

338 <
img
 
¤c
='".self::$base_imagenes.self::$img_modificar."'

339 
width
='16' 
height
='16' 
bÜd”
='0' 
t™Ë
='Modificar'

340 
®t
='[#]' ></
a
></
td
>";

343 iàĞ
$–imš¬
 ) {

344 
echo
 "\n\t\t\t<td><a href='$enlace&$accion=$eliminar'>

345 <
img
 
¤c
='".self::$base_imagenes.self::$img_borrar."'

346 
width
='16' 
height
='16' 
bÜd”
='0' 
t™Ë
='Eliminar'

347 
®t
='[-]' ></
a
></
td
>";

350 iàĞ
$v”
 ) {

351 
echo
 "\n\t\t\t<td><a href='$enlace&$accion=ver'>

352 <
img
 
¤c
='".self::$base_imagenes.self::$img_ver."'

353 
width
='16' 
height
='16' 
bÜd”
='0' 
t™Ë
='ver'

354 
®t
='[*]' ></
a
></
td
>";

357 
$’Ïû
 = 
NULL
;

361 
echo
 "\n\t\t</tr>";

363 
$’Ïûs_ü—dos
 = 
	`¬¿y
();

364 iàĞ
$§lida_fa_uniÿ
 ) 
echo
 $salida_fila_unica;

365 
$§lida_fa_uniÿ
 = '';

367 
$åi
 = ( $fpi == 'evenrow' ) ? 'oddrow' : 'evenrow';

371 
echo
 "\n\t</tbody>";

372 
echo
 "</table>";

374 
	}
}

	@gcm/lib/int/autentificacion/lib/Autentificacion.php

1 <?
php


30 şas 
	cAu‹ÁifiÿciÚ
 {

34 
´iv©e
 
	m$pdo
;

38 
public
 
	m$sufijo
;

50 
´iv©e
 
	m$acciÚes
;

63 
funùiÚ
 
__cÚ¡ruù
(
PDO
 
$pdo
, 
$sufijo
='au', 
$acciÚes
 = 
FALSE
) {

65 
$this
->
pdo
 = 
$pdo
;

66 
	m$this
->
	msufijo
 = 
$sufijo
;

68 
	m$this
->
	macciÚes
 = ( 
$acciÚes
 ) ? $acciÚe : 
¬¿y
('admin' =>‡rray('administrar' =>‡rray('administrador')) ) ;

72 iàĞ! 
	m$this
->
exi¡e_bÏ
(
$this
->
sufijo
.'usu¬ios'èè$this->
ü—r_bÏ
();

76 
	m$sql
 = 'SELECT COUNT(*èFROM '.
$this
->
sufijo
.'usuarios u LEFT JOIN '.$this->sufijo.'r_usuarios_roles„ur ON„ur.usuarios_id = u.id WHERE„ur.roles_id=1';

78 iàĞ! 
	m$¡h
 = 
$this
->
pdo
->
´•¬e
(
$sql
) ) ;

80 ià(!
	m$¡h
->
execu‹
()) ;

82 
	m$¬Row
 = 
$¡h
->
ãtch
();

84 
fÜ—ch
(
$¬Row
 
as
 
$key
 => 
$v®ue
) {

85 
$num_admni¡¿dÜes
 = 
$v®ue
;

88 iàĞ
	m$num_admni¡¿dÜes
 < 1 )

89 
	m$this
->
ü—r_admš_deãùo
();

99 
funùiÚ
 
	$£t_acciÚes
(
$acciÚes
) {

100 
$this
->
acciÚes
 = 
	`¬¿y_m”ge
($this->acciÚes, 
$acciÚes
);

101 
	}
}

107 
funùiÚ
 
	$exi¡e_bÏ
(
$bÏ
) {

109 
Œy
 {

111 
$sql
 = 'SELECT COUNT(*èFROM '.
$bÏ
;

113 iàĞ! 
$¡h
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
) ) {

115 
	`»gi¡¿r
(
__FILE__
,
__LINE__
, 'Noƒxisteabla…ara usuarios†a creamos','AVISO');

116 
$this
->
	`ü—r_bÏ
();

120 ià(!
$¡h
->
	`execu‹
()) {

122 
$this
->
	`ü—r_bÏ
();

127 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

129  
FALSE
;

133  
TRUE
;

135 
	}
}

144 
funùiÚ
 
	$ü—r_bÏ
() {

146 iàĞ! 
$this
->
	`exi¡e_bÏ
($this->
sufijo
.'roles') ) {

148 
$SQL
 = "CREATE TABLE ".
$this
->
sufijo
."roles (

149 
id
 
INT
 
PRIMARY
 
KEY
,

150 
nomb»
 
	`v¬ch¬
(150è
NOT
 
NULL
,

151 
desüciÚ
 
	`v¬ch¬
(500è
NOT
 
NULL


155 iàĞ! 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

157 
throw
 
Ãw
 
	`Exû±iÚ
("E¼Ü‡Èü—¸bÏ d".
$this
->
sufijo
."rŞes\n".
$pdo_”rÜ
);

158  
FALSE
;

164 iàĞ! 
$this
->
	`exi¡e_bÏ
($this->
sufijo
.'r_usuarios_roles') ) {

166 
$SQL
 = "CREATE TABLE ".
$this
->
sufijo
."r_usuarios_roles (

167 
usu¬ios_id
 (11è
NOT
 
NULL
,

168 
rŞes_id
 (11è
NOT
 
NULL
,

169 
PRIMARY
 
	`KEY
 (
usu¬ios_id
,
rŞes_id
)

173 iàĞ! 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

175 
throw
 
Ãw
 
	`Exû±iÚ
("E¼Ü‡Èü—¸bÏ d".
$this
->
sufijo
."r_usu¬ios_rŞes\n".
$pdo_”rÜ
);

176  
FALSE
;

182 
$SQL
="CREATE TABLE ".
$this
->
sufijo
."usuarios (

183 
id
 
INT
 
PRIMARY
 
KEY
 
AUTO_INCREMENT
 ,

184 
usu¬io
 
	`CHAR
(50) ,

185 
·ss_md5
 
	`CHAR
(32) ,

186 
nomb»
 
	`CHAR
(50) ,

187 
­–lidos
 
	`CHAR
(50) ,

188 
ãcha_ü—ciÚ
 
d©‘ime
 
NOT
 
NULL
,

189 
ãcha_modifiÿciÚ
 
time¡amp
 
NOT
 
NULL
 
DEFAULT
 
CURRENT_TIMESTAMP
 ,

190 
ma
 
	`CHAR
(60) ,

191 
‹ËfÚo
 
	`CHAR
(15)

194 iàĞ! 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

196 
throw
 
Ãw
 
	`Exû±iÚ
("E¼Ü‡Èü—¸bÏ d".
$this
->
sufijo
."usu¬ios\n".
$pdo_”rÜ
);

197  
FALSE
;

201 
$this
->
	`ü—r_admš_deãùo
();

203 
	}
}

214 
funùiÚ
 
	$’Œ¬
(
$usu¬io
, 
$·ss
) {

216 
glob®
 
$_SESSION
;

218 
$sql
 = "SELECT id, usu¬iØFROM ".
$this
->
sufijo
."usuarios WHERE usuario=? AND…ass_md5=? LIMIT 1";

219 
$comªdo
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
);

220 iàĞ! 
$comªdo
->
	`execu‹
(
	`¬¿y
(
$usu¬io
, 
	`md5
(
$·ss
)) ) ) {

221 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

222 
$m’_”rÜ
 = 
$”r
[2];

223 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡Èš£¹¬„egi¡ro: '.
$m’_”rÜ
);

226 
$»tÜno
 = 
$comªdo
->
	`ãtchAÎ
(
PDO
::
FETCH_NUM
);

228 ià(!
$comªdo
) {

230 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

231 
$m’_”rÜ
 = 
$”r
[2];

232 
throw
 
Ãw
 
	`Exû±iÚ
('E¼ÜƒjecundØqu”y: '.
$m’_”rÜ
. ' sql: '.
$cÚsuÉa
);

233  
FALSE
;

235 } 
	`–£if
 ( 
	`couÁ
(
$»tÜno
) < 1 ) {

237 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Usuario o contraseÃ±a incorrecta','AVISO');

239  
FALSE
;

243 
	`li¡
(
$id
,
$usu¬io
èğ
$»tÜno
[0];

247 
$sql
 = "SELECT„.nomb» FROM ".
$this
->
sufijo
."roles„ LEFT JOIN ".$this->sufijo."r_usuarios_roles„ur ON„ur.roles_id=r.id WHERE„ur.usuarios_id=?";

248 
$comªdo
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
);

250 iàĞ! 
$comªdo
->
	`execu‹
(
	`¬¿y
(
$id
)) ) {

251 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

252 
$m’_”rÜ
 = 
$”r
[2];

253 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡Èš£¹¬„egi¡ro: '.
$m’_”rÜ
);

256 
$»tÜno
 = 
$comªdo
->
	`ãtchAÎ
(
PDO
::
FETCH_NUM
);

258 ià(!
$comªdo
) {

260 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

261 
$m’_”rÜ
 = 
$”r
[2];

262 
throw
 
Ãw
 
	`Exû±iÚ
('E¼ÜƒjecundØqu”y: '.
$m’_”rÜ
. ' sql: '.
$cÚsuÉa
);

263  
FALSE
;

265 } 
	`–£if
 ( 
	`couÁ
(
$»tÜno
) < 1 ) {

268 
$rŞes
[] = 'usuario';

272 
	`fÜ—ch
 ( 
$»tÜno
 
as
 
$rŞ
 ) {

273 
$rŞes
[] = 
$rŞ
[0];

279 
$_SESSION
[
$this
->
sufijo
.'id'] = 
$id
;

280 
$_SESSION
[
$this
->
sufijo
.'usu¬io'] = 
$usu¬io
;

281 
$_SESSION
[
$this
->
sufijo
.'rŞes'] = 
	`£rŸlize
(
$rŞes
);

283  
TRUE
;

285 
	}
}

293 
funùiÚ
 
	$log—do
() {

295 
glob®
 
$_SESSION
;

297  ( 
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'id']èè? $_SESSION[$this->sufijo.'id'] : 
FALSE
 ;

299 
	}
}

309 
funùiÚ
 
	$es_admš
() {

311 iàĞ! 
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'rŞes']èè 
FALSE
;

313 
$rŞes
 = 
	`un£rŸlize
(
$_SESSION
[
$this
->
sufijo
.'roles']);

315  
	`š_¬¿y
('admši¡¿dÜ',
$rŞes
) ;

317 
	}
}

325 
funùiÚ
 
	$id
() {

326  ( 
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'id']èè? $_SESSION[$this->sufijo.'id']: 
FALSE
 ;

327 
	}
}

344 
funùiÚ
 
	$rŞes_usu¬io
() {

346 iàĞ! 
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'rŞes']èè 
FALSE
;

348  
	`un£rŸlize
(
$_SESSION
[
$this
->
sufijo
.'roles']);

350 
	}
}

361 
funùiÚ
 
	$rŞes_acciÚ
(
$modulo
, 
$acciÚ
) {

363 
glob®
 
$gcm
;

365 iàĞ
	`is£t
(
$this
->
acciÚes
[
$modulo
][
$acciÚ
]) )  $this->acciones[$modulo][$accion];

367  
FALSE
;

369 
	}
}

379 
funùiÚ
 
³rmiso
(
$acciÚ
 = 'admši¡¿r', 
$modulo
 = 'admin') {

381 
glob®
 
$gcm
;

383 iàĞ
	gGCM_DEBUG
 ) 
	g$t›mpo_šicio
 = 
miüÙime
(
TRUE
);

385 
	g$usu¬io_id
 = 
$this
->
id
();

389 iàĞ! 
	g$usu¬io_id
 )  
	gFALSE
;

393 iàĞ
	g$gcm
->
	gau
->
es_admš
(èè 
	gTRUE
;

395 
	g$rŞes_usu¬io
 = 
$this
->
rŞes_usu¬io
();

396 
	g$rŞes_acciÚ
 = 
$this
->
rŞes_acciÚ
(
$modulo
,
$acciÚ
);

398 iàĞ! 
	g$rŞes_acciÚ
 ) {

399 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Sš…”miso ·¿ ['.
$modulo
.'->'.
$acciÚ
.'()]','DEBUG');

400 iàĞ
	gGCM_DEBUG
 )

401 
»gi¡¿r
(
__FILE__
,
__LINE__
,'T›mpØdejecuciÃ³Àd'.
__CLASS__
.'->'.
__FUNCTION__
.'('.
$acciÚ
.','.
$modulo
.'): ('.
round
(
miüÙime
(
TRUE
)-
$t›mpo_šicio
,4).')');

402  
	gFALSE
;

405 
fÜ—ch
 ( 
$rŞes_acciÚ
 
as
 
$rŞ_acciÚ
 ) {

406 iàĞ
š_¬¿y
(
$rŞ_acciÚ
, 
$rŞes_usu¬io
èè 
	gTRUE
;

409  
	gFALSE
;

421 
funùiÚ
 
	$§lœ
() {

423 iàĞ
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'id']èè
	`un£t
($_SESSION[$this->sufijo.'id']);

424 iàĞ
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'admš']èè
	`un£t
($_SESSION[$this->sufijo.'admin']);

425 iàĞ
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'rŞes']èè
	`un£t
($_SESSION[$this->sufijo.'roles']);

426 
	`£ssiÚ_de¡roy
();

427  
TRUE
;

429 
	}
}

438 
funùiÚ
 
	$ü—r_admš_deãùo
() {

442 
$sql
 = "INSERT INTO ".
$this
->
sufijo
."usuarios (id, usuario,…ass_md5, fecha_creacion, mail) VALUES ";

443 
$sql
 .= "(?,?,?,?,?)";

444 
$comªdo
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
);

445 iàĞ!
$comªdo
 ) {

446 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

447 
$m’_”rÜ
 = 
$”r
[2];

448 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡È´•¬¬ sql'.
$m’_”rÜ
);

451 iàĞ! 
$comªdo
->
	`execu‹
(
	`¬¿y
(1,'admš',
	`md5
('admš'),
	`d©e
('Y-m-d H:i'), 'root@localhost') ) ) {

452 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

453 
$m’_”rÜ
 = 
$”r
[2];

454 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡Èš£¹¬„egi¡ro: '.
$m’_”rÜ
);

457 
$sql
 = "INSERT INTO ".
$this
->
sufijo
."roles VALUES (1,'administrador','El‡dministradorieneodos†os…rivilegios');";

458 
$sql
 .ğ"INSERT INTO ".
$this
->
sufijo
."roles VALUES (2,'usuario','Usuario„egistrado');";

459 
$sql
 .ğ"INSERT INTO ".
$this
->
sufijo
."roles VALUES (3,'editor','Puede‡Ã±adir su…ropio contenido');";

460 
$sql
 .ğ"INSERT INTO ".
$this
->
sufijo
."roles VALUES (4,'traductor','Puede modificar†asraducciones');";

462 
$comªdo
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
);

463 iàĞ!
$comªdo
 ) {

464 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

465 
$m’_”rÜ
 = 
$”r
[2];

466 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡È´•¬¬ sql'.
$m’_”rÜ
);

469 iàĞ! 
$comªdo
->
	`execu‹
() ) {

470 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

471 
$m’_”rÜ
 = 
$”r
[2];

472 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡Èš£¹¬„egi¡ro: '.
$m’_”rÜ
);

475 
	`un£t
(
$comªdo
);

477 
$this
->
	`š£¹¬_rŞ_usu¬io
(1,1);

478 
$this
->
	`š£¹¬_rŞ_usu¬io
(1,2);

480 
	}
}

486 
funùiÚ
 
	$š£¹¬_rŞ_usu¬io
(
$usu¬io_id
, 
$rŞ_id
) {

488 
$sql
 = "INSERT INTO ".
$this
->
sufijo
."r_usu¬ios_rŞe VALUES (".
$usu¬io_id
.",".
$rŞ_id
.")";

490 
$comªdo
 = 
$this
->
pdo
->
	`exec
(
$sql
);

492 iàĞ!
$comªdo
 ) {

493 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

494 
$m’_”rÜ
 = 
$”r
[2];

495 
throw
 
Ãw
 
	`Exû±iÚ
('E¼Ü‡Èwjwcu¸sql: '.
$sql
."\n\n<b¸/>".
	`d•u¿r
(
$”r
));

504 
	}
}

	@gcm/lib/int/autentificacion/test/AutentificacionTest.php

1 <?
php


3 ià(!
defšed
("PHPUnit_MAIN_METHOD")) {

4 
defše
("PHPUnit_MAIN_METHOD", "AutentificacionTest::main");

7 
	g»quœe_Úû
 "PHPUnit/Framework/TestCase.php";

8 
	g»quœe_Úû
 "PHPUnit/Framework/TestSuite.php";

10 
	g»quœe_Úû
 '../lib/Autentificacion.php';

14 
	g$_SESSION
 = 
¬¿y
();

20 şas 
	cAu‹ÁifiÿciÚTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
 {

22 
´iv©e
 
	m$pdo
;

23 
´iv©e
 
	m$au
;

31 
public
 
funùiÚ
 
	$maš
() {

32 
»quœe_Úû
 "PHPUnit/TextUI/TestRunner.php";

34 
$su™e
 = 
Ãw
 
	`PHPUn™_F¿mewÜk_Te¡Su™e
("AutentificacionTest");

35 
$»suÉ
 = 
PHPUn™_TextUI_Te¡RuÂ”
::
	`run
(
$su™e
);

44 
´Ùeùed
 
funùiÚ
 
	$£tUp
() {

46 iàĞ
	`fe_exi¡s
('/tmp/au.db'èè
	`uÆšk
('/tmp/au.db');

48 
$this
->
pdo
 = 
Ãw
 
	`PDO
('sqlite:/tmp/au.db');

49 
$this
->
au
 = 
Ãw
 
	`Au‹ÁifiÿciÚ
($this->
pdo
);

51 
	}
}

59 
´Ùeùed
 
funùiÚ
 
	$‹¬Down
() {

60 iàĞ
	`fe_exi¡s
('/tmp/au.db'èè
	`uÆšk
('/tmp/au.db');

61 
	}
}

63 
public
 
funùiÚ
 
	$‹¡C»¬_bÏ
() {

64 
$this
->
	`as£¹True
(
	`fe_exi¡s
('/tmp/au.db'), 'Archivo de„egistro creado');

65 
	}
}

67 
public
 
funùiÚ
 
	$‹¡EÁ¿r
() {

69 
glob®
 
$_SESSION
;

71 
$this
->
	`as£¹True
($this->
au
->
	`’Œ¬
('admin','admin'), 'Archivo de„egistro creado');

72 
	}
}

74 
public
 
funùiÚ
 
	$‹¡Log—do
() {

76 
glob®
 
$_SESSION
;

78 
$this
->
	`as£¹Equ®s
($this->
au
->
	`log—do
(),1,'Hay sesiÃ³n‡ctiva');

79 
	}
}

81 
public
 
funùiÚ
 
	$‹¡Es_admš
() {

83 
glob®
 
$_SESSION
;

85 
$this
->
	`as£¹True
($this->
au
->
	`es_admš
(),'Hay sesiÃ³n‡ctiva');

87 
	}
}

92 ià(
	gPHPUn™_MAIN_METHOD
 == "AutentificacionTest::main") {

93 
Au‹ÁifiÿciÚTe¡
::
maš
();

	@gcm/lib/int/captcha/captcha.php

1 <?
php


19 
funùiÚ
 
ªyadœC­tcha
(
$nom
='deçuÉ', 
$»tÜn
='false') {

21 
$NC
=
$nom
."_cf_".
ÿ¿ù”_®—tÜio
();

22 
	g$_SESSION
[
$nom
.'_cf_'] = 
$NC
;

24 iàĞ
	g$»tÜn
 == 'false' ) {

25 
echo
 '<špuˆty³="hidd’"‚ame="'.
$NC
.'" v®ue="'.
time
().'" />';

27  '<špuˆty³="hidd’"‚ame="'.
	g$NC
.'" v®ue="'.
time
().'" />';

39 
funùiÚ
 
v”ifiÿrC­tcha
(
$£g
=10, 
$nom
='default'){

41 iàĞ! 
is£t
(
$_SESSION
[
$nom
.'_cf_']èè 
FALSE
;

42 iàĞ! 
is£t
(
$_POST
[
$_SESSION
[
$nom
.'_cf_']]èè 
	gFALSE
;

44 
	g$aùu®
 = 
time
();

45 
	g$fÜm
 = 
$_POST
[
$_SESSION
[
$nom
.'_cf_']];

46 
	g$diã»ncŸ
 = 
$aùu®
 - 
$fÜm
 ;

48 iàĞ
	g$diã»ncŸ
 < 
	g$£g
 || 
em±y
(
$fÜm
) ) {

49  
	gFALSE
;

51  
	gTRUE
;

60 
funùiÚ
 
	$ªyadœC­tchaImag’
() {

62 
glob®
 
$_ADMIN
 ;

64 
$ÿ±cha_‹xto
 = "";

66 
$i
 = 1; $i <= 4; $i++) {

67 
$ÿ±cha_‹xto
 .ğ
	`ÿ¿ù”_®—tÜio
();

70 
$_SESSION
["ÿ±cha_‹xto_£ssiÚ"] = 
$ÿ±cha_‹xto
;

74 <
img
 
width
='110px' 
height
='30px' 
¤c
="<?ph°echØ"../
lib
/
imgC­tcha
.
php
?".SID ; ?>" /><
br
>

75 <
šput
 
Çme
="‹xto_šg»§do" 
ty³
="‹xt" 
id
="‹xto_šg»§do" 
¡yË
='width: 55px' 
size
="6" 
maxËngth
="4" />

76 <?
php


78 
	}
}

84 
funùiÚ
 
	$ÿ¿ù”_®—tÜio
() {

86 
	`mt_¤ªd
(()
	`miüÙime
()*1000000);

88 
$v®Ü_®—tÜio
 = 
	`mt_¿nd
(1,3);

90 
$v®Ü_®—tÜio
) {

92 
$v®Ü_®—tÜio
 = 
	`mt_¿nd
(97, 122);

95 
$v®Ü_®—tÜio
 = 
	`mt_¿nd
(48, 57);

98 
$v®Ü_®—tÜio
 = 
	`mt_¿nd
(65, 90);

102  
	`chr
(
$v®Ü_®—tÜio
);

103 
	}
}

107 
funùiÚ
 
	$v”ifiÿrC­tchaImag’
(){

110 
$‹xto_šg»§do
 = 
	`¡¹Şow”
(
$_POST
["texto_ingresado"]);

112 
$ÿ±cha_‹xto
 = 
	`¡¹Şow”
(
$_SESSION
["captcha_texto_session"]);

114 ià(
$‹xto_šg»§do
 !ğ
$ÿ±cha_‹xto
) {

116  
FALSE
 ;

126 
	`un£t
(
$_SESSION
["captcha_texto_session"]);

127  
TRUE
;

129 
	}
}

	@gcm/lib/int/databoundobject/lib/Crud.php

1 <?
php


22 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/DataBoundObject.php');

24 
»quœe_Úû
(
GCM_DIR
.'lib/int/solicitud/lib/Solicitud.php');

47 şas 
	cCrud
 
ex‹nds
 
	mD©aBoundObjeù
 {

49 
public
 
	m$–em’tos_·gša
 = 10;

51 
public
 
	m$css_fÜmuÏrio
 = 
FALSE
 ;

53 
public
 
	m$u¾_ajax
;

79 
´Ùeùed
 
	m$to_bÏ
 = 'normal';

87 
´Ùeùed
 
funùiÚ
 
	$visu®izªdo_»gi¡ro
(è{  
FALSE
 ; }

121 
public
 
$İciÚes_¬¿y2bË
 = 
FALSE
;

129 
public
 
$cÚf_·gšadÜ
 = 
FALSE
;

131 
´Ùeùed
 
$ev’to_gu¬d¬
 = 
FALSE
;

132 
´Ùeùed
 
$ev’to_modifiÿr
 = 
FALSE
;

133 
´Ùeùed
 
$ev’to_bÜ¿r
 = 
FALSE
;

135 
´Ùeùed
 
$»¡ricciÚes
;

136 
´Ùeùed
 
$m’§jes
;

146 
´Ùeùed
 
$tos_fÜmuÏrio
;

154 
´Ùeùed
 
$id_»ÏciÚ
 = '_id';

158 
´Ùeùed
 
$¶ªtÏ
;

162 
´Ùeùed
 
$fich”o_css
;

186 
public
 
$sql_li¡ado
;

203 
´Ùeùed
 
$sql_li¡ado_»ÏciÚ
 = 
FALSE
;

209 
´Ùeùed
 
$äom_li¡ado
;

211 
´Ùeùed
 
$g®”Ÿ
 = 
FALSE
;

284 
´Ùeùed
 
$tos_ÿmpos
;

286 
´Ùeùed
 
$³rmisos
 = 
FALSE
;

288 
´Ùeùed
 
$acciÚ
 = 'ver';

294 
´Ùeùed
 
$dœ_img_¬¿y2bË
 = 
FALSE
;

300 
funùiÚ
 
	$__cÚ¡ruù
(
PDO
 
$objPdo
, 
$id
 = 
NULL
) {

302 
glob®
 
$gcm
;

304 
·»Á
::
	`__cÚ¡ruù
(
$objPdo
, 
$id
);

308 iàĞ
$this
->
to_bÏ
 == 'combinatoria' ) {

310 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

311 iàĞ! 
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$šdiû
]) ) {

312 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['tipo'] = "relacion";

313 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['bÏ'] = 
	`¡r_»¶aû
($this->
id_»ÏciÚ
,'',$indice);

314 
$mod–o_»ÏciÚado
 = 
	`ucfœ¡
(
$this
->
tos_fÜmuÏrio
[
$šdiû
]['tabla']);

315 
$id_»ÏciÚado
 = 
FALSE
;

316 
$»ÏciÚ
 = 
Ãw
 
	`$mod–o_»ÏciÚado
(
$this
->
objPDO
,
$id_»ÏciÚado
);

317 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['İciÚes'] = 
$»ÏciÚ
->
	`li¡ado_·¿_£Ëù
();

322 
$this
->
	`»¡ricciÚes_autom©iÿs
();

323 
$this
->
	`m’§jes_autom©icos
();

354 
	}
}

360 
funùiÚ
 
	$»¡ricciÚes
() {

361  
$this
->
»¡ricciÚes
;

362 
	}
}

368 
funùiÚ
 
	$m’§jes
() {

369  
$this
->
m’§jes
;

370 
	}
}

376 
funùiÚ
 
	$DefšeTabËName
() {

377  
	`¡¹Şow”
(
	`g‘_şass
(
$this
));

378 
	}
}

386 
funùiÚ
 
	$DefšeR–©iÚM­
(
$objPDO
) {

388 
$»ã»ncŸ_ÿmpos
 = 
	`¬¿y
();

390 
$driv”
 = 
$objPDO
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

392 
$driv”
) {

396 
$sql
 = 
	`¥rštf
("´agm¨bË_šfo('%s')",
$this
->
¡rTabËName
);

398 
$r¡
 = 
$objPDO
->
	`qu”y
(
$sql
è
Ü
 
	`d›
('E¼Ü‡Èbusÿ¸šfÜmaciÃ³À’†¨bÏ '.
$this
->
¡rTabËName
);

400  
$row
 = 
$r¡
->
	`ãtch
() ) {

402 iàĞ
$row
['name'] == 'id' ) {

404 
$»ã»ncŸ_ÿmpos
['id'] = 'ID';

408 
$»ã»ncŸ_ÿmpos
[
$row
['Çme']] = 
	`ucfœ¡
($row['name']);

410 
$this
->
	`defšœ_tos_ÿmpo
(
$row
, 
$objPDO
);

411 
$this
->
	`defšœ_tos_fÜmuÏrio
(
$row
, 
$objPDO
);

421 
$sql
 = 
	`¥rštf
Ğ"SHOW FIELDS FROM `%s`", 
$this
->
¡rTabËName
 );

423 
$r¡
 = 
$objPDO
->
	`qu”y
(
$sql
è
Ü
 
	`d›
('E¼Ü‡Èbusÿ¸šfÜmaciÃ³À’†¨bÏ '.
$this
->
¡rTabËName
);

425  
$row
 = 
$r¡
->
	`ãtch
() ) {

427 iàĞ
$row
['Field'] == 'id' ) {

429 
$»ã»ncŸ_ÿmpos
['id'] = 'ID';

433 
$»ã»ncŸ_ÿmpos
[
$row
['F›ld']] = 
	`ucfœ¡
($row['Field']);

435 
$this
->
	`defšœ_tos_ÿmpo
(
$row
, 
$objPDO
);

436 
$this
->
	`defšœ_tos_fÜmuÏrio
(
$row
, 
$objPDO
);

445  
$»ã»ncŸ_ÿmpos
;

447 
	}
}

458 
´iv©e
 
funùiÚ
 
	$defšœ_tos_ÿmpo
(
$row
, 
$objPDO
) {

460 
$driv”
 = 
$objPDO
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

462 iàĞ
$driv”
 == 'sqlite' ) {

464 iàĞ! 
	`is£t
(
$this
->
tos_ÿmpos
[
$row
['name']]['tipo']) ) $this->tipos_campos[$row['name']]['tipo'] = $row['type'];

465 iàĞ! 
	`is£t
(
$this
->
tos_ÿmpos
[
$row
['name']]['null']) ) $this->tipos_campos[$row['name']]['null'] = ( $row['notnull'] == 0 ) ? 1 : 0;

466 iàĞ!
	`em±y
(
$row
['DeçuÉ']è&& ! 
	`is£t
(
$this
->
tos_ÿmpos
[$row['name']]['default']) ) $this->tipos_campos[$row['name']]['default'] = $row['dflt_value'];

467 iàĞ!
	`em±y
(
$row
['ExŒa']è&& ! 
	`is£t
(
$this
->
tos_ÿmpos
[$row['name']]['extra']) ) $this->tipos_campos[$row['name']]['extra'] = $row['extra'];

471 
	`´eg_m©ch
("/\((.*)\)/",
$row
['ty³'],
$cošcid’cŸs
);

472 
$max
 = 
FALSE
;

473 iàĞ
	`is£t
(
$cošcid’cŸs
[1]) ) {

474 
$max
 = 
$cošcid’cŸs
[1];

475 iàĞ
	`¡½os
(
$max
,',') ) {

476 
$maxs
 = 
	`ex¶ode
(',',
$max
);

477 
$max
 = 
$maxs
[0] + $maxs[1] + 1;

479 
$this
->
tos_ÿmpos
[
$row
['Çme']]['max'] = 
$max
;

483 iàĞ
$row
['type'] == 'timestamp' || $row['type'] == 'datetime' ) {

484 
$max
=20;

485 
$this
->
tos_ÿmpos
[
$row
['Çme']]['max'] = 
$max
;

488 } 
	`–£if
 ( 
$row
['type'] == 'date' ) {

489 
$max
=10;

490 
$this
->
tos_ÿmpos
[
$row
['Çme']]['max'] = 
$max
;

498 iàĞ! 
	`is£t
(
$this
->
tos_ÿmpos
[
$row
['Field']]['tipo']) ) $this->tipos_campos[$row['Field']]['tipo'] = $row['Type'];

499 iàĞ! 
	`is£t
(
$this
->
tos_ÿmpos
[
$row
['Field']]['null']) ) $this->tipos_campos[$row['Field']]['null'] = $row['Null'];

500 iàĞ!
	`em±y
(
$row
['DeçuÉ']è&& ! 
	`is£t
(
$this
->
tos_ÿmpos
[$row['Field']]['default']) ) $this->tipos_campos[$row['Field']]['default'] = $row['Default'];

501 iàĞ!
	`em±y
(
$row
['ExŒa']è&& ! 
	`is£t
(
$this
->
tos_ÿmpos
[$row['Field']]['extra']) ) $this->tipos_campos[$row['Field']]['extra'] = $row['Extra'];

505 
	`´eg_m©ch
("/\((.*)\)/",
$row
['Ty³'],
$cošcid’cŸs
);

506 
$max
 = 
FALSE
;

507 iàĞ
	`is£t
(
$cošcid’cŸs
[1]) ) {

508 
$max
 = 
$cošcid’cŸs
[1];

509 iàĞ
	`¡½os
(
$max
,',') ) {

510 
$maxs
 = 
	`ex¶ode
(',',
$max
);

511 
$max
 = 
$maxs
[0] + $maxs[1] + 1;

513 
$this
->
tos_ÿmpos
[
$row
['F›ld']]['max'] = 
$max
;

517 iàĞ
$row
['Type'] == 'timestamp' || $row['Type'] == 'datetime' ) {

518 
$max
=20;

519 
$this
->
tos_ÿmpos
[
$row
['F›ld']]['max'] = 
$max
;

522 } 
	`–£if
 ( 
$row
['Type'] == 'date' ) {

523 
$max
=10;

524 
$this
->
tos_ÿmpos
[
$row
['F›ld']]['max'] = 
$max
;

532 
	}
}

543 
funùiÚ
 
	$defšœ_tos_fÜmuÏrio
(
$row
, 
$objPDO
) {

545 
$driv”
 = 
$objPDO
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

547 iàĞ
$driv”
 == 'sqlite' ) {

549 iàĞ
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo']) )  ;

551 iàĞ
	`is£t
(
$this
->
tos_ÿmpos
[
$row
['name']]['max']) ) {

552 iàĞ
$this
->
tos_ÿmpos
[
$row
['name']]['max'] > 150 ) {

553 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'textarea';

554 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['cols'] = '30';

555 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['rows'] = '3';

557 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'text';

558 
$this
->
tos_fÜmuÏrio
[
$row
['Çme']]['maxËngth'] = $this->
tos_ÿmpos
[$row['name']]['max'];

559 
$this
->
tos_fÜmuÏrio
[
$row
['Çme']]['size'] = ($this->
tos_ÿmpos
[$row['name']]['max'] > 30) ? 30 : $this->tipos_campos[$row['name']]['max'];

562 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'text';

567 iàĞ
	`¡½os
(
$row
['Çme'],
$this
->
id_»ÏciÚ
 ) !=ğ
FALSE
 ) {

569 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'relacion';

570 
$this
->
tos_fÜmuÏrio
[
$row
['Çme']]['bÏ'] = 
	`¡r_»¶aû
($this->
id_»ÏciÚ
,'',$row['name']);

576 iàĞ
$row
['name'] == 'pass_md5' ) {

577 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'pass_md5';

582 iàĞ
$row
['name'] == 'mail' ) {

583 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'mail';

588 iàĞ
$row
['name'] == 'imagen_url' ) {

589 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'imagen_url';

594 iàĞ! 
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo']) && $row['type'] == 'text' ) {

596 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'textarea';

597 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['cols'] = '30';

598 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['rows'] = '3';

604 iàĞ
$row
['type'] == 'date' ) {

606 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'fecha';

612 iàĞ
$row
['type'] == 'timestamp' || $row['type'] == 'datetime' ) {

614 
$this
->
tos_fÜmuÏrio
[
$row
['name']]['tipo'] = 'fecha_hora';

620 iàĞ
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo']) )  ;

622 iàĞ
	`is£t
(
$this
->
tos_ÿmpos
[
$row
['Field']]['max']) ) {

623 iàĞ
$this
->
tos_ÿmpos
[
$row
['Field']]['max'] > 150 ) {

624 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'textarea';

625 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['cols'] = '30';

626 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['rows'] = '3';

628 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'text';

629 
$this
->
tos_fÜmuÏrio
[
$row
['F›ld']]['maxËngth'] = $this->
tos_ÿmpos
[$row['Field']]['max'];

630 
$this
->
tos_fÜmuÏrio
[
$row
['F›ld']]['size'] = ($this->
tos_ÿmpos
[$row['Field']]['max'] > 30) ? 30 : $this->tipos_campos[$row['Field']]['max'];

633 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'text';

638 iàĞ
	`¡½os
(
$row
['F›ld'],
$this
->
id_»ÏciÚ
 ) !=ğ
FALSE
 ) {

640 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'relacion';

641 
$this
->
tos_fÜmuÏrio
[
$row
['F›ld']]['bÏ'] = 
	`¡r_»¶aû
($this->
id_»ÏciÚ
,'',$row['Field']);

647 iàĞ
$row
['Field'] == 'pass_md5' ) {

648 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'pass_md5';

653 iàĞ
$row
['Field'] == 'mail' ) {

654 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'mail';

659 iàĞ
$row
['Field'] == 'imagen_url' ) {

660 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'imagen_url';

665 iàĞ
$row
['Type'] == 'text' ) {

667 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'textarea';

668 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['cols'] = '30';

669 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['rows'] = '3';

675 iàĞ
$row
['Type'] == 'date' ) {

677 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'fecha';

683 iàĞ
$row
['Type'] == 'timestamp' || $row['Type'] == 'datetime' ) {

685 
$this
->
tos_fÜmuÏrio
[
$row
['Field']]['tipo'] = 'fecha_hora';

691 
	}
}

701 
funùiÚ
 
	$»¡ricciÚes_autom©iÿs
() {

703 
	`fÜ—ch
 ( 
$this
->
¬R–©iÚM­
 
as
 
$ÿmpo
 => 
$»ã»ncŸ
) {

705 iàĞ
$ÿmpo
 =ğ'ma' ) 
$this
->
»¡ricciÚes
[$ÿmpo][
RT_MAIL
] = 1;

707 iàĞ
$ÿmpo
 =ğ'·ss_md5' ) 
$this
->
»¡ricciÚes
[$ÿmpo][
RT_PASSWORD
] = 1;

709 iàĞ
$ÿmpo
 == 'fecha_creacion' || $campo == 'fecha_modificacion' ) ;

711 iàĞ
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['oculto_form']) && $this->tipos_formulario[$campo]['oculto_form'] == 1 ) ;

714 iàĞ! 
	`is£t
(
$this
->
»¡ricciÚes
[
$ÿmpo
][
RT_LONG_MAX
]è&& is£t($this->
tos_ÿmpos
[$campo]['max']) ) {

715 
$this
->
»¡ricciÚes
[
$ÿmpo
][
RT_LONG_MAX
] = $this->
tos_ÿmpos
[$campo]['max'];

719 iàĞ! 
	`is£t
(
$this
->
»¡ricciÚes
[
$ÿmpo
][
RT_REQUERIDO
]) &&

720 
	`is£t
(
$this
->
tos_ÿmpos
[
$ÿmpo
]['null']) &&

721 
$this
->
tos_ÿmpos
[
$ÿmpo
]['null'] == 'NO' &&

722 !
	`is£t
(
$this
->
tos_ÿmpos
[
$ÿmpo
]['Default']) ) {

724 
$this
->
»¡ricciÚes
[
$ÿmpo
][
RT_REQUERIDO
] = 1;

725 
$this
->
m’§jes
[
$ÿmpo
][
RT_REQUERIDO
] = 
	`l™”®
('Campo obligatorio',3);

731 
	}
}

737 
funùiÚ
 
	$m’§jes_autom©icos
() {

739 iàĞ
	`is£t
(
$this
->
»¡ricciÚes
) ) {

741 
	`fÜ—ch
 ( 
$this
->
»¡ricciÚes
 
as
 
$ÿmpo
 => 
$»¡ricciÚ
 ) {

743 
	`fÜ—ch
 ( 
$»¡ricciÚ
 
as
 
$to
 => 
$v®Ü
) {

745 iàĞ! 
	`is£t
(
$this
->
m’§jes
[
$ÿmpo
][
$to
]) ) {

747 
$to
) {

749 
RT_MAIL
:

750 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('El correo‚o…arece valido',3);

753 
RT_LONG_MIN
:

754 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Longitud minima',3);

757 
RT_LONG_MAX
:

758 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Longitud mÃ¡xima',3)

759 .' '.
$this
->
tos_ÿmpos
[
$ÿmpo
]['max'];

762 
RT_CARACTERES_PERMITIDOS
:

763 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Caracteres‚o…ermitidos',3);

766 
RT_CARACTERES_NO_PERMITIDOS
:

767 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Caracteres‚o…ermitidos',3);

770 
RT_MENOR_QUE
:

771 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Demasiado…equeÃ±o',3);

774 
RT_MAYOR_QUE
:

775 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Demasiado grande',3);

778 
RT_IGUAL_QUE
:

779 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('No coincide',3);

782 
RT_NO_IGUAL
:

783 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('No coincide',3);

786 
RT_PASA_EXPRESION_REGULAR
:

787 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Contenido‚o…ermitido',3);

790 
RT_NO_PASA_EXPRESION_REGULAR
:

791 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('Contenido‚o…ermitido',3);

794 
RT_PASSWORD
:

795 
$this
->
m’§jes
[
$ÿmpo
][
$to
] = 
	`l™”®
('ContraseÃ±a‚o…asa verificaciÃ³n',3);

806 
	}
}

813 
funùiÚ
 
	$v®Ües
(
$ÿmpo
,
$di¥ÏyHash
=
NULL
) {

815 iàĞ
	`is£t
(
$di¥ÏyHash
['VALORES'][
$ÿmpo
]) ) {

816  
$di¥ÏyHash
['VALORES'][
$ÿmpo
];

820 ià(
	`is£t
(
$this
->
ID
)) {

822 
$¡rR‘V®
 = 
$this
->
	`G‘AcûssÜ
(
	`ucfœ¡
(
$ÿmpo
));

824 iàĞ
$¡rR‘V®
 )  $strRetVal;

828 iàĞ
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['valor'] ) )

829  
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['valor'];

831  
FALSE
;

833 
	}
}

842 
funùiÚ
 
	$visu®iz¬_»gi¡ro
() {

846 
$§lida
 = 
$this
->
	`visu®izªdo_»gi¡ro
() ;

848 iàĞ
$§lida
 ) {

849 
echo
 
$§lida
;

853 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/Formulario.php');

855 
$di¥ÏyHash
 = ( 
	`is£t
($di¥ÏyHashèè? $di¥ÏyHash : 
NULL
;

859 
	`fÜ—ch
 ( 
$this
->
¬R–©iÚM­
 
as
 
$ÿmpo
 => 
$R
 ) {

861 iàĞ
$ÿmpo
 !ğ
	`¬¿y_£¬ch
('ID',
$this
->
¬R–©iÚM­
èè$this->
tos_fÜmuÏrio
[$ÿmpo]['v®Ü'] = $this->
	`v®Ües
($ÿmpo, 
$di¥ÏyHash
);

865 iàĞ
	`couÁ
(
$this
->
ÿmpos_šdiûs
) > 1 ) {

866 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

867 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['tipo'] = "relacion";

868 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['v®Ü'] = $this->
v®Ües
[$indice];

871 iàĞ
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['tabla']) ) {

872 
$mod–o_»ÏciÚado
 = 
	`ucfœ¡
(
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['tabla']);

873 
$id_»ÏciÚado
 = 
$this
->
	`G‘AcûssÜ
(
$ÿmpo
);

874 
$»ÏciÚ
 = 
Ãw
 
	`$mod–o_»ÏciÚado
(
$this
->
objPDO
,
$id_»ÏciÚado
);

875 
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['İciÚes'] = 
$»ÏciÚ
->
	`li¡ado_·¿_£Ëù
();

880 
$fÜm
 = 
Ãw
 
	`FÜmuÏrio
(
$this
->
tos_fÜmuÏrio
, 
$di¥ÏyHash
, $this->
»¡ricciÚes
, $this->
m’§jes
);

882 
$fÜm
->
css
 = 
$this
->
css_fÜmuÏrio
;

885 iàĞ
	`is£t
(
$this
->
¶ªtÏ_visu®iz¬
) ) {

886 
$fÜm
->
¶ªtÏ_visu®iz¬
 = 
$this
->plantilla_visualizar;

889 
$fÜm
->
	`g’”a_fÜmuÏrio
(
TRUE
, 
$this
->
acciÚ
);

891 iàĞ
$this
->
g®”Ÿ
 ) $this->g®”Ÿ->
	`šicŸ
();

893 
	}
}

900 
funùiÚ
 
	$g’”¬_fÜmuÏrio
(
$di¥ÏyHash
=
NULL
) {

902 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/Formulario.php');

906 
	`fÜ—ch
 ( 
$this
->
¬R–©iÚM­
 
as
 
$ÿmpo
 => 
$R
 ) {

909 iàĞ
$this
->
ID
 ) {

910 
$this
->
tos_fÜmuÏrio
[$this->
	`DefšeTabËName
().'_id']['v®Ü'] = $this->
ID
;

911 
$this
->
tos_fÜmuÏrio
[$this->
	`DefšeTabËName
().'_id']['oculto_form'] = 1;

916 iàĞ
	`couÁ
(
$this
->
ÿmpos_šdiûs
) > 1 ) {

917 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

918 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['tipo'] = "relacion";

919 
$this
->
tos_fÜmuÏrio
[
$šdiû
]['v®Ü'] = $this->
v®Ües
[$indice];

923 iàĞ
$ÿmpo
 !ğ
	`¬¿y_£¬ch
('ID',
$this
->
¬R–©iÚM­
èè$this->
tos_fÜmuÏrio
[$ÿmpo]['v®Ü'] = $this->
	`v®Ües
($ÿmpo, 
$di¥ÏyHash
);

925 iàĞ
	`is£t
(
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['tabla']) ) {

926 
$mod–o_»ÏciÚado
 = 
	`ucfœ¡
(
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['tabla']);

927 
$id_»ÏciÚado
 = 
$this
->
	`G‘AcûssÜ
(
$ÿmpo
);

928 
$»ÏciÚ
 = 
Ãw
 
	`$mod–o_»ÏciÚado
(
$this
->
objPDO
,
$id_»ÏciÚado
);

929 
$this
->
tos_fÜmuÏrio
[
$ÿmpo
]['İciÚes'] = 
$»ÏciÚ
->
	`li¡ado_·¿_£Ëù
();

934 
$fÜm
 = 
Ãw
 
	`FÜmuÏrio
(
$this
->
tos_fÜmuÏrio
, 
$di¥ÏyHash
, $this->
»¡ricciÚes
, $this->
m’§jes
);

936 iàĞ
$this
->
css_fÜmuÏrio
 ) 
$fÜm
->
css
 = $this->css_formulario;

939 iàĞ
	`is£t
(
$this
->
¶ªtÏ_ed™¬
èè
$fÜm
->
¶ªtÏ
 = $this->plantilla_editar;

942 <
fÜm
 
Çme
="üud" 
aùiÚ
="<?ph°iàĞis£t($_SERVER['REDIRECT_URL']èèechØ$_SERVER['REDIRECT_URL'];?>" 
m‘hod
="post">

943 <?
php


945 
$fÜm
->
	`g’”a_fÜmuÏrio
(
FALSE
, 
$this
->
acciÚ
);

947 iàĞ
$this
->
g®”Ÿ
 ) $this->g®”Ÿ->
	`šicŸ
();

950 <
p
 
şass
="bÙÚ”a_üud"><
šput
 
ty³
="subm™" 
Çme
="<?ph°echØ$this->DefšeTabËName(); ?>_gu¬d¬" 
v®ue
="Guardar"></p>

951 </
fÜm
>

952 <?
php


953 
	}
}

965 
funùiÚ
 
admši¡¿r
(
$cÚdiciÚ
 = 
FALSE
, 
$Üd”
 = FALSE, 
$dœ_img
 = '', 
$³rmisos
 = FALSE, 
$acciÚ_dœeùa
 = FALSE) {

967 
glob®
 
$gcm
;

969 
	g$this
->
	g³rmisos
 = 
$³rmisos
;

971 
	g$di¥ÏyHash
 = 
¬¿y
();

973 iàĞ
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_id']èè
	g$this
->
	gID
 = $_REQUEST[$this->DefineTableName().'_id'];

976 iàĞ! 
	g$this
->
	gID
 && 
is£t
(
$_SESSION
['VALORES'][
$this
->
DefšeTabËName
().'_id']) )

977 
	g$this
->
	gID
 = 
is£t
(
$_SESSION
['VALORES'][
$this
->
DefšeTabËName
().'_id']);

980 iàĞ
	g$this
->
	gID
 ) {

981 iàĞ! 
	g$this
->
	gblIsLßded
 ) {

982 iàĞ! 
	g$this
->
Lßd
() ) {

983 
»gi¡¿r
(
__FILE__
,
__LINE__
,'NØesi¡»gi¡rØ['.
$this
->
ID
.']','ERROR');

984  
	gFALSE
;

991 iàĞ
is£t
(
$_POST
[
$this
->
DefšeTabËName
().'_guardar']) ) {

992 
	g$this
->
	gacciÚ
 = 'guardando';

993 } 
–£if
 ( 
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_š£¹¬']è&& $this->
³rmisos
 ) {

994 
	g$this
->
	gacciÚ
 = 'insertar';

995 } 
–£if
 ( 
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_accio_galeria']) && $_REQUEST[$this->DefineTableName().'_accio_galeria'] == 'agafa_imatge' ) {

996 
$this
->
acciÚ
 = 'agafa_imatge';

997 } 
–£if
 ( 
is£t
(
$_SESSION
['RESPUESTA_ERRONEA']è|| is£t(
$_POST
[
$this
->
DefšeTabËName
().'_formulario'])) {

998 
	g$this
->
	gacciÚ
 = 'con_errores';

999 } 
–£if
 ( 
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_accion']) && $_REQUEST[$this->DefineTableName().'_accion'] == 'ver') {

1000 
$this
->
acciÚ
 = 'ver';

1001 } 
–£if
 ( 
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_accion']) && $_REQUEST[$this->DefineTableName().'_accion'] == 'eliminar') {

1002 
$this
->
acciÚ
 = 'eliminar';

1003 } 
–£if
 ( 
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_accion']) && $_REQUEST[$this->DefineTableName().'_accion'] == 'editar') {

1004 
$this
->
acciÚ
 = 'editar';

1005 } 
–£if
 ( 
$acciÚ_dœeùa
 ) {

1006 
	g$this
->
	gacciÚ
 = 
$acciÚ_dœeùa
;

1008 iàĞ
is£t
(
$_REQUEST
[
$this
->
DefšeTabËName
().'_id']) ) {

1009 
	g$this
->
	gacciÚ
 = 'ver';

1011 
	g$this
->
	gacciÚ
 = 'inicio';

1022 iàĞ
	g$this
->
	gacciÚ
 =ğ'agaç_im©ge' ) 
$this
->
g®”Ÿ
->
šicŸ
();

1024 iàĞ
	g$this
->
	gacciÚ
 == 'guardando' ) {

1026 
$sŞic™ud
 = 
Ãw
 
SŞic™ud
();

1027 
	g$sŞic™ud
->
S‘RedœeùOnCÚ¡¿štFau»
(
Œue
);

1028 
	g$_SESSION
['VALORES'] = 
$sŞic™ud
->
G‘P¬am‘”s
();

1030 iàĞ
is£t
(
$this
->
»¡ricciÚes
è&& ! 
em±y
($this->restricciones) ) {

1031 
	g$cÚ
=0;

1032 
fÜ—ch
 ( 
$this
->
»¡ricciÚes
(è
as
 
$ÿmpo
 => 
$»¡ricciÚ
 ) {

1033 
fÜ—ch
 ( 
$»¡ricciÚ
 
as
 
$to
 => 
$v®Ü
 ) {

1034 
$»¡ricciÚes
[
$cÚ
] = 
Ãw
 
Re¡ricciÚes
(
$to
, 
$v®Ü
);

1035 
	g$sŞic™ud
->
AddCÚ¡¿št
(
$ÿmpo
, 
ENTRADAS_POST
, 
$»¡ricciÚes
[
$cÚ
]);

1036 
	g$cÚ
++;

1041 
	g$sŞic™ud
->
Te¡CÚ¡¿šts
();

1047 
	g$»suÉado
 = 
$_POST
;

1049 iàĞ
	g$»suÉado
 ) {

1051 
fÜ—ch
 ( 
$this
->
¬R–©iÚM­
 
as
 
$ÿmpo
 => 
$rCampo
 ) {

1053 iàĞ
is£t
(
$this
->
ID
è&& 
$ÿmpo
 == 'fecha_creacion' ) {

1054 
$this
->
S‘AcûssÜ
(
$rCampo
, 
d©e
("Y-m-d H:i:s"));

1058 iàĞ
	g$ÿmpo
 == 'fecha_modificacion' ) {

1059 
$this
->
S‘AcûssÜ
(
$rCampo
, 
d©e
("Y-m-d H:i:s"));

1065 iàĞ
	g$ÿmpo
 =ğ'·ss_md5' && !
em±y
(
$»suÉado
[
$ÿmpo
]) ) {

1066 
$this
->
S‘AcûssÜ
(
$rCampo
, 
md5
(
$»suÉado
[
$ÿmpo
]));

1073 iàĞ
	g$ÿmpo
 =ğ'·ss_md5' && 
em±y
(
$»suÉado
[
$ÿmpo
]) ) {

1074 
$this
->
D–AcûssÜ
(
$rCampo
);

1078 iàĞ
	g$ÿmpo
 !ğ
¬¿y_£¬ch
('ID',
$this
->
¬R–©iÚM­
) ) {

1079 ià(
g‘_magic_quÙes_gpc
() == 1) {

1080 
$this
->
S‘AcûssÜ
(
$rCampo
, 
¡r¦ashes
(
$»suÉado
[
$ÿmpo
]));

1082 
	g$this
->
S‘AcûssÜ
(
$rCampo
, 
$»suÉado
[
$ÿmpo
]);

1089 iàĞ
	g$this
->
§ve
() ) {

1093 
	g$this
->
	gacciÚ
 = ( 
is£t
(
$this
->
ID
) ) ? 'modificando' : 'insertando';

1095 
	g$this
->
	gID
 = ( 
is£t
(
$this
->
ID
èè? $this->ID : $this->
uÉimo_id’tifiÿdÜ
();

1099 iàĞ
	g$this
->
	gev’to_gu¬d¬
 && $this->
	gacciÚ
 == 'insertando' ) {

1100 
$m‘odo
 = 
$this
->
ev’to_gu¬d¬
;

1101 
	g$this
->
$m‘odo
(
$this
->
ID
);

1103 iàĞ
	g$this
->
	gev’to_modifiÿr
 && $this->
	gacciÚ
 == 'modificando' ) {

1104 
$m‘odo
 = 
$this
->
ev’to_modifiÿr
;

1105 
	g$this
->
$m‘odo
(
$this
->
ID
);

1108 iàĞ
	g$this
->
	gg®”Ÿ
 ) $this->g®”Ÿ->
gu¬d¬
(
$this
->
ID
);

1110 
	g$m’s
 = ( 
$this
->
acciÚ
 == 'modificando' ) ? 'Registro modificado' : 'Registro incluido';

1111 
»gi¡¿r
(
__FILE__
,
__LINE__
,
l™”®
(
$m’s
,3),'AVISO');

1112 
un£t
(
$_SESSION
['VALORES']);

1114 
»gi¡¿r
(
__FILE__
,
__LINE__
,'ERROR‡l‡Ã±adir o modificar„egistro','ERROR');

1119 
	g$_SESSION
['dh'] = 
$di¥ÏyHash
;

1120 
	g$_SESSION
['m’s'] = 
$gcm
->
»g
->
£siÚ
;

1121 
	g$»dœecciÚ
 = 
$_SERVER
['REDIRECT_URL'];

1122 
h—d”
("LoÿtiÚ: ".
$»dœecciÚ
);

1123 
ex™
(0);

1127 } 
–£if
 ( 
$this
->
acciÚ
 == 'con_errores' ) {

1129 
$sŞic™ud
 = 
Ãw
 
SŞic™ud
();

1130 
	g$´obËmas
 = (
$sŞic™ud
->
IsRedœeùFŞlowšgCÚ¡¿štFau»
());

1131 
	g$di¥ÏyHash
['HADPROBLEMS'] = 
$´obËmas
;

1133 iàĞ
	g$´obËmas
 ) {

1135 
	g$objFašgReque¡
 = 
$sŞic™ud
->
G‘Origš®Reque¡ObjeùFŞlowšgCÚ¡¿štFau»
();

1136 
	g$¬CÚ¡¿štFau»s
 = 
$objFašgReque¡
->
G‘CÚ¡¿štFau»s
();

1138 
	g$di¥ÏyHash
["PROBLEMS"] = 
A¼ay
();

1140 
	g$m’§jes_”rÜ
 = 
$this
->
m’§jes
();

1142 
	g$i
=0; $i<=(
$¬CÚ¡¿štFau»s
)-1; $i++) {

1144 
	g$objThisCÚ¡¿štFau»
 = &
$¬CÚ¡¿štFau»s
[
$i
];

1145 
	g$objThisFašgCÚ¡¿štObjeù
 = 
$objThisCÚ¡¿štFau»
->
G‘FaedCÚ¡¿štObjeù
();

1146 
	g$štTy³OfFau»
 = 
$objThisFašgCÚ¡¿štObjeù
->
G‘CÚ¡¿štTy³
();

1147 
	g$nomb»_·¿m‘ro
 = 
$¬CÚ¡¿štFau»s
[
$i
]->
G‘P¬am‘”Name
();

1149 iàĞ
is£t
(
$m’§jes_”rÜ
[
$nomb»_·¿m‘ro
][
$štTy³OfFau»
]) ) {

1150 
	g$di¥ÏyHash
["PROBLEMS"][
$nomb»_·¿m‘ro
] = 
$m’§jes_”rÜ
[$nomb»_·¿m‘ro][
$štTy³OfFau»
];

1152 
	g$di¥ÏyHash
["PROBLEMS"][
$nomb»_·¿m‘ro
] = "Error sin definir";

1157 iàĞ
is£t
(
$_SESSION
['VALORES']) ) {

1158 
	g$di¥ÏyHash
['VALORES'] = 
$_SESSION
['VALORES'];

1159 
un£t
(
$_SESSION
['VALORES']);

1164 
	g$this
->
g’”¬_fÜmuÏrio
(
$di¥ÏyHash
);

1165 
	g$this
->
bÙÚes_acciÚes
(
$this
->
acciÚ
);

1167 } 
–£if
 ( 
$this
->
acciÚ
 == 'ver' ) {

1169 iàĞ! 
$this
->
ID
 ) {

1170 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Noƒxiste„egistro','ERROR');

1171  
	gFALSE
;

1174 
	g$this
->
visu®iz¬_»gi¡ro
();

1175 
	g$this
->
bÙÚes_acciÚes
(
$this
->
acciÚ
);

1177 } 
–£if
 ( 
$this
->
acciÚ
 == 'eliminar' ) {

1179 iàĞ! 
$this
->
ID
 ) {

1180 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Noƒxiste„egistro','ERROR');

1181  
	gFALSE
;

1185 iàĞ
	g$this
->
	gev’to_bÜ¿r
 ) {

1186 
	g$m‘odo
 = 
$this
->
ev’to_bÜ¿r
;

1187 
	g$this
->
$m‘odo
(
$this
->
ID
);

1190 
	g$this
->
M¬kFÜD–‘iÚ
();

1191 
	g$this
->
__de¡ruù
();

1193 
»gi¡¿r
(
__FILE__
,
__LINE__
,"Registroƒliminado",'AVISO');

1194 
h—d”
("LoÿtiÚ: ".
$_SERVER
['REDIRECT_URL']);

1195 
ex™
(0);

1197 } 
–£if
 ( 
$this
->
acciÚ
 == 'editar' ) {

1199 
$this
->
g’”¬_fÜmuÏrio
();

1200 
	g$this
->
bÙÚes_acciÚes
(
$this
->
acciÚ
);

1202 } 
–£if
 ( 
$this
->
acciÚ
 == 'insertar' ) {

1204 
$this
->
g’”¬_fÜmuÏrio
(
NULL
);

1205 
	g$this
->
bÙÚes_acciÚes
(
$this
->
acciÚ
);

1209 
	g$this
->
li¡ado
(
$cÚdiciÚ
, 
$Üd”
);

1210 
	g$this
->
bÙÚes_acciÚes
(
$this
->
acciÚ
);

1220 
funùiÚ
 
	$bÙÚes_acciÚes
(
$acciÚ
) {

1223 iàĞ! 
$this
->
³rmisos
 )  ;

1226 iàĞ!
	`is£t
(
$_REQUEST
['formato']) || $_REQUEST['formato'] != 'ajax' ) {

1228 
echo
 '<div class="botones_acciones">';

1231 iàĞ
$this
->
acciÚ
 == "ver" || $this->accion == "inicio" ) {

1232 
echo
 '<¨şass="fÜmuÏri2 bÙÚ" h»f="?'.
$this
->
	`DefšeTabËName
().'_š£¹¬=1">'.
	`l™”®
('Insertar',3).' </a>&nbsp;';

1236 iàĞ
$this
->
acciÚ
 !ğ"ed™¬" && $this->
ID
 ) {

1237 
echo
 ' <¨şass="fÜmuÏri2 bÙÚ" h»f="?'.
$this
->
	`DefšeTabËName
().'_acciÚód™¬&'.$this->DefšeTabËName().'_id='.$this->
ID
.'">'.
	`l™”®
('Editar',3).' </a>&nbsp;';

1241 iàĞ
$this
->
ID
 ) {

1242 
echo
 ' <¨Úşick="»tuº cÚfœm(\''.
	`l™”®
('CÚfœm¬ bÜ¿do').'\');" id="a_–imš¬_'.
$this
->
	`DefšeTabËName
().'" cÏss="fÜmuÏri2 bÙÚ" h»f="?'.$this->DefšeTabËName().'_acciÚólimš¬&'.$this->DefšeTabËName().'_id='.$this->
ID
.'">'.literal('Borrar',3).' </a>&nbsp;';

1246 iàĞ
$this
->
acciÚ
 == "editar" || $this->accion == 'insertar' ) {

1247 
echo
 ' <¨şass="fÜmuÏri2 bÙÚ" h»f="'.
$_SERVER
['PHP_SELF'].'">'.
	`l™”®
('Cancelar',3).' </a> ';

1250 
echo
 '</div>';

1253 
	}
}

1261 
funùiÚ
 
	$li¡ado
(
$cÚdiciÚ
 = 
FALSE
, 
$Üd”
 = FALSE) {

1263 
$sql
 = ( 
	`is£t
(
$this
->
sql_li¡ado
èè? $this->sql_li¡adØ: 'SELECT * FROM '.$this->
¡rTabËName
;

1267 iàĞ
$cÚdiciÚ
 ) {

1269 iàĞ
	`¡ros
(
$sql
,'GROUP'è!=ğ
FALSE
 ) {

1270 
$sql
 = 
	`¡r_œ•Ïû
('GROUP',' WHERE '.
$cÚdiciÚ
.' GROUP', $sql);

1272 
$sql
 .ğ' WHERE '.
$cÚdiciÚ
 ;

1277 
$Üd”
 = ( $Üd” ) ? ' ORDER BY '.$Üd” : ' ORDER BY '.
	`¬¿y_£¬ch
('ID',
$this
->
¬R–©iÚM­
).' desc';

1279 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmPDO/lib/paginarPDO.php');

1281 
$this
->
–em’tos
 = ( $this->
–em’tos_·gša
 ) ? $this->–em’tos_·gš¨: 
NULL
;

1283 
$pd
 = 
Ãw
 
	`Pagš¬PDO
(
$this
->
objPDO
, 
$sql
, $this->
¡rTabËName
.'_', $this->
–em’tos_·gša
, 
$Üd”
, $this->
sql_li¡ado_»ÏciÚ
);

1286 iàĞ
$this
->
cÚf_·gšadÜ
 ) {

1287 
	`fÜ—ch
(
$this
->
cÚf_·gšadÜ
 
as
 
$©r
 => 
$v®Ü
 ) {

1288 
$pd
->
$©r
 = 
$v®Ü
;

1292 iàĞ
$pd
->
	`v®id¬
() ) {

1294 iàĞ
$this
->
³rmisos
 ) {

1295 
$İciÚes
 = 
	`¬¿y
(

1296 'u¾' => '?'.
$this
->
	`DefšeTabËName
().'_id='

1301 ,'acciÚ' => 
$this
->
	`DefšeTabËName
().'_accion'

1303 ,'dœ_img' => ( 
$this
->
dœ_img_¬¿y2bË
 ) ? $this->dœ_img_¬¿y2bË : 
NULL


1306 
$İciÚes
 = 
	`¬¿y
(

1307 'u¾' => '?'.
$this
->
	`DefšeTabËName
().'_id='

1310 ,'acciÚ' => 
$this
->
	`DefšeTabËName
().'_accion'

1312 ,'dœ_img' => ( 
$this
->
dœ_img_¬¿y2bË
 ) ? $this->dœ_img_¬¿y2bË : 
NULL


1317 iàĞ
	`is£t
(
$this
->
İciÚes_¬¿y2bË
['op']) )

1318 
$İciÚes
 = 
	`¬¿y_m”ge
($İciÚes, 
$this
->
İciÚes_¬¿y2bË
['op']);

1322 
$´e£ÁaciÚ
 = ( 
	`is£t
(
$this
->
İciÚes_¬¿y2bË
['presentacion']) ) ?

1323 
$this
->
İciÚes_¬¿y2bË
['presentacion'] :

1326 
$pd
->
	`g’”¬_·gša
(
$this
->
u¾_ajax
, 
$İciÚes
, 
$´e£ÁaciÚ
);

1329 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Tabla sin contenido",'AVISO');

1332 
	}
}

	@gcm/lib/int/databoundobject/lib/DataBoundObject.php

1 <?
php


28 
ab¡¿ù
 cÏs 
	cD©aBoundObjeù
 {

30 
´Ùeùed
 
	m$ID
;

31 
´Ùeùed
 
	m$objPDO
;

32 
´Ùeùed
 
	m$¡rTabËName
;

33 
´Ùeùed
 
	m$¬R–©iÚM­
;

34 
´Ùeùed
 
	m$blFÜD–‘iÚ
;

35 
´Ùeùed
 
	m$blIsLßded
;

36 
´Ùeùed
 
	m$¬Modif›dR–©iÚs
;

46 
´Ùeùed
 
	m$ÿmpos_šdiûs
 = 
¬¿y
();

52 
´Ùeùed
 
	m$v®Ües
;

58 
ab¡¿ù
 
´Ùeùed
 
funùiÚ
 
DefšeTabËName
();

64 
ab¡¿ù
 
´Ùeùed
 
funùiÚ
 
DefšeR–©iÚM­
(
$objPDO
);

72 
funùiÚ
 
	$com´ob¬_šdiûs
() {

74 
$ÿmpo_šdiû
 = 
	`¬¿y_£¬ch
('ID',
$this
->
¬R–©iÚM­
);

76 
$this
->
ÿmpos_šdiûs
 = 
	`ex¶ode
(",",
$ÿmpo_šdiû
);

89 
public
 
funùiÚ
 
	$__cÚ¡ruù
(
PDO
 
$objPDO
, 
$id
 = 
NULL
) {

91 
$this
->
¡rTabËName
 = $this->
	`DefšeTabËName
();

92 
$this
->
¬R–©iÚM­
 = $this->
	`DefšeR–©iÚM­
(
$objPDO
);

93 
$this
->
objPDO
 = 
$objPDO
;

94 
$this
->
blIsLßded
 = 
çl£
;

95 ià(
	`is£t
(
$id
)è
$this
->
ID
 = $id;

96 
$this
->
¬Modif›dR–©iÚs
 = 
	`¬¿y
();

97 
$this
->
	`com´ob¬_šdiûs
();

99 
	}
}

105 
public
 
funùiÚ
 
	$Lßd
() {

107 ià(
	`is£t
(
$this
->
ID
)) {

109 
$šdiûs
 = 
	`ex¶ode
(",",
$this
->
ID
);

111 
$¡rQu”y
 = "SELECT ";

112 
	`fÜ—ch
 (
$this
->
¬R–©iÚM­
 
as
 
$key
 => 
$v®ue
) {

113 iàĞ
$v®ue
 == 'ID' ) {

114 
$¡rQu”y
 .ğ
$key
 . ",";

116 
$¡rQu”y
 .ğ'`'.
$key
 . "`,";

119 
$¡rQu”y
 = 
	`sub¡r
($¡rQu”y, 0, 
	`¡¾’
($strQuery)-1);

120 
$¡rQu”y
 .ğ" FROM " . 
$this
->
¡rTabËName
 . " WHERE ";

122 
$cÚdiciÚ
 = "";

123 
$cÚ
 = 0;

124 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

128 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

129 
$cÚdiciÚ
 .ğ
$šdiû
. "=:".$indice." AND ";

132 
$cÚ
++;

135 
$cÚdiciÚ
 = 
	`¹rim
($condicion,"AND ");

137 
$¡rQu”y
 .ğ
$cÚdiciÚ
;

139 
$objS‹m’t
 = 
$this
->
objPDO
->
	`´•¬e
(
$¡rQu”y
);

141 
$cÚ
 = 0;

142 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

145 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

146 
$objS‹m’t
->
	`bšdP¬am
(':'.
$šdiû
, 
$šdiûs
[
$cÚ
],

147 
PDO
::
PARAM_INT
);

149 
$cÚ
++;

152 
$objS‹m’t
->
	`execu‹
();

153 
$¬Row
 = 
$objS‹m’t
->
	`ãtch
(
PDO
::
FETCH_ASSOC
);

155 iàĞ! 
$¬Row
 ) {

156 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØexi¡»gi¡rØ['.
$this
->
ID
.']ƒÀ['.$this->
¡rTabËName
.']'."\nsql: ".
$¡rQu”y
,'ADMIN');

157 
$this
->
ID
 = 
FALSE
;

158  
FALSE
;

161 
	`fÜ—ch
(
$¬Row
 
as
 
$key
 => 
$v®ue
) {

165 iàĞ
	`š_¬¿y
(
$key
,
$this
->
ÿmpos_šdiûs
) ) {

166 
$¡rMemb”
 = 
$key
;

167 
$this
->
v®Ües
[
$¡rMemb”
] = 
$v®ue
;

169 
$¡rMemb”
 = 
$this
->
¬R–©iÚM­
[
$key
];

170 
$this
->
v®Ües
[
$¡rMemb”
] = 
$v®ue
;

174 
$this
->
blIsLßded
 = 
Œue
;

175  
TRUE
;

177 
	}
}

183 
public
 
funùiÚ
 
	$Save
() {

185 
$debug
 = '';

187 
$šdiûs
 = 
	`ex¶ode
(",",
$this
->
ID
);

189 ià(
	`is£t
(
$this
->
ID
)) {

191 
$¡rQu”y
 = 'UPDATE ' . 
$this
->
¡rTabËName
 . ' SET ';

193 
$§lida
 = 
FALSE
;

194 
	`fÜ—ch
 (
$this
->
¬R–©iÚM­
 
as
 
$key
 => 
$v®ue
) {

196 
$aùu®V®
 = ( 
	`is£t
(
$this
->
v®Ües
[
$v®ue
]èè? $this->v®Ües[$v®ue] : 
NULL
 ;

197 ià(
	`¬¿y_key_exi¡s
(
$v®ue
, 
$this
->
¬Modif›dR–©iÚs
)) {

198 
$§lida
 .ğ
$key
 . " = :$value, ";

203 iàĞ
	`couÁ
(
$this
->
ÿmpos_šdiûs
) > 1 ) {

204 
$cÚ
 = 0;

205 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

206 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

207 
$§lida
 .ğ
$šdiû
. "=:post_".$indice.", ";

209 
$cÚ
++;

213 iàĞ
$§lida
 ) 
$¡rQu”y
 .ğ
	`sub¡r
($§lida, 0, 
	`¡¾’
($salida)-2);

215 
$cÚdiciÚ
 = " WHERE ";

216 
$cÚ
 = 0;

217 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

221 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

222 
$cÚdiciÚ
 .ğ
$šdiû
. "=:".$indice." AND ";

225 
$cÚ
++;

228 
$cÚdiciÚ
 = 
	`¹rim
($condicion,"AND ");

230 
$¡rQu”y
 .ğ
$cÚdiciÚ
;

232 
	`un£t
(
$objS‹m’t
);

233 
$objS‹m’t
 = 
$this
->
objPDO
->
	`´•¬e
(
$¡rQu”y
);

235 
$cÚ
 = 0;

236 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

239 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

240 
$objS‹m’t
->
	`bšdP¬am
(':'.
$šdiû
, 
$šdiûs
[
$cÚ
],

241 
PDO
::
PARAM_INT
);

243 
$cÚ
++;

247 
	`fÜ—ch
 (
$this
->
¬R–©iÚM­
 
as
 
$key
 => 
$v®ue
) {

249 
$aùu®V®
 = ( 
	`is£t
(
$this
->
v®Ües
[
$v®ue
]èè? $this->v®Ües[$v®ue] : 
NULL
 ;

251 ià(
	`¬¿y_key_exi¡s
(
$v®ue
, 
$this
->
¬Modif›dR–©iÚs
)) {

253 ià((
	`is_št
(
$aùu®V®
))) {

254 
$debug
 .= "\nNumero: $value : $actualVal";

255 
$objS‹m’t
->
	`bšdV®ue
(':' . 
$v®ue
, 
$aùu®V®
,

256 
PDO
::
PARAM_INT
);

258 iàĞ
	`em±y
(
$aùu®V®
) ) $actualVal = '';

259 
$debug
 .= "\nCadena: $value : $actualVal";

260 
$objS‹m’t
->
	`bšdV®ue
(':' . 
$v®ue
, 
$aùu®V®
,

261 
PDO
::
PARAM_STR
);

267 iàĞ
	`couÁ
(
$this
->
ÿmpos_šdiûs
) > 1 ) {

268 
$cÚ
 = 0;

269 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

270 iàĞ
	`is£t
(
$_POST
[
$šdiû
]) ) {

271 
$objS‹m’t
->
	`bšdV®ue
(':po¡_' . 
$šdiû
, 
$_POST
[$indice],

272 
PDO
::
PARAM_INT
);

274 
$cÚ
++;

278 
Œy
 {

280 
$objS‹m’t
->
	`execu‹
();

282 } 
	`ÿtch
 (
PDOExû±iÚ
 
$e
) {

284 
$msg
 = 
$e
->
	`g‘Mes§ge
();

285 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$msg
,'ADMIN');

286  
FALSE
;

289  
TRUE
;

293 iàĞ
$this
->
	`driv”PDO
() == 'mysql' ) {

294 
$this
->
ID
 = 
NULL
;

296 
$this
->
ID
 = $this->
	`uÉimo_id’tifiÿdÜ
() + 1;

298 
$¡rV®ueLi¡
 = "";

299 iàĞ
$this
->
	`driv”PDO
() == 'mysql' ) {

300 
$¡rQu”y
 = 'INSERT INTO ' . 
$this
->
¡rTabËName
 . ' ( ';

302 
$¡rQu”y
 = 'INSERT INTO ' . 
$this
->
¡rTabËName
 . ' ( '.
	`¬¿y_£¬ch
('ID',$this->
¬R–©iÚM­
).',';

306 iàĞ
	`couÁ
(
$this
->
ÿmpos_šdiûs
) > 1 ) {

307 
$cÚ
 = 0;

308 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

309 iàĞ
	`is£t
(
$_POST
[
$šdiû
]) ) {

311 
$¡rQu”y
 .ğ
$šdiû
 . ', ';

312 
$¡rV®ueLi¡
 .= ":post_$indice, ";

314 
$cÚ
++;

319 
	`fÜ—ch
 (
$this
->
¬R–©iÚM­
 
as
 
$key
 => 
$v®ue
) {

321 
$aùu®V®
 = ( 
	`is£t
(
$this
->
v®Ües
[
$v®ue
]èè? $this->v®Ües[$v®ue] : 
NULL
 ;

322 ià(
	`is£t
(
$aùu®V®
)) {

323 ià(
	`¬¿y_key_exi¡s
(
$v®ue
, 
$this
->
¬Modif›dR–©iÚs
)) {

324 
$¡rQu”y
 .ğ
$key
 . ', ';

325 
$¡rV®ueLi¡
 .= ":$value, ";

330 
$¡rQu”y
 = 
	`sub¡r
($¡rQu”y, 0, 
	`¡¾’
($strQuery) - 2);

331 
$¡rV®ueLi¡
 = 
	`sub¡r
($¡rV®ueLi¡, 0, 
	`¡¾’
($strValueList) - 2);

332 iàĞ
$this
->
	`driv”PDO
() == 'mysql' ) {

333 
$¡rQu”y
 .= ") VALUES ( ";

335 
$¡rQu”y
 .ğ"èVALUES ( ".
$this
->
ID
.",";

337 
$¡rQu”y
 .ğ
$¡rV®ueLi¡
;

338 
$¡rQu”y
 .= ")";

340 
	`un£t
(
$objS‹m’t
);

342 
$objS‹m’t
 = 
$this
->
objPDO
->
	`´•¬e
(
$¡rQu”y
);

344 
	`fÜ—ch
 (
$this
->
¬R–©iÚM­
 
as
 
$key
 => 
$v®ue
) {

346 
$aùu®V®
 = ( 
	`is£t
(
$this
->
v®Ües
[
$v®ue
]èè? $this->v®Ües[$v®ue] : 
NULL
 ;

347 ià(
	`is£t
(
$aùu®V®
)) {

348 ià(
	`¬¿y_key_exi¡s
(
$v®ue
, 
$this
->
¬Modif›dR–©iÚs
)) {

349 ià((
	`is_št
(
$aùu®V®
)è|| ($aùu®V® =ğ
NULL
)) {

350 iàĞ! 
$objS‹m’t
->
	`bšdV®ue
(':' . 
$v®ue
, 
$aùu®V®
, 
PDO
::
PARAM_INT
) ) {

351 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Error‡Ã±adiendo datos: [$value] [$actualVal]",'ADMIN');

354 iàĞ! 
$objS‹m’t
->
	`bšdV®ue
(':' . 
$v®ue
, 
$aùu®V®
, 
PDO
::
PARAM_STR
) ) {

355 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Error‡Ã±adiendo datos: [$value] [$actualVal]",'ADMIN');

363 iàĞ
	`couÁ
(
$this
->
ÿmpos_šdiûs
) > 1 ) {

364 
$cÚ
 = 0;

365 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

366 iàĞ
	`is£t
(
$_POST
[
$šdiû
]) ) {

367 
$objS‹m’t
->
	`bšdV®ue
(':po¡_' . 
$šdiû
, 
$_POST
[$indice],

368 
PDO
::
PARAM_INT
);

370 
$cÚ
++;

375  
$objS‹m’t
->
	`execu‹
();

377 
	}
}

383 
public
 
funùiÚ
 
	$M¬kFÜD–‘iÚ
() {

384 
$this
->
blFÜD–‘iÚ
 = 
Œue
;

385 
	}
}

392 
public
 
funùiÚ
 
	$__de¡ruù
() {

394 ià(
	`is£t
(
$this
->
ID
)) {

396 
$šdiûs
 = 
	`ex¶ode
(",",
$this
->
ID
);

398 ià(
$this
->
blFÜD–‘iÚ
 =ğ
Œue
) {

400 
$¡rQu”y
 = 'DELETE FROM ' . 
$this
->
¡rTabËName
 . ' WHERE ';

402 
$cÚdiciÚ
 = "";

403 
$cÚ
 = 0;

404 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

408 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

409 
$cÚdiciÚ
 .ğ
$šdiû
. "=:".$indice." AND ";

412 
$cÚ
++;

415 
$cÚdiciÚ
 = 
	`¹rim
($condicion,"AND ");

416 
$¡rQu”y
 .ğ
$cÚdiciÚ
;

420 
$objS‹m’t
 = 
$this
->
objPDO
->
	`´•¬e
(
$¡rQu”y
);

422 
$cÚ
 = 0;

423 
	`fÜ—ch
 ( 
$this
->
ÿmpos_šdiûs
 
as
 
$šdiû
 ) {

426 iàĞ
	`is£t
(
$šdiûs
[
$cÚ
]) ) {

427 
$objS‹m’t
->
	`bšdP¬am
(':'.
$šdiû
, 
$šdiûs
[
$cÚ
],

428 
PDO
::
PARAM_INT
);

430 
$cÚ
++;

433 
Œy
 {

434 
$objS‹m’t
->
	`execu‹
();

435 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

436 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'E¼Ü cÚ BD: '.
$ex
->
	`g‘Mes§ge
(),'ERROR');

440 
	}
}

449 
public
 
funùiÚ
 
	$__ÿÎ
(
$¡rFunùiÚ
, 
$¬Argum’ts
) {

451 
$¡rM‘hodTy³
 = 
	`sub¡r
(
$¡rFunùiÚ
, 0, 3);

452 
$¡rM‘hodMemb”
 = 
	`sub¡r
(
$¡rFunùiÚ
, 3);

453 
$¡rM‘hodTy³
) {

455 (
$this
->
	`S‘AcûssÜ
(
$¡rM‘hodMemb”
, 
$¬Argum’ts
[0]));

458 (
$this
->
	`G‘AcûssÜ
(
$¡rM‘hodMemb”
));

460 (
çl£
);

461 
	}
}

470 
funùiÚ
 
	$S‘AcûssÜ
(
$¡rMemb”
, 
$¡rNewV®ue
) {

471 iàĞ
$¡rMemb”
 == 'ID' ) $strMember = 'id';

472 
$this
->
v®Ües
[
$¡rMemb”
] = 
$¡rNewV®ue
;

473 
$this
->
¬Modif›dR–©iÚs
[
$¡rMemb”
] = "1";

474 
	}
}

482 
funùiÚ
 
	$G‘AcûssÜ
(
$¡rMemb”
) {

483 ià(
$this
->
blIsLßded
 !ğ
Œue
) {

484 
$this
->
	`Lßd
();

486 iàĞ
$¡rMemb”
 == 'ID' ) $strMember = 'id';

487  ( 
	`is£t
(
$this
->
v®Ües
[
$¡rMemb”
]èè? $this->v®Ües[$¡rMemb”] : 
FALSE
 ;

488 
	}
}

500 
funùiÚ
 
	$D–AcûssÜ
(
$¡rMemb”
) {

501 iàĞ
$¡rMemb”
 == 'ID' ) $strMember = 'id';

502 iàĞ
	`is£t
(
$this
->
v®Ües
[
$¡rMemb”
]èè
	`un£t
($this->valores[$strMember]);

504 
	}
}

510 
public
 
funùiÚ
 
	$uÉimo_id’tifiÿdÜ
() {

512  
$this
->
	`driv”PDO
() ) {

515 
$sql
 = "£Ëù id from ".
$this
->
¡rTabËName
." order by id desc†imit 1;";

516 
$»suÉ
 = 
$this
->
objPDO
->
	`qu”y
(
$sql
)->
	`ãtch
(
PDO
::
FETCH_ASSOC
);

517 
$id
 = 
$»suÉ
['id'];

521 
$id
 = 
$this
->
objPDO
->
	`Ï¡I£¹Id
($this->
¡rTabËName
 . "_id_seq");

525 
$id
 = 
$this
->
objPDO
->
	`Ï¡In£¹Id
();

530  
$id
;

531 
	}
}

537 
funùiÚ
 
	$driv”PDO
() {

538  
$this
->
objPDO
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

539 
	}
}

551 
funùiÚ
 
	$fšd
(
$cÚdiciÚ
=
NULL
, 
$ÿmpos
=NULL, 
$Üd’
=NULL) {

553 
$»tÜno
 = 
	`¬¿y
();

555 iàĞ
$ÿmpos
 ) {

556 
$£ËcciÚ
 = '';

557 
$x
=0; $x<=
	`couÁ
(
$ÿmpos
)-1; $x++) {

558 
$£ËcciÚ
 .= " $campos[$x]";

559 iàĞ
$x
 < 
	`couÁ
(
$ÿmpos
)-1 ) 
$£ËcciÚ
 .= ',';

562 
$£ËcciÚ
 = '*';

565 
$sql
 = "S–eù $£ËcciÚ from ".
$this
->
¡rTabËName
;

567 iàĞ
$cÚdiciÚ
 ) 
$sql
 .= " WHERE $condicion";

569 iàĞ
	`is£t
(
$Üd’
èè
$sql
 .= " ORDER BY ".$orden;

571 
$objS‹m’t
 = 
$this
->
objPDO
->
	`´•¬e
(
$sql
);

572 
$objS‹m’t
->
	`execu‹
();

574 
$¬AÎ
 = 
$objS‹m’t
->
	`ãtchAÎ
(
PDO
::
FETCH_ASSOC
);

576 
$cÚ
 = 0;

577 
	`fÜ—ch
 ( 
$¬AÎ
 
as
 
$¬Row
 ) {

578 
	`fÜ—ch
(
$¬Row
 
as
 
$key
 => 
$v®ue
) {

579 
$»tÜno
[
$cÚ
][
$key
] = 
$v®ue
;

581 
$cÚ
++;

584  ( 
	`em±y
(
$»tÜno
èè? 
FALSE
 : $retorno;

586 
	}
}

593 
public
 
funùiÚ
 
	$li¡ado_·¿_£Ëù
() {

595  
$this
->
	`fšd
(
nuÎ
,
	`¬¿y
('id', 'nombre'),'id desc');

597 
	}
}

	@gcm/lib/int/databoundobject/lib/Formulario.php

1 <?
php


119 şas 
	cFÜmuÏrio
 {

123 
public
 
	m$¶ªtÏ
;

127 
public
 
	m$¶ªtÏ_visu®iz¬
;

131 
public
 
	m$css
 = 
FALSE
;

135 
´Ùeùed
 
	m$ÿmpos
;

139 
´Ùeùed
 
	m$di¥ÏyHash
;

143 
´Ùeùed
 
	m$»¡ricciÚes
;

147 
´Ùeùed
 
	m$m’§jes
;

158 
funùiÚ
 
	$__cÚ¡ruù
(
$ÿmpos
, 
$di¥ÏyHash
=
NULL
, 
$»¡ricciÚes
=
FALSE
, 
$m’§jes
=FALSE) {

160 
$this
->
»¡ricciÚes
 = 
$»¡ricciÚes
;

161 
$this
->
m’§jes
 = 
$m’§jes
;

162 
$this
->
ÿmpos
 = 
$ÿmpos
;

163 
$this
->
di¥ÏyHash
 = 
$di¥ÏyHash
;

165 
$this
->
¶ªtÏ
 = 
	`dœÇme
(
__FILE__
).'/../html/form_registro.html';

166 
$this
->
¶ªtÏ_visu®iz¬
 = 
	`dœÇme
(
__FILE__
).'/../html/registro.html';

168 
$this
->
css
 = 
	`dœÇme
(
__FILE__
).'/../css/formulario.css';

171 
	`uasÜt
(
$this
->
ÿmpos
, 'ordenar_por_peso');

181 
funùiÚ
 
	$v®Ües
(
$ÿmpo
) {

183  ( 
	`is£t
(
$this
->
ÿmpos
[
$ÿmpo
]['v®Ü']èè? $this->ÿmpos[$ÿmpo]['v®Ü'] : 
NULL
 ;

185 
	}
}

194 
funùiÚ
 
g’”a_fÜmuÏrio
(
$v”
 = 
FALSE
, 
$acciÚ
 = 'insertando') {

196 iàĞ
$v”
 ) {

197 
$¶ªtÏ
 = 
$this
->
¶ªtÏ_visu®iz¬
;

199 
	g$¶ªtÏ
 = 
$this
->
¶ªtÏ
;

202 ià(! 
fe_exi¡s
(
$¶ªtÏ
) ) {

203 
throw
 
Ãw
 
Exû±iÚ
('NØ£ƒncÚŒØ¶ªtÏ: '.
$¶ªtÏ
);

206 
»quœe
(
$¶ªtÏ
);

208 iàĞ
	g$this
->
	gcss
 && ! 
em±y
(
$this
->
css
) ) {

210 iàĞ! 
fe_exi¡s
(
$this
->
css
) ) {

211 
»gi¡¿r
(
__FILE__
,
__LINE__
,'ArchivØcÚ cs nØ’cÚŒadØ['.
$this
->
css
.']','ERROR');

214 <
	g¡yË
>

215 <?
php
 
»quœe
(
$this
->
css
); ?>

216 </
	g¡yË
>

217 <?
	gphp


223 <
	gsüt
>

224 <?
php
 
»quœe
(
dœÇme
(
__FILE__
).'/../js/validate.js'); ?>

225 
v¬
 
	gv®id©Ü
 = 
Ãw
 
FÜmV®id©Ü
('üud', [<?
php
 
echo
 
$this
->
ü—r_»¡ricciÚes
();?>], 
funùiÚ
(
”rÜs
, 
ev’ts
) {

226 ià(
”rÜs
.
Ëngth
 > 0) {

231 
§lida
 = 
”rÜs
.
još
("\n");

232 
®”t
(
§lida
);

235 <?=
$this
->
ü—r_m’§jes
();?>

236 </
	gsüt
>

237 <?
	gphp


248 
funùiÚ
 
	$ü—r_m’§jes
() {

250 
$m’
= "";

252 iàĞ
	`is£t
(
$this
->
m’§jes
) ) {

253 
	`fÜ—ch
 ( 
$this
->
m’§jes
 
as
 
$ÿmpo
 => 
$m’§jes
 ) {

255 
	`fÜ—ch
 ( 
$m’§jes
 
as
 
$»¡ricciÚ
 => 
$m’§je
 ) {

257 
$»¡ricciÚ
) {

259 
RT_MAIL
:

260 
$m’
.= "\nvalidator.setMessage('valid_email', '%s $mensaje');";

263 
RT_LONG_MIN
:

264 
$m’
.= "\nvalidator.setMessage('min_length', '%s $mensaje');";

267 
RT_LONG_MAX
:

268 
$m’
.= "\nvalidator.setMessage('max_length', '%s $mensaje');";

279 
RT_MENOR_QUE
:

280 
$m’
.= "\nvalidator.setMessage('greater_than', '%s $mensaje');";

283 
RT_MAYOR_QUE
:

284 
$m’
.= "\nvalidator.setMessage('less_than', '%s $mensaje');";

287 
RT_IGUAL_QUE
:

288 
$m’
.= "\nvalidator.setMessage('matches', '%s $mensaje');";

303 
RT_NO_ES_NUMERO
:

304 
$m’
.= "\nvalidator.setMessage('numeric', '%s $mensaje');";

307 
RT_REQUERIDO
:

308 
$m’
.= "\nvalidator.setMessage('required', '%s $mensaje');";

317 iàĞ
	`em±y
(
$m’
èè 
FALSE
;

319  
$m’
;

321 
	}
}

337 
funùiÚ
 
	$ü—r_»¡ricciÚes
() {

339 
$§lida
 = "";

341 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
)."/../../solicitud/lib/constantes.php");

343 iàĞ
	`is£t
(
$this
->
»¡ricciÚes
) ) {

345 
	`fÜ—ch
 ( 
$this
->
»¡ricciÚes
 
as
 
$ÿmpo
 => 
$»¡ricciÚes
 ) {

347 
	`fÜ—ch
 (
$»¡ricciÚes
 
as
 
$»¡ricciÚ
 => 
$v®Ü
) {

349 
$»¡ricciÚ
) {

351 
RT_MAIL
:

352 
$§lida
 .= "{

353 
Çme
: '$campo',

354 
ruËs
: 'valid_email'

358 
RT_LONG_MIN
:

359 
$§lida
 .= "{

360 
Çme
: '$campo',

361 
ruËs
: 'min_length[$valor]'

365 
RT_LONG_MAX
:

366 
$§lida
 .= "{

367 
Çme
: '$campo',

368 
ruËs
: 'max_length[$valor]'

386 
RT_MENOR_QUE
:

387 
$§lida
 .= "{

388 
Çme
: '$campo',

389 
ruËs
: 'greater_than[$valor]'

393 
RT_MAYOR_QUE
:

394 
$§lida
 .= "{

395 
Çme
: '$campo',

396 
ruËs
: 'less_than[$valor]'

397 
	}
},";

400 
	gRT_IGUAL_QUE
:

401 
$§lida
 .= "{

402 
Çme
: '$campo',

403 
	gruËs
: 'matches[$valor]'

428 
	gRT_NO_ES_NUMERO
:

429 
$§lida
 .= "{

430 
Çme
: '$campo',

431 
	gruËs
: 'numeric[$valor]'

435 
	gRT_REQUERIDO
:

436 
$§lida
 .= "{

437 
Çme
: '$campo',

438 
	gruËs
: 'required'

448 iàĞ
	$em±y
(
$§lida
èè 
FALSE
;

451 
$§lida
 = 
	`Œim
($salida, ',');

452  
$§lida
;

454 
	}
}

	@gcm/lib/int/formato/lib/Formato.php

1 <?
php


12 şas 
	cFÜm©o
 {

26 
funùiÚ
 
li¡a_»cursiva
(
$d©os
, 
$İciÚes
 = 
FALSE
, 
$fÜm©o
 = 'html') {

28 
$İ
 = 
¬¿y
(
$™em_visibË
 = 
FALSE


29 , 
$£ËcciÚabË
 = 
FALSE


30 , 
$checkqued
 = 
FALSE


31 , 
$muÉË
 = 
FALSE


32 , 
$¶ªtÏ
 = 
FALSE


35 iàĞ
	m$İciÚes
 ) 
	m$İ
 = 
¬¿y_m”ge
(
$İ
,
$İciÚes
);

40 
	m$™ems_a_desÿ¹¬
 = 
$this
->
desÿ¹¬
 ;

41 iàĞ
	m$ocuÉ¬
 ) 
	m$™ems_a_desÿ¹¬
[] = 
$ocuÉ¬
;

43 iàĞ(
	m$™ems_a_desÿ¹¬
) ) {

45 
	m$desÿ¹¬
 = 
FALSE
;

46 
fÜ—ch
 ( 
$™ems_a_desÿ¹¬
 
as
 
$desÿ¹ado
 ) {

47 iàĞ
¡½os
(
$·th
,
$desÿ¹ado
è!=ğ
FALSE
 ) {

48 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Desÿ¹ado: '.
$·th
. ' cošcidcÚ '.
$desÿ¹ado
);

49 
	m$desÿ¹¬
 = 
TRUE
;

52 
fÜ—ch
 ( 
$this
->
fŒo_£cciÚes
 
as
 
$desÿ¹ado
 ) {

53 iàĞ
¡½os
(
$·th
,
$desÿ¹ado
è!=ğ
FALSE
 ) {

54 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Desÿ¹ado: '.
$·th
. ' cošcidcÚ '.
$desÿ¹ado
);

55 
	m$desÿ¹¬
 = 
TRUE
;

59 iàĞ
	m$desÿ¹¬
 ) {

64 iàĞ
	m$ocuÉ¬
 ) $ocuÉ¬ = 
com´ob¬_b¬¿
(
$ocuÉ¬
,'eliminar');

65 
	m$·th
 = 
com´ob¬_b¬¿
(
$·th
,'eliminar');

66 
	m$nomb»_ÿmpo
 = 'seleccionado[]';

68 iàĞ
	m$muÉË
 ) {

69 
	m$to_ÿmpo
 = 'checkbox';

71 
	m$to_ÿmpo
 = 'radio';

75 iàĞ
	m$checkqued
 ) {

76 
	m$checkqued
 = 
com´ob¬_b¬¿
(
$checkqued
,'eliminar');

79 
	m$v”
='NO';

81 
	m$dœ_pÜ_deãùo
='Fe/'.
Rou‹r
::
$ii
;

82 
	m$d
 = 
dœ
(
$·th
);

83 
	m$HAY
="NO";

84 
	m$sub£cciÚes
 = 
¬¿y
();

85 
	m$docum’tos
 = 
¬¿y
();

86 
	m$’Œy
=
$d
->
»ad
()) {

88 ià(
is_dœ
(
$·th
."/".
$’Œy
) && $entry{0} != "." ) {

89 
$HAY
="SI";

90 
	m$sub£cciÚes
[]=
$·th
."/".
$’Œy
;

91 } 
–£if
 ( 
$v”Docum’tos
 && 
$’Œy
{0} != "." ) {

92 
$docum’tos
[
$·th
][]=
$’Œy
;

96 
	m$d
->
şo£
();

99 iàĞ
	m$·th_visibË
 ) {

100 
	m$·th1
 = 
ex¶ode
('/',
$d
->
·th
);

101 
	m$·th2
 = 
ex¶ode
('/',
$·th_visibË
);

105 iàĞ
š_¬¿y
(
$·th1
[
couÁ
($·th1)-1],
$·th2
) ) {

106 
	m$v”
='SI';

110 
	mecho
 "\n<ul>";

113 iàĞĞ
	m$v”
 =ğ'SI' ) || 
$d
->
·th
 =ğ
$dœ_pÜ_deãùo
) {

115 iàĞ
$d
->
·th
 =ğ
$checkqued
 ) {

116 
echo
 " <špuˆcheckedy³='".
$to_ÿmpo
."'‚ame='".
$nomb»_ÿmpo
."' v®ue='", 
htmËÁ™›s
(
$d
->
·th
), "' />";

117 } 
–£if
 ( 
$d
->
·th
 =ğ
$ocuÉ¬
 ) {

118 
echo
 "Descartado";

120 
	mecho
 " <špuˆty³='".
	m$to_ÿmpo
."'‚ame='".
	m$nomb»_ÿmpo
."' v®ue='", 
htmËÁ™›s
(
$d
->
·th
), "' />";

124 
	mecho
 " <špuˆty³='".
	m$to_ÿmpo
."'‚ame='".
	m$nomb»_ÿmpo
."' v®ue='", 
htmËÁ™›s
(
$d
->
·th
), "' />";

128 iàĞ
	m$HAY
 =ğ"SI" || 
$v”Docum’tos
) {

129 
echo
 "<¨h»f='#' cÏss='š‹¼ogª‹' onşick=\"visu®iz¬('",
htmËÁ™›s
(
$d
->
·th
),"');„eturn false;\" >";

130 
echo
 
ba£Çme
(
$d
->
·th
);

131 
	mecho
 "</a>";

133 
echo
 
ba£Çme
(
$d
->
·th
);

135 iàĞĞ
	m$v”
 =ğ'SI' ) || 
$d
->
·th
 =ğ
$dœ_pÜ_deãùo
 ) {

136 
echo
 "<div id='",
$d
->
·th
,"' class='toggle'>";

138 
	mecho
 "<div id='",
	m$d
->
	m·th
,"' class='toggle' style='display:‚one' >";

142 iàĞ
	m$v”Docum’tos
 ) {

143 iàĞ! 
em±y
(
$docum’tos
[
$d
->
·th
]è&& 
couÁ
($documentos[$d->path]) > 0 ) {

144 
fÜ—ch
Ğ
$docum’tos
[
$d
->
·th
] 
as
 
$doc
 ) {

145 
	mecho
 '<li>';

146 iàĞ
	mGUt
::
to_de_¬chivo
(
$d
->
·th
.'/'.
$doc
) == 'text/html' ) {

147 
echo
 '<span class="datos_fichero_html">';

149 
	mecho
 '<span class="datos_fichero">';

151 
	mecho
 "<špuˆty³='".
	m$to_ÿmpo
."'‚ame='".
	m$nomb»_ÿmpo
."' ";

152 
	mecho
 'v®ue="'.
htmËÁ™›s
(
$d
->
·th
."/".
$doc
).'" />';

154 iàĞ
esImag’
(
$d
->
·th
.'/'.
$doc
) ) {

155 
	mecho
 "<img‡lign='ûÁ”' width='50px' src='".
htmËÁ™›s
(
$d
->
·th
."/".
$doc
)."' />";

157 
	mecho
 '<¨t™Ë="'.
l™”®
('Visu®iz¬').'" h»f="?ed™òo&u¾='.
htmËÁ™›s
(
$d
->
·th
.'/'.
$doc
).'">';

158 
echo
 
	m$doc
;

159 
	mecho
 "</a>";

161 iàĞ
	mGUt
::
to_de_¬chivo
(
$d
->
·th
.'/'.
$doc
) == 'text/html' ) {

162 
echo
 '<¨t™Ë="'.
l™”®
('Ed™¬').'" h»f="?eód™¬_cÚ‹nido&u¾='.
htmËÁ™›s
(
$d
->
·th
.'/'.
$doc
).'"> [#]</a>';

164 
	mecho
 '<span class="detalles_fichero">';

165 
	mecho
 ' ['.
´e£Á¬By‹s
(
fesize
(
$d
->
·th
.'/'.
$doc
)).', '.
´e£Á¬Fecha
(
femtime
($d->path.'/'.$doc),2).']';

166 
	mecho
 '</span>';

167 
	mecho
 '</span>';

168 
	mecho
 '</li>';

173 
fÜ—ch
(
$sub£cciÚes
 
as
 
$x
) {

174 
	m$this
->
mo¡¿rSecciÚes
(
$x
, 
$·th_visibË
, 
$v”Docum’tos
, 
$£ËcciÚabË
, 
$fŒo
, 
$»cursivo
, 
$checkqued
, 
$muÉË
, 
$ocuÉ¬
);

177 
	mecho
 "</div>";

178 
	mecho
 "\n</ul>";

	@gcm/lib/int/galeria/lib/Galeria.php

1 <?
php


51 şas 
	cG®”Ÿ
 {

55 
public
 
	m$lim™_im©ges
 = 1;

56 
public
 
	m$g¿nd¬Ÿ_max
 = '520000';

57 
public
 
	m$am¶¬Ÿ_max
 = 640;

58 
public
 
	m$®tu¿_max
 = 
NULL
;

59 
public
 
	m$am¶ada_´e£Áacio
 = 140;

60 
public
 
	m$®tu¿_´e£Áacio
 = 
NULL
;

61 
public
 
	m$js_po¡_pujada
 = 
NULL
;

62 
public
 
	m$js_po¡_esbÜ¿
 = 
NULL
;

63 
public
 
	m$im©ge_e¥”a
 = '../imatges/uploading.gif';

65 
public
 
	m$cÚtšgut_’Îac_bÜ¿r
 = '<img src="../grafics/goma.gif" width="18" height="16" border="0">';

66 
public
 
	m$cŞÜ_bÜd
 = '#000';

67 
public
 
	m$dœ_tmp
 = 'tmp/';

68 
public
 
	m$u¾_¿iz
 = '../';

69 
public
 
	m$am¶ada_bÙo_fe
 = 30;

70 
public
 
	m$sufijo
 = '01_';

74 
´iv©e
 
	m$num_mšŸtu»s
 = 0;

75 
´iv©e
 
	m$imag’es
 = 
NULL
;

76 
´iv©e
 
	m$”rÜes
 = 
¬¿y
();

87 
´iv©e
 
	m$e¡ado
 = 
NULL
;

97 
´iv©e
 
	m$toG®”Ÿ
;

99 
´iv©e
 
	m$id’tifiÿdÜ
;

101 
´iv©e
 
	m$şa£_imag’
;

103 
´iv©e
 
	m$cÚf_im©ges
;

105 
´iv©e
 
	m$f™x”_js
;

119 
public
 
funùiÚ
 
	$__cÚ¡ruù
(
$cÚf_im©ges
, 
$id’tifiÿdÜ
=
NULL
) {

121 
$this
->
cÚf_im©ges
 = 
$cÚf_im©ges
;

122 
$this
->
imag’es
 = 
	`¬¿y
();

123 
$this
->
toG®”Ÿ
 = $this->
cÚf_im©ges
['tipo'];

124 
$this
->
id’tifiÿdÜ
 = 
$id’tifiÿdÜ
;

125 
$this
->
f™x”_js
 = 
	`dœÇme
(
__FILE__
).'/../js/galeria.js';

127 
$this
->
e¡ado
 = ( $this->
id’tifiÿdÜ
 ) ? 'visualizando' : 'insertando' ;

129 
$this
->
toG®”Ÿ
) {

132 
$this
->
şa£_imag’
 = 'ImagenesTablaArchivo';

135 
$this
->
şa£_imag’
 = 'ImagenesArchivo';

138 
$this
->
şa£_imag’
 = 'ImagenesMysql';

141 
$this
->
şa£_imag’
 = 'ImagenesTablaArchivo';

145 
	`»quœe
(
	`dœÇme
(
__FILE__
).'/'.
$this
->
şa£_imag’
.'.php');

153 
funùiÚ
 
	$subœ_imag’
() {

155 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ_tmp
) ) {

156 
$this
->
”rÜes
[] = "Sš dœeùÜiØ‹mpÜ®…¬¨imÃ¡g’e [".$this->
dœ_tmp
."]";

157  
FALSE
;

162 
$nIdThumb
 = 
$_POST
["nummin"];

163 
$®tu¿
 = 
$this
->
®tu¿_max
;

164 
$am¶¬Ÿ
 = 
$this
->
am¶¬Ÿ_max
;

168 
$fFeTmpName
 = 
$_FILES
['fimatge']['tmp_name'];

169 
$fFeName
 = 
$_FILES
['fimatge']['name'];

170 
$fFeSize
 = 
$_FILES
['fimatge']['size'];

171 
$fFeTy³
 = 
$_FILES
['fimatge']['type'];

172 
$fFeE¼Ü
 = 
$_FILES
['fimatge']['error'];

174 ià(
$fFeE¼Ü
==4){

176 
$fFeTmpName
 = 
nuÎ
;

177 
$fFeName
 = 
nuÎ
;

178 
$fFeSize
 = 
nuÎ
;

179 
$fFeTy³
 = 
nuÎ
;

181 
$this
->
”rÜes
[] = "No ha seleccionat cap fitxer";

182  
FALSE
;

187 ià(
$fFeE¼Ü
>0){

189 
$fFeE¼Ü
){

192 
$this
->
”rÜes
[] = "EÈf™x”‚ØpÙ su³¿¸Ë ".
$_POST
['MAX_FILE_SIZE']." bytes";

196 iàĞ
$_POST
['MAX_FILE_SIZE'] ) {

197 
$this
->
”rÜes
[] = "EÈf™x”‚ØpÙ su³¿¸Ë ".
$_POST
['MAX_FILE_SIZE']." bytes";

199 
$this
->
”rÜes
[] = 'El fitxer‡ superatƒl…es…ermÃ¨s…el servidor';

204 
$this
->
”rÜes
[] = "S'ha…roduit unƒrrorƒnƒl…rocÃ©s d'upload";

212 ià(!
	`is_u¶ßded_fe
(
$fFeTmpName
)){

214 
$this
->
”rÜes
[] = "S'ha…roduit unƒrrorƒnƒl…rocÃ©s d'upload del fitxer. Possible intent d'accÃ¨s‚o‡utoritzat‡l servidor";

218 
$vD©osImg
 = @
	`g‘imagesize
(
$_FILES
['fimatge']['tmp_name']);

221 ià(!
$vD©osImg
) {

223 
$this
->
”rÜes
[] = 'Error†legint informaciÃ³ d\'imatge';

227 ià(
	`is£t
(
$vD©osImg
['mime'])) {

228 
$sTo
 = 
$vD©osImg
['mime'];

229 } if(
	`is£t
(
$vD©osImg
[2])) {

230 
$sTo
 = 
	`image_ty³_to_mime_ty³
(
$vD©osImg
[2]);

231 } ià(
	`is£t
(
$iTo
)) {

232 
$sTo
 = 
	`image_ty³_to_mime_ty³
(
$iTo
);

235 iàĞ!
$sTo
 ) {

237 
$this
->
”rÜes
[] = 'Error†legint informaciÃ³ d\'imatge: mime';

241 
$sTo
){

243 
$fu’‹
 = 
	`imageü—‹äomgif
(
$fFeTmpName
è
Ü


244 
$this
->
”rÜes
[] = 'Errorreballant‡mb format d\'imatge gif,…rovi‡mb‡ltre format';

247 
$fu’‹
 = 
	`imageü—‹äomj³g
(
$fFeTmpName
è
Ü


248 
$this
->
”rÜes
[] = 'Errorreballant‡mb format d\'imatge jpeg,…rovi‡mb‡ltre format';

251 
$fu’‹
 = 
	`imageü—‹äom²g
(
$fFeTmpName
è
Ü


252 
$this
->
”rÜes
[] = 'Errorreballant‡mb format d\'imatge…ng,…rovi‡mb‡ltre format';

255 
$this
->
”rÜes
[] = 'E¼Ü»b®ÏÁ‡mb fÜm© d\'im©g'.
$sTo
.',…rovi‡mb‡ltre format';

260 iàĞ
	`em±y
(
$this
->
”rÜes
) ) {

262 
$am¶¬Ÿ_im©ge
 = 
$vD©osImg
[0];

263 
$®tu¿_im©ge
 = 
$vD©osImg
[1];

267 
$ŒªsfÜmacio
 = 
FALSE
;

269 iàĞ!
	`em±y
(
$am¶¬Ÿ
è&&ƒm±y(
$®tu¿
) ) {

272 
$®tu¿
 = 
$®tu¿_im©ge
 * 
$am¶¬Ÿ
 / 
$am¶¬Ÿ_im©ge
 ;

273 
$ŒªsfÜmacio
 = 
TRUE
;

275 } 
	`–£if
 ( !
	`em±y
(
$®tu¿
è&&ƒm±y(
$am¶¬Ÿ
) ) {

278 
$am¶¬Ÿ
 = 
$am¶¬Ÿ_im©ge
 * 
$®tu¿
 / 
$®tu¿_im©ge
 ;

279 
$ŒªsfÜmacio
 = 
TRUE
;

281 } 
	`–£if
 ( !
	`em±y
(
$®tu¿
è&& !em±y(
$am¶¬Ÿ
) ) {

284 
$ŒªsfÜmacio
 = 
TRUE
;

290 iàĞ
$ŒªsfÜmacio
 && ( 
$am¶¬Ÿ_im©ge
 > 
$am¶¬Ÿ
 || 
$®tu¿_im©ge
 > 
$®tu¿
 ) ) {

292 
$nova_im©ge
ğ
	`ImageC»©eTrueCŞÜ
(
$am¶¬Ÿ
, 
$®tu¿
)

293 
Ü
 
$nova_im©ge
=
	`ImageC»©e
(
$am¶¬Ÿ
, 
$®tu¿
);

295 
	`ImageCİyResized
(
$nova_im©ge
,
$fu’‹
,0,0,0,0,
$am¶¬Ÿ
,
$®tu¿
,
$am¶¬Ÿ_im©ge
,
$®tu¿_im©ge
);

306 
$sTo
){

308 
	`imagegif
(
$nova_im©ge
,
$fFeTmpName
);

311 
	`imagej³g
(
$nova_im©ge
,
$fFeTmpName
, 100);

314 
	`imag•ng
(
$nova_im©ge
,
$fFeTmpName
, 9);

317 
$this
->
”rÜes
[] = 'E¼Ü»b®ÏÁ‡mb fÜm© d\'im©g'.
$sTo
.',…rovi‡mb‡ltre format';

321 
$fLogoSize
 = 
	`fesize
(
$fFeTmpName
);

326 
$nom_im©ge
 = 
$fFeName
 ;

327 
$¤c_img
 = 
$this
->
dœ_tmp
.
$nom_im©ge
;

329 iàĞ! 
	`»Çme
(
$fFeTmpName
,
$¤c_img
) ) {

330 
$this
->
”rÜes
[] = 'No se…udo guardar imagenƒn directorioemporal';

341 
$¤c_img
 = ( 
	`is£t
($src_img) ) ? $src_img : '';

344 <!
DOCTYPE
 
html
 
PUBLIC
 "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

345 <
html
 
xmÊs
="http://www.w3.org/1999/xhtml">

346 <
h—d
>

347 <
t™Ë
></title>

348 <
m‘a
 
h‰p
-
equiv
="CÚ‹Á-Ty³" 
cÚ‹Á
="text/html; charset=iso-8859-1">

349 </
h—d
>

351 <
süt
 
Ïnguage
="JavaScript">

353 ià(
docum’t
.
images
) {

354 
thumbIO
 = 
Ãw
 
	`Image
();

355 
thumbIO
.
¤c
='<?phpƒcho $this->url_raiz.$src_img;?>';

358 
funùiÚ
 
	`showResuÉ
(){

360 <?
php
 ià(
	`em±y
(
$this
->
”rÜes
)) { ?>

363 
oThumb
 = 
·»Á
.
docum’t
.
	`g‘EËm’tById
('thumbIMG<?phpƒcho $nIdThumb;?>');

365 
oThumb
.
¤c
 = 
thumbIO
.src;

369 
v¬
 
šput_im©ge
 = 
docum’t
.
	`ü—‹EËm’t
('input');

370 
šput_im©ge
.
Çme
 = 'imatges_formulari[]';

371 
šput_im©ge
.
v®ue
 = 
thumbIO
.
¤c
;

372 
šput_im©ge
.
ty³
 = 'text';

373 
šput_im©ge
.
¡yË
.
di¥Ïy
 = 'none';

374 
oThumb
.
	`­³ndChd
(
šput_im©ge
);

377 
oThumbBu‰Ú
 = 
·»Á
.
docum’t
.
	`g‘EËm’tById
('buttonDIV<?phpƒcho $nIdThumb;?>');

378 
oThumbBu‰Ú
.
šÃrHTML
 = '<a href=\"javascript:esborrarImatge(\'<?=$this->sufijo?>\',<?phpƒcho $nIdThumb;?>);\"><?=$this->contingut_enllac_borrar?></a>';

380 <?
php
 } { ?>

383 <?
php
 
	`fÜ—ch
 ( 
$this
->
”rÜes
 
as
 
$”rÜ
 ) { ?>

384 
·»Á
.
	`showMes§geBßrd
('<?phpƒcho‡ddslashes($error);?>');

385 <?
php
 } ?>

388 
oThumb
 = 
·»Á
.
docum’t
.
	`g‘EËm’tById
('thumbDIV<?phpƒcho $nIdThumb;?>');

389 
oThumb
.
¡yË
.
di¥Ïy
 = 'none';

391 
·»Á
.
docum’t
.
	`g‘EËm’tById
('<?=$this->sufijo?>fim©ge').
¡yË
.
di¥Ïy
 = 'block';

393 <?
php
 } ?>

397 
wšdow
.
Úlßd
 = 
showResuÉ
;

399 </
süt
>

401 <
body
>

402 <?
php


403 iàĞ
	`em±y
(
$this
->
”rÜes
) ) {

404 
echo
 '<img src="'.
$this
->
u¾_¿iz
.
$¤c_img
.'"/>';

406 
	`fÜ—ch
 ( 
$this
->
”rÜes
 
as
 
$”rÜ
 ) 
echo
 '<br />- '.$error;

410 </
body
>

411 </
html
>

412 <?
php


413 
	`ex™
();

415 
	}
}

424 
public
 
funùiÚ
 
	$šicŸ
() {

426 iàĞ
	`is£t
(
$_GET
['accio_galeria']) && $_GET['accio_galeria'] == 'agafa_imatge' ) {

428 
$this
->
	`subœ_imag’
();

432 
$this
->
	`´e£ÁaG®”Ÿ
();

436 
	}
}

445 
funùiÚ
 
	$gu¬d¬
(
$id_bÏ
) {

447 iàĞ
	`is£t
(
$_POST
['imatges_formulari']) ) {

448 
	`fÜ—ch
 ( 
$_POST
['im©ges_fÜmuÏri'] 
as
 
$nomb»_imag’
 ) {

449 
$img
 = 
Ãw
 
$this
->
	`şa£_imag’
($this->
cÚf_im©ges
,
$id_bÏ
);

450 
$img
->
	`gu¬d¬
(
$nomb»_imag’
);

451 
$this
->
	`addI‹m
(
$img
);

455 ià(
	`is£t
(
$_POST
['imatges_borrar']) ) {

457 
	`fÜ—ch
 ( 
$_POST
['im©ges_bÜ¿r'] 
as
 
$nomb»_imag’
 ) {

458 
$img
 = 
Ãw
 
$this
->
	`şa£_imag’
($this->
cÚf_im©ges
,
$id_bÏ
);

459 
$img
->
	`bÜ¿r
(
$nomb»_imag’
);

460 
$this
->
	`»moveI‹m
(
$img
);

465 
	}
}

475 
public
 
funùiÚ
 
	$´e£ÁaG®”Ÿ
(
$nom_im©ge_‹mpÜ®
=
NULL
) {

477 
echo
 '<script†anguage="JavaScript">';

478 
	`šşude_Úû
(
$this
->
f™x”_js
);

479 
echo
 '</script>';

482 iàĞ
$this
->
id’tifiÿdÜ
 ) {

483 
$this
->
	`»cog”_imag’es_g®”Ÿ
();

488 <
div
 
şass
="g®”Ÿ_im©ges" 
id
="<?=$this->sufijo?>galeria">

489 <
šput
 
ty³
="hidd’" 
Çme
="MAX_FILE_SIZE" 
v®ue
="<?phpƒcho $this->grandaria_max;?>" />

490 <
šput
 
ty³
="hidd’" 
id
="<?=$this->sufijo?>nummš" 
Çme
="nummš" 
v®ue
="<?=$this->num_miniatures?>" />

491 <
šput
 
ty³
="hidd’" 
id
="<?=$this->sufijo?>tÙ®_mšŸtu¿s" 
Çme
="tÙ®_mšŸtu¿s" 
v®ue
="<?=$this->num_miniatures?>" />

492 <
šput
 
ty³
="hidd’" 
Çme
="e¡ado" 
v®ue
="<?=$this->estado?>" />

493 <
šput
 
ty³
="hidd’" 
Çme
="id’tifiÿdÜ" 
v®ue
="<?=$this->identificador?>" />

494 <
šput
 
id
="<?=$this->sufijo?>fim©ge" 
Çme
="fimatge"

495 <?
php
 iàĞ
$nom_im©ge_‹mpÜ®
 ) {

496 
echo
 'v®ue="'.
$im©ge
.'"ype="text"';

498 
echo
 'ype="file" ';

500 <?
php
 iàĞ
$this
->
num_mšŸtu»s
 >ğ$this->
lim™_im©ges
 ) 
echo
 " style='display:‚one;'"; ?>

501 
size
="<?phpƒcho $this->amplada_boto_file; ?>"

502 <?
php
 iàĞ
$this
->
js_po¡_pujada
 ) { ?>

503 
Úchªge
="javascript:…ujarImatge(this.form,<?=$this->limit_imatges?>,'<?=$this->js_post_pujada?>');" />

504 <?
php
 } { ?>

505 
Úchªge
="javascript:…ujarImatge(this.form,<?=$this->limit_imatges?>);" />

506 <?
php
 } ?>

507 <
iäame
 
Çme
="äameIm©ge" 
width
="100%" 
height
="200px" 
¡yË
="display:none;"></iframe>

508 </
div
>

510 <?
php


512 
$this
->
	`ÿixa_g®”Ÿ
();

513 
$this
->
	`ÿixa_mis§tges
();

517 
echo
 '<style>';

518 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../css/galeria.css');

519 
echo
 '</style>';

520 
	}
}

524 
funùiÚ
 
	$ÿixa_mis§tges
() {

527 <
div
 
id
="mes§geBßrdDIV" 
¡yË
="display:none;">

528 <
div
>&
nb¥
;</div>

529 <
div
 
şass
="g’Bu‰Ú"><
a
 
h»f
="javasüt:hideMes§geBßrd();">
ok
</a></div>

530 </
div
>

531 <?
php


533 
	}
}

541 
funùiÚ
 
	$ÿixa_g®”Ÿ
(
$im©ge
=
NULL
) {

543 
$nIdImg
 = ( 
	`is£t
(
$_POST
['nIdImg']) ) ? $_POST['nIdImg'] : '';

545 
echo
 '<div id="galleryContainerDIV">';

547 iàĞ! 
	`em±y
(
$this
->
imag’es
) ) {

549 
$cÚ
=0;

550 
	`fÜ—ch
 ( 
$this
->
imag’es
 
as
 
$img
 ) {

551 
$cÚ
++;

552 
$this
->
	`´e£ÁaIm©geEd™¬
(
$img
,
$cÚ
);

553 
$this
->
num_mšŸtu»s
++;

558 </
div
>

559 <?
php


560 
	}
}

566 
´iv©e
 
funùiÚ
 
	$»cog”_imag’es_g®”Ÿ
() {

568 iàĞ
	`em±y
(
$this
->
imag’es
) ) {

569 
$imag’es
 = 
	`ÿÎ_u£r_func
Ğ
	`¬¿y
(
$this
->
şa£_imag’
, "li¡ado"),$this->
cÚf_im©ges
, $this->
id’tifiÿdÜ
 );

570 
	`fÜ—ch
 ( 
$imag’es
 
as
 
$nomb»_imag’
) {

571 
$this
->
num_mšŸtu»s
++;

572 
$this
->
imag’es
[] = 
Ãw
 $this->
	`şa£_imag’
($this->
cÚf_im©ges
, $this->
id’tifiÿdÜ
, 
$nomb»_imag’
);

576 
	}
}

586 
funùiÚ
 
	$´e£ÁaIm©geEd™¬
(
$img
, 
$cÚ
=1) {

589 <
div
 
id
="thumbDIV<?ph°echØ$cÚ; ?>" 
şass
="galleryThumbnail">

590 <
div
>

591 <
img
 
id
="thumbIMG<?=$conta?>"

592 
¤c
="<?=$this->url_raiz.$img->getUrl();?>"

593 
¡yË
="border: 1px solid <?phpƒcho $this->color_bord;?>"

594 <?
php
 iàĞ
$this
->
am¶ada_´e£Áacio
 ) 
echo
 " width='".$this->amplada_presentacio."'"; ?>

595 <?
php
 iàĞ
$this
->
®tu¿_´e£Áacio
 ) 
echo
 " height='".$this->altura_presentacio."'"; ?>

597 </
div
>

598 <
div
 
id
="buttonDIV<?phpƒcho $conta;?>">

599 <
a
 
h»f
="javascript:esborrarImatge('<?=$this->sufijo?>',<?=$conta?>);">

600 <?=
$this
->
cÚtšgut_’Îac_bÜ¿r
?>

601 </
a
>

602 <
šput
 
ty³
="hidd’" 
Çme
="im©geG®”Ÿ[<?=$cÚ?>]" 
v®ue
="<?=$img->getNombre()?>" />

603 </
div
>

604 </
div
>

605 <?
php


607 
	}
}

613 
funùiÚ
 
	$addI‹m
(
$img
) {

615 
$this
->
imag’es
[] = 
$img
;

616 
$this
->
num_mšŸtu»s
++;

618 
	}
}

624 
funùiÚ
 
	$»moveI‹m
(
$img
) {

626 
$this
->
num_mšŸtu»s
--;

628 
	}
}

	@gcm/lib/int/galeria/lib/ImagenesAbstract.php

1 <?
php


22 
ab¡¿ù
 cÏs 
	cImag’esAb¡¿ù
 {

24 
´iv©e
 
	m$tomime
;

25 
´iv©e
 
	m$®tu¿
;

26 
´iv©e
 
	m$ªchu¿
;

28 
´Ùeùed
 
	m$nomb»_imag’
;

30 
ab¡¿ù
 
funùiÚ
 
bÜ¿r
(
$nomb»_imag’
);

31 
ab¡¿ù
 
funùiÚ
 
gu¬d¬
(
$nomb»_imag’
);

32 
ab¡¿ù
 
funùiÚ
 
g‘U¾
();

33 
ab¡¿ù
 
funùiÚ
 
g‘AÉu¿
();

34 
ab¡¿ù
 
funùiÚ
 
g‘Anchu¿
();

35 
ab¡¿ù
 
funùiÚ
 
g‘Tomime
();

37 
funùiÚ
 
	$__cÚ¡ruù
() {

41 
´Ùeùed
 
funùiÚ
 
	$li¡ado
(
$cÚf_im©ges
, 
$id_bÏ
) {

43 
echo
 
__CLASS__
.'::'.
__METHOD__
."\n".'Debe implementarseƒn clase hija';

45 
	}
}

51 
funùiÚ
 
	$g‘Nomb»
() {

53  
$this
->
nomb»_imag’
;

55 
	}
}

	@gcm/lib/int/galeria/lib/ImagenesTablaArchivo.php

1 <?
php


18 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/ImagenesAbstract.php');

38 şas 
	cImag’esTabÏArchivo
 
ex‹nds
 
	mImag’esAb¡¿ù
 {

40 
public
 
	m$bÏ
 = 'galeria';

41 
public
 
	m$ÿmpo_id
 = 'id';

43 
´iv©e
 
	m$”rÜes
 = 
¬¿y
();

44 
´iv©e
 
	m$pdo
;

46 
´iv©e
 
	m$bÏ_»ÏciÚada
 = '';

47 
´iv©e
 
	m$id_bÏ
;

48 
´iv©e
 
	m$dœ_tmp
;

49 
´iv©e
 
	m$dœ_imag’es
;

60 
funùiÚ
 
	$__cÚ¡ruù
(
$cÚfigu¿cio
, 
$id_bÏ
, 
$nomb»_imag’
=
FALSE
) {

62 
$this
->
id_bÏ
 = 
$id_bÏ
;

64 
$this
->
pdo
 = 
$cÚfigu¿cio
['pdo'];

65 
$this
->
bÏ_»ÏciÚada
 = 
$cÚfigu¿cio
['tabla'];

66 
$this
->
dœ_imag’es
 = 
$cÚfigu¿cio
['dir_imagenes'];

67 
$this
->
dœ_tmp
 = 
$cÚfigu¿cio
['dir_tmp'];

69 
$this
->
nomb»_imag’
 = 
$nomb»_imag’
;

78 
funùiÚ
 
	$bÜ¿r
(
$nomb»_imag’
) {

80 
$nomb»_imag’
 = 
	`ba£Çme
($nombre_imagen);

82 
$sql
 = "DELETE FROM ".
$this
->
bÏ
."

83 
WHERE
 
bÏ
='".$this->tabla_relacionada."'

84 
AND
 
id_bÏ
=".$this->id_tabla."

85 
AND
 
imag’
='".$nombre_imagen."'";

87 
$objS‹m’t
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
);

89 iàĞ! 
$objS‹m’t
->
	`execu‹
() ) {

90 
$”rÜ
 = 
$objS‹m’t
->
	`”rÜInfo
();

91 
	`Œigg”_”rÜ
(
$”rÜ
,
E_USER_ERROR
);

92  
FALSE
;

95 iàĞ
	`fe_exi¡s
(
$this
->
dœ_imag’es
.
$nomb»_imag’
èè
	`uÆšk
($this->dir_imagenes.$nombre_imagen);

97 
	}
}

106 
funùiÚ
 
	$gu¬d¬
(
$u¾_imag’
) {

108 
$nomb»_imag’
 = 
	`ba£Çme
(
$u¾_imag’
);

110 
$sql
 = "INSERT INTO ".
$this
->
bÏ
." (tabla, id_tabla, imagen) VALUES (:tabla, :id_tabla, :imagen)";

111 
$objS‹m’t
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
);

113 
$objS‹m’t
->
	`bšdV®ue
(':bÏ', 
$this
->
bÏ_»ÏciÚada
, 
PDO
::
PARAM_STR
);

114 
$objS‹m’t
->
	`bšdV®ue
(':id_bÏ', 
$this
->
id_bÏ
, 
PDO
::
PARAM_INT
);

115 
$objS‹m’t
->
	`bšdV®ue
(':imag’', 
$nomb»_imag’
, 
PDO
::
PARAM_STR
);

117 iàĞ! 
$objS‹m’t
->
	`execu‹
() ) {

118 
$”rÜ
 = 
$objS‹m’t
->
	`”rÜInfo
();

119 
	`Œigg”_”rÜ
(
$”rÜ
,
E_USER_ERROR
);

120  
FALSE
;

123 
	`»Çme
(
$this
->
dœ_tmp
.
$nomb»_imag’
, $this->
dœ_imag’es
.$nombre_imagen);

126 
	}
}

132 
funùiÚ
 
	$g‘U¾
() {

134  
$this
->
dœ_imag’es
.$this->
nomb»_imag’
;

136 
	}
}

142 
funùiÚ
 
	$g‘AÉu¿
() {

144 
echo
 
__METHOD__
.'…endiente';

146 
	}
}

152 
funùiÚ
 
	$g‘Anchu¿
() {

154 
echo
 
__METHOD__
.'…endiente';

156 
	}
}

162 
funùiÚ
 
	$g‘Tomime
() {

164 
echo
 
__METHOD__
.'…endiente';

166 
	}
}

173 
funùiÚ
 
	$li¡ado
(
$cÚf_im©ges
, 
$id_bÏ
) {

175 
$im©ges
 = 
	`¬¿y
();

177 
$sql
 = "SELECT imagen FROM galeria

178 
WHERE
 
bÏ
='".$cÚf_im©ges['bÏ']."' 
AND
 
id_bÏ
=".$id_tabla;

180 
Œy
 {

182 
$»suÉado
=
$cÚf_im©ges
['pdo']->
	`´•¬e
(
$sql
);

183 
$»suÉado
->
	`execu‹
();

185 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

186 
	`Œigg”_”rÜ
("E¼Ü g’”ª†li¡¨d'imges\n\nSQL: ".
$sql
."\n".
$ex
->
	`g‘Mes§ge
(), 
E_USER_ERROR
);

187  
FALSE
;

190 
$¬AÎ
 = 
$»suÉado
->
	`ãtchAÎ
(
PDO
::
FETCH_ASSOC
);

192 
	`fÜ—ch
 ( 
$¬AÎ
 
as
 
$¬Row
 ) {

193 
$im©ges
[] = 
$¬Row
['imagen'];

196  
$im©ges
;

198 
	}
}

	@gcm/lib/int/galeria/lit/lit_ca.php

1 <?
php


2 
	g$l™
['Subir imagen'] = 'Pujar imatge';

	@gcm/lib/int/galeria/lit/lit_es.php

1 <?
php


2 
	g$l™
['Subir imagen'] = 'Subir imagen';

	@gcm/lib/int/gcm/lib/Eventos.php

1 <?
php


57 şas 
	cEv’tos
 {

63 
public
 
	m$ev’tos
 = 
¬¿y
();

67 
public
 
	m$ubiÿciÚes
 = 
¬¿y
();

83 
public
 
	m$cEv’tos
 = 
¬¿y
();

90 
´iv©e
 
	m$modulos_aùivados
;

92 
´iv©e
 
	m$dœ_modulos
;

93 
´iv©e
 
	m$dœ_modulos_´oyeùo
;

94 
´iv©e
 
	m$bAdmš
;

98 
´iv©e
 
	m$dœ_ev’tos_´oyeùo
 = 'DATOS/eventos/';

102 
´iv©e
 
	m$Ë”_ev’tos_´oyeùo
 = 
TRUE
;

109 
´iv©e
 
	m$visu®iz¬
 = 
FALSE
;

115 
public
 
	m$š¡ªcŸs
 = 
¬¿y
();

134 
´iv©e
 
	m$li¡a_bÏnÿ
 = 
¬¿y
();

146 
funùiÚ
 
	$__cÚ¡ruù
(
$dœ_modulos
, 
$bAdmš
=
FALSE
, 
$eProyeùo
=
TRUE
, 
$visu®iz¬
=FALSE) {

148 
glob®
 
$gcm
;

150 
$this
->
modulos_aùivados
 = 
	`¬¿y_m”ge
(
$gcm
->
modulos_basicos
,$gcm->
	`cÚfig
('admin','MÃ³dulos‡ctivados'));

152 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`d•u¿r
(
$this
->
modulos_aùivados
,'Modulos‡ctivados'));

154 
$this
->
visu®iz¬
 = 
$visu®iz¬
;

155 
$this
->
ev’tos
 = 
	`¬¿y
();

156 
$this
->
dœ_modulos
 = 
$dœ_modulos
;

157 
$this
->
dœ_modulos_´oyeùo
 = 'modulos/';

158 
$this
->
bAdmš
 = 
$bAdmš
;

159 
$this
->
Ë”_ev’tos_´oyeùo
 = 
$eProyeùo
;

163 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ_ev’tos_´oyeùo
) ) {

164 iàĞ! 
	`mkdœ
 (
$this
->
dœ_ev’tos_´oyeùo
) ) {

165  
FALSE
;

171 iàĞ
$this
->
bAdmš
 ) {

172 
$this
->
	`Ë”_ev’tos
('admin');

173 iàĞ
	`fe_exi¡s
(
$this
->
dœ_modulos_´oyeùo
èè$this->
	`Ë”_ev’tos
('admin',$this->dir_modulos_proyecto);

176 
$this
->
	`Ë”_ev’tos
('usuario');

177 iàĞ
	`fe_exi¡s
(
$this
->
dœ_modulos_´oyeùo
èè$this->
	`Ë”_ev’tos
('usuario',$this->dir_modulos_proyecto);

179 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`d•u¿r
(
	`g‘_objeù_v¬s
(
$this
),'Variablesƒnƒventos'));

194 
public
 
funùiÚ
 
	$g‘_li¡a_bÏnÿ
(
$modulo
, 
$acciÚ
) {

195 iàĞ
	`is£t
(
$this
->
li¡a_bÏnÿ
[
$modulo
]è&& 
	`š_¬¿y
(
$acciÚ
, $this->li¡a_bÏnÿ[$modulo]èè 
TRUE
;

196  
FALSE
;

197 
	}
}

218 
public
 
funùiÚ
 
	$£t_li¡a_bÏnÿ
(
$modulo
,
$acciÚ
) {

219 iàĞ! 
$this
->
	`g‘_li¡a_bÏnÿ
(
$modulo
, 
$acciÚ
èè$this->
li¡a_bÏnÿ
[$modulo][] = $accion;

221 
	}
}

237 
funùiÚ
 
	$Ë”_ev’tos
(
$niv–
, 
$dœeùÜio
=
NULL
) {

239 
glob®
 
$gcm
;

241 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__FUNCTION__
.'('.
$niv–
.','.
$dœeùÜio
.')');

243 
$nomb»_ÿche
 = ( 
$dœeùÜio
 ) ? 'ev’tos_'.
$niv–
.'_'.
	`¡r_»¶aû
('/','-',
	`¹rim
($directorio,'/')) : 'eventos_'.$nivel ;

250 
$com´ob¬_aùivados
 = 
FALSE
;

252 
$n
 = 0;

254 iàĞ! 
$dœeùÜio
 ) {

255 
$dœeùÜio
 = 
$this
->
dœ_modulos
;

256 
$com´ob¬_aùivados
 = 
TRUE
;

259 iàĞ! 
	`fe_exi¡s
(
$dœeùÜio
) ) {

260 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ‹Ãmo dœeùÜiØdmodulo ’ '.
$dœeùÜio
, 'ERROR');

261  
FALSE
;

264 
$dœeùÜio_modulos
 = 
	`dœ
(
$dœeùÜio
);

266 
$modulo
 = 
$dœeùÜio_modulos
->
	`»ad
()) {

268 iàĞ
$com´ob¬_aùivados
 && ! 
	`š_¬¿y
(
$modulo
,
$this
->
modulos_aùivados
) ) ;

270 
$fich”o_modulo
 = 
$dœeùÜio
.
$modulo
.'/ev’tos_'.
$niv–
.'.php';

271 
$fich”o_ev’to
 = 
$this
->
dœ_ev’tos_´oyeùo
.
$modulo
.'/ev’tos_'.
$niv–
.'.php';

273 iàĞ! 
	`is_fe
(
$fich”o_modulo
) ) ;

274 iàĞ! 
	`is_fe
(
$fich”o_ev’to
) ) {

275 iàĞ! 
	`is_dœ
(
$this
->
dœ_ev’tos_´oyeùo
.
$modulo
) ) {

276 iàĞ! 
	`mkdœ
(
$this
->
dœ_ev’tos_´oyeùo
.
$modulo
) ) {

277 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ£…udØü—¸dœeùÜiØdmÃ³dulØ’†¨cÚfigu¿ciÃ³Àd–…royeùØ['.
$modulo
.']','ERROR');

278  
FALSE
;

281 iàĞ! 
	`cİy
(
$fich”o_modulo
, 
$fich”o_ev’to
) ) {

282 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ£…udØcİŸ¸¬chivØdev’tØ['.
$fich”o_ev’to
.']','ERROR');

283  
FALSE
;

288 
$acciÚes
 = 
FALSE
;

290 iàĞ
$this
->
Ë”_ev’tos_´oyeùo
 ) {

291 
	`šşude
(
$fich”o_ev’to
);

293 
	`šşude
(
$fich”o_modulo
);

296 iàĞ
$acciÚes
 ) {

297 
$gcm
->
au
->
	`£t_acciÚes
(
$acciÚes
);

300 iàĞ
	`is£t
(
$ev’tos
è&& 
	`is_¬¿y
($eventos) ) {

301 
	`fÜ—ch
 ( 
$ev’tos
 
as
 
$e
 => 
$acciÚ
 ) {

302 
	`fÜ—ch
 ( 
$acciÚ
 
as
 
$a
 => 
$v®Ü
 ) {

303 
	`fÜ—ch
 ( 
$v®Ü
 
as
 
$´iÜidad
 => 
$¬gum’tos
 ) {

305 iàĞ
$niv–
 =ğ'usu¬io' ) 
$this
->
li¡a_bÏnÿ
[
$modulo
][] = 
$a
;

306 
$this
->
ev’tos
[
$e
][
$modulo
][
$a
][
$´iÜidad
] = 
$¬gum’tos
;

307 
$this
->
ubiÿciÚes
[
$modulo
] = 
$dœeùÜio
.$modulo;

308 
$n
++;

309 iàĞ
	`is£t
(
$cEv’tos
[
$e
]) ) {

310 
$this
->
cEv’tos
[
$e
][
$cEv’tos
[$e]] = 
$modulo
;

313 
	`un£t
(
$a
);

314 iàĞ
	`is£t
(
$cEv’tos
èè
	`un£t
($cEv’tos[
$e
]);

317 
	`un£t
(
$ev’tos
);

321 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Num”Ødev’to ’ '.
$dœeùÜio
.': '.
$n
);

323 
	}
}

332 
funùiÚ
 
	$v”ifiÿr_ev’to
(
$e
) {

334 iàĞ
	`em±y
(
$this
->
ev’tos
[
$e
]) ) {

335  
FALSE
;

337  
TRUE
;

340 
	}
}

358 
public
 
funùiÚ
 
Ïnz¬Ev’to
(
$e
, 
$¬gs
=''){

360 
glob®
 
$gcm
;

362 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Ïnz¬Ev’to('.
$e
.','.
$¬gs
.')');

364 
	g$ev’to
 = 
$e
;

366 iàĞ
	g$this
->
	gvisu®iz¬
 ) 
	gecho
 '<div cÏss="visu®iz¬_ev’to" ><°¡yË="fÚt-size: 12px; cŞÜ:„ed;">'.
	g$e
.'</p>';

368 
	g$·¿m‘ros_ev’tos
 = 
$¬gs
;

372 iàĞ
is£t
(
$this
->
cEv’tos
[
$e
]['anular']) ) {

373 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Ev’tos->Ïnz¬Ev’to('.
$e
.','.
$¬gs
.') Evento‡nulado‚os volvemos');

379 iàĞ
	g$this
->
v”ifiÿr_ev’to
('´e'.
$ev’to
èè{ $this->
Ïnz¬Ev’to
('pre'.$evento); }

381 
	gŒy
 {

383 iàĞ!
	g$this
->
v”ifiÿr_ev’to
(
$ev’to
) ) {

385 
throw
 
Ãw
 
Exû±iÚ
('Sšƒv’to ·¿ ['.
$ev’to
.']');

391 
	g$Üd’
 = 
$this
->
´iÜidad
(
$e
);

393 
»gi¡¿r
(
__FILE__
,
__LINE__
,'AcciÚe ·¿ƒv’tØ['.
$ev’to
.']: '.
d•u¿r
(
$Üd’
));

397 
fÜ—ch
 ( 
$Üd’
 
as
 
$acciÚ
 => 
$´iÜidad
 ) {

401 iàĞ
is£t
(
$this
->
cEv’tos
[
$e
]['anular']) ) {

402 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Ev’tos->Ïnz¬Ev’to('.
$e
.','.
$¬gs
.') Evento‡nulado‚os volvemos');

406 
li¡
(
$m
,
$a
,
$·¿m‘ros_m‘odo
èğ
ex¶ode
('|',
$acciÚ
);

408 iàĞ!
em±y
Ğ
$·¿m‘ros_m‘odo
è&& !em±y(
$·¿m‘ros_ev’tos
) ) {

409 
	g$·¿m‘ros
 = 
$·¿m‘ros_ev’tos
.'&'.
$·¿m‘ros_m‘odo
;

410 } 
–£if
 ( 
em±y
(
$·¿m‘ros_ev’tos
) ) {

411 
	g$·¿m‘ros
 = 
$·¿m‘ros_m‘odo
;

412 } 
–£if
 ( 
em±y
(
$·¿m‘ros_m‘odo
) ) {

413 
	g$·¿m‘ros
 = 
$·¿m‘ros_ev’tos
;

418 iàĞ
is£t
(
$this
->
cEv’tos
[
$e
]['unico']è&& 
	g$this
->
	gcEv’tos
[$e]['unico'] !ğ
$m
 ) {

422 
»gi¡¿r
(
__FILE__
,
__LINE__
,

423 'CompÜm›ÁØ[ unicØ]…¬¨ev’tØ['.
$e
.']…Ü…¬‹ d[ '.
$this
->
cEv’tos
[$e]['unico'].' ]');

430 iàĞ
	gGCM_DEBUG
 && 
	gRou‹r
::
$fÜm©o
 =ğ'html' && 
$m
 !=ğ'ÿche_h‰p'è
´štf
("\n".
Rou‹r
::
$fÜma_com’rios
."\n",'Ev’tos: '.$m.'->'.
$a
.'('.
$e
.','.
$·¿m‘ros
.')');

431 iàĞ
	g$this
->
	gvisu®iz¬
 ) {

432 iàĞ
	g$m
 =ğ"‹mas" ) 
$this
->
Ïnz¬_acciÚ_modulo
(
$m
,
$a
,
$e
,
$·¿m‘ros
);

433 
	gecho
 "\n".'<°¡yË="fÚt-size: 12px"><¨h»f="?m÷dmš&aód™¬_cÚexiÚ&md='.
	g$m
.'">',$m,'->',
	g$a
,'('.
	g$e
.','.
	g$·¿m‘ros
.')</a></p>'."\n";

435 
	g$this
->
Ïnz¬_acciÚ_modulo
(
$m
,
$a
,
$e
,
$·¿m‘ros
);

438 iàĞ
	gGCM_DEBUG
 && 
	gRou‹r
::
$fÜm©o
 =ğ'html' && 
$m
 !=ğ'ÿche_h‰p'è
´štf
("\n".
Rou‹r
::
$fÜma_com’rios
."\n",' / Ev’tos: '.$m.'->'.
$a
.'('.
$e
.','.
$·¿m‘ros
.')');

444 } 
ÿtch
 (
Exû±iÚ
 
$ex
) {

446 
»gi¡¿r
(
$ex
->
g‘Fe
(),$ex->
g‘Lše
(),'ExûpciÃ³À’ƒv’to [ '.
$e
.' ] : '.$ex->
g‘Mes§ge
(). "\n",'ADMIN');

452 iàĞ
	g$this
->
v”ifiÿr_ev’to
('po¡'.
$ev’to
èè{ $this->
Ïnz¬Ev’to
('post'.$evento); }

454 iàĞ
	g$this
->
	gvisu®iz¬
 ) 
	gecho
 '</div>';

455  
	gTRUE
;

466 
´iv©e
 
funùiÚ
 
	$´iÜidad
(
$e
) {

468 
$¬»glo
 = 
	`¬¿y
();

469 
$ev’tos
 = 
$this
->
ev’tos
[
$e
];

470 
$¬gs
 = 
NULL
;

472 
	`fÜ—ch
 ( 
$ev’tos
 
as
 
$“
 => 
$¯
 ) {

473 
$n_m
 = 
$“
;

474 
	`fÜ—ch
Ğ
$¯
 
as
 
$n_a
 => 
$v®Ü
 ) {

476 
	`fÜ—ch
 ( 
$v®Ü
 
as
 
$´iÜidad
 => 
$¬gum’tos
 ) {

478 iàĞ
$´iÜidad
 > 0 ) {

479 
$¬»glo
[
$n_m
.'|'.
$n_a
.'|'.
$¬gum’tos
] = 
$´iÜidad
;

484 
	`un£t
(
$n_a
, 
$mm
);

485 
	`un£t
(
$n_e
);

488 
	`asÜt
(
$¬»glo
);

489 
	`»£t
(
$¬»glo
);

490  
$¬»glo
;

491 
	}
}

500 
funùiÚ
 
	$š¡ªcŸ_modulo
(
$m
) {

502 
glob®
 
$gcm
;

506 iàĞ! 
	`š_¬¿y
(
$m
,
$this
->
modulos_aùivados
) ) ;

512 
$fm
 = 
NULL
 ;

516 
$M
 = 
	`ucfœ¡
(
$m
);

520 
$log—dos
 = ( 
$gcm
->
au
->
	`log—do
(èè? 
TRUE
 : 
FALSE
 ;

522 iàĞ
	`is£t
(
$this
->
ubiÿciÚes
[
$m
]) ) {

523 iàĞ
$log—dos
 && 
	`fe_exi¡s
(
$this
->
ubiÿciÚes
[
$m
].'/lib/'.
$M
.'Admin.php') ) {

524 
$MA
 = 
$M
.'Admin';

525 
$fm
 = 
$this
->
ubiÿciÚes
[
$m
].'/lib/'.
$MA
.'.php';

527 
$fm
 = 
$this
->
ubiÿciÚes
[
$m
].'/lib/'.
$M
.'.php';

528 
$MA
 = 
FALSE
;

531 } 
	`–£if
 ( 
$log—dos
 && 
	`fe_exi¡s
(
$this
->
dœ_modulos_´oyeùo
.
$m
.'/lib/'.
$M
.'Admin.php') ) {

532 
$MA
 = 
$M
.'Admin';

533 
$fm
 = 
$this
->
dœ_modulos_´oyeùo
.
$m
.'/lib/'.
$MA
.'.php';

534 } 
	`–£if
 ( 
	`fe_exi¡s
(
$this
->
dœ_modulos_´oyeùo
.
$m
.'/lib/'.
$M
.'.php') ) {

535 
$fm
 = 
$this
->
dœ_modulos_´oyeùo
.
$m
.'/lib/'.
$M
.'.php';

536 
$MA
 = 
FALSE
;

537 } 
	`–£if
 ( 
$log—dos
 && 
	`fe_exi¡s
(
$this
->
dœ_modulos
.
$m
.'/lib/'.
$M
.'.php') ) {

538 
$MA
 = 
$M
.'Admin';

539 
$fm
 = 
$this
->
dœ_modulos
.
$m
.'/lib/'.
$MA
.'.php';

540 } 
	`–£if
 ( 
	`fe_exi¡s
(
$this
->
dœ_modulos
.
$m
.'/lib/'.
$M
.'.php') ) {

541 
$MA
 = 
FALSE
;

542 
$fm
 = 
$this
->
dœ_modulos
.
$m
.'/lib/'.
$M
.'.php';

544 
	`Œigg”_”rÜ
('E¼Ü‡Èÿrg¬ mÃ³dulo, Fich”ØdmÃ³dulØnØ’cÚŒadØ['.
$m
.']', 
E_USER_ERROR
);

545 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'E¼Ü‡Èÿrg¬ mÃ³dulo, Fich”ØdmÃ³dulØnØ’cÚŒadØ['.
$m
.']','ERROR');

546  
FALSE
;

549 iàĞ!
	`is£t
(
$this
->
š¡ªcŸs
[
$m
]) ) {

551 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'In¡ªcŸ dmÃ³dulo: ['.
$m
.']');

552 
	`»quœe_Úû
(
$fm
);

554 iàĞ
$MA
 ) {

555 
$this
->
š¡ªcŸs
[
$m
] = 
Ãw
 
	`$MA
();

557 
$this
->
š¡ªcŸs
[
$m
] = 
Ãw
 
	`$M
();

562  
$this
->
š¡ªcŸs
[
$m
];

564 
	}
}

586 
funùiÚ
 
	$Ïnz¬_acciÚ_modulo
(
$m
, 
$a
, 
$e
=
NULL
, 
$¬gs
=NULL) {

588 
glob®
 
$gcm
;

590 iàĞ! 
	`š_¬¿y
(
$m
,
$this
->
modulos_aùivados
) ) ;

593 iàĞ! 
$this
->
	`g‘_li¡a_bÏnÿ
(
$m
,
$a
) ) {

595 iàĞ! 
	`³rmiso
(
$a
) ) {

596 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m
.'->'.
$a
.'() sin…ermisos','ERROR');

597  
FALSE
;

606 iàĞ
$this
->
	`š¡ªcŸ_modulo
(
$m
) ) {

608 iàĞ
	`m‘hod_exi¡s
(
$this
->
š¡ªcŸs
[
$m
], 
$a
 ) ) {

610 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m
.'->'.
$a
.'('.
$e
.','.
$¬gs
.');');

612 iàĞ
GCM_DEBUG
 ) 
$t›mpo_šicio
 = 
	`miüÙime
(
TRUE
);

613 iàĞ
$this
->
š¡ªcŸs
[
$m
]->
	`$a
(
$e
,
$¬gs
è==ğ
FALSE
 ) {

614 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Ev’tos->Ïnz¬_acciÚ_modulo('.
$m
.','.
$a
.','.
$e
.','.
$¬gs
.') Error‡l†anzarƒvento');

616 iàĞ
	`¡ros
(
$e
,'´e'è!=ğ
FALSE
 ) {

617 
$ev’to_Üigš®
 = 
	`¡r_»¶aû
('´e','',
$e
);

618 
$this
->
	`ªuÏr
('´e'.
$ev’to_Üigš®
, 
$m
);

619 
$this
->
	`ªuÏr
(
$ev’to_Üigš®
, 
$m
);

620 
$this
->
	`ªuÏr
('po¡'.
$ev’to_Üigš®
, 
$m
);

621 } 
	`–£if
 ( 
	`¡ros
(
$e
,'po¡'è!=ğ
FALSE
 ) {

622 
$ev’to_Üigš®
 = 
	`¡r_»¶aû
('po¡','',
$e
);

623 
$this
->
	`ªuÏr
(
$ev’to_Üigš®
, 
$m
);

624 
$this
->
	`ªuÏr
('po¡'.
$ev’to_Üigš®
, 
$m
);

626 
$this
->
	`ªuÏr
(
$e
, 
$m
);

627 
$this
->
	`ªuÏr
('po¡'.
$e
, 
$m
);

631 iàĞ
GCM_DEBUG
 ) 
$t›mpo_tÙ®
 = 
	`round
(
	`miüÙime
(
TRUE
)-
$t›mpo_šicio
,4);

632 iàĞ
GCM_DEBUG
 ) 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'T›mpØdejecuciÃ³Àd'.
$m
.'->'.
$a
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'): ('.
$t›mpo_tÙ®
.')');

637 iàĞ
	`is£t
(
$a
è&& !
	`em±y
($a) ) {

638 
	`Œigg”_”rÜ
('Ev’tos->Ïnz¬_acciÚ_modulo('.
$m
.','.
$a
.','.
$e
.','.
$¬gs
.') AcciÃ³n‚o„econocida');

640 
	`Œigg”_”rÜ
('Ev’tos->Ïnz¬_acciÚ_modulo('.
$m
.','.
$a
.','.
$e
.','.
$¬gs
.'èSš‡cciÃ³Àdefšida', 
E_USER_ERROR
);

646 
	`Œigg”_”rÜ
('Ev’tos->Ïnz¬_acciÚ_modulo('.
$m
.','.
$a
.','.
$e
.','.
$¬gs
.'èMÃ³dulØnØ»cÚocido', 
E_USER_ERROR
);

649 
	}
}

658 
funùiÚ
 
	$ªuÏr
(
$ev’to
, 
$modulo
) {

659 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Ev’tos->ªuÏr('.
$ev’to
.','.
$modulo
.')');

660 
$this
->
cEv’tos
[
$ev’to
]['ªuÏr'] = 
$modulo
;

661 
	}
}

669 
funùiÚ
 
	$ªuÏdo
(
$e
) {

671  ( 
	`is£t
(
$this
->
cEv’tos
[
$e
]['ªuÏr']èè? 
TRUE
 : 
FALSE
 ;

673 
	}
}

683 
funùiÚ
 
	$unico
(
$ev’to
, 
$modulo
) {

684 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Ev’tos->unico('.
$ev’to
.','.
$modulo
.')');

685 
$this
->
cEv’tos
[
$ev’to
]['unico'] = 
$modulo
;

686 
	}
}

698 
funùiÚ
 
acciÚ2ev’to
(
$ev’to
,
$modulo
,
$m‘odo
,
$´iÜidad
,
$¬gs
='') {

700 
$this
->
ev’tos
[
$ev’to
][
$modulo
][
$m‘odo
][
$´iÜidad
] = 
$¬gs
;

	@gcm/lib/int/gcm/lib/GUtil.php

1 <?
php


29 şas 
	cGUt
 {

36 
funùiÚ
 
	$¬chivo_ËibË
(
$¬chivo
) {

38 iàĞ!
	`fe_exi¡s
(
$¬chivo
) ) {

39 
	`Œigg”_”rÜ
('ArchivØnØ’cÚŒadØ['.
$¬chvio
.']', 
E_USER_ERROR
);

40  
FALSE
;

43 iàĞ!
	`is_fe
(
$¬chivo
) ) {

44 
	`Œigg”_”rÜ
('ArchivØnØ»guÏ¸['.
$¬chvio
.']', 
E_USER_ERROR
);

45  
FALSE
;

48 iàĞ!
	`is_»adabË
(
$¬chivo
) ) {

49 
	`Œigg”_”rÜ
('ArchivØnØt›Ã…”miso dËùu¿ ['.
$¬chvio
.']', 
E_USER_ERROR
);

50  
FALSE
;

53  
TRUE
;

62 
funùiÚ
 
	$¬chivo_modifiÿbË
(
$¬chivo
) {

64 iàĞ! 
£lf
::
	`¬chivo_ËibË
(
$¬chivo
) ) {

65 
	`Œigg”_”rÜ
('ArchivØnØt›Ã…”miso dËùu¿ ['.
$¬chvio
.']', 
E_USER_ERROR
);

66  
FALSE
;

69 iàĞ! 
	`is_wr™abË
(
$¬chivo
) ) {

70 
	`Œigg”_”rÜ
('ArchivØnØt›Ã…”miso desü™u¿ ['.
$¬chvio
.']', 
E_USER_ERROR
);

71  
FALSE
;

74  
TRUE
;

76 
	}
}

91 
funùiÚ
 
	$‹xtİÏno
(
$‹xt
) {

93 
$‹xt
 = 
	`¡r¦ashes
($text);

94 
$‹xt
 = 
	`Œim
($text);

95 
$‹xt
 = 
	`´eg_»¶aû
("/Ã¡|Ã |Ã¢|Ã€|Ã|Ã‚/", "a", $text);

96 
$‹xt
 = 
	`´eg_»¶aû
("/Ã©|Ã¨|Ãª|Ãˆ|Ã‰|ÃŠ/", "e", $text);

97 
$‹xt
 = 
	`´eg_»¶aû
("/Ã­|Ã¬|Ã®|ÃŒ|Ã|Ã/", "i", $text);

98 
$‹xt
 = 
	`´eg_»¶aû
("/Ã³|Ã²|Ã´|Ã’|Ã“|Ã”/", "o", $text);

99 
$‹xt
 = 
	`´eg_»¶aû
("/Ãº|Ã¹|Ã»|Ã¼|Ã™|Ãš|Ã›|Ãœ/", "u", $text);

100 
$‹xt
 = 
	`´eg_»¶aû
("/Ã±/", "ny", $text);

101 
$‹xt
 = 
	`´eg_»¶aû
("/Ã‘/", "NY", $text);

102 
$‹xt
 = 
	`´eg_»¶aû
("/Ã‡/", "C", $text);

103 
$‹xt
 = 
	`´eg_»¶aû
("/Ã§/", "c", $text);

104 
$‹xt
 = 
	`¡r_»¶aû
(" ", "_", $text);

105 
$‹xt
 = 
	`¡r_»¶aû
("'", "", $text);

107 (
$‹xt
);

109 
	}
}

119 
funùiÚ
 
	$escomsim¶e
(
$‹xto
) {

121  
	`¡r_»¶aû
("'","\'",
	`¡r¦ashes
(
$‹xto
));

123 
	}
}

133 
funùiÚ
 
	$escomdobËs
(
$‹xto
) {

135  
	`¡r_»¶aû
('"','\"',
	`¡r¦ashes
(
$‹xto
));

137 
	}
}

155 
funùiÚ
 
	$ge¡iÚ_”rÜes
(
$num_”r
, 
$m’s_”r
, 
$nomb»_¬chivo
,

156 
$num_lš—
, 
$v¬s
)

159 
glob®
 
$gcm
;

162 
$dt
 = 
	`d©e
("Y-m-d H:i:s (T)");

163 
$fich”o_»gi¡ro
 = 
Rou‹r
::
$dœ
."../log/errores.log";

170 
$to_”rÜ
 = 
	`¬¿y
 (

171 
E_ERROR
 => "Error",

172 
E_WARNING
 => "Advertencia",

173 
E_PARSE
 => "Error de IntÃ©rprete",

174 
E_NOTICE
 => "AnotaciÃ³n",

175 
E_CORE_ERROR
 => "Error de NÃºcleo",

176 
E_CORE_WARNING
 => "Advertencia de NÃºcleo",

177 
E_COMPILE_ERROR
 => "Error de CompilaciÃ³n",

178 
E_COMPILE_WARNING
 => "Advertencia de CompilaciÃ³n",

179 
E_USER_ERROR
 => "Error de Usuario",

180 
E_USER_WARNING
 => "Advertencia de Usuario",

181 
E_USER_NOTICE
 => "AnotaciÃ³n de Usuario",

182 
E_STRICT
 => "AnotaciÃ³n deiempo deƒjecuciÃ³n"

185 
$”rÜes_a_»gi¡¿r
 = 
	`¬¿y
(
E_WARNING
, 
E_USER_WARNING
, 
E_USER_ERROR
, 
E_ERROR
, 
E_CORE_ERROR
 );

186 
$”rÜes_a_mo¡¿r
 = 
	`¬¿y
(
E_WARNING
, 
E_USER_WARNING
, 
E_USER_ERROR
, 
E_ERROR
, 
E_CORE_ERROR
);

188 iàĞ
	`is£t
(
$to_”rÜ
[
$num_”r
]) ) {

189 
$to
 = 
$to_”rÜ
[
$num_”r
];

191 
$to
 = 
$num_”r
;

194 iàĞ
GCM_DEBUG
 ) {

195 
echo
 "<div class='error'>";

196 
echo
 "<p><b>$mens_err</b></p>";

197 
echo
 '<¨h»f="vim://'.
$nomb»_¬chivo
.'@'.
$num_lš—
.'">';

198 
echo
 "<p>$nombre_archivo : $num_linea $tipo</p>";

199 
echo
 "</a>";

200 
echo
 "</div>";

203 ià(
	`š_¬¿y
(
$num_”r
, 
$”rÜes_a_mo¡¿r
)) {

207 
	`»gi¡¿r
(
$nomb»_¬chivo
,
$num_lš—
, 
$m’s_”r
,'ERROR');

209 } 
	`–£if
 ( 
	`š_¬¿y
(
$num_”r
, 
$”rÜes_a_»gi¡¿r
) ) {

213 
	`»gi¡¿r
(
$nomb»_¬chivo
,
$num_lš—
, 
$to
.' :: '.
$m’s_”r
,'ADMIN');

219 
	`»gi¡¿r
(
$nomb»_¬chivo
,
$num_lš—
, 
$to
.' :: '.
$m’s_”r
,'DEBUG');

223 
	}
}

239 
funùiÚ
 
	$to_de_¬chivo
(
$¬chivo
) {

241 
glob®
 
$gcm
;

244 
$mime_dœ
='text/directory';

247 iàĞ@
	`is_dœ
(
$¬chivo
) ) {

248 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gut::to_de_¬chivo()::to_de_¬chivo::mim‘y³=".
$mime_dœ
);

249  
$mime_dœ
;

253 
$feInfo
 = 
	`·thšfo
(
$¬chivo
);

254 
$ext
 = ( 
	`is£t
(
$feInfo
['ex‹nsiÚ']èè? $feInfo['ex‹nsiÚ'] : 
NULL
 ;

255 iàĞ
	`is£t
(
$ext
èè$exˆğ
	`¡¹Şow”
($ext);

259 iàĞ
$ext
 == "btml" )  'text/html';

262 
	`»quœe
(
GCM_DIR
.'lib/int/mimetypes.php');

264 iàĞ! 
	`em±y
(
$mim‘y³s
[
	`Œim
(
$ext
)]) ) {

266 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gut::to_de_¬chivo(".
$¬chivo
.")::to_de_¬chivo::mim‘y³=".
$mim‘y³s
[
$ext
]);

267  
$mim‘y³s
[
$ext
];

273 iàĞ
	`fe_exi¡s
(
$¬chivo
) ) {

274 
$¬
=
	`fİ’
(
$¬chivo
,"r");

275 
$lš—
=
	`fg‘s
(
$¬
);

276 
$·l
 = 
	`ex¶ode
('/',
$lš—
);

277 
	`fşo£
(
$¬
);

278 
$to
 = 
	`Œim
(
$·l
[
	`couÁ
($pal)-1]);

280 
$to
) {

283 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gut::to_de_¬chivo()::to_de_¬chivo::mim‘y³=".
$mim‘y³s
['sh']);

284  
$mim‘y³s
['sh'];

287 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gut::to_de_¬chivo()::to_de_¬chivo::mim‘y³=".
$mim‘y³s
['perl']);

288  
$mim‘y³s
['perl'];

291 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gut::to_de_¬chivo()::to_de_¬chivo::mim‘y³=".
$mim‘y³s
['python']);

292  
$mim‘y³s
['py'];

295 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gut::to_de_¬chivo()::to_de_¬chivo::mim‘y³=".
$mim‘y³s
['php']);

296  
$mim‘y³s
['php'];

306 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gutil::tipo_de_archivo()::tipo_de_archivo::No se…udo detectaripo de‡rchivo‚i mirando dentro, $archivo");

307  
FALSE
;

309 
	}
}

317 
funùiÚ
 
	$’Ïû_docum’ciÚ
(
$busÿr
) {

319  "<¨h»f='".
Rou‹r
::
$ba£
.
GCM_DIR
."../docs/doxyg’/html/£¬ch.php?qu”y=".
$busÿr
."'>".$buscar."</a>";

321 
	}
}

337 
funùiÚ
 
	$gcm_g’”¬_u¾
(
$u¾
=
NULL
) {

339 iàĞ
	`is£t
(
$u¾
) ) {

341 
$£cciÚ
 = 
	`dœÇme
 ( 
$u¾
 );

342 
$cÚ‹nido
 = 
	`ba£Çme
 ( 
$u¾
 );

343 
$u
 = 
Rou‹r
::
$dœ
.
$£cciÚ
."/".
$cÚ‹nido
;

344 
$u
 = 
	`¡r_»¶aû
(' ','%20',$u);

345  
$u
;

348 
$b
=
	`dœÇme
(
$_SERVER
['PHP_SELF']);

349 
$u
=
$b
.'/'.
$£siÚ
.'/'.
$cÚ‹nido
;

350 
$u
 = 
	`¡r_»¶aû
('//','/',$u);

351 
$u
 = 
	`¡r_»¶aû
(' ','%20',$u);

352  
$u
;

353 
	}
}

368 
funùiÚ
 
	$desglo§r_u¾
(
$u¾
) {

370 
glob®
 
$gcm
;

373 
$u¾
 = 
	`¡r_»¶aû
('Fe/'.
$gcm
->
	`cÚfig
('idiomas','Idioma…or defecto').'/','',$url);

375 
$u¾
 = 
	`¡r_»¶aû
(
Rou‹r
::
$d
.'/','',$url);

377  
$u¾
;

379 
	}
}

396 
funùiÚ
 
	$ÿmšo
(
$u¾
,
$’Ïz¬
 = 
FALSE
, 
$cÚ‹nido
 = 
TRUE
) {

398 
$aU¾
 = 
Rou‹r
::
	`desglo§rU¾
(
$u¾
);

399 
$ÿmšo
 = 
	`ex¶ode
('/',
$aU¾
['s']);

400 
$´im”o
 = 
TRUE
;

401 
$§lida
 = '';

402 
$’Ïû
 = '';

404 
	`fÜ—ch
 (
$ÿmšo
 
as
 
$–em’to
) {

406 iàĞ! 
	`em±y
(
$–em’to
) ) {

407 iàĞ!
$´im”o
 ) 
$§lida
 .= ' / ';

408 iàĞ
$’Ïz¬
 ) {

409 
$’Ïû
 .ğ
$–em’to
.'/';

410 
$§lida
 .ğ'<¨h»f="'.
Rou‹r
::
$ba£
.
$’Ïû
.'">'.
	`l™”®
(
$–em’to
).'</a>';

412 
$§lida
 .ğ
	`l™”®
(
$–em’to
);

414 
$´im”o
 = 
FALSE
;

419 iàĞ
$cÚ‹nido
 ) {

420 iàĞ
	`is£t
(
$aU¾
['c']) ) {

421 iàĞ!
$´im”o
 ) 
$§lida
 .= ' / ';

422 iàĞ
$’Ïz¬
 ) {

423 
$§lida
 .ğ'<¨h»f="'.
Rou‹r
::
$ba£
.
$u¾
.'">'.
	`l™”®
(
	`¡r_»¶aû
('.html','',
$aU¾
['c'])).'</a>';

425 
$§lida
 .ğ
	`l™”®
(
	`¡r_»¶aû
('.html','',
$aU¾
['c']));

429  
$§lida
;

430 
	}
}

	@gcm/lib/int/gcm/lib/Gcm.php

1 <?
php


30 
”rÜ_»pÜtšg
(
E_ALL
);

33 
£ssiÚ_¡¬t
();

36 
»quœe
("helpers.php");

39 
»quœe
("Router.php");

42 
»quœe
("GUtil.php");

45 
»quœe
('Eventos.php');

48 
»quœe
('Plantilla.php');

51 
»quœe_Úû
(
GCM_DIR
.'lib/int/solicitud/lib/Solicitud.php');

54 
»quœe_Úû
(
GCM_DIR
.'lib/int/registro/Registro.php');

57 
»quœe_Úû
(
GCM_DIR
."lib/int/autentificacion/lib/Autentificacion.php");

60 
»quœe
('Modulos.php');

64 
funùiÚ
 
	$__autŞßd
(
$şa£
) {

66 
glob®
 
$gcm
;

68 
$şa£
 = 
	`¡¹Şow”
($clase);

69 
$fich
 = 
GCM_DIR
.'modulos/'.
$şa£
.'/lib/'.
	`ucfœ¡
($clase).'.php';

71 iàĞ! 
	`fe_exi¡s
(
$fich
) )

72 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'E¼Ü‡È»qu”œ mÃ³dulØ['.
$şa£
.'] EÈ¬chivØ['.
$fich
.']‚oƒxiste','ERROR');

74 
	`»quœe_Úû
(
$fich
);

76 
	}
}

79 
£t_”rÜ_hªdËr
("Gutil::gestion_errores");

90 şas 
	cGcm
 {

92 
public
 
	m$pdo
 = 
NULL
;

93 
public
 
	m$ev’t
;

94 
public
 
	m$rou‹r
 = 
NULL
;

95 
public
 
	m$»g
 = 
NULL
;

96 
public
 
	m$au
 = 
NULL
;

110 
public
 
	m$‹ma
 = 
FALSE
;

122 
public
 
	m$memÜŸ
 = 
¬¿y
();

128 
public
 
	m$£ËcciÚado
;

134 
public
 
	m$§lida
 = '';

140 
public
 
	m$sufijo
 = '';

162 
´iv©e
 
	m$cÚ‹nidos
 = 
¬¿y
();

168 
´iv©e
 
	m$javasüts
 = 
¬¿y
();

174 
´iv©e
 
	m$lib»rŸs_javasüt
 = 
¬¿y
();

183 
´iv©e
 
	m$ev’tos_´oyeùo
 = 
TRUE
 ;

189 
´iv©e
 
	m$cÚfig
;

197 
public
 
	m$modulos_basicos
 = 
¬¿y
(

219 
funùiÚ
 
	$__cÚ¡ruù
() {

223 
$·Ïb¿_£ü‘a_·¿_debug
 = 
$this
->
	`cÚfig
('admin','Palabra secreta…ara depurar');

225 iàĞ
	`is£t
(
$·Ïb¿_£ü‘a_·¿_debug
) ) {

226 iàĞ
	`is£t
(
$_GET
[
$·Ïb¿_£ü‘a_·¿_debug
]) && $_GET[$palabra_secreta_para_debug] == 1 ) {

227 
	`DEFINE
('GCM_DEBUG', 
TRUE
);

228 
$_SESSION
[
$·Ïb¿_£ü‘a_·¿_debug
] = 1;

229 } 
	`–£if
 ( 
	`is£t
(
$·Ïb¿_£ü‘a_·¿_debug
è&& is£t(
$_GET
[$palabra_secreta_para_debug]) && $_GET[$palabra_secreta_para_debug] != 1 ) {

230 
	`DEFINE
('GCM_DEBUG', 
FALSE
);

231 iàĞ
	`is£t
(
$_SESSION
[
$·Ïb¿_£ü‘a_·¿_debug
]) ) $_SESSION[$palabra_secreta_para_debug] = 0;

232 } 
	`–£if
 ( 
	`is£t
(
$_SESSION
[
$·Ïb¿_£ü‘a_·¿_debug
]) && $_SESSION[$palabra_secreta_para_debug] == 1 ) {

233 
	`DEFINE
('GCM_DEBUG', 
TRUE
);

234 } 
	`–£if
 ( 
	`is£t
(
$_SESSION
[
$·Ïb¿_£ü‘a_·¿_debug
]) && $_SESSION[$palabra_secreta_para_debug] != 1 ) {

235 
	`DEFINE
('GCM_DEBUG', 
FALSE
);

236 iàĞ
	`is£t
(
$_SESSION
[
$·Ïb¿_£ü‘a_·¿_debug
]) ) $_SESSION[$palabra_secreta_para_debug] = 0;

238 
	`DEFINE
('GCM_DEBUG', 
FALSE
);

241 
	`DEFINE
('GCM_DEBUG',
FALSE
);

242 iàĞ
	`is£t
(
$_SESSION
[
$·Ïb¿_£ü‘a_·¿_debug
]) ) $_SESSION[$palabra_secreta_para_debug] = 0;

245 
$this
->
sufijo
 = $this->
	`cÚfig
('admin','Sufijo…ara base de datos');

247 
$bd_»gi¡ros
 = 
$this
->
	`cÚfig
('admin','bd_conexion');

252 iàĞ
	`¡½os
(
$bd_»gi¡ros
,'sql™e'è!=ğ
FALSE
 || $bd_registros == '' ) {

254 iàĞ! 
	`is_dœ
('log'èè
	`mkdœ
('log');

255 
$this
->
»g
 = 
Ãw
 
	`Regi¡ro
('log');

259 
$this
->
»g
 = 
Ãw
 
	`Regi¡ro
($this->
	`pdo_cÚexiÚ
('»gi¡ros'),$this->
sufijo
);

263 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Gcm->cÚ¡ruù: REQUEST_URI: '.
$_SERVER
['REQUEST_URI'],'NORMAL');

294 
funùiÚ
 
	$cÚfig
(
$modulo
, 
$nomb»_v¬ŸbË
, 
$v®Ü
=
FALSE
) {

296 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmConfig/lib/GcmConfigFactory.php');

299 
$modulo
 = 
	`¡¹Şow”
($modulo[0]).
	`sub¡r
($modulo,1);

302 iàĞ!
$v®Ü
 && 
	`is£t
(
$this
->
cÚfig
[
$modulo
][
$nomb»_v¬ŸbË
]) )  $this->config[$modulo][$nombre_variable];

304 
$dœ_cÚfigu¿ciÚ_´oyeùo
 = 'DATOS/configuracion/';

306 iàĞ
$v®Ü
 && !
	`fe_exi¡s
(
$dœ_cÚfigu¿ciÚ_´oyeùo
èè
	`mkdœ
($dir_configuracion_proyecto);

308 
$dœ_cÚfigu¿ciÚ_´oyeùo_modulo
 = 
$dœ_cÚfigu¿ciÚ_´oyeùo
.
$modulo
.'/';

310 iàĞ
$v®Ü
 && !
	`fe_exi¡s
(
$dœ_cÚfigu¿ciÚ_´oyeùo_modulo
) )

311 
	`mkdœ
(
$dœ_cÚfigu¿ciÚ_´oyeùo_modulo
);

313 
$¬chivo_cÚfigu¿ciÚ
 = 
$dœ_cÚfigu¿ciÚ_´oyeùo_modulo
.'config.php';

315 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,

316 'CÚfig, modulo: ['.
$modulo
.'] v®Ü: ['.
$v®Ü
.']

317 
Archivo
 
de
 
cÚfigu¿ci
Ã³
n
 ['.$archivo_configuracion.']');

319 iàĞ
$v®Ü
 ) {

321 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$¬chivo_cÚfigu¿ciÚ
);

323 
$¬r
->
	`£t
(
$nomb»_v¬ŸbË
,
$v®Ü
);

324 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

325 
$this
->
cÚfig
[
$modulo
][
$nomb»_v¬ŸbË
] = 
$v®Ü
;

329 iàĞ!
	`fe_exi¡s
(
$¬chivo_cÚfigu¿ciÚ
èè$¬chivo_cÚfigu¿ciÚ = 
GCM_DIR
.'modulos/'.
$modulo
.'/config/config.php';

331 iàĞ!
	`fe_exi¡s
(
$¬chivo_cÚfigu¿ciÚ
) ) {

332 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__


333 ,'NØ‹Ãmo –‡rchivØ['.
$¬chivo_cÚfigu¿ciÚ
.'] dcÚfigu¿ciÃ³Àd– mÃ³dulØ['.
$modulo
.']','ERROR');

334  
FALSE
;

337 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$¬chivo_cÚfigu¿ciÚ
);

338 
$v®Ü
 = 
$¬r
->
	`g‘
(
$nomb»_v¬ŸbË
);

339 
$this
->
cÚfig
[
$modulo
][
$nomb»_v¬ŸbË
] = 
$v®Ü
;

340  
$v®Ü
;

344 
	}
}

357 
funùiÚ
 
	$cÚ¡ruœ_£ËcciÚado
(
$¬gs
=
NULL
) {

359 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$¬gs
.')');

361 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
$¬gs
);

363 iàĞ
	`is£t
(
$·¿m‘ros
['url']) ) {

365 
$m’s
 = 'Seleccionados viene…or $args';

366 
$this
->
£ËcciÚado
 = 
	`¬¿y
(
$·¿m‘ros
['url']);

368 } 
	`–£if
 ( 
	`is£t
 ( 
$_GET
['seleccionado']) ) {

370 
$m’s
 = 'Seleccionados viene…or _GET';

371 
$this
->
£ËcciÚado
 = 
$_GET
['seleccionado'];

373 } 
	`–£if
 ( 
	`is£t
 ( 
$_POST
['seleccionado']) ) {

375 
$m’s
 = 'Seleccionados viene…or _POST';

376 
$this
->
£ËcciÚado
 = 
$_POST
['seleccionado'];

378 } 
	`–£if
 ( 
	`is£t
 ( 
$_POST
['f']) ) {

380 
$m’s
 = 'Seleccionados viene…or _POST[$f]';

381 
$this
->
£ËcciÚado
 = 
	`¬¿y
(
$_POST
['f']);

385 
$m’s
 = 'Seleccionados viene…or defecto‡rchivo‡ctual';

386 
$this
->
£ËcciÚado
 = 
	`¬¿y
(
Rou‹r
::
$d
.Rou‹r::
$s
.Rou‹r::
$c
);

390 iàĞ
	`is£t
(
$m’s
èè
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$¬gs
.') '.$mens);

391 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`d•u¿r
(
$this
->
£ËcciÚado
,'Seleccionado'));

392 
	}
}

401 
funùiÚ
 
	$add_lib_js
(
$modulo
, 
$¬chivo
) {

402 iàĞ
	`š_¬¿y
(
$modulo
.":".
$¬chivo
, 
$this
->
lib»rŸs_javasüt
) ) {

403 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Temas->javasüts('.
$modulo
.','.
$¬chivo
.') AÃ±adido‡nteriormente');

406 
$this
->
lib»rŸs_javasüt
[] = 
$modulo
.":".
$¬chivo
;

407 
	}
}

416 
funùiÚ
 
	$add_js
(
$modulo
, 
$¬chivo
) {

417 iàĞ
	`š_¬¿y
(
$modulo
.":".
$¬chivo
, 
$this
->
javasüts
) ) {

418 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Temas->javasüts('.
$modulo
.','.
$¬chivo
.') AÃ±adido‡nteriormente');

421 
$this
->
javasüts
[] = 
$modulo
.":".
$¬chivo
;

422 
	}
}

428 
funùiÚ
 
	$li¡a_js
(è{  
$this
->
javasüts
; 
	}
}

434 
funùiÚ
 
	$li¡a_lib_js
(è{  
$this
->
lib»rŸs_javasüt
; 
	}
}

457 
funùiÚ
 
pdo_cÚexiÚ
(
$cÚexiÚ
='principal') {

461 iàĞ
is£t
(
$this
->
pdo
[
$cÚexiÚ
]) )  $this->pdo[$conexion];

464 
	g$ubiÿciÚ
 = 'local';

468 
	g$bd_cÚexiÚ
 = 
$this
->
cÚfig
('admin','bd_conexion');

469 
	g$bd_usu¬io
 = 
$this
->
cÚfig
('admin','bd_usuario');

470 
	g$bd_·ss
 = 
$this
->
cÚfig
('admin','bd_pass');

472 
	g$driv”
 = 
ex¶ode
(':',
$bd_cÚexiÚ
);

473 
	g$mÙÜ
 = 
$driv”
[0];

474 
	g$¬chivo
 = 
$driv”
[1];

476 iàĞ
	g$mÙÜ
 == "sqlite" ) {

480 
$dœ
 = 
dœÇme
(
$¬chivo
);

482 iàĞ! 
mkdœ_»cursivo
(
$dœ
) ) {

483 
»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
d•u¿r
(
$¬gs
).'èNØ£…udØü—¸– dœeùÜiØ·¿†¨ba£ dd©o ['.
$dœ
.']','ERROR');

484 
ex™
();

489 
	g$this
->
»gi¡¿
(
__FILE__
,
__LINE__
,'Creamos‚ueva conexiÃ³n‡ base de datos','DEBUG');

491 
	gŒy
 {

493 iàĞ
	g$mÙÜ
 == "sqlite" ) {

495 
$this
->
pdo
[
$cÚexiÚ
] = 
Ãw
 
PDO
(
$bd_cÚexiÚ
);

497 } 
–£if
 ( 
$mÙÜ
 == 'mysql' ) {

499 
$this
->
pdo
[
$cÚexiÚ
] = 
Ãw
 
PDO
(
$bd_cÚexiÚ
, 
$bd_usu¬io
,
$bd_·ss
,

500 
¬¿y
(
PDO
::
MYSQL_ATTR_INIT_COMMAND
 => "SET NAMES utf8"));

504 
	g$this
->
	gpdo
[
$cÚexiÚ
] = 
Ãw
 
PDO
(
$bd_cÚexiÚ
, 
$bd_usu¬io
, 
$bd_·ss
);

508 
	g$this
->
	gpdo
[
$cÚexiÚ
]->
£tA‰ribu‹
(
PDO
::
ATTR_ERRMODE
, PDO::
ERRMODE_EXCEPTION
);

509 
	g$this
->
	gpdo
[
$cÚexiÚ
]->
£tA‰ribu‹
(
PDO
::
ATTR_PERSISTENT
, 
TRUE
);

511 } 
ÿtch
 (
Exû±iÚ
 
$ex
) {

513 
	gecho
 "<p class='error'>";

514 
	gecho
 "Error con†a conexiÃ³n‡ base de datos";

515 
	gecho
 "<p>Configure correctamenteƒl‡rchivo del mÃ³dulo‡dmin</p>";

516 iàĞ
	gGCM_DEBUG
 ) {

517 
	gecho
 '<br />';

518 
echo
 
	g$ex
->
g‘Mes§ge
();

519 
	gecho
 '<br />';

520 
echo
 
	g$ex
->
g‘Fe
(),'@',$ex->
g‘Lše
();

522 
	gecho
 "</p>";

524 
ex™
();

525 
»gi¡¿r
(
$ex
->
g‘Fe
(),$ex->
g‘Lše
,$ex->
g‘Mes§ge
(),'ERROR');

529  
	g$this
->
	gpdo
[
$cÚexiÚ
];

537 
funùiÚ
 
	$__g‘
(
$–em’to
) {

539 iàĞ
	`is£t
(
$this
->
cÚ‹nidos
[
$–em’to
] ) ) {

540 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Gcm->__g‘('.
$–em’to
.')');

541  
$this
->
cÚ‹nidos
[
$–em’to
];

544 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Gcm->__g‘('.
$–em’to
.'): Noƒsta definido');

545  
FALSE
;

546 
	}
}

552 
funùiÚ
 
	$__£t
(
$–em’to
, 
$v®Ü
) {

554 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Gcm->__£t('.
$–em’to
.')');

555 
$this
->
cÚ‹nidos
[
$–em’to
] = 
$v®Ü
;

557 
	}
}

561 
funùiÚ
 
	$__is£t
(
$–em’to
) {

563  
	`is£t
(
$this
->
cÚ‹nidos
[
$–em’to
]);

565 
	}
}

569 
funùiÚ
 
»gi¡¿
(
$fich”o
,
$lš—
,
$m’§je
, 
$to
='DEBUG', 
$desüciÚ
 = 
NULL
) {

571 iàĞ
$this
->
»g
 
š¡ªûof
 
Regi¡ro
 ) {

572 
$this
->
»g
->
»gi¡¿
(
$fich”o
,
$lš—
,
$m’§je
, 
$to
, 
$desüciÚ
);

589 
funùiÚ
 
	$´oû§CÚ‹nido
(
$ev’to
) {

591 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Gcm->´oû§CÚ‹nido('.
$ev’to
.')');

593 
	`ob_¡¬t
();

595 
Œy
 {

597 
$this
->
ev’t
->
	`Ïnz¬Ev’to
(
$ev’to
);

599 } 
	`ÿtch
 (
Exû±iÚ
 
$e
) {

601 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Gcm->´oû§CÚ‹nido: E¼ÜƒÀev’tØ['.
$ev’to
.'] '.
$e
->
	`g‘Mes§ge
(),'DEBUG');

604 
$this
->
cÚ‹nidos
[
$ev’to
] = ( 
	`is£t
($this->cÚ‹nidos[$ev’to]èè? $this->cÚ‹nidos[$ev’to].
	`ob_g‘_cÚ‹Ás
() : ob_get_contents();

606 
	`ob_’d_ş—n
();

608 iàĞ
	`em±y
(
$this
->
cÚ‹nidos
[
$ev’to
]) ) {

609 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Gcm->´oû§CÚ‹nido: Ev’tØ['.
$ev’to
.'] sin contenido');

610  
FALSE
;

613 
$§lida
 = 
PHP_EOL
.'<!-- '.
$ev’to
.' -->'.PHP_EOL;

614 iàĞ
$ev’to
 == 'titulo' ) {

615 
$§lida
 .ğ'<h1 cÏss="t™ulo_´šc®">'.
$this
->
cÚ‹nidos
[
$ev’to
].'</h1>';

617 
$§lida
 .ğ
$this
->
cÚ‹nidos
[
$ev’to
];

619 
$§lida
 .ğ
PHP_EOL
.'<!-- / '.
$ev’to
.' -->'.PHP_EOL;

620  
$§lida
;

622 
	}
}

626 
funùiÚ
 
	$§lœ
() {

628 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Gcm->salir()');

630 iàĞ
$this
->
ev’t
->
	`v”ifiÿr_ev’to
('po¡ÿrga'èè$this->ev’t->
	`Ïnz¬Ev’to
('postcarga');

640 
echo
 
$this
->
§lida
;

641 
	`ex™
();

643 
	}
}

652 
funùiÚ
 
	$´e£Á¬_·gša
() {

654 
$¶ªtÏ_u¾
 = 
$this
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('temas','html','principal.html');

656 iàĞ!
$¶ªtÏ_u¾
 ) {

657 
$¶ªtÏ_u¾
 = 
$this
->
‹ma
->
	`ru
('temas','html','principal.html');

660 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Gcm->´e£Á¬_·gša: Proû§mo ¶ªtÏ htmÈ[".
$¶ªtÏ_u¾
."]");

662 
$¶ªtÏ
 = 
Ãw
 
	`PÏÁÏ
(
$¶ªtÏ_u¾
, 
$this
);

663 
$·gša
 = 
$¶ªtÏ
->
	`´oû§PÏÁÏ
();

665  
$·gša
;

667 
	}
}

686 
funùiÚ
 
	$šicŸ
() {

690 
$this
->
au
 = 
Ãw
 
	`Au‹ÁifiÿciÚ
($this->
	`pdo_cÚexiÚ
(), $this->
sufijo
);

694 iàĞ
GCM_DEBUG
 || 
$this
->
au
->
	`log—do
(èè$this->
»g
->
	`niv–
('ADMIN');

697 ià(
	`is£t
(
$_POST
['§lœ']è|| is£t(
$_GET
['salir'])) {

698 
$this
->
au
->
	`§lœ
();

699 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"gcm->inicia: SessiÃ³nerminada");

704 iàĞ
	`is£t
(
$_POST
['loginPro']) ){

705 iàĞ
$this
->
au
->
	`’Œ¬
(
$_POST
["loginPro"],$_POST["passwd"]) ) {

706 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'gcm->šicŸ: Usu¬iØ[ '.
$_POST
['loginPro'].' ]„egistrado');

712 iàĞ
$this
->
au
->
	`log—do
() ) {

713 
$this
->
ev’tos_´oyeùo
 = ( 
	`is£t
(
$_GET
['eGcm']èè? 
FALSE
 : 
TRUE
 ;

714 
$visu®iz¬
 = ( 
	`is£t
(
$_GET
['eVisu®iz¬']èè? 
TRUE
 : 
FALSE
 ;

715 
$this
->
ev’t
 = 
Ãw
 
	`Ev’tos
(
GCM_DIR
.'modulos/',
TRUE
,$this->
ev’tos_´oyeùo
,
$visu®iz¬
);

717 
$this
->
ev’t
 = 
Ãw
 
	`Ev’tos
(
GCM_DIR
.'modulos/',
FALSE
);

720 
$this
->
rou‹r
 = 
Rou‹r
::
	`g‘In¡ªû
();

721 
$this
->
rou‹r
->
	`šicŸ
();

727 
	`DEFINE
('GCM_DIR_P',
Rou‹r
::
$dœ
.
GCM_DIR
);

729 
$this
->
cÚ‹nidos
['contenido'] = '';

731 
$this
->
	`cÚ¡ruœ_£ËcciÚado
();

734 
	`ob_¡¬t
();

740 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'gcm->šicŸ: U¾:'.
$_SERVER
['REQUEST_URI']);

742 
$this
->
ev’t
->
	`Ïnz¬Ev’to
('precarga');

744 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Tem¨aùu® de¥ue d§lœ d´eÿrga: '.
$this
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`g‘Tema
());

748 iàĞ
Rou‹r
::
$m
 ) {

749 
$m
 = 
Rou‹r
::$m;

750 
$a
 = 
Rou‹r
::$a;

751 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'gcm->šicŸ: Recibimo ³ticiÃ³ÀdmÃ³dulØ['.
$m
.'] cÚ‡cciÃ³À['.
$a
.']','DEBUG');

752 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

753 
$this
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
(
$m
,
$a
);

754 
$§lida
 = 
	`ob_g‘_cÚ‹Ás
(); 
	`ob_’d_ş—n
();

755 
$this
->
§lida
 = 
$§lida
;

756 
$this
->
	`§lœ
();

758 
$this
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
(
$m
,
$a
);

764 iàĞ
Rou‹r
::
$e
 ) {

765 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"gcm->šicŸ: T’emo uÀev’tØdefšido[".
Rou‹r
::
$e
.']');

766 
Œy
 {

767 
$this
->
ev’t
->
	`Ïnz¬Ev’to
(
Rou‹r
::
$e
);

768 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

769 
$this
->
	`»gi¡¿
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),"gcm->šicŸ: E¼Ü‡ÈÏnz¬ƒv’to: ".$ex->
	`g‘Mes§ge
(),'ERROR');

771 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

772 
$§lida
 = 
	`ob_g‘_cÚ‹Ás
(); 
	`ob_’d_ş—n
();

773 
$this
->
§lida
 = $this->
cÚ‹nido
;

774 
$this
->
§lida
 .ğ
$§lida
;

775 
$this
->
	`§lœ
();

781 
$this
->
cÚ‹nidos
['cÚ‹nido'] .ğ
	`ob_g‘_cÚ‹Ás
(); 
	`ob_’d_ş—n
();

783 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

784 
$this
->
	`§lœ
();

787 
$this
->
§lida
 = $this->
	`´e£Á¬_·gša
();

789 
$this
->
	`§lœ
();

791 
	}
}

	@gcm/lib/int/gcm/lib/Modulos.php

1 <?
php


27 
»quœe_Úû
(
GCM_DIR
."lib/int/GcmConfig/lib/GcmConfigFactory.php");

41 
ab¡¿ù
 cÏs 
	cModulos
 {

43 
´iv©e
 
	m$cÚdÜ_š¡ªcŸs
 = -1;

50 
´iv©e
 
	m$nomb»_şa£
 = '';

58 
funùiÚ
 
	$__cÚ¡ruù
() {

60 
glob®
 
$gcm
;

62 
£lf
::
$cÚdÜ_š¡ªcŸs
++;

63 
$this
->
nomb»_şa£
 = 
	`¡r_»¶aû
('Admš','',
	`g‘_şass
($this));

65 iàĞ
$gcm
 ) {

66 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"InicŸd¨şa£ hija::[".
$this
->
nomb»_şa£
.'] Num”Ødš¡ªcŸ: ['.
£lf
::
$cÚdÜ_š¡ªcŸs
.']');

77 
´Ùeùed
 
funùiÚ
 
	$ªuÏrEv’to
(
$ev’to
) {

79 
glob®
 
$gcm
;

81 iàĞ
$gcm
 && $gcm 
š¡ªûof
 
Gcm
 ) {

82 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$ev’to
.'èEv’tØªuÏdØpÜ '.
$this
->
nomb»_şa£
);

83 
$gcm
->
ev’t
->
	`ªuÏr
(
$ev’to
,
$this
->
nomb»_şa£
);

85 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modulos->ªuÏrEv’to('.
$ev’to
.') Gcm‚oƒsta definido','ERROR');

87 
	}
}

96 
´Ùeùed
 
funùiÚ
 
Ïnz¬Ev’to
(
$ev’to
, 
$¬gs
='') {

98 
glob®
 
$gcm
;

100 iàĞ
	g$gcm
 && 
$gcm
 
š¡ªûof
 
	gGcm
 ) {

101 
»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$ev’to
.'èLªzadØev’tØdesd'.
$this
->
nomb»_şa£
);

102 
	g$gcm
->
	gev’t
->
Ïnz¬Ev’to
(
$ev’to
,
$¬gs
);

104 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Modulos->ªuÏrEv’to('.
$ev’to
.','.
$¬gs
.') Gcm‚oƒsta definido','ERROR');

114 
´Ùeùed
 
funùiÚ
 
	$lib»rŸs_js
(
$¬chivo
) {

116 
glob®
 
$gcm
;

118 iàĞ
$gcm
 && $gcm 
š¡ªûof
 
Gcm
 ) {

119 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modulos->lib»rŸs_js('.
$¬chivo
.'èmodulo: '.
$this
->
nomb»_şa£
);

120 
$gcm
->
	`add_lib_js
(
$this
->
nomb»_şa£
,
$¬chivo
);

122 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modulos->lib»rŸ_javasüts('.
$¬chivo
.') $gcm‚oƒsta definida','ERROR');

124 
	}
}

132 
´Ùeùed
 
funùiÚ
 
	$javasüts
(
$¬chivo
) {

134 
glob®
 
$gcm
;

136 iàĞ
$gcm
 && $gcm 
š¡ªûof
 
Gcm
 ) {

137 
$gcm
->
	`add_js
(
$this
->
nomb»_şa£
,
$¬chivo
);

138 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modulos->javas_üts('.
$¬chivo
.'èmodulo: '.
$this
->
nomb»_şa£
);

140 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modulos->javasüts('.
$¬chivo
.') $gcm‚oƒsta definida','ERROR');

142 
	}
}

148 
´Ùeùed
 
funùiÚ
 
	$cÚfig
(
$–em’to
,
$v®Ü
=
NULL
) {

150 
glob®
 
$gcm
;

152 iàĞ
$gcm
 && $gcm 
š¡ªûof
 
Gcm
 ) {

153 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$–em’to
.','.
$v®Ü
.')');

155 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

156 
__CLASS__
.'->'.
__FUNCTION__
.'('.
$–em’to
.','.
$v®Ü
.'èGcm‚Øe¡¨im¶em’dØ·¿ Modulo. '.
$this
->
nomb»_şa£
,

158  
FALSE
;

161 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

162 'CÚfig, modulo: ['.
$this
->
nomb»_şa£
.'] EËm’tØ['.
$–em’to
.'] v®Ü: ['.
$v®Ü
.']');

164  
$gcm
->
	`cÚfig
(
$this
->
nomb»_şa£
,
$–em’to
,
$v®Ü
);

166 
	}
}

172 
public
 
funùiÚ
 
	$cÚfigu¿ciÚ
(
$e
, 
$¬gs
) {

174 
glob®
 
$gcm
;

176 iàĞ!
	`³rmiso
('cÚfigu¿ciÚ'èè 
FALSE
;

178 iàĞ
	`is£t
(
$_POST
['accion']) && $_POST['accion'] == 'escribir_gcmconfig' ) {

182 
Œy
 {

184 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmConfig/lib/GcmConfigGui.php');

186 
$cÚfigu¿ciÚ
 = 
Ãw
 
	`GcmCÚfigGui
(
$_POST
['archivo']);

188 
$cÚfigu¿ciÚ
->
	`esüibœ_desde_po¡
();

190 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

191 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),$ex->
	`g‘Mes§ge
(),'ERROR');

192  
FALSE
;

195 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('ConfiguraciÃ³n guardada',3),'AVISO');

201 iàĞ
	`is£t
(
$¬gs
['modulo']) ) {

202 
$modulo
 = 
$¬gs
['modulo'];

203 
$m’
 = 'Desde‡rgs';

204 } 
	`–£if
 ( !
	`em±y
(
Rou‹r
::
$m
) ) {

205 
$modulo
 = 
Rou‹r
::
$m
;

206 
$m’
 = 'Desde Router';

208 
$modulo
 = 
$this
->
nomb»_şa£
;

209 
$m’
 = 'Desdeƒl…ropio mÃ³dulo';

212 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

213 
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'è'.
$m’
.' ['.
$modulo
.']');

215 
$this
->
	`ªuÏrEv’to
('titulo');

216 
$this
->
	`ªuÏrEv’to
('contenido');

217 
$gcm
->
t™ulo
 = 
	`l™”®
('CÚfigu¿ciÃ³n',3).' '.l™”®('de',3).' '.
$modulo
;

219 
$¬chivo
 = 'DATOS/cÚfigu¿ciÚ/'.
$modulo
.'/config.php';

226 iàĞ
	`is£t
(
$_POST
['»£t']è&& 
	`fe_exi¡s
(
$¬chivo
èè
	`uÆšk
($archivo);

228 iàĞ!
	`fe_exi¡s
('DATOS/cÚfigu¿ciÚ'èè
	`mkdœ
('DATOS/configuracion');

229 iàĞ!
	`fe_exi¡s
('DATOS/cÚfigu¿ciÚ/'.
$modulo
èè
	`mkdœ
('DATOS/configuracion/'.$modulo);

231 iàĞ!
	`fe_exi¡s
(
$¬chivo
èè
	`cİy
(
GCM_DIR
.'modulos/'.
$modulo
.'/config/config.php', $archivo);

233 
Œy
 {

235 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmConfig/lib/GcmConfigGui.php');

237 
$cÚfigu¿ciÚ
 = 
Ãw
 
	`GcmCÚfigGui
(
$¬chivo
);

239 
$¬gs
 = 
	`¬¿y
();

240 
$¬gs
['eliminar'] = 'si';

242 
$cÚfigu¿ciÚ
->
	`dœeùÜio_desüciÚes
(
GCM_DIR
.'modulos/'.
$modulo
.'/config');

244 
$cÚfigu¿ciÚ
->
	`fÜmuÏrio
(
$¬gs
);

246 
echo
 '<br /><br /><form‡ction="" method="post">';

247 
echo
 '<input‚ame="reset"ype="submit" value="Valores…or defecto"/>';

248 
echo
 '</form>';

250 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

251 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),$ex->
	`g‘Mes§ge
(),'ERROR');

255 
	}
}

268 
´Ùeùed
 
funùiÚ
 
	$ejecu_‹¡
(
$nomb»
, 
$uno
, 
$dos
 = 
FALSE
) {

270 iàĞĞ! 
$dos
 && 
$uno
 ) || ( $uno === $dos ) ) {

271 
echo
 '<div cÏss="aviso">'.
$this
->
nomb»_şa£
.' '.
$nomb»
.' bien</div>';

273 
echo
 '<div cÏss="”rÜ">'.
$this
->
nomb»_şa£
.' <b>'.
$nomb»
.'</b>: ';

274 iàĞ
	`is_¬¿y
(
$uno
) ) {

275 
echo
 '<b¸/>'.
	`d•u¿r
(
$uno
).'<b¸/>diã»Á¨<b¸/>'.d•u¿r(
$dos
);

277 
echo
 '['.
$uno
.'] diã»Á¨['.
$dos
.']';

279 
echo
 '</div>';

282 
	}
}

	@gcm/lib/int/gcm/lib/Plantilla.php

1 <?
php


41 şas 
	cPÏÁÏ
 {

43 
´iv©e
 
	m$cPÏÁÏ
;

44 
´iv©e
 
	m$–em’tos
;

45 
´iv©e
 
	m$obj‘o
;

46 
´iv©e
 
	m$¶ªtÏ
;

47 
´iv©e
 
	m$–em’tos_v™®es_´im”os
;

54 
´iv©e
 
	m$–em’tos_v™®es_uÉimos
;

55 
´iv©e
 
	m$cÚ‹nido_–em’tos
;

67 
funùiÚ
 
	$__cÚ¡ruù
(
$¶ªtÏ
, 
$obj‘o
) {

69 
$this
->
obj‘o
 = 
$obj‘o
;

70 
$this
->
¶ªtÏ
 = 
$¶ªtÏ
;

72 
$this
->
–em’tos_v™®es_´im”os
 = 
	`¬¿y
('contenido','titulo');

73 
$this
->
–em’tos_v™®es_uÉimos
 = 
	`¬¿y
('avisos','debug','scripts');

77 
$this
->
cPÏÁÏ
 = @
	`fe_g‘_cÚ‹Ás
($this->
¶ªtÏ
);

79 
	`´eg_m©ch_®l
('/\{[A-Za-z]+\}/', 
$this
->
cPÏÁÏ
, 
$–
, 
PREG_PATTERN_ORDER
);

81 
$this
->
–em’tos
 = 
$–
[0];

99 
funùiÚ
 
	$´oû§PÏÁÏ
() {

101 
$§lida
 = 
$this
->
cPÏÁÏ
;

103 
	`fÜ—ch
 ( 
$this
->
–em’tos_v™®es_´im”os
 
as
 
$–
) {

104 
$this
->
cÚ‹nido_–em’tos
[
$–
] = $this->
obj‘o
->
	`´oû§CÚ‹nido
($el);

107 
	`fÜ—ch
 ( 
$this
->
–em’tos
 
as
 
$–
 ) {

109 
$–
 = 
	`sub¡r
($–, 1, 
	`¡¾’
($el)-2);

111 iàĞ!
	`š_¬¿y
(
$–
,
$this
->
–em’tos_v™®es_uÉimos
è&& !š_¬¿y($–,$this->
–em’tos_v™®es_´im”os
) ) {

112 
$this
->
cÚ‹nido_–em’tos
[
$–
] = $this->
obj‘o
->
	`´oû§CÚ‹nido
($el);

117 
	`fÜ—ch
 ( 
$this
->
–em’tos_v™®es_uÉimos
 
as
 
$–
) {

118 
$this
->
cÚ‹nido_–em’tos
[
$–
] = $this->
obj‘o
->
	`´oû§CÚ‹nido
($el);

121 
	`fÜ—ch
 ( 
$this
->
cÚ‹nido_–em’tos
 
as
 
$key
 => 
$cÚ‹nidos
 ) {

125 iàĞ
$key
 == 'contenido' )  ;

127 iàĞ!
$cÚ‹nidos
 ) {

129 iàĞĞ
	`š_¬¿y
(
$key
,
$this
->
–em’tos_v™®es_´im”os
è|| in_¬¿y($key,$this->
–em’tos_v™®es_uÉimos
 ) && $key !== 'scripts' ) ) {

130 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

131 'NØ‹Ãmo cÚ‹nidØv™®…¬¨['.
$key
.'] d¶ªtÏ ['.
$this
->
¶ªtÏ
.'] yƒs‚ecesario…araƒl correcto funcionamiento');

133 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'EËm’tØ['.
$key
.'] d¶ªtÏ ['.
$this
->
¶ªtÏ
.'] vacio');

138 
$»suÉado
 = "\n<!-- EËm’to:".
$key
." -->\n".
$cÚ‹nidos
."\n<!-- Acaba:".$key." -->\n";

139 
$§lida
 = 
	`¡r_»¶aû
('{'.
$key
.'}', 
$»suÉado
, $salida);

141 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'PÏÁÏ->´oû§PÏÁÏ(è Fš®iz¨´oûsØ’…ÏÁÏ…¬¨–em’tØ['.
$–
.']');

146 
$key
 = 'contenido';

147 
$cÚ‹nidos
 = 
$this
->
cÚ‹nido_–em’tos
['contenido'];

149 iàĞ!
$cÚ‹nidos
 ) {

150 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ‹Ãmo cÚ‹nidØ·¿ cÚ‹nidØ['.
$cÚ‹nidos
.'] d¶ªtÏ ['.
$this
->
¶ªtÏ
.']');

152 
$»suÉado
 = '<div id="'.
$key
.'">'.
$cÚ‹nidos
.'</div>';

153 
$§lida
 = 
	`¡r_»¶aû
('{'.
$key
.'}', 
$»suÉado
, $salida);

156  
$§lida
;

158 
	}
}

	@gcm/lib/int/gcm/lib/Router.php

1 <?
php


74 şas 
	cRou‹r
 {

76 
´iv©e
 
	m$»ã»ncŸ
 = 
NULL
;

87 
´iv©e
 
	m$modulos
 = 
NULL
;

99 
public
 
	m$¬gs
;

105 
´iv©e
 
	m$ev’tos
 = 
NULL
;

113 
´iv©e
 
	m$fÜm©os
 = 
NULL
;

119 
´iv©e
 
	m$idiomas
 = 
NULL
 ;

121 
public
 
	m$u¾
;

122 
public
 
	m$dœ
;

123 
public
 
	m$dd
;

124 
public
 
	m$d
;

125 
public
 
	m$s
;

126 
public
 
	m$c
;

127 
public
 
	m$f
;

128 
public
 
	m$m
;

129 
public
 
	m$a
;

130 
public
 
	m$e
;

131 
public
 
	m$i
;

132 
public
 
	m$ii
;

133 
public
 
	m$ba£
;

134 
public
 
	m$e¡amos
;

135 
public
 
	m$ed™¬
;

136 
public
 
	m$mime_ty³
;

137 
public
 
	m$fÜm©o
;

138 
public
 
	m$esBÜ¿dÜ
 = 
FALSE
;

139 
public
 
	m$sš_cÚ‹nido
 = 
FALSE
;

140 
public
 
	m$sš_ŒaducciÚ
 = 
FALSE
;

141 
public
 
	m$fÜma_com’rios
 = '<!-- %s -->';

148 
public
 
	m$’Ïû_»Ïtivo
;

156 
funùiÚ
 
	$£t_idiomas
() {

157 
£lf
::
$idiomas
 = 
	`¬¿y
('es','ca');

164 
funùiÚ
 
	$£t_fÜm©os
() {

165 
£lf
::
$fÜm©os
 = 
	`¬¿y
('html', 'ajax', 'rst');

166 
	}
}

174 
funùiÚ
 
	$£t_ev’tos
() {

176 
glob®
 
$gcm
;

178 iàĞ
	`is£t
(
$gcm
->
ev’t
->
ev’tos
) ) {

180 
£lf
::
$ev’tos
 = 
	`¬¿y_keys
(
$gcm
->
ev’t
->
ev’tos
);

203 
	}
}

214 
funùiÚ
 
	$£t_modulos
() {

216 
glob®
 
$gcm
;

218 iàĞ
	`is£t
(
$gcm
->
ev’t
->
ev’tos
) ) {

220 
	`fÜ—ch
 ( 
$gcm
->
ev’t
->
ev’tos
 
as
 
$ev’to
 ) {

221 
	`fÜ—ch
 ( 
$ev’to
 
as
 
$modulo
 => 
$acciÚ
 ) {

222 iàĞ! 
£lf
::
$modulos
 || ! 
	`š_¬¿y
(
$modulo
,self::$modulos) ) {

223 
£lf
::
$modulos
[] = 
$modulo
;

241 
	}
}

247 
funùiÚ
 
	$com´ob¬_»£rvadas
() {

249 
$msg
 = 
FALSE
;

250 
$msg_comun
 = "\nLas coincidenciasƒn†as…alabras„eservadas que utiliza Router…ueden‡fectar

251 
®
 
compÜm›Áo
 
de
 
Rou‹r
 
a
 
Ï
 
hÜa
 d
£ËcciÚ¬
†¨
acci
Ã³
n
 
que
 
£
 
de£a
 
»®iz¬
, 
·¿


252 
m
Ã¡
s
 
šfÜmaci
Ã³
n
 
v—£
 
Ï
 
docum’ci
Ã³À
de
 ".GUtil::enlace_documentacion('Router');

254 
$»£rvadas
 = 
	`¬¿y
('modulos', 'eventos', 'idiomas', 'formatos');

256 
	`fÜ—ch
 ( 
$»£rvadas
 
as
 
$»£rvada
 ) {

258 
	`fÜ—ch
 ( 
£lf
::
$$»£rvada
 
as
 
$–em’to
 ) {

259 iàĞ
$»£rvada
 !ğ'ev’tos' && 
	`š_¬¿y
(
$–em’to
, 
£lf
::
$ev’tos
) ) {

260 
$msg
 .= "$reservada: $elemento coincide conƒventos\n";

262 iàĞ
$»£rvada
 !ğ'modulos' && 
	`š_¬¿y
(
$–em’to
, 
£lf
::
$modulos
) ) {

263 
$msg
 .= "$reservada: $elemento coincide con modulos\n";

265 iàĞ
$»£rvada
 !ğ'idiomas' && 
	`š_¬¿y
(
$–em’to
, 
£lf
::
$idiomas
) ) {

266 
$msg
 .= "$reservada: $elemento coincide con idiomas\n";

268 iàĞ
$»£rvada
 !ğ'fÜm©os' && 
	`š_¬¿y
(
$–em’to
, 
£lf
::
$fÜm©os
) ) {

269 
$msg
 .= "$reservada: $elemento coincide con formatos\n";

274 iàĞ
$msg
 ) 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,$msg.
$msg_comun
,'ADMIN');

277 
	}
}

283 
funùiÚ
 
	$g‘In¡ªû
() {

285 iàĞ!
£lf
::
$»ã»ncŸ
 
š¡ªûof
 self ) {

287 
$şa£
 = 
__CLASS__
;

288 
£lf
::
$»ã»ncŸ
 = 
Ãw
 
$şa£
;

292  
£lf
::
$»ã»ncŸ
;

294 
	}
}

304 
funùiÚ
 
	$šicŸ
(
$u¾
=
NULL
) {

306 
glob®
 
$gcm
;

308 
$´oyeùo
 = 
$gcm
->
	`cÚfig
('admin','Proyecto');

310 
$this
->
	`£t_modulos
();

311 
$this
->
	`£t_ev’tos
();

312 
$this
->
	`£t_fÜm©os
();

313 
$this
->
	`£t_idiomas
();

316 iàĞ! 
	`is£t
(
$u¾
èè$u¾ = 
	`¡r¦ashes
((is£t(
$_REQUEST
['url'])) ? $_REQUEST['url'] : '' );

317 
$»tÜno
 = 
£lf
::
	`desglo§rU¾
(
$u¾
);

321 
£lf
::
$u¾
 = 
$»tÜno
['url'];

322 
£lf
::
$s
 = 
$»tÜno
['s'];

323 
£lf
::
$c
 = 
$»tÜno
['c'];

324 
£lf
::
$a
 = 
$»tÜno
['a'];

325 
£lf
::
$e
 = 
$»tÜno
['e'];

326 
£lf
::
$i
 = 
$»tÜno
['i'];

327 
£lf
::
$ii
 = 
$»tÜno
['ii'];

328 
£lf
::
$d
 = 
$»tÜno
['d'];

329 
£lf
::
$dd
 = 
$»tÜno
['dd'];

330 
£lf
::
$m
 = 
$»tÜno
['m'];

331 
£lf
::
$¬gs
 = 
$»tÜno
['args'];

332 
£lf
::
$fÜm©o
 = 
$»tÜno
['formato'];

333 
£lf
::
$’Ïû_»Ïtivo
 = 
$»tÜno
['enlace_relativo'];

334 
£lf
::
$mime_ty³
 = 
$»tÜno
['mime_type'];

335 
£lf
::
$esBÜ¿dÜ
 = 
$»tÜno
['esBorrador'];

336 
£lf
::
$fÜma_com’rios
 = 
$»tÜno
['forma_comentarios'];

338 iàĞ
	`is£t
(
$_REQUEST
['i']) ) {

339 
£lf
::
$i
 = 
$_REQUEST
['i'];

340 } 
	`–£if
 ( 
	`is£t
(
$_REQUEST
['idioma']) ) {

341 
£lf
::
$i
 = 
$_REQUEST
['idioma'];

342 } 
	`–£if
 ( 
	`is£t
(
$_SESSION
[
$´oyeùo
."-idioma"]) ) {

343 
£lf
::
$i
 = 
$_SESSION
[
$´oyeùo
."-idioma"];

346 iàĞ
	`is£t
(
$_REQUEST
['fÜm©o']èè{ 
£lf
::
$fÜm©o
 = $_REQUEST['formato']; }

348 iàĞ
	`is£t
(
$_REQUEST
['a']èè{ 
£lf
::
$a
 = $_REQUEST['a']; }

349 iàĞ
	`is£t
(
$_REQUEST
['e']èè{ 
£lf
::
$e
 = $_REQUEST['e']; }

350 iàĞ
	`is£t
(
$_REQUEST
['m']èè{ 
£lf
::
$m
 = $_REQUEST['m']; }

351 iàĞ
	`is£t
(
$_REQUEST
['¬gs']èè{ 
£lf
::
$¬gs
 = $_REQUEST['args']; }

354 
£lf
::
$d
 = "Fe/".£lf::
$i
.'/';

364 
$uri_p
=
	`´eg_»¶aû
('/\?(.*)$/', '', 
$_SERVER
['REQUEST_URI']);

365 
$uri
 = 
	`ex¶ode
("/",
$uri_p
);

366 
$sütName
 = 
	`ex¶ode
("/",
$_SERVER
['SCRIPT_NAME'] );

367 
$£c
 = 
	`¬¿y_diff
(
$uri
, 
$sütName
);

368 
$diã»ncŸ
 = 
	`couÁ
(
$uri
)-couÁ(
$sütName
);

371 
£lf
::
$dœ
 = '';

372 
$x
=0;$x<
$diã»ncŸ
;$x++) {

373 
£lf
::
$dœ
 .= "../";

376 
£lf
::
$ba£
 = s–f::
$’Ïû_»Ïtivo
.£lf::
$dœ
;

380 
$aC¬³_ba£
=
	`ex¶ode
('/',
$_SERVER
['SCRIPT_FILENAME']);

381 
$ÿ½‘a_ba£
 = 
$aC¬³_ba£
[
	`couÁ
($aCarpeta_base)-2];

383 
$aU¾
 = 
	`ex¶ode
('/',
£lf
::
$u¾
);

384 
$şave
 = 
	`¬¿y_£¬ch
(
$ÿ½‘a_ba£
, 
$aU¾
);

385 iàĞ
$şave
 > 0 ) {

386 
£lf
::
$u¾
=
	`im¶ode
('/',
	`¬¿y_¦iû
(
$aU¾
,
$şave
+1));

391 
£lf
::
$u¾
 = 
	`¡r_»¶aû
('../','',self::$url);

397 
£lf
::
$s
 = ( 
	`is£t
(
$_REQUEST
['s']èè? 
	`¡r¦ashes
($_REQUEST['s']) : self::$s;

398 
£lf
::
$c
 = ( 
	`is£t
(
$_REQUEST
['c']èè? 
	`¡r¦ashes
($_REQUEST['c']) : self::$c;

400 iàĞ
£lf
::
$s
 == '/' ) self::$s = '';

407 iàĞ
	`esImag’
Ğ
£lf
::
$u¾
) ) {

409 
$¬chivo
 = 
£lf
::
$dd
.£lf::
$u¾
;

410 iàĞ!
	`is_fe
(
$¬chivo
) ) {

413 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Rou‹r::NØ’cÚŒado:......'.
$¬chivo
);

415 
$¬chivo_¬¿y
 = 
	`ex¶ode
('Fe',
$¬chivo
);

417 
$¬chivo
 = 'Fe'.
$¬chivo_¬¿y
[
	`couÁ
($archivo_array)-1];

418 iàĞ! 
	`fe_exi¡s
(
$¬chivo
) ) {

419 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Rou‹r::TampocØ’cu’Œo:..'.
$¬chivo
);

421 
$¬chivo
 = 
	`¡r_»¶aû
(
£lf
::
$s
,'',$archivo);

422 iàĞ! 
	`fe_exi¡s
(
$¬chivo
) ) {

423 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Rou‹r::šicŸ::TampocØ’cu’Œo:..'.
$¬chivo
.

425 
	`ex™
();

429 
$¬chivo_cÚ‹nido
 = 
	`fe_g‘_cÚ‹Ás
(
$¬chivo
);

430 
	`h—d”
('CÚ‹Á-ty³: '. 
£lf
::
$mime_ty³
);

431 
	`h—d”
 ("Expœes: ".
	`gmd©e
("D, d M Y H:i:s",
	`time
()+86400).' GMT');

432 
echo
 
$¬chivo_cÚ‹nido
;

433 
	`ex™
();

438 ià(!
£lf
::
$s
 && !£lf::
$c
) {

439 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Router::inicia::No hay secciÃ³n‚i contenido');

440 
£lf
::
$f
=£lf::
$d
."index.html";

441 
£lf
::
$c
 = "index.html";

442 
£lf
::
$e¡amos
="inicio";

444 } 
	`–£if
 (!
£lf
::
$s
 && s–f::
$c
){

445 
£lf
::
$f
=£lf::
$d
.£lf::
$c
;

446 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Router::inicia::No hay seccion");

448 } 
	`–£if
 (
£lf
::
$c
 && !£lf::
$s
) {

449 
£lf
::
$f
=£lf::
$d
.£lf::
$c
;

450 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Router::inicia::No hay seccion,…ero si contenido");

452 } 
	`–£if
 (
£lf
::
$s
 && !£lf::
$c
) {

453 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Router::inicia::Hay seccion,…ero‚o hay contenido");

454 
£lf
::
$f
=£lf::
$d
.£lf::
$s
."index.html";

455 
£lf
::
$c
 = "index.html";

456 } 
	`–£if
 (
£lf
::
$c
 && s–f::
$s
) {

457 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Router::inicia::Hay seccion, y hay contenido");

458 
£lf
::
$f
=£lf::
$d
.£lf::
$s
.£lf::
$c
;

466 ià(!
	`em±y
(
£lf
::
$s
)) {

467 
£lf
::
$e¡amos
 = 
	`ba£Çme
(£lf::
$d
.£lf::
$s
);

471 
$this
->
	`com´ob¬_»£rvadas
();

474 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Rou‹r:'.
	`d•u¿r
(
	`g‘_şass_v¬s
(
__CLASS__
),'Variables'));

476 
	}
}

487 
funùiÚ
 
	$desglo§rU¾
(
$u¾
) {

489 
glob®
 
$gcm
;

493 
$cÚ‹nidos
 = 
$gcm
->
ev’t
->
	`š¡ªcŸ_modulo
('contenidos');

495 
$s
 = 
NULL
;

496 
$c
 = 
NULL
;

497 
$dd
 = 
NULL
;

498 
$d
 = 
NULL
;

499 
$ii
 = 
NULL
;

500 
$i
 = 
NULL
;

501 
$a
 = 
NULL
;

502 
$m
 = 
NULL
;

503 
$¬gs
 = 
NULL
;

504 
$e
 = 
NULL
;

505 
$’Ïû_»Ïtivo
 = 
NULL
;

506 
$mime_ty³
 = 
NULL
;

507 
$fÜm©o
 = 
NULL
;

509 
$»tÜno
 = 
	`¬¿y
();

510 
$u¾
 = 
	`¡r_»¶aû
('//','/',$url);

514 
$ii
 = 
$gcm
->
	`cÚfig
('idiomas','Idioma…or defecto');

516 
$´oyeùo
 = 
$gcm
->
	`cÚfig
('admin','Proyecto');

520 iàĞ
	`¡½os
(
$u¾
,'/Fe/'è!=ğ
FALSE
 ) {

521 
$u¾
 = 
	`sub¡r
($u¾,
	`¡½os
($url,'/File/'));

526 
$cÚtšu¬
 = 
TRUE
;

528  
$cÚtšu¬
 ) {

530 
$cÚtšu¬
 = 
FALSE
;

534 
$£cciÚes
 = 
	`ex¶ode
('/',
$u¾
);

536 iàĞ
	`’d
(
$£cciÚes
) != 'proyecto.js' &&ƒnd($secciones) != 'proyectos.css' ) {

538 iàĞ
	`š_¬¿y
(
$£cciÚes
[0], 
£lf
::
$modulos
) ) {

539 
$m
 = 
$£cciÚes
[0];

540 
	`¬¿y_shiá
(
$£cciÚes
);

541 
$a
 = ( 
	`is£t
(
$£cciÚes
[0]èè? $£cciÚes[0] : 
FALSE
;

542 
	`¬¿y_shiá
(
$£cciÚes
);

545  
	`is£t
(
$£cciÚes
[0]è&& ! 
$cÚ‹nidos
->
	`v”ifiÿr_£cciÚ
($secciones[0]) && $secciones[0] != 'proyectos.css' && $secciones[0] != 'proyecto.js' ) {

546 
$¬gs
[] = 
$£cciÚes
[0];

547 
	`¬¿y_shiá
(
$£cciÚes
);

550 
$u¾
 = 
	`im¶ode
('/',
$£cciÚes
);

551 
$cÚtšu¬
 = 
TRUE
;

558 
$£cciÚes
 = 
	`ex¶ode
('/',
$u¾
);

560 iàĞ
	`š_¬¿y
(
$£cciÚes
[0], 
£lf
::
$ev’tos
) ) {

561 
$e
 = 
$£cciÚes
[0];

562 
	`¬¿y_shiá
(
$£cciÚes
);

565  
	`is£t
(
$£cciÚes
[0]è&& ! 
$cÚ‹nidos
->
	`v”ifiÿr_£cciÚ
($secciones[0]) && $secciones[0] != 'proyectos.css' && $secciones[0] != 'proyecto.js' ) {

566 
$¬gs
[] = 
$£cciÚes
[0];

567 
	`¬¿y_shiá
(
$£cciÚes
);

570 
$u¾
 = 
	`im¶ode
('/',
$£cciÚes
);

571 
$cÚtšu¬
 = 
TRUE
;

576 
$£cciÚes
 = 
	`ex¶ode
('/',
$u¾
);

578 iàĞ
	`š_¬¿y
(
$£cciÚes
[0], 
£lf
::
$fÜm©os
) ) {

579 
$fÜm©o
 = 
$£cciÚes
[0];

580 
	`¬¿y_shiá
(
$£cciÚes
);

581 
$u¾
 = 
	`im¶ode
('/',
$£cciÚes
);

582 
$cÚtšu¬
 = 
TRUE
;

586 iàĞ!
$fÜm©o
 ) { $formato = 'html'; }

590 
$£cciÚes
 = 
	`ex¶ode
('/',
$u¾
);

592 iàĞ
	`š_¬¿y
(
$£cciÚes
[0], 
£lf
::
$idiomas
) ) {

593 
$i
 = 
$£cciÚes
[0];

594 
	`¬¿y_shiá
(
$£cciÚes
);

595 
$u¾
 = 
	`im¶ode
('/',
$£cciÚes
);

596 
$cÚtšu¬
 = 
TRUE
;

607 if(
	`¡ri¡r
(
$u¾
, 'Fe/'è!=ğ
FALSE
) {

608 
$d
 = 
	`sub¡r
(
$u¾
,0,7);

609 
$i
 = 
	`¡r_»¶aû
('Fe/','',
$d
);

610 
$d
 = 
	`com´ob¬_b¬¿
($d);

613 
$dd
 = 'Fe/'.
$ii
.'/';

617 
$u¾
=
	`¡r_»¶aû
(
$dd
,'',$url);

619 iàĞ
$d
 ) 
$u¾
=
	`¡r_»¶aû
($d,'',$url);

626 
$u¾_sš_subdœeùÜios
 = 
	`¡r_»¶aû
('../','',
$u¾
);

628 
$mime_ty³
 = 
GUt
::
	`to_de_¬chivo
(
$dd
.
$u¾_sš_subdœeùÜios
);

630 iàĞ
	`sub¡r_couÁ
(
$u¾
,".btml") != 0) {

631 
$esBÜ¿dÜ
 = 
TRUE
 ;

633 
$esBÜ¿dÜ
 = 
FALSE
 ;

638 
$mime_ty³
) {

641 
$fÜma_com’rios
 = '/* %s */';

644 
$fÜma_com’rios
 = '/* %s */';

647 
$fÜma_com’rios
 = 
£lf
::$forma_comentarios;

653 iàĞ
	`em±y
(
$mime_ty³
) || $mime_type != 'text/directory' ) {

655 
$u¾_¬¿y
 = 
	`ex¶ode
("/",
$u¾
);

656 
$uÉimo
 = 
$u¾_¬¿y
[
	`couÁ
($url_array)-1];

657 
	`un£t
(
$u¾_¬¿y
[
	`couÁ
($url_array)-1]);

658 
$s
 = 
	`im¶ode
('/',
$u¾_¬¿y
);

659 
$c
 = 
$uÉimo
;

663 iàĞ
$u¾
 == 'index.html' ) {

664 
$s
 = '';

665 
$c
 = 'index.html';

667 
$s
 = 
$u¾
;

668 
$c
= '';

675 iàĞ!
	`em±y
(
$s
èè$ ğĞ$s{
	`¡¾’
($s)-1} == '/' ) ? $s : $s.'/' ;

676 iàĞ
$s
 == '/' ) $s = '';

677 
$s
 = 
	`¡r_»¶aû
('../','',$s);

681 iàĞ
$mime_ty³
 =ğ'‹xt/dœeùÜy' && 
	`com´ob¬_b¬¿
(
$u¾
) != $url ) {

682 
$£cciÚes
 = 
	`ex¶ode
('/',
$s
);

683 
$uÉimo
 = 
$£cciÚes
[
	`couÁ
($secciones)-2];

684 
$’Ïû_»Ïtivo
 = ( 
	`em±y
(
$uÉimo
) ) ? '' : './';

686 
$’Ïû_»Ïtivo
 = './';

689 
$»tÜno
['u¾'] = 
$u¾
;

690 
$»tÜno
['s'] = 
$s
;

691 
$»tÜno
['c'] = 
$c
;

692 
$»tÜno
['dd'] = 
$dd
;

693 
$»tÜno
['d'] = ( 
$d
 ) ? $d : 
$dd
 ;

694 
$»tÜno
['ii'] = 
$ii
;

695 
$»tÜno
['i'] = ( 
$i
 ) ? $˜: 
$ii
 ;

696 
$»tÜno
['a'] = 
$a
;

697 
$»tÜno
['m'] = 
$m
;

698 
$»tÜno
['¬gs'] = 
$¬gs
;

699 
$»tÜno
['e'] = 
$e
;

700 
$»tÜno
['’Ïû_»Ïtivo'] = 
$’Ïû_»Ïtivo
;

701 
$»tÜno
['mime_ty³'] = 
$mime_ty³
;

702 
$»tÜno
['fÜm©o'] = 
$fÜm©o
;

703 
$»tÜno
['esBÜ¿dÜ'] = 
$esBÜ¿dÜ
;

704 
$»tÜno
['fÜma_com’rios'] = 
$fÜma_com’rios
;

706  
$»tÜno
;

708 
	}
}

	@gcm/lib/int/gcm/lib/helpers.php

1 <?
php


16 ifĞ! 
funùiÚ_exi¡s
("literal") ) {

42 
funùiÚ
 
l™”®
(
$l™”®
, 
$niv–
=2, 
$v®Ü
=
NULL
) {

44 
glob®
 
$LG
, 
$GCM_LG
, 
$gcm
;

46 
	g$´oyeùo
 = 
$gcm
->
cÚfig
('admin','Proyecto');

48 
	g$l™”®
 = 
html_’t™y_decode
(
$l™”®
,
ENT_NOQUOTES
,'UTF-8');

50 iàĞ
em±y
(
$l™”®
è|| 
	g$l™”®
 == ' ' || $literal == '' ) {

51  
FALSE
;

54 
	g$niv–
) {

58 iàĞ!
$v®Ü
 && 
is£t
(
$LG
[
$l™”®
]) && $LG[$literal] != "" ) {

59  
$LG
[
$l™”®
] ;

62 iàĞ
	g$v®Ü
 ) {

64 
	g$m’s
 = 'NuevØl™”® ['.
$l™”®
.'] d´oyeùØcÚ v®Ü ['.
$v®Ü
.']';

66 } 
–£if
 ( 
is_¬¿y
(
$LG
è&& ! @
¬¿y_key_exi¡s
 ( 
$l™”®
 , $LG ) ) {

72 
	g$m’s
 = 'NuevØl™”® d´oyeùØ['.
$l™”®
.']';

73 
	g$v®Ü
 = '';

76  
	g$l™”®
;

79 
	g$idioma_aùu®
 = 
$_SESSION
[
$´oyeùo
.'-idioma'];

80 
	g$fe
=
$gcm
->
cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
	g$idioma_aùu®
.".php";

82 
»quœe_Úû
(
GCM_DIR
."lib/int/GcmConfig/lib/GcmConfigFactory.php");

84 
	g$¬r
 = 
GcmCÚfigFaùÜy
::
G‘GcmCÚfig
(
$fe
);

85 
	g$¬r
->
£t
(
$l™”®
,
$v®Ü
);

86 
	g$¬r
->
gu¬d¬_v¬ŸbËs
();

88 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
);

90 
	g$LG
[
$l™”®
] = '';

92  
	g$l™”®
;

98 iàĞ
is£t
(
$LG
[
$l™”®
]) && $LG[$literal] != "" ) {

99  
$LG
[
$l™”®
] ;

100 } 
–£if
 ( 
is£t
(
$GMC_LG
[
$l™”®
]è&& 
$GCM_LG
[$literal] != "" ) {

101  
$GMC_LG
[
$l™”®
];

106  
	g$l™”®
;

112 iàĞ!
$v®Ü
 && 
is£t
(
$GCM_LG
[
$l™”®
]è&& !
em±y
($GCM_LG[$literal]) && $GCM_LG[$literal] !== '' ) {

113  
$GCM_LG
[
$l™”®
] ;

116 iàĞ
	g$v®Ü
 ) {

118 
	g$m’s
 = 'NuevØl™”® ['.
$l™”®
.'] dGcm cÚ v®Ü ['.
$v®Ü
.']';

120 } 
–£if
 ( ! 
¬¿y_key_exi¡s
 ( 
$l™”®
 , 
$GCM_LG
 ) ) {

122 
	g$m’s
 = 'NuevØl™”® dGcm ['.
$l™”®
.']';

123 
	g$v®Ü
 = '';

126  
	g$l™”®
;

129 
	g$idioma_aùu®
 = 
$_SESSION
[
$´oyeùo
.'-idioma'];

130 
	g$fe
=
GCM_DIR
."DATOS/idiomas/GCM_LG_".
$idioma_aùu®
.".php";

132 
»quœe_Úû
(
GCM_DIR
."lib/int/GcmConfig/lib/GcmConfigFactory.php");

134 
	g$¬r
 = 
GcmCÚfigFaùÜy
::
G‘GcmCÚfig
(
$fe
);

135 
	g$¬r
->
£t
(
$l™”®
,
$v®Ü
);

136 
	g$¬r
->
gu¬d¬_v¬ŸbËs
();

138 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
);

142 
	g$GCM_LG
[
$l™”®
]='';

144  
	g$l™”®
;

148  
	gFALSE
;

153 iàĞ! 
funùiÚ_exi¡s
("registrar") ) {

166 
funùiÚ
 
»gi¡¿r
(
$fich”o
,
$lš—
,
$m’§je
,
$to
='DEBUG') {

168 
glob®
 
$gcm
;

172 iàĞ!
is£t
(
$gcm
) ) {

173 
	gecho
 '<div class="error">No hay instancia de gcm';

174 
	gecho
 '<b¸/>M’§je: '.
	g$m’§je
;

175 
	gecho
 '<b¸/>'.
	g$fich”o
,
	g$lš—
,
	g$m’§je
,
	g$to
;

176 
	gecho
 '</div>';

182 
	g$gcm
->
»gi¡¿
(
$fich”o
,
$lš—
,
$m’§je
,
$to
);

205 
funùiÚ
 
com´ob¬_b¬¿
(
$u¾
, 
$acciÚ
='anyadir') {

207 
$u¾
 = 
¡r_»¶aû
('//','/',$url);

209 ià(
	g$u¾
) {

211 iàĞ
	g$acciÚ
 == 'eliminar' ) {

212 iàĞ
$u¾
{
¡¾’
($url)-1} == '/' ) {

213  
sub¡r
(
$u¾
,0, -1);

215  
	g$u¾
;

218 iàĞ
	g$u¾
{
¡¾’
(
$u¾
)-1} == '/' ) {

219  
$u¾
;

221  
	g$u¾
.'/';

241 
funùiÚ
 
	$esImag’
(
$¬chivo
) {

243 
$ex‹nsiÚes
 = 
	`¬¿y
("jpg", "jpeg", "JPG", "JPEG", "GIF", "gif", "png", "PNG", "tiff", "TIFF");

246 
$feInfo
 = 
	`·thšfo
(
$¬chivo
);

247 
$ext
 = ( 
	`is£t
(
$feInfo
['ex‹nsiÚ']èè? $feInfo['ex‹nsiÚ'] : 
NULL
 ;

250 iàĞ
	`š_¬¿y
(
$ext
,
$ex‹nsiÚes
) ) {

251  
TRUE
;

253  
FALSE
;

256 
	}
}

260 
funùiÚ
 
	$d•u¿r
(
$v¬
, 
$t™ulo
=
NULL
, 
$niv–
=0) {

262 iàĞ
$t™ulo
 ) {

263 
$t™ulo
 = "[".$titulo."]\n";

265 
$t™ulo
 = 
NULL
;

268 
$¡ršg
 = '';

269 
$buÏdÜ
 = '';

271 iàĞ
$niv–
 > 0 ) 
$buÏdÜ
 = 
	`¡r_»³©
("\t",$nivel);

273 ià(
$t™ulo
è
$¡ršg
 .ğ
$buÏdÜ
.$titulo;

275 
$niv–
++;

277 ià(
	`is_¬¿y
(
$v¬
)) {

279 
	`fÜ—ch
(
$v¬
 
as
 
$key
 => 
$v®ue
) {

281 ià(
	`is_¬¿y
(
$v®ue
)) {

282 
$¡ršg
 .ğ"\n".
$buÏdÜ
.
$key
.': ';

283 
$¡ršg
 .ğ
	`d•u¿r
(
$v®ue
, 
çl£
, 
$niv–
);

284 } 
	`–£if
(
	`g‘ty³
(
$v®ue
) == 'object') {

285 
$¡ršg
 .ğ"\n".
$buÏdÜ
.
$key
.': ';

286 
$¡ršg
 .ğ"Objeù oàşas " . 
	`g‘_şass
(
$v®ue
);

288 
$¡ršg
 .ğ"\n".
$buÏdÜ
.
$key
.': ';

289 
$¡ršg
 .= "$value" ;

294 } 
	`–£if
(
	`g‘ty³
(
$v¬
) == 'object') {

295 
$¡ršg
 .ğ"Objeù oàşas " . 
	`g‘_şass
(
$v¬
);

297 
$¡ršg
 .= "$var" ;

300  
$¡ršg
;

301 
	}
}

311 
funùiÚ
 
	$»cog”_·¿m‘ros
(
$·¿m‘ros
){

313 
$»tÜno
 = 
	`¬¿y
();

315 iàĞ
	`is£t
Ğ
$·¿m‘ros
 ) ) {

317 iàĞ!
	`is_¬¿y
(
$·¿m‘ros
) ) {

319 iàĞ
	`sub¡r_couÁ
(
$·¿m‘ros
,'&') > 0 ) {

320 
$d©os
 = 
	`ex¶ode
('&',
$·¿m‘ros
);

322 
$d©os
 = 
	`¬¿y
(
$·¿m‘ros
);

326 
$d©os
 = 
$·¿m‘ros
;

329 
	`fÜ—ch
 (
$d©os
 
as
 
$·¿m‘ro
) {

330 iàĞ
	`sub¡r_couÁ
(
$·¿m‘ro
,'=') > 0 ) {

331 
	`li¡
(
$v¬
,
$v®
èğ
	`ex¶ode
('=',
$·¿m‘ro
);

332 
$»tÜno
[
$v¬
] = 
$v®
;

337  
$»tÜno
;

338 
	}
}

355 
funùiÚ
 
	$´e£Á¬By‹s
(
$by‹s
) {

357 
$Kb
 = 
	`¥rštf
("%.1f", 
$by‹s
 / 1000);

359  
$Kb
.'Kb';

361 
	}
}

385 
funùiÚ
 
´e£Á¬Fecha
(
$time
, 
$fÜm©o_§lida
=1, 
$fÜm©o_’Œada
='unix') {

387 
»gi¡¿r
(
__FILE__
,
__LINE__
, "<br>time: $time / formato_entrada: $formato_entrada / formato_salida: $formato_salida");

389 iàĞ
	g$fÜm©o_’Œada
 =ğ'sql™e' ) 
$fÜm©o_’Œada
 = 'unix';

391 iàĞ
	g$fÜm©o_’Œada
 == 'deducir' ) {

393 iàĞ
is_št
(
$time
) ) {

394 
$fÜm©o_’Œada
 = 'unix';

396 
»gi¡¿r
(
__FILE__
,
__LINE__
, "NØ£…udØdedicœƒÈfÜm©ØdÏ fech¨[".
$time
."]",'ADMIN');

400 iàĞ
	g$fÜm©o_’Œada
 != 'unix' ) {

402 
$fÜm©o_’Œada
) {

405 
$time
 = 
¡¹Ùime
Ğ
d©e
($time) );

408 
$time
 = 
¡¹Ùime
Ğ
d©e
($time) );

413 
	g$mes
 = 
d©e
('F', 
$time
);

414 
	g$dŸ
 = 
d©e
('d', 
$time
);

415 
	g$ªyo
 = 
d©e
('Y', 
$time
);

416 
	g$hÜa
 = 
d©e
('H', 
$time
);

417 
	g$mšutos
 = 
d©e
('i', 
$time
);

419 
	g$mes
 = 
l™”®
(
$mes
);

421 
	g$fÜm©o_§lida
) {

424  
$dŸ
.' d'.
$mes
.', '.
$ªyo
. ' '.
$hÜa
.':'.
$mšutos
;

428  
$dŸ
.' d'.
$mes
;

432  
$dŸ
.' d'.
$mes
.', '.
$ªyo
;

452 
funùiÚ
 
	$modifiÿrG‘
(
$v¬
, 
$v®Ü
) {

454 
glob®
 
$s
, 
$c
 ;

456 
$§lida
 = "?".
$v¬
."=".
$v®Ü
;

457 
	`fÜ—ch
(
$_GET
 
as
 
$key
 => 
$v®
 ) {

458 iàĞ
$key
 !ğ
$v¬
 ) {

460 iàĞ
$key
 != "url" ) {

461 
$§lida
 .ğ"&".
$key
."=".
$v®
;

465  
$§lida
;

467 
	}
}

475 
funùiÚ
 
	$cÚ¡ruœ_g‘
 (
$v¬ŸbËs
) {

477 
$»suÉado
 = 
	`¬¿y_m”ge
Ğ
$_GET
, 
$v¬ŸbËs
 );

479 
$simbŞo
 = '?';

480 
$§lida
 = '';

482 
	`fÜ—ch
 ( 
$»suÉado
 
as
 
$v¬ŸbË
 => 
$v®Ü
) {

484 
$§lida
 .ğ
$simbŞo
.
$v¬ŸbË
."=".
$v®Ü
;

485 
$simbŞo
 = '&';

488  
$§lida
;

490 
	}
}

492 ifĞ! 
funùiÚ_exi¡s
("permiso") ) {

512 
funùiÚ
 
³rmiso
(
$acciÚ
='admši¡¿r', 
$modulo
 = 'admš', 
$§lœ
=
FALSE
, 
$m’§je
=FALSE) {

514 
glob®
 
$gcm
;

516 iàĞ
	g$gcm
->
	gau
->
³rmiso
(
$acciÚ
, 
$modulo
èè 
	gTRUE
;

518 iàĞ
	g$§lœ
 ) {

519 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Se‚ecesitan…ermisos…araƒsta‡cciÃ³n','ERROR');

520 
h—d”
('loÿtiÚ:'.
Rou‹r
::
$ba£
.Rou‹r::
$s
.Rou‹r::
$c
);

521 
ex™
();

522 } 
–£if
 ( 
$m’§je
 ) {

523 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Se‚ecesitan…ermisos…araƒsta‡cciÃ³n','ERROR');

526  
	gFALSE
;

544 
funùiÚ
 
	$limpŸrCÚ‹nido
(
$cÚ‹nido
){

545 
$cÚ‹nido
ğ
	`´eg_»¶aû
( '/\\\"/', '\"', $contenido);

546 
$cÚ‹nido
ğ
	`´eg_»¶aû
( "/\\\'/", "'", $contenido);

547 
$cÚ‹nido
ğ
	`´eg_»¶aû
( "/\'/", "'", $contenido);

548 
$cÚ‹nido
 = 
	`¡r¦ashes
($contenido);

549  
$cÚ‹nido
;

550 
	}
}

570 
funùiÚ
 
	$¬¿y_li¡a
(
$cÚ‹nido
, 
$niv–
=0, 
$fÜm
=
FALSE
) {

572 iàĞ
	`em±y
(
$cÚ‹nido
èè 
FALSE
;

574 
$fÜm©o_fÜm
 = '<input checkedype="checkbox"‚ame="seleccionado[]" value="%s" /> ';

576 
echo
 "\n".
	`¡r_»³©
("\t",
$niv–
)."<ul>";

577 
	`fÜ—ch
 ( 
$cÚ‹nido
 
as
 
$key
 => 
$v®
 ) {

578 iàĞ
	`is_¬¿y
(
$v®
) ) {

579 
echo
 "\n".
	`¡r_»³©
("\t",
$niv–
);

580 iàĞ
$fÜm
 ) 
	`´štf
(
$fÜm©o_fÜm
,
$key
);

581 
echo
 "<b>$key</b>";

582 
	`¬¿y_li¡a
(
$v®
, ++
$niv–
, 
$fÜm
);

584 iàĞ
	`em±y
(
$v®
) ) {

585 
echo
 "\n\t".
	`¡r_»³©
("\t",
$niv–
)."<li>";

586 iàĞ
$fÜm
 ) 
	`´štf
(
$fÜm©o_fÜm
,
$key
);

587 
echo
 
$key
,'</li>';

589 
echo
 "\n\t".
	`¡r_»³©
("\t",
$niv–
)."<li>";

590 iàĞ
$fÜm
 ) 
	`´štf
(
$fÜm©o_fÜm
,
$v®
);

591 
echo
 
$v®
,'</li>';

595 
echo
 "\n".
	`¡r_»³©
("\t",
$niv–
)."</ul>";

596 
	}
}

602 
funùiÚ
 
	$mb_un£rŸlize
(
$£rŸl_¡r
) {

603 
$out
 = 
	`´eg_»¶aû
('!s:(\d+):"(.*?)";!£', "'s:'.¡¾’('$2').':\"$2\";'", 
$£rŸl_¡r
);

604  
	`un£rŸlize
(
$out
);

605 
	}
}

614 
funùiÚ
 
	$g‘_šşude_cÚ‹Ás
(
$f’ame
,
$d©os
=
NULL
) {

616 
glob®
 
$gcm
;

618 ià(
	`is_fe
(
$f’ame
)) {

620 
	`ob_¡¬t
();

621 
šşude
 
$f’ame
;

622 
$cÚ‹Ás
 = 
	`ob_g‘_cÚ‹Ás
();

623 
	`ob_’d_ş—n
();

624  
$cÚ‹Ás
;

627  
çl£
;

629 
	}
}

633 
funùiÚ
 
	$mo¡¿r_
() {

635 ifĞ
	`is£t
(
$_SERVER
['HTTP_X_FORWARDED_FOR']) ) {

637 
$ş›Á_
 =

638 Ğ!
	`em±y
(
$_SERVER
['REMOTE_ADDR']) ) ?

639 
$_SERVER
['REMOTE_ADDR']

641 ĞĞ!
	`em±y
(
$_ENV
['REMOTE_ADDR']) ) ?

642 
$_ENV
['REMOTE_ADDR']

652 
$’Œ›s
 = 
	`ex¶ode
('[, ]', 
$_SERVER
['HTTP_X_FORWARDED_FOR']);

654 
	`»£t
(
$’Œ›s
);

655 
	`li¡
(, 
$’Œy
èğ
	`—ch
(
$’Œ›s
)) {

657 
$’Œy
 = 
	`Œim
($entry);

658 iàĞ
	`´eg_m©ch
("/^([0-9]+.[0-9]+.[0-9]+.[0-9]+)/", 
$’Œy
, 
$_li¡
) ) {

660 
$´iv©e_
 = 
	`¬¿y
(

667 
$found_
 = 
	`´eg_»¶aû
(
$´iv©e_
, 
$ş›Á_
, 
$_li¡
[1]);

669 ià(
$ş›Á_
 !ğ
$found_
) {

670 
$ş›Á_
 = 
$found_
;

678 
$ş›Á_
 =

679 Ğ!
	`em±y
(
$_SERVER
['REMOTE_ADDR']) ) ?

680 
$_SERVER
['REMOTE_ADDR']

682 ĞĞ!
	`em±y
(
$_ENV
['REMOTE_ADDR']) ) ?

683 
$_ENV
['REMOTE_ADDR']

688  
$ş›Á_
;

690 
	}
}

698 
funùiÚ
 
	$mkdœ_»cursivo
(
$ru
) {

700 
$dœeùÜios
 = 
	`ex¶ode
('/',
$ru
);

701 
$dœ
 = '';

702  
$i
=0;$i<=
	`couÁ
(
$dœeùÜios
)-1;$i++ ) {

703 
$dœ
=$dœ.
$dœeùÜios
[
$i
];

704 iàĞ! 
	`is_dœ
(
$dœ
) ) {

705 iàĞ! @
	`mkdœ
Ğ
$dœ
) ) {

706 
$m’s
 = 'Debü—r£ƒÈdœeùÜiØdlo idioma cÚ†o l™”®e ’: ['.
$dœ
.'] con†os…ermisos‡decuados' ;

707 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

708  
FALSE
;

711 
$dœ
=$dir.'/';

714  
TRUE
;

715 
	}
}

724 
funùiÚ
 
	$exi¡e_bÏ
(
$pdo
, 
$bÏ
) {

726 
Œy
 {

728 
$sql
 = 'SELECT COUNT(*èFROM '.
$bÏ
;

730 iàĞ! 
$¡h
 = 
$pdo
->
	`´•¬e
(
$sql
) ) {

732  
FALSE
;

736 ià(!
$¡h
->
	`execu‹
()) {

738  
FALSE
;

744 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

746  
FALSE
;

750  
TRUE
;

752 
	}
}

761 
funùiÚ
 
	$bÜ¿r_bÏ
(
$pdo
, 
$bÏ
) {

763 iàĞ
	`exi¡e_bÏ
(
$pdo
,
$bÏ
) ) {

764 
$sql
="drİabË ".
$bÏ
;

765 
$sqlResuÉ
 = 
$pdo
->
	`qu”y
(
$sql
);

768 
	}
}

777 
funùiÚ
 
	$bÜ¿r_cÚ‹nido_bÏ
(
$pdo
, 
$bÏ
) {

779 iàĞ
	`exi¡e_bÏ
(
$pdo
,
$bÏ
) ) {

780 
$sql
="d–‘äom ".
$bÏ
;

781 
$sqlResuÉ
 = 
$pdo
->
	`qu”y
(
$sql
);

784 
	}
}

799 
funùiÚ
 
rglob
(
$·‰”n
='*', 
$æags
 = 0, 
$·th
=
çl£
) {

801 ià(!
$·th
è{ $·th=
dœÇme
(
$·‰”n
).
DIRECTORY_SEPARATOR
; }

802 
	g$·‰”n
=
ba£Çme
(
$·‰”n
);

803 
	g$·ths
=
glob
(
$·th
.'*', 
GLOB_MARK
|
GLOB_ONLYDIR
|
GLOB_NOSORT
);

804 
	g$fes
=
glob
(
$·th
.
$·‰”n
, 
$æags
);

805 iàĞ!
is_¬¿y
(
$fes
èè{ 
	g$fes
 = 
¬¿y
(); }

806 iàĞ
em±y
(
$·ths
èè 
	gFALSE
;

807 
fÜ—ch
 (
$·ths
 
as
 
$·th
) {

808 
	g$mas
 = 
rglob
(
$·‰”n
, 
$æags
, 
$·th
);

809 iàĞ
	g$mas
 && !
em±y
(
$mas
è&& 
is_¬¿y
($masèè{ 
	g$fes
=
¬¿y_m”ge
(
$fes
,$mas); }

811  
	g$fes
;

824 
funùiÚ
 
	$dœ_¬¿y
(
$·th
, 
$desÿ¹ados
=
NULL
) {

826 
glob®
 
$gcm
;

828 
$cÚ‹nido
 = 
FALSE
;

830 iàĞ!
	`is_dœ
(
$·th
) ) {

831 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"ERROR::$path Noƒs un directorio",'ERROR');

832  
FALSE
;

835 
$dœeùÜio
=
	`dœ
(
$·th
);

837 
$¬chivo
 = 
$dœeùÜio
->
	`»ad
()) {

839 ià(
$¬chivo
 !="." && $archivo != ".." && $archivo != ".svn" ) {

841 
$fe
 = 
$·th
."/".
$¬chivo
;

845 iàĞ
	`is£t
(
$desÿ¹ados
) ) {

847 
$desÿ¹¬
 = 
FALSE
;

848 
	`fÜ—ch
 ( 
$desÿ¹ados
 
as
 
$desÿ¹ado
 ) {

849 iàĞ
	`¡½os
(
$¬chivo
,
$desÿ¹ado
è!=ğ
FALSE
 ) {

850 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Desÿ¹ado: '.
$¬chivo
. ' cošcidcÚ '.
$desÿ¹ado
);

851 
$desÿ¹¬
 = 
TRUE
;

855 iàĞ
$desÿ¹¬
 ) {

860 iàĞ
	`is_dœ
(
$·th
."/".
$¬chivo
) ) {

861 
$dœeùÜios
[]=
$·th
."/".
$¬chivo
;

862 } 
	`–£if
 ( 
	`is_fe
(
$·th
."/".
$¬chivo
) ) {

863 
$fich”os
[]=
$·th
."/".
$¬chivo
 ;

870 iàĞ
	`is£t
(
$fich”os
è&& 
	`is_¬¿y
($ficheros) ) {

872 
	`fÜ—ch
 ( 
$fich”os
 
as
 
$f
 ) {

874 
$cÚ‹nido
[] = 
$f
 ;

880 iàĞ
	`is£t
(
$dœeùÜios
è&& 
	`is_¬¿y
($directorios) ) {

882 
	`fÜ—ch
 ( 
$dœeùÜios
 
as
 
$d
 ) {

884 
$cÚ‹nido
[
$d
]=
	`dœ_¬¿y
($d,
$desÿ¹ados
);

890 
$dœeùÜio
->
	`şo£
();

892  
$cÚ‹nido
;

894 
	}
}

911 
funùiÚ
 
	$rmdœ_»cursivo
(
$dœeùÜio
) {

913 ià(
$dœ
 = 
	`İ’dœ
(
$dœeùÜio
)) {

915 
$fe
 = 
	`»addœ
(
$dœ
)) {

917 ià(
$fe
 != "." && $file != ".." ) {

919 iàĞ
	`is_dœ
(
$dœeùÜio
.'/'.
$fe
) ) {

921 
	`rmdœ_»cursivo
(
$dœeùÜio
.'/'.
$fe
);

925 if(
	`uÆšk
(
$dœeùÜio
.'/'.
$fe
)) {

927 
$fich”o
=
$dœeùÜio
.
$fe
;

931 
	`Œigg”_”rÜ
(
	`l™”®
('E¼Ü').' '.l™”®('ElimšªdØcÚ‹nido').': '.
$dœeùÜio
.'/'.
$fe
, 
E_USER_ERROR
);

936 
	`şo£dœ
(
$dœ
);

940 ià(
	`rmdœ
(
$dœeùÜio
) ) {

942  
TRUE
;

946 
	`Œigg”_”rÜ
(
	`l™”®
('E¼Ü').' '.l™”®('NØ£…udØ–imš¬').' '.l™”®('£cciÚ').': '.
$dœeùÜio
, 
E_USER_ERROR
);

948  
FALSE
;

952 
	}
}

958 
funùiÚ
 
	$mšimiz¬_css
(
$bufãr
) {

959 
$bufãr
 = 
	`´eg_»¶aû
('!/\*[^*]*\*+([^/][^*]*\*+)*/!', '', $buffer);

960 
$bufãr
 = 
	`¡r_»¶aû
(
	`¬¿y
("\r\n", "\r", "\n", "\t"), '', $buffer);

961  
$bufãr
;

962 
	}
}

977 
funùiÚ
 
	$mšutos2t›mpo
(
$mšutos
) {

979 
$hÜas
 = 
	`numb”_fÜm©
(
$mšutos
/60,0);

980 
$mš
 = 
	`numb”_fÜm©
(
$mšutos
%60,0);

981 
$t›mpo
 = 
$hÜas
.':'.
$mš
;

983  
$t›mpo
;

985 
	}
}

998 
funùiÚ
 
	$Üd’¬_pÜ_³so
(
$a
, 
$b
) {

1000 
$aPeso
 = ( 
	`is£t
(
$a
['peso']) ) ? $a['peso'] : 0 ;

1001 
$bPeso
 = ( 
	`is£t
(
$b
['peso']) ) ? $b['peso'] : 0 ;

1003 ià(
$aPeso
 =ğ
$bPeso
)  1;

1004  (
$aPeso
 < 
$bPeso
) ? -1 : 1;

1005 
	}
}

1012 
funùiÚ
 
	$g‘Temp
() {

1013 iàĞ! 
	`fe_exi¡s
('tmp'èè
	`mkdœ
('tmp');

1015 
	}
}

1027 
funùiÚ
 
	$bÜ¿r_¬chivos_v›jos
(
$hÜas
, 
$·ŒÚ
) {

1029 
$f™xes
 = 
	`glob
(
$·ŒÚ
);

1031 iàĞ! 
	`em±y
(
$f™xes
) ) {

1033 
	`fÜ—ch
 ( 
$f™xes
 
as
 
$f™x”
 ) {

1035 
$d©a_f™x”
 = 
	`femtime
(
$f™x”
);

1037 
$‹mps
 = ( 
	`time
(è- 
$d©a_f™x”
 ) / 60 ;

1039 iàĞ
$‹mps
 > 
$hÜas
 ) {

1040 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

1041 'BÜ¿mo ¬chivo v›jo ['.
$f™x”
.'] ['.
	`d©e
("Y-m-d H:i:s",
$d©a_f™x”
).']',

1043 iàĞ
	`is_dœ
(
$f™x”
) ) {

1044 
	`rmdœ_»cursivo
(
$f™x”
);

1046 
	`uÆšk
(
$f™x”
);

1052 
	}
}

1054 iàĞ! 
funùiÚ_exi¡s
("sesion") ) {

1064 
funùiÚ
 
£siÚ
(
$–em’to
, 
$v®Ü
=
FALSE
) {

1066 
glob®
 
$gcm
;

1068 iàĞ
	g$v®Ü
 ) {

1069 
	g$_SESSION
[
$gcm
->
sufijo
.
$–em’to
] = 
$v®Ü
 ;

1073 iàĞ
is£t
(
$_SESSION
[
$gcm
->
sufijo
.
$–em’to
]) )

1074  
	g$_SESSION
[
$gcm
->
sufijo
.
$–em’to
];

1076  
	gFALSE
;

	@gcm/lib/int/gcm/test/EventosTest.php

1 <?
php


4 ià(!
defšed
("PHPUnit_MAIN_METHOD")) {

5 
defše
("PHPUnit_MAIN_METHOD", "EventosTest::main");

8 
	g»quœe_Úû
 "PHPUnit/Framework/TestCase.php";

9 
	g»quœe_Úû
 "PHPUnit/Framework/TestSuite.php";

14 
DEFINE
('GCM_DIR',
dœÇme
(
__FILE__
).'/../../../../../gcm/');

15 
»quœe
(
GCM_DIR
.'inicio.php');

22 şas 
	cEv’tosTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
 {

24 
´iv©e
 
	m$e
;

33 
public
 
funùiÚ
 
	$maš
() {

35 
»quœe_Úû
 "PHPUnit/TextUI/TestRunner.php";

37 
$su™e
 = 
Ãw
 
	`PHPUn™_F¿mewÜk_Te¡Su™e
("EventosTest");

38 
$»suÉ
 = 
PHPUn™_TextUI_Te¡RuÂ”
::
	`run
(
$su™e
);

48 
´Ùeùed
 
funùiÚ
 
	$£tUp
() {

52 
$dœ_ejem¶o
 = '/tmp/test_eventos/';

53 iàĞ
	`is_dœ
(
$dœ_ejem¶o
èè`
rm
 -
ä
 $dir_ejemplo.'/*'`;

54 iàĞ!
	`is_dœ
(
$dœ_ejem¶o
èè
	`mkdœ
($dir_ejemplo);

55 iàĞ!
	`is_dœ
(
$dœ_ejem¶o
.'modulo1'èè
	`mkdœ
($dir_ejemplo.'modulo1');

56 iàĞ!
	`is_dœ
(
$dœ_ejem¶o
.'modulo2'èè
	`mkdœ
($dir_ejemplo.'modulo2');

57 iàĞ!
	`is_dœ
(
$dœ_ejem¶o
.'modulo1/lib'èè
	`mkdœ
($dir_ejemplo.'modulo1/lib');

58 iàĞ!
	`is_dœ
(
$dœ_ejem¶o
.'modulo2/lib'èè
	`mkdœ
($dir_ejemplo.'modulo2/lib');

62 
$cÚ‹nido
 = "\n".'<?php ';

63 
$cÚ‹nido
 .= "\n\$eventos['evento1']['accion1'][1]='';";

64 
$cÚ‹nido
 .= "\n\$eventos['evento2']['accion2'][1]='';";

65 
$cÚ‹nido
 .= "\n\$eventos['evento3']['accion3'][1]='';";

66 
$cÚ‹nido
 .= "\n".'?>';

67 
	`fe_put_cÚ‹Ás
(
$dœ_ejem¶o
.'modulo1/ev’tos_admš.php', 
$cÚ‹nido
);

69 
$cÚ‹nido
 = "\n".'<?php ';

70 
$cÚ‹nido
 .= "\n\$eventos['evento4']['accion1'][1]='';";

71 
$cÚ‹nido
 .= "\n\$eventos['evento5']['accion2'][1]='';";

72 
$cÚ‹nido
 .= "\n\$eventos['evento6']['accion3'][1]='';";

73 
$cÚ‹nido
 .= "\n\$cEventos['evento6']='unico';";

74 
$cÚ‹nido
 .= "\n".'?>';

75 
	`fe_put_cÚ‹Ás
(
$dœ_ejem¶o
.'modulo1/ev’tos_usu¬io.php', 
$cÚ‹nido
);

77 
$cÚ‹nido
 = "\n".'<?php ';

78 
$cÚ‹nido
 .= "\n\$eventos['evento1']['accion1'][1]='';";

79 
$cÚ‹nido
 .= "\n\$eventos['evento2']['accion2'][1]='';";

80 
$cÚ‹nido
 .= "\n\$eventos['evento3']['accion3'][1]='';";

81 
$cÚ‹nido
 .= "\n".'?>';

82 
	`fe_put_cÚ‹Ás
(
$dœ_ejem¶o
.'modulo2/ev’tos_admš.php', 
$cÚ‹nido
);

84 
$cÚ‹nido
 = "\n".'<?php ';

85 
$cÚ‹nido
 .= "\n\$eventos['evento4']['accion1'][1]='';";

86 
$cÚ‹nido
 .= "\n\$eventos['evento5']['accion2'][1]='';";

87 
$cÚ‹nido
 .= "\n\$eventos['evento6']['accion3'][1]='';";

88 
$cÚ‹nido
 .= "\n".'?>';

89 
	`fe_put_cÚ‹Ás
(
$dœ_ejem¶o
.'modulo2/ev’tos_usu¬io.php', 
$cÚ‹nido
);

91 
$cÚ‹nido
 = "\n".'<?php ';

92 
$cÚ‹nido
 .= "\nclass modulo1 {";

93 
$cÚ‹nido
 .= "\nfunction‡ccion1(\$e) {";

94 
$cÚ‹nido
 .= "\nglobal \$_GLOBALS;";

95 
$cÚ‹nido
 .= "\n\$_GLOBALS['eventos'][\$e]['Modulo1'] = 'accion1';";

96 
$cÚ‹nido
 .= "\n}";

97 
$cÚ‹nido
 .= "\nfunction‡ccion2(\$e) {";

98 
$cÚ‹nido
 .= "\nglobal \$_GLOBALS;";

99 
$cÚ‹nido
 .= "\n\$_GLOBALS['eventos'][\$e]['Modulo1'] = 'accion2';";

100 
$cÚ‹nido
 .= "\n}";

101 
$cÚ‹nido
 .= "\nfunction‡ccion3(\$e) {";

102 
$cÚ‹nido
 .= "\nglobal \$_GLOBALS;";

103 
$cÚ‹nido
 .= "\n\$_GLOBALS['eventos'][\$e]['Modulo1'] = 'accion3';";

104 
$cÚ‹nido
 .= "\n}";

105 
$cÚ‹nido
 .= "\n}";

106 
$cÚ‹nido
 .= "\n".'?>';

107 
	`fe_put_cÚ‹Ás
(
$dœ_ejem¶o
.'modulo1/lib/Modulo1.php', 
$cÚ‹nido
);

109 
$cÚ‹nido
 = "\n".'<?php ';

110 
$cÚ‹nido
 .= "\nclass modulo2 {";

111 
$cÚ‹nido
 .= "\nfunction‡ccion1(\$e) {";

112 
$cÚ‹nido
 .= "\nglobal \$_GLOBALS;";

113 
$cÚ‹nido
 .= "\n\$_GLOBALS['eventos'][\$e]['Modulo2'] = 'accion1';";

114 
$cÚ‹nido
 .= "\n}";

115 
$cÚ‹nido
 .= "\nfunction‡ccion2(\$e) {";

116 
$cÚ‹nido
 .= "\nglobal \$_GLOBALS;";

117 
$cÚ‹nido
 .= "\n\$_GLOBALS['eventos'][\$e]['Modulo2'] = 'accion2';";

118 
$cÚ‹nido
 .= "\n}";

119 
$cÚ‹nido
 .= "\nfunction‡ccion3(\$e) {";

120 
$cÚ‹nido
 .= "\nglobal \$_GLOBALS;";

121 
$cÚ‹nido
 .= "\n\$_GLOBALS['eventos'][\$e]['Modulo2'] = 'accion3';";

122 
$cÚ‹nido
 .= "\n}";

123 
$cÚ‹nido
 .= "\n}";

124 
$cÚ‹nido
 .= "\n".'?>';

125 
	`fe_put_cÚ‹Ás
(
$dœ_ejem¶o
.'modulo2/lib/Modulo2.php', 
$cÚ‹nido
);

127 
$this
->
e
 = 
Ãw
 
	`Ev’tos
(
$dœ_ejem¶o
,
FALSE
);

128 
$this
->
a
 = 
Ãw
 
	`Ev’tos
(
$dœ_ejem¶o
,
TRUE
);

129 
	}
}

137 
´Ùeùed
 
funùiÚ
 
	$‹¬Down
() {

138 
	}
}

140 
public
 
funùiÚ
 
	$‹¡L“r_ev’tos
() {

142 
$this
->
	`as£¹F®£
(
	`em±y
($this->
e
->
ev’tos
), 'Hayƒventos');

143 
$this
->
	`as£¹F®£
(
	`em±y
($this->
a
->
ev’tos
), 'Hayƒventos');

145 
	}
}

147 
public
 
funùiÚ
 
	$‹¡V”ifiÿr_ev’to
() {

149 
$this
->
	`as£¹True
($this->
e
->
	`v”ifiÿr_ev’to
('evento4'),'Verificarƒvento usuario');

150 
$this
->
	`as£¹True
($this->
a
->
	`v”ifiÿr_ev’to
('evento4'),'Verificarƒvento usuario');

151 
$this
->
	`as£¹True
($this->
a
->
	`v”ifiÿr_ev’to
('evento2'),'Verificarƒvento usuario');

152 
	}
}

154 
public
 
funùiÚ
 
	$‹¡Lªz¬Ev’to
() {

156 
$this
->
	`as£¹True
($this->
e
->
	`Ïnz¬Ev’to
('evento4'),'Lanzarƒvento usuario');

157 
$this
->
	`as£¹True
($this->
a
->
	`Ïnz¬Ev’to
('evento5'),'Lanzarƒvento usuario');

158 
$this
->
	`as£¹True
($this->
a
->
	`Ïnz¬Ev’to
('evento2'),'Lanzarƒvento usuario');

159 
	}
}

161 
public
 
funùiÚ
 
	$‹¡CompÜm›Áos
() {

163 
glob®
 
$_GLOBALS
;

167 
$_GLOBALS
 = 
	`¬¿y
();

170 
$this
->
a
->
cEv’tos
['evento3']['unico'] = 'modulo1';

171 
$this
->
a
->
	`Ïnz¬Ev’to
('evento3');

172 
$num_ev’tos
 = 
	`couÁ
(
$_GLOBALS
['eventos']['evento3']);

174 
$this
->
	`as£¹True
(
$num_ev’tos
 == 1,'Evento unico');

179 
$this
->
e
->
cEv’tos
['evento4']['anular'] = 'modulo1';

180 
$this
->
e
->
	`Ïnz¬Ev’to
('evento4');

181 
$num_ev’tos
 = 
	`couÁ
(
$_GLOBALS
['eventos']['evento4']);

182 
$this
->
	`as£¹True
(
$num_ev’tos
 == 0,'Evento‡nulado');

185 
	}
}

189 ià(
	gPHPUn™_MAIN_METHOD
 == "EventosTest::main") {

190 
Ev’tosTe¡
::
maš
();

	@gcm/lib/int/gcm/test/RouterTest.php

1 <?
php


8 
	gecho
 "No funciona, crea directorio de†og‡ra„egistros";

9 
ex™


11 
defše
("GCM_DIR",
dœÇme
(
__FILE__
).'/../../../../../gcm/');

13 
	g»quœe_Úû
 'PHPUnit/Framework.php';

16 
»quœe
(
dœÇme
(
__FILE__
).'/../lib/Gcm.php');

18 
	g$gcm
 = 
Ãw
 
Gcm
();

24 şas 
	cRou‹rTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
{

26 
´Ùeùed
 
funùiÚ
 
	$£tUp
() {

27 
glob®
 
$gcm
;

34 
funùiÚ
 
	$‹¡desglo§rU¾
() {

36 
glob®
 
$gcm
;

38 
$u¾
 = '/index.html?e=buscar&args=palabra_a_buscar';

40 
Rou‹r
::
	`desglo§rU¾
(
$u¾
);

42 
$this
->
	`as£¹Equ®s
(
Rou‹r
::
$u¾
,'index.html');

44 
	}
}

	@gcm/lib/int/gcm_imagen.php

1 <?
php


35 
funùiÚ
 
gcm_imag’_cİŸr
(
$imag’
, 
$de¡šo
, 
$imag’AÉo
='0', 
$imag’Ancho
='0', 
$mšŸtu¿
='no', 
$mšŸtu¿AÉo
='0', 
$mšŸtu¿Ancho
='0') {

37 
glob®
 
$_FILES
;

39 
	g$imag’Fe
 = 
$imag’
['tmp_name'];

40 
	g$imag’Name
 = 
$imag’
['name'];

41 
	g$imag’Size
 = 
$imag’
['size'];

42 
	g$imag’Ty³
 = 
$imag’
['type'];

43 
	g$imag’E¼Ü
 = 
$imag’
['error'];

46 iàĞ
is_dœ
(
$de¡šo
) ) {

47 
	g$dœFš®
 = 
$de¡šo
."/";

48 
	g$nomb»Fš®
 = 
$dœFš®
.
$imag’Name
 ;

50 
	g$dœFš®
 = 
$de¡šo
;

51 
	g$nomb»Fš®
 = 
$dœFš®
;

54 iàĞ
	g$imag’E¼Ü
 == 4 ) {

56 
$imag’Fe
 = 
nuÎ
;

57 
	g$imag’Name
 = 
nuÎ
;

58 
	g$imag’Size
 = 
nuÎ
;

59 
	g$imag’Ty³
 = 
nuÎ
;

61 
	g$m’s
 = "No se subio‚ingÃºn fichero";

62 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

64  
	gNULL
 ;

70 ià(
	g$imag’E¼Ü
>0){

72 
	g$imag’E¼Ü
){

74 
$m’s
 = "TamaÃ±oƒxcesivo de‡rchivo";

75 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

76 
	gecho
 '<süt>®”t("TamaÃ±Ød–‡rchivØexûsivo\nMax…”m™ido: '.
ši_g‘
('upload_max_filesize').'");</script>';

77  
	gNULL
 ;

80 
$m’s
 = "TamaÃ±oƒxcesivo de‡rchivo";

81 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

82 
	gecho
 '<süt>®”t("TamaÃ±Ød–‡rchivØexûsivo\nMax…”m™ido: '.
ši_g‘
('upload_max_filesize').'");</script>';

83  
	gNULL
 ;

86 
$m’s
 = "Error‡l subir†a imÃ¡gen";

87 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

88  
	gNULL
 ;

91 
	g$m’s
 = "Error‡l subir†a imÃ¡gen";

92 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

93  
	gNULL
 ;

97 ià(!
is_u¶ßded_fe
(
$imag’Fe
)){

98 
	g$m’s
 = "Acceso‚o…ermitido,…osible violaciÃ³n de seguridad";

99 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

100  
	gNULL
 ;

104 iàĞ
	g$imag’Ty³
 == 'application/zip' ) {

106 
$z
 = 
Ãw
 
ZArchive
;

109 iàĞ
	g$z
->
İ’
(
$imag’Fe
è==ğ
TRUE
 ) {

110 
$num_imag’es
 = 
$z
->
numFes
;

112 
	g$m’s
 = 'NØ£…udØabrœƒÈ¬chivØz: '.
$imag’Name
;

113 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

114 
	gecho
 '<süt>®”t(\'NØ£…udØabrœƒÈ¬chivØz: '.
	g$imag’Name
.'\');</script>';

115  
	gnuÎ
 ;

118 iàĞ
	g$num_imag’es
 < 1 ) {

119 
	g$m’s
 = 
$imag’Name
.' vacio';

120 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

121 
	gecho
 '<süt>®”t(\'VaciØ'.
	g$imag’Name
.'\');</script>';

122  
	gnuÎ
 ;

126 iàĞ
	g$z
->
exŒaùTo
(
$dœFš®
) ) {

127 
	gecho
 '<süt>·»Á.»suÉadoU¶ßd (\'0\', \''.
	g$imag’Name
.'\');</script>';

129 
	g$m’s
 = 'ArchivØ'.
$imag’Name
.'‚o se…udo descomprimir';

130 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

131 
	gecho
 '<süt>·»Á.»suÉadoU¶ßd (\'4\', \'NØ£…udØdescom´imœ '.
	g$imag’Name
.'\');</script>';

132  
	gNULL
 ;

135 
	gecho
 "gcm_imagen_copiar::Numero de imagenes: <b>$num_imagenes</b>";

136 iàĞ
	g$num_imag’es
 > 0 ) {

137 
	g$i
=0 ; $i!=
$num_imag’es
; $i++) {

138 
	g$f’ame
 = 
$z
->
g‘NameIndex
(
$i
);

139 
	g$fešfo
 = 
·thšfo
(
$f’ame
);

140 
	g$imag’
 = 
$dœFš®
.
$f’ame
 ;

141 
	g$§lida
.=
$imag’
.'\n';

144 
g’”¬Imag’
(
$imag’
, 
$dœFš®
, 
$imag’AÉo
, 
$imag’Ancho
);

147 
	g$haûrMšŸtu¿
 = 
NULL
;

149 iàĞ
	g$mšŸtu¿
 !ğ"" && 
$mšŸtu¿
 != 'no' ) {

150 
$haûrMšŸtu¿
 = 
TRUE
;

151 
g’”¬Imag’
(
$imag’
, 
$mšŸtu¿
, 
$mšŸtu¿AÉo
, 
$mšŸtu¿Ancho
);

157 
	gecho
 '<süt>·»Á.»suÉadoU¶ßd (\'0\', \''.
	g$imag’Name
.' '.
	g$num_imag’es
.' imag’es\\n'.
	g$§lida
.'\');</script>';

159  
	gTRUE
 ;

165 ià(!
cİy
(
$imag’Fe
 ,
$nomb»Fš®
)) {

166 
Œigg”_”rÜ
('E¼Ü‡ÈcİŸ¸imag’ ['.
$imag’Fe
.']‡ ['.
$nomb»Fš®
.']', 
E_USER_ERROR
);

167  
	gNULL
 ;

170 
	g$imag’
 = 
$nomb»Fš®
 ;

173 iàĞ
	g$imag’AÉo
 !ğ0 && 
$imag’Ancho
 != 0 ) {

174 
g’”¬Imag’
(
$imag’
, 
$dœFš®
, 
$imag’AÉo
, 
$imag’Ancho
);

178 
	g$haûrMšŸtu¿
 = 
NULL
;

180 iàĞ
	g$mšŸtu¿
 !ğ"" && 
$mšŸtu¿
 != 'no' ) {

181 
$haûrMšŸtu¿
 = 
TRUE
;

182 
g’”¬Imag’
(
$imag’
, 
$mšŸtu¿
, 
$mšŸtu¿AÉo
, 
$mšŸtu¿Ancho
);

185  
	gTRUE
 ;

210 
funùiÚ
 
g’”¬Imag’
(
$imag’
, 
$de¡šo
, 
$®to
, 
$ªcho
, 
$mšŸtu¿
='si') {

212 
$dœFš®
 = 
com´ob¬_b¬¿
(
$de¡šo
);

215 
	g$vD©osImg
 = 
g‘imagesize
(
$imag’
);

216 
	g$imag’Name
 = 
ba£Çme
(
$imag’
);

218 ià(!
	g$vD©osImg
) {

219 
	g$m’s
 = 
l™”®
('Error con†as datos de†a imagen',3);

220 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

221  
	gNULL
 ;

224 
	g$imgAncho
 = 
$vD©osImg
[0];

225 
	g$imgAÉo
 = 
$vD©osImg
[1];

228 iàĞ
is£t
(
$vD©osImg
['mime']) ) {

229 
	g$sTo
 = 
$vD©osImg
['mime'];

230 } 
–£if
 ( 
is£t
(
$vD©osImg
[2]) ) {

231 
	g$sTo
 = 
image_ty³_to_mime_ty³
(
$vD©osImg
[2]);

232 } 
–£if
 ( 
is£t
(
$iTo
) ) {

233 
	g$sTo
 = 
image_ty³_to_mime_ty³
(
$iTo
);

235 
	g$m’s
 = 
l™”®
('Error con datos mime de†a imagen',3);

236 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

237  
	gNULL
 ;

241 
	g$ÿmbŸrMšŸtu¿
 = 
NULL
;

243 iàĞ
	g$ªcho
 < 
	g$imgAncho
 ) {

244 
	g$ÿmbŸrMšŸtu¿
=
TRUE
;

245 } 
–£if
 ( 
$®to
 < 
$imgAÉo
) {

246 
	g$ÿmbŸrMšŸtu¿
=
TRUE
;

252 iàĞ
	g$mšŸtu¿
 == 'si' ) {

253 iàĞ! 
is_dœ
(
$dœFš®
) ) {

254 iàĞ! 
mkdœ
(
com´ob¬_b¬¿
(
$dœFš®
,'eliminar')) ) {

255 
$m’s
 = 
l™”®
('E¼Ü‡Èü—¸dœeùÜiØde¡šo',3).'['.
	g$dœFš®
.']';

256 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

257  
	gNULL
 ;

263 iàĞ
	g$ÿmbŸrMšŸtu¿
 ) {

265 
	g$sTo
){

267 
$fu’‹
 = 
imageü—‹äomgif
(
$imag’
) ;

270 
$fu’‹
 = 
imageü—‹äomj³g
(
$imag’
) ;

273 
$fu’‹
 = 
imageü—‹äom²g
(
$imag’
) ;

279 iàĞ!
	g$fu’‹
 ) {

280 
»gi¡¿r
(
__FILE__
,
__LINE__
,
l™”®
('E¼Ü cÚ d©o mime',3).'['.
$sTo
.']','ERROR');

281  
	gNULL
 ;

285 iàĞ
	g$ªcho
 > 0 ) {

286 
	g$ªchoFš®
 = 
$ªcho
;

287 
	g$®toFš®
 = 
$imgAÉo
 * 
$ªcho
 / 
$imgAncho
 ;

289 iàĞ
	g$®toFš®
 > 
	g$®to
 ) {

290 
	g$®toFš®
 = 
$®to
;

291 
	g$ªchoFš®
 = 
$imgAncho
 * 
$®to
 / 
$imgAÉo
 ;

293 } 
–£if
 ( 
$®to
 > 0 ) {

294 
	g$®toFš®
 = 
$®to
;

295 
	g$ªchoFš®
 = 
$imgAncho
 * 
$®to
 / 
$imgAÉo
 ;

296 iàĞ
	g$ªchoFš®
 > 
	g$ªcho
 ) {

297 
	g$ªchoFš®
 = 
$ªcho
 ;

298 
	g$®toFš®
 = 
$imgAÉo
 * 
$ªcho
 / 
$imgAncho
 ;

302 
	g$imag’
ğ
ImageC»©eTrueCŞÜ
(
$ªchoFš®
, 
$®toFš®
)

303 
Ü
 
	g$imag’
=
ImageC»©e
(
$ªchoFš®
, 
$®toFš®
);

305 
ImageCİyResized
(
$imag’
,
$fu’‹
,0,0,0,0,
$ªchoFš®
,
$®toFš®
,
$imgAncho
,
$imgAÉo
);

312 
	g$sTo
){

314 
imagegif
(
$imag’
,
$dœFš®
.
$imag’Name
);

317 
imagej³g
(
$imag’
,
$dœFš®
.
$imag’Name
, 100);

320 
imag•ng
(
$imag’
,
$dœFš®
.
$imag’Name
);

323 
»gi¡¿r
(
__FILE__
,
__LINE__
,
l™”®
('TØdimag’‚ØsİÜda',3).' ['.
$sTo
.']','ERROR');

324  
	gNULL
 ;

330 ià(!
cİy
(
$imag’
 ,
com´ob¬_b¬¿
(
$dœFš®
).
$imag’Name
)) {

331 
»gi¡¿r
(
__FILE__
,
__LINE__
,
l™”®
('Fallo‡l generar imagen',3),'ERROR');

332 
Œigg”_”rÜ
("E¼Ü‡ÈcİŸ¸imag’", 
E_USER_ERROR
);

334  
	gNULL
 ;

354 
funùiÚ
 
	$gcm_li¡aImag’es
(
$·th
, 
$to
=1) {

356 
glob®
 
$gcm
;

360 
$li¡a
 = 
	`¬¿y
();

362 
$®toMaxMšŸtu¿
 = 
$gcm
->
	`cÚfig
('imagenes','altoMaxMiniatura');

363 
$ªchoMaxMšŸtu¿
 = 
$gcm
->
	`cÚfig
('imagenes','anchoMaxMiniatura');

365 
$ex‹nsiÚes
 = 
	`¬¿y
("jpg", "jpeg", "JPG", "JPEG", "GIF", "gif", "png", "PNG", "tiff", "TIFF");

366 
$ex‹nsiÚes_·¿_exif
 = 
	`¬¿y
("jpg", "jpeg", "JPG", "JPEG", "tiff", "TIFF");

368 
$ba£_imag’es
='';

370 iàĞ! 
	`is_dœ
(
$·th
) ) {

371 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$·th
.' '.
	`l™”®
('Noƒs un directorio',3),'ERROR');

372  
NULL
;

376 
$Ù¿sSecciÚes
 = 
	`¬¿y
() ;

378 
$uri
 = 
	`ex¶ode
("/",
$·th
);

379 
$uÉimo
 = ( 
$uri
[
	`couÁ
($uri)-1] ) ? $uri[count($uri)-1] : $uri[count($uri)-2];

380 
	`un£t
(
$uri
[
	`couÁ
($uri)-1]);

381 
	`un£t
(
$uri
[
	`couÁ
($uri)-1]);

382 
$¬riba
 = 
	`im¶ode
("/",
$uri
);

390 iàĞ
$uÉimo
 !=ğ
$gcm
->
	`cÚfig
('idiomas','Idioma…or defecto') ) {

391 
$Ù¿sSecciÚes
[] = 
	`¬¿y
 (
	`l™”®
('subœ'),
	`im¶ode
("/",
$uri
));

392 
$e¡amos
 = 
$uÉimo
;

394 
$e¡amos
 = 'inicio';

398 
$·th
 = 
	`com´ob¬_b¬¿
($path);

400 
$dœeùÜio
 = 
	`dœ
(
$·th
);

402 
$¬chivo
 = 
$dœeùÜio
->
	`»ad
()) {

404 
$fe
 = 
$·th
.
$¬chivo
 ;

406 iàĞ
$¬chivo
 !ğ".svn" && 
	`is_dœ
(
$fe
è&& $¬chivØ!ğ"thumbÇ" && $f!ğ
$·th
 && $archivo != "." && $archivo != ".." ) {

407 
$Ù¿sSecciÚes
[]ğ
	`¬¿y
 (
$fe
,
	`l™”®
(
$¬chivo
));

409 
$feInfo
 = 
	`·thšfo
(
$fe
);

410 
$ext
 = ( ! 
	`em±y
(
$feInfo
['ex‹nsiÚ']èè? $feInfo['ex‹nsiÚ'] : 
NULL
 ;

412 iàĞ
	`š_¬¿y
(
$ext
,
$ex‹nsiÚes
) ) {

414 
$mš
=
$·th
.'thumbÇ/'.
$¬chivo
;

415 iàĞ! 
	`is_fe
(
$mš
) ) {

416 iàĞ! 
	`is_dœ
(
$·th
.'thumbnail') ) {

417 iàĞ! 
	`mkdœ
(
$·th
.'thumbnail') ) {

418 
$m’s
 = 
	`l™”®
('E¼Ü‡Èü—¸dœeùÜiØde¡šo',3).'['.
$·th
.'thumbnail'.']';

419 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'ERROR');

420  
NULL
 ;

423 iàĞ
	`g’”¬Imag’
(
$fe
, 
$·th
.'thumbÇ', 
$®toMaxMšŸtu¿
, 
$ªchoMaxMšŸtu¿
è==ğ
FALSE
 ) {

424 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('E¼Ü‡Èg’”¬ mšŸtu¿',3).' ['.
$fe
.']ƒÀ['.
$·th
.'thumbnail'.']','ERROR');

430 iàĞ
	`š_¬¿y
(
$ext
,
$ex‹nsiÚes_·¿_exif
) ) {

431 
$exif
 = @
	`exif_»ad_d©a
(
$·th
.'/'.
$¬chivo
, 0, 
Œue
);

433 
$exif
 = 
FALSE
;

435 
$i_size
 = 
	`g‘fesize
(
	`fesize
(
$·th
.'/'.
$¬chivo
));

436 
$i_¬—
 = 
	`g‘imagesize
(
$·th
.'/'.
$¬chivo
);

437 
$i_width
 = 
$i_¬—
[0];

438 
$i_height
 = 
$i_¬—
[1];

439 
$li¡a
[]=
	`¬¿y
(
$¬chivo
, 
$ba£_imag’es
.
$·th
.$¬chivo, $ba£_imag’es.$·th.'thumbÇ/'.$¬chivo, 
$i_width
, 
$i_height
, 
$i_size
, 
$exif
) ;

444 
$dœeùÜio
->
	`şo£
();

448 
	`fÜ—ch
 ( 
$Ù¿sSecciÚes
 
as
 &
$£cciÚ_cÚ_imag’es
 ) {

449 iàĞ
	`is_dœ
(
$£cciÚ_cÚ_imag’es
[0]) && $seccion_con_imagenes[0] != '..' ) {

450 
$£cciÚ_cÚ_imag’es
[1] = $£cciÚ_cÚ_imag’es[1]. ' ('.
	`cÚbiz¬_imag’es_dœeùÜio
($seccion_con_imagenes[0]).')';

454 iàĞ
$to
 == 1 ) {

456 
$num
 = 
	`couÁ
(
$li¡a
);

457 iàĞ
$num
 > 0 ) {

459 
$¬chivo
 = 
$·th
."/.listaImg.js";

460 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'ArchivØdli¡¨dimg, '.
$¬chivo
);

462 ià(!
$fe
 = 
	`fİ’
(
$¬chivo
, "w")) {

463 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'No se…uede‡brirƒl‡rchivo…araƒscribir','ERROR');

464  
FALSE
;

466 
	`åuts
(
$fe
, "varinyMCEImageList =‚ew Array (\n");

468 
$i
=0 ; $i!=
$num
-1; $i++) {

469 
	`åuts
(
$fe
, "[\"mši/".
$li¡a
[
$i
][0]."\",\"".$lista[$i][2]."\"],\n");

470 
	`åuts
(
$fe
, "[\"".
$li¡a
[
$i
][0]."\",\"".$lista[$i][1]."\"],\n");

472 
	`åuts
(
$fe
, "[\"mši/".
$li¡a
[
$i
][0]."\",\"".$lista[$i][2]."\"],\n");

473 
	`åuts
(
$fe
, "[\"".
$li¡a
[
$i
][0]."\",\"".$lista[$i][1]."\"]");

475 
	`åuts
(
$fe
, ");\n");

476 
	`fşo£
(
$fe
);

477  
TRUE
;

481 } 
	`–£if
 ( 
$to
 == 5 ) {

483 
$»tÜno
['e¡amos'] = 
$e¡amos
 ;

484 
$»tÜno
['Ù¿s_£cciÚes'] = 
$Ù¿sSecciÚes
;

485 
$»tÜno
['li¡a'] = 
$li¡a
;

486  
$»tÜno
;

488 } 
	`–£if
 ( 
$to
 == 3 ) {

489 
$devŞv”
 = 
	`¬¿y
 ();

490 
$devŞv”
['imgs'] = ( 
	`is£t
(
$li¡a
èè? $li¡¨: 
NULL
;

491 
$devŞv”
['£c']ğ
$Ù¿sSecciÚes
;

492 
´št
 
	`jsÚ_’code
(
$devŞv”
);

494 } 
	`–£if
 ( 
$to
 == 4 ) {

495 
echo
 "\nv¬†i¡¨ğ".
	`jsÚ_’code
(
$li¡a
);

498 
´št
 
	`jsÚ_’code
(
$li¡a
);

501 
	}
}

513 
funùiÚ
 
	$cÚbiz¬_imag’es_dœeùÜio
(
$dœeùÜio
, 
$num”o_aùu®
=0) {

515 
$ex‹nsiÚes
 = 
	`¬¿y
("jpg", "jpeg", "JPG", "JPEG", "GIF", "gif", "png", "PNG", "tiff", "TIFF");

518 
$·th
 = 
	`¹rim
(
$dœeùÜio
,'/').'/';

520 
$imag’es
 = 
	`glob
(
$·th
."{*.GIF,*.JPG,*.PNG,*.gif,*.jpg,*.²g}", 
GLOB_BRACE
);

522 
$num”o
 = 
$num”o_aùu®
 + (
$imag’es
);

524 
$dœ
 = 
	`glob
(
$·th
.'*');

526 
$‹Ãmos_subdœeùÜio
 = 
FALSE
 ;

528 iàĞ
$dœ
 ) {

530 
	`fÜ—ch
 ( 
$dœ
 
as
 
$™em
 ) {

532 iàĞ
	`is_dœ
(
$™em
) ) {

533 
	`cÚbiz¬_imag’es_dœeùÜio
(
$™em
, 
$num”o
);

534 
$‹Ãmos_subdœeùÜio
 = 
TRUE
 ;

540  
$num”o
;

541 
	}
}

556 
funùiÚ
 
	$gcm_bÜ¿rImag’
(
$u¾
) {

558 iàĞ! 
	`is_fe
(
$u¾
) ) {

561 
$u¾
 = 
	`”eg_»¶aû
('.*'.
$dd
,$dd,$url);

562 iàĞ! 
	`is_fe
(
$u¾
) ) {

563 
$”rÜ
=
	`l™”®
(
$dd
."L¨imÃ¡g’‚Øexi¡e").'::'.
$u¾
;

564 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$”rÜ
,'ERROR');

565  
NULL
 ;

569 iàĞ! 
	`uÆšk
(
$u¾
) ) {

570 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('NØ£…udØbÜ¿¸– fich”o',3).' ['.
$u¾
.']','ERROR');

573 
$mš
 = 
	`dœÇme
(
$u¾
).'/thumbÇ/'.
	`ba£Çme
($url);

574 iàĞ
	`is_fe
(
$mš
) ) {

575 iàĞ! 
	`uÆšk
(
$mš
) ) {

576 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('NØ£ bÜ¿¸– fich”o',3).' ['.
$mš
.']','ERROR');

577  
nuÎ
 ;

580 
	`gcm_li¡aImag’es
(
	`dœÇme
(
$u¾
));

581  
TRUE
;

585 
	`gcm_li¡aImag’es
(
	`dœÇme
(
$u¾
));

586  
TRUE
;

590 
	}
}

607 
funùiÚ
 
gcm_v”Imag’es
(
$·th
 = "Image") {

609 
glob®
 
$gcm
;

611 
	g$ex‹nsiÚes
 = 
¬¿y
("jpg", "jpeg", "JPG", "JPEG", "GIF", "gif", "png", "PNG", "tiff", "TIFF");

613 iàĞ! 
is_dœ
(
$·th
) ) {

614 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$·th
.', '.
l™”®
('Noƒs un directorio',3),'ERROR');

615  
	gNULL
;

617 
	g$dœeùÜio
=
dœ
(
$·th
);

619 
	g$¬chivo
 = 
$dœeùÜio
->
»ad
()) {

621 
$fe
 = 
$·th
."/".
$¬chivo
 ;

622 
	g$feInfo
 = 
·thšfo
(
$fe
);

623 
	g$ext
 = 
$feInfo
['extension'];

625 iàĞ
š_¬¿y
(
$ext
,
$ex‹nsiÚes
) ) {

627 
	g$mš
=
$·th
.'/thumbÇ/'.
$¬chivo
;

629 iàĞ! 
is_fe
(
$mš
) ) {

630 
g’”¬Imag’
(
$fe
, 
$·th
.'/thumbÇ', 
$®toMaxMšŸtu¿
, 
$ªchoMaxMšŸtu¿
);

633 
	g$exif
 = @
exif_»ad_d©a
(
$·th
.'/'.
$¬chivo
, 0, 
Œue
);

634 
	g$exif
 = ( 
$exif
 ==ğ
FALSE
 ) ? FALSE : $exif ;

635 
	g$li¡a
[]=
¬¿y
(
$¬chivo
, 
$·th
."/".$¬chivo, 
$mš
, 
$exif
) ;

640 
	g$dœeùÜio
->
şo£
();

642 
	g$num
 = 
couÁ
(
$li¡a
);

643 
	gecho
 "Numero de imagenes: <b>$num</b>";

644 iàĞ
	g$num
 > 0 ) {

646 
	gecho
 "\n<div id='thumbnails'>";

647 
	g$i
=0 ; $i!=
$num
; $i++) {

648 
	g$i_size
 = 
g‘fesize
(
fesize
(
$li¡a
[
$i
][1]));

649 
	g$i_¬—
 = 
g‘imagesize
(
$li¡a
[
$i
][1]);

650 
	g$i_width
 = 
$i_¬—
[0];

651 
	g$i_height
 = 
$i_¬—
[1];

652 
	gecho
 "\n<p class='thumb' ><tt>";

653 
	gecho
 "<¨»l='thumbÇ' onşick=\"javasüt:İ’('",
	g$li¡a
[
$i
][1],"','",$li¡a[$i][0],"','toŞb¬òo,süŞlb¬sòo,width=",
	g$i_width
 + 20 ,",height=",
	g$i_height
 + 20,"')\" >";

654 
	gecho
 "<img id='thumb_",
	g$i
,"' src='",
	g$li¡a
[
$i
][2],"' ";

655 
	gecho
 "alt='Imagen' /> </a>";

656 
	gecho
 "<b¸/><¥ª cÏss='idim'>[",
	g$i_width
,"x",
	g$i_height
,"] ",
	g$i_size
;

657 iàĞ
couÁ
(
$li¡a
[
$i
][3]) > 1 ) {

658 
	gecho
 " [<¨Úşick='visu®iz¬(\"exif_",
	g$i
,"\");visualizar(\"thumb_",$i,"\")' >exif</a>]";

659 
	gecho
 "</span>";

660 
	gecho
 "<br/> <¥ª id='exif_",
	g$i
,"' class='isize' style='display:‚one'><p>";

661 
fÜ—ch
 (
$li¡a
[
$i
][3] 
as
 
$key
 => 
$£ùiÚ
) {

662 
fÜ—ch
 (
$£ùiÚ
 
as
 
$Çme
 => 
$v®
) {

663 
echo
 "<b>$key.$name:</b> $val<br />\n";

666 
	gecho
 "</p></span></tt></p>";

668 
	gecho
 "</span></tt></p>";

671 
	gecho
 "\n</div> <!-- Acabahumbnails -->";

672  
	gTRUE
;

675  
	gTRUE
;

692 
funùiÚ
 
	$g‘fesize
(
$size
) {

694 
$un™s
 = 
	`¬¿y
(' B', ' KB', ' MB', ' GB', ' TB');

695 
$i
 = 0; 
$size
 > 1024; $i++) { $size /= 1024; }

696  
	`round
(
$size
, 2).
$un™s
[
$i
];

697 
	}
}

	@gcm/lib/int/idiomas/lib/IdiomasCore.php

1 <?
php


18 
»quœe_Úû
(
GCM_DIR
.'lib/int/gcm/lib/helpers.php');

40 şas 
	cIdiomasCÜe
 {

48 
´iv©e
 
	m$´oyeùo
;

50 
´iv©e
 
	m$idiomas_aùivados
;

51 
´iv©e
 
	m$idiomaxdeãùo
;

52 
´iv©e
 
	m$dœ_idiomas
;

54 
´iv©e
 
	m$idioma_aùu®
;

67 
funùiÚ
 
	$__cÚ¡ruù
(
$aCÚfigu¿ciÚ
) {

69 iàĞ! 
	`is£t
(
$aCÚfigu¿ciÚ
) ) {

70 
	`Œigg”_”rÜ
("E Ãû§riØdefšœ†a v¬ŸbË dcÚfigu¿ciÚ", 
E_USER_ERROR
);

75 
$GLOBALS
['LG'] = 
	`¬¿y
();

77 
	`fÜ—ch
 ( 
$aCÚfigu¿ciÚ
 
as
 
$key
 => 
$v®Ü
 ) {

78 
$this
->
$key
 = 
$v®Ü
;

81 
$this
->
´oyeùo
 = ( 
	`is£t
($this->proyecto) ) ? $this->proyecto : 'default';

83 iàĞ! 
	`is£t
(
$this
->
idiomas_aùivados
) ) {

84 
	`Œigg”_”rÜ
("E Ãû§riØdefšœ idiomas_aùivado d’ŒØd–‡¼ay dcÚfigu¿ciÚ", 
E_USER_ERROR
);

87 iàĞ! 
	`is£t
(
$this
->
idiomaxdeãùo
) ) {

88 
	`Œigg”_”rÜ
("E Ãû§riØdefšœ idiomaxdeãùØd’ŒØd–‡¼ay dcÚfigu¿ciÚ", 
E_USER_ERROR
);

91 iàĞ! 
	`is£t
(
$this
->
dœ_idiomas
) ) {

92 
	`Œigg”_”rÜ
("E Ãû§riØdefšœ dœ_idioma d’ŒØd–‡¼ay dcÚfigu¿ciÚ", 
E_USER_ERROR
);

95 
$this
->
	`idioma_aùu®
();

103 
funùiÚ
 
	$idioma_aùu®
() {

106 iàĞ
$this
->
idioma_aùu®
 )  $this->idioma_actual;

109 ià(
	`is£t
(
$_GET
["idioma"])) {

110 
$_SESSION
[
$this
->
´oyeùo
."-idioma"] = 
$_GET
["idioma"];

111 
$this
->
idioma_aùu®
 = 
$_GET
['idioma'];

112  
$_GET
['idioma'];

116 ià(
	`is£t
(
$_SESSION
[
$this
->
´oyeùo
."-idioma"])) {

118 
$this
->
idioma_aùu®
 = 
$_SESSION
[$this->
´oyeùo
."-idioma"] ;

124 
$s™–ªg
 = 
	`g‘’v
("HTTP_ACCEPT_LANGUAGE");

125 
$s™–ªg
 = $sitelang[0].$sitelang[1];

127 iàĞ
	`¬¿y_key_exi¡s
(
$s™–ªg
,
$this
->
idiomas_aùivados
 ) ) {

129 
$_SESSION
[
$this
->
´oyeùo
."-idioma"] = 
$s™–ªg
;

130 
$this
->
idioma_aùu®
 = 
$s™–ªg
;

134 
$_SESSION
[
$this
->
´oyeùo
."-idioma"] = $this->
idiomaxdeãùo
;

135 
$this
->
idioma_aùu®
 = $this->
idiomaxdeãùo
;

141 
	}
}

149 
funùiÚ
 
	$š¡®aciÚ
() {

150 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ_idiomas
) ) {

151  
	`mkdœ_»cursivo
(
$this
->
dœ_idiomas
);

154 
	}
}

170 
public
 
funùiÚ
 
	$£ËcciÚ_idioma
() {

172 
glob®
 
$LG
, 
$GCM_LG
;

176 
$this
->
	`šşuœ_l™”®es
(
GCM_DIR
.'DATOS/idiomas/GCM_LG_'.$this->
idiomaxdeãùo
.'.php', $this->idiomaxdefecto, 'GCM_LG_');

178 iàĞ
$this
->
idioma_aùu®
 !ğ$this->
idiomaxdeãùo
 ) {

179 
$this
->
	`šşuœ_l™”®es
(
GCM_DIR
.'DATOS/idiomas/GCM_LG_'.$this->
idioma_aùu®
.'.php', $this->idioma_actual, 'GCM_LG_');

184 
$this
->
	`šşuœ_l™”®es
($this->
dœ_idiomas
."LG_".$this->
idiomaxdeãùo
.".php", $this->idiomaxdefecto);

190 iàĞ
$this
->
idioma_aùu®
 !ğ$this->
idiomaxdeãùo
 ) {

191 
$this
->
	`šşuœ_l™”®es
($this->
dœ_idiomas
."LG_".$this->
idioma_aùu®
.".php", $this->idioma_actual);

194 
	}
}

205 
´iv©e
 
funùiÚ
 
šşuœ_l™”®es
(
$fe
, 
$idioma
, 
$´efijo_¬¿y
 = 'LG_') {

207 
glob®
 
$LG
;

209 iàĞ
fe_exi¡s
(
$fe
) ) {

210 
šşude
(
$fe
);

211 iàĞ
is£t
(
$
{
$´efijo_¬¿y
.
$idioma
}èè
	g$LG
 = 
¬¿y_m”ge
(
$LG
,${$prefijo_array.$idioma});

220 
funùiÚ
 
	$g‘Idiomaxdeãùo
() {

221  ( 
	`is£t
(
$this
->
idiomaxdeãùo
èè? $this->idiomaxdeãùØ: 
FALSE
;

222 
	}
}

228 
funùiÚ
 
	$g‘Idioma_aùu®
() {

229  ( 
	`is£t
(
$this
->
idioma_aùu®
èè? $this->idioma_aùu® : 
FALSE
;

230 
	}
}

236 
funùiÚ
 
	$g‘Dœ_idiomas
() {

237  ( 
	`is£t
(
$this
->
dœ_idiomas
èè? $this->dœ_idioma : 
FALSE
;

238 
	}
}

242 
funùiÚ
 
	$g‘IdiomasAùivados
() {

243  
$this
->
idiomas_aùivados
;

244 
	}
}

250 
funùiÚ
 
	$£ËùÜ_idiomas
() {

252 
glob®
 
$gcm
;

255 iàĞ
	`couÁ
(
$this
->
idiomas_aùivados
) > 1 ) {

258 <
süt
 
ty³
="text/javascript">

259 
funùiÚ
 
	`v®idaS–eù
(
theLi¡
){heLi¡.
fÜm
.
	`subm™
(); }

260 </
süt
>

261 <?
php


263 
echo
 "\n<div id='idiomas'>" ;

264 
echo
 "\n<form‡ction='#'>";

265 
echo
 "<select‚ame='idioma' onChange='validaSelect(this);' >";

266 
	`fÜ—ch
(
$this
->
idiomas_aùivados
 
as
 
$idioma
) {

267 ià(
$idioma
!=
$_SESSION
[
$this
->
´oyeùo
."-idioma"]) {

268 
echo
 "<İtiÚ v®ue='".
$idioma
."' >".
	`l™”®
($idioma)."</option>";

270 
echo
 "<İtiÚ s–eùed v®ue='".
$idioma
."' >".
	`l™”®
($idioma)."</option>";

273 
echo
 "</select>\n</form>";

274 
echo
 "\n</div> <!-- ACABA idiomas -->";

277 
	}
}

288 
funùiÚ
 
	$bªd”as
(
$¶ªtÏ
 = 
FALSE
) {

290 
glob®
 
$gcm
;

292 iàĞ! 
$¶ªtÏ
 ) {

295 iàĞ
	`couÁ
(
$this
->
idiomas_aùivados
) > 1 ) {

296 
echo
 '<div id="banderas">';

297 
	`fÜ—ch
(
$this
->
idiomas_aùivados
 
as
 
$idioma
) {

299 
$bªd”a
 = ( 
	`fe_exi¡s
(
$this
->
dœ_idiomas
.''.
$idioma
.'.²g'èè? $this->dœ_idiomas.''.$idioma.'.²g' : 
Rou‹r
::
$ba£
.
GCM_DIR
.'lib/int/idiomas/img/'.$idioma.'.png' ;

301 ià(
$idioma
 !ğ
$_SESSION
[
$this
->
´oyeùo
."-idioma"]) {

302 
echo
 '<¨h»f="?idioma='.
$idioma
.'" ><img‡É="'.$idioma.'" src="'.
$bªd”a
.'" /></a> ';

304 
echo
 '<¨şass="idioma_aùivado" h»f="?idioma='.
$idioma
.'" ><img‡É="'.$idioma.'" src="'.
$bªd”a
.'" /></a> ';

307 
echo
 '</div>';

310 
	`šşude
(
$¶ªtÏ
);

312 
	}
}

	@gcm/lib/int/mimetypes.php

1 <?
php


2 
	g$mim‘y³s
=
¬¿y
(

	@gcm/lib/int/registro/Registro.php

1 <?
php


15 
»quœe_Úû
(
GCM_DIR
.'lib/int/gcm/lib/helpers.php');

48 şas 
	cRegi¡ro
 {

50 
´iv©e
 
	m$tos_adm™idos
;

51 
´iv©e
 
	m$cÚexiÚ
 = 
NULL
;

52 
´iv©e
 
	m$sufijo
 = '';

58 
´iv©e
 
	m$”rÜes
 = 
FALSE
;

64 
public
 
	m$»gi¡ros
;

66 
public
 
	m$tos_»gi¡ros
 = 
¬¿y
('DEBUG', 'NORMAL', 'ADMIN', 'AVISO', 'ERROR');

67 
public
 
	m$£siÚ
 = 
NULL
;

68 
public
 
	m$lim™e_m’§jes
 = 500;

69 
public
 
	m$lim™e_desüciÚ
 = 1300;

70 
public
 
	m$ba£_d©os
;

72 
´iv©e
 
	m$mÙÜ_bd
;

81 
funùiÚ
 
__cÚ¡ruù
(
$ba£_d©os
=
NULL
, 
$sufijo
='') {

83 
$this
->
sufijo
 = 
$sufijo
;

87 
	m$this
->
niv–
('AVISO');

89 iàĞ
$ba£_d©os
 
š¡ªûof
 
	mPDO
 ) {

91 
	m$this
->
	mcÚexiÚ
 = 
$ba£_d©os
;

93 } 
–£if
 ( 
is_dœ
(
$ba£_d©os
) ) {

95 
	m$this
->
	mba£_d©os
 = 
$ba£_d©os
.'/'.
d©e
("d-m-Y").'_registros.bd';

96 
	m$this
->
	mcÚexiÚ
 = 
Ãw
 
PDO
('sql™e:'.
$this
->
ba£_d©os
);

100 
	m$this
->
	mba£_d©os
 = 
$ba£_d©os
;

101 
	m$this
->
	mcÚexiÚ
 = 
Ãw
 
PDO
('sql™e:'.
$this
->
ba£_d©os
);

106 
	m$this
->
exi¡e_bÏ
(
$this
->
sufijo
.'registros');

110 
	m$uÉima_£siÚ
 = 
$this
->
uÉima_£siÚ
();

111 
	m$this
->
	m£siÚ
 = 
$uÉima_£siÚ
 + 1;

113 
	m$this
->
	mmÙÜ_bd
 = 
$this
->
cÚexiÚ
->
g‘A‰ribu‹
(
cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

114 
	m$this
->
»gi¡¿
(
__FILE__
,
__LINE__
,"SesiÚ: ".
$this
->
£siÚ
."\n".'SšicŸ„egi¡rØ¨Ï '.
¡ráime
("%d d%b d– %Y‡†a %r").'ƒÀ'.$this->
ba£_d©os
,'NORMAL');

122 
funùiÚ
 
	$exi¡e_bÏ
(
$bÏ
) {

124 
Œy
 {

126 
$sql
 = 'SELECT COUNT(*èFROM '.
$bÏ
;

128 iàĞ! 
$¡h
 = 
$this
->
cÚexiÚ
->
	`´•¬e
(
$sql
) ) {

130 
$this
->
	`ü—r_bÏ
(
$bÏ
);

134 ià(!
$¡h
->
	`execu‹
()) {

136 
$this
->
	`ü—r_bÏ
(
$bÏ
);

141 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

143 
$this
->
	`ü—r_bÏ
(
$bÏ
);

152  
TRUE
;

154 
	}
}

167 
funùiÚ
 
	$ü—r_bÏ
(
$bÏ
) {

169 iàĞ
$this
->
cÚexiÚ
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME")) == 'sqlite' ) {

170 
$autošüem’t
 = '';

172 
$autošüem’t
 = 'AUTO_INCREMENT';

175 
$SQL
 = "CREATE TABLE $tabla (

176 
id
 
INTEGER
 
PRIMARY
 
KEY
 
$autošüem’t
,

177 
£siÚ
 
INTEGER
,

178 
ãcha
 
	`INT
(14),

179 
to
 
	`VARCHAR
(10),

180 
fich”o
 
	`VARCHAR
(100),

181 
lš—
 
INTEGER
,

182 
m’§je
 
	`VARCHAR
(".$this->limite_mensajes."),

183 
desüciÚ
 
	`VARCHAR
(".$this->limite_descripcion.")

186 iàĞ! 
$sqlResuÉ
 = 
$this
->
cÚexiÚ
->
	`qu”y
(
$SQL
) ) {

188 
$”r
 = 
$this
->
cÚexiÚ
->
	`”rÜInfo
();

189 
throw
 
Ãw
 
	`Exû±iÚ
("E¼Ü‡Èü—¸bÏ d".
$bÏ
."\n".
$”r
[2]);

190  
FALSE
;

194 
	}
}

198 
funùiÚ
 
	$”rÜes
(è{  
$this
->
”rÜes
; 
	}
}

202 
public
 
funùiÚ
 
	$g‘In¡ªû
() {

204 
$obj‘oRegi¡ro
;

206 iàĞ!
	`is£t
(
$obj‘oRegi¡ro
) ) {

207 
$obj‘oRegi¡ro
 = 
Ãw
 
	`Regi¡ro
();

210  
$obj‘oRegi¡ro
;

212 
	}
}

221 
funùiÚ
 
	$toA»gi¡ro
(
$to
) {

223 iàĞ
	`š_¬¿y
(
$to
,
$this
->
tos_adm™idos
) ) {

224  
TRUE
;

226  
FALSE
;

229 
	}
}

238 
funùiÚ
 
niv–
(
$niv–
='AVISO') {

240 iàĞ! 
$this
->
v®id¬_to
(
$niv–
) ) {

241 
throw
 
Ãw
 
Exû±iÚ
('Niv– '.
$niv–
.' inexistente');

242  
	gFALSE
;

245 
	g$m¬ÿ
 = 
NULL
;

246 
	g$this
->
	gtos_adm™idos
 = 
¬¿y
();

248 
fÜ—ch
Ğ
$this
->
tos_»gi¡ros
 
as
 
$to
 ) {

250 iàĞ
	g$to
 =ğ
$niv–
 || 
$m¬ÿ
 ) {

251 
$this
->
tos_adm™idos
[] = 
$to
;

252 
	g$m¬ÿ
 = 
TRUE
;

257 
	g$this
->
»gi¡¿
(
__FILE__
,
__LINE__
,'Niv– d»gi¡ro ¨'.
$niv–
. "\nTo admš™idos: ".
d•u¿r
(
$this
->
tos_adm™idos
));

259  
	gTRUE
;

265 
funùiÚ
 
	$uÉima_£siÚ
() {

267 
$sql
 = 'SELECT sesiÚ FROM '.
$this
->
sufijo
.'registros order by sesion desc†imit 1';

268 
$»suÉ
 = 
$this
->
cÚexiÚ
->
	`qu”y
(
$sql
,
PDO
::
FETCH_NUM
);

270 ià(!
$»suÉ
) {

273 
	`fÜ—ch
 ( 
$»suÉ
 
as
 
$uÉimo
 ) {

274  
$uÉimo
[0];

277 
	}
}

288 
funùiÚ
 
	$v®id¬_to
(
$to
) {

290 iàĞ! 
	`š_¬¿y
(
$to
, 
$this
->
tos_»gi¡ros
) ) {

291 
throw
 
Ãw
 
	`Exû±iÚ
('V®idaciÚ dtØÃg©iv¨['.
$to
.']');

292  
FALSE
;

294  
TRUE
;

297 
	}
}

313 
funùiÚ
 
»gi¡¿
(
$fich”o
,
$lš—
, 
$m
, 
$to
 = 'DEBUG', 
$desüciÚ
 = 
NULL
) {

315 
$t›mpo
 = 
time
();

317 iàĞ!
	g$m
 || $m == '' ) {

318 
throw
 
Ãw
 
Exû±iÚ
('Se„equiere de contenido‡„egistrar');

319  
	gçl£
;

322 iàĞ! 
	g$this
->
v®id¬_to
Ğ
$to
 ) ) {

323 
throw
 
Ãw
 
Exû±iÚ
('Tipo_incorrecto');

324  
	gçl£
;

327 
	g$§lida
 = '';

333 iàĞ
is_¬¿y
(
$m
) ) {

334 
	g$§lida
 = '';

335 
fÜ—ch
 ( 
$m
 
as
 
$key
 => 
$m’§je
 ) {

336 iàĞ
is_¬¿y
(
$m’§je
) ) {

337 
fÜ—ch
 (
$m’§je
 
as
 
$key2
 => 
$v®Ü2
) {

338 iàĞ
is_¬¿y
(
$v®Ü2
) ) {

339 
$§lida
 .ğ
$key2
." => ".
v¬_expÜt
(
$v®Ü2
,
Œue
)."\n";

341 
	g$§lida
 .ğ
$key2
." => ".
$v®Ü2
."\n";

345 
	g$§lida
 .ğ
$key
." => ".
$m’§je
."\n";

349 
	g$§lida
 = 
$m
;

356  
¡¾’
(
$§lida
è> 
	g$this
->
	glim™e_m’§jes
 ) {

358 
	g$§lidaA¼ay
[] = 
sub¡r
(
$§lida
,0,
$this
->
lim™e_m’§jes
).'@->';

359 
	g$§lida
 = 
sub¡r
(
$§lida
,
$this
->
lim™e_m’§jes
);

363 
	g$§lidaA¼ay
[] = 
$§lida
;

365 
fÜ—ch
 ( 
$§lidaA¼ay
 
as
 
$§lida
 ) {

366 
	g$Ä
 = ( 
couÁ
(
$this
->
»gi¡ros
) > 0 ) ? count($this->registros) : 0 ;

367 
	g$this
->
	g»gi¡ros
[
$Ä
] = 
¬¿y
($Ä,
$this
->
£siÚ
,
$t›mpo
,
$to
,
$fich”o
,
$lš—
,
$§lida
,
$desüciÚ
);

372 iàĞ! 
	g$this
->
toA»gi¡ro
(
$to
) ) ;

376 
	g$_SESSION
[
$this
->
sufijo
.'»gi¡ros'][
$to
][] = 
¬¿y
(
$fich”o
,
$lš—
,
$§lida
);

380 
fÜ—ch
 ( 
$§lidaA¼ay
 
as
 
$§lida
 ) {

382 iàĞ
	g$to
 == 'ERROR' ) {

384 
$this
->
”rÜes
 = 
TRUE
;

386 iàĞ
	gGCM_DEBUG
 ) {

388 
	gecho
 "<div class='error'>";

389 
	gecho
 "<pre>$salida</b></pre>";

390 
	gecho
 '<¨h»f="vim://'.
	g$fich”o
.'@'.
	g$lš—
.'">';

391 
	gecho
 "<p>$fichero : $linea</p>";

392 
	gecho
 "</a>";

393 
	gecho
 "</div>";

398 
	g$SQL
 = "INSERT INTO ".
$this
->
sufijo
."registros ( sesion, fecha,ipo, mensaje, fichero,†inea, descripcion ) VALUES ";

399 
	g$SQL
 .= "(?,?,?,?,?,?,?)";

400 
	g$comªdo
 = 
$this
->
cÚexiÚ
->
´•¬e
(
$SQL
);

401 iàĞ!
	g$comªdo
 ) {

402 
	g$”r
 = 
$this
->
cÚexiÚ
->
”rÜInfo
();

403 
	g$m’_”rÜ
 = 
$”r
[2];

404 
throw
 
Ãw
 
Exû±iÚ
('E¼Ü‡È´•¬¬ sql'.
$m’_”rÜ
);

407 iàĞ! 
	g$comªdo
->
execu‹
(
¬¿y
(
$this
->
£siÚ
,
$t›mpo
,
$to
,
$§lida
, 
$fich”o
, 
$lš—
, 
$desüciÚ
) ) ) {

408 
	g$”r
 = 
$this
->
cÚexiÚ
->
”rÜInfo
();

409 
	g$m’_”rÜ
 = 
$”r
[2];

410 
throw
 
Ãw
 
Exû±iÚ
('E¼Ü‡Èš£¹¬„egi¡ro: '.
$m’_”rÜ
);

414  
	g$t›mpo
.'::'.
	g$to
.'::'.
	g$§lida
;

424 
funùiÚ
 
	$v”_»gi¡ros
(
$tos
 = 
NULL
, 
$cÚdiciÚ
 = NULL ) {

426 
$ãcha_mysql
 = "FROM_UNIXTIME( fecha )";

427 
$ãcha_sql™e
 = "datetime(fecha, 'unixepoch', 'localtime')";

429 iàĞ
$this
->
cÚexiÚ
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME")) == 'sqlite' ) {

430 
$ãcha
 = 
$ãcha_sql™e
;

432 
$ãcha
 = 
$ãcha_mysql
;

435 
$sql0
 = 'SELECT id, sesiÚ, '.
$ãcha
.',ipo, fichero,†inea, mensaje, descripcion ';

436 
$sql1
 = 'FROM '.
$this
->
sufijo
.'registros WHERE 1 ';

440 iàĞ
	`is_¬¿y
(
$tos
) ) {

442 
$sql1
 .= ' AND (';

444 
	`fÜ—ch
 ( 
$tos
 
as
 
$to
 ) {

445 iàĞ
$to
 =ğ
$tos
[0] ) {

446 
$sql1
 .ğ'Øğ"'.
$to
.'"';

448 
$sql1
 .ğ' ORØğ"'.
$to
.'"';

451 
$sql1
 .= ')';

455 iàĞ
$tos
 ) {

456 
$sql1
 .ğ' ANDo="'.
$tos
.'"';

463 iàĞ
$cÚdiciÚ
 ) {

464 
$sql1
 .ğ' AND '.
	`¡r¦ashes
(
$cÚdiciÚ
) ;

466 
$sql1
 .ğ' AND sesiÚ='.
$this
->
£siÚ
;

469 
$cÚsuÉa
 = 
$sql0
.
$sql1
;

470 
$»suÉ
 = 
$this
->
cÚexiÚ
->
	`´•¬e
(
$cÚsuÉa
);

472 iàĞ! 
$»suÉ
 ) {  
FALSE
; }

474 
$»suÉ
->
	`execu‹
();

475 
$»tÜno
 = 
$»suÉ
->
	`ãtchAÎ
(
PDO
::
FETCH_NUM
);

479 ià(!
$»suÉ
) {

481 
$”r
 = 
$this
->
cÚexiÚ
->
	`”rÜInfo
();

482 
$m’_”rÜ
 = 
$”r
[2];

483 
throw
 
Ãw
 
	`Exû±iÚ
('E¼ÜƒjecundØqu”y: '.
$m’_”rÜ
. ' sql: '.
$cÚsuÉa
);

485 } 
	`–£if
 ( 
	`couÁ
(
$»tÜno
) > 0 ) {

488 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Regi¡ro::CÚ„esuÉado::'.
$sql1
);

489  
$»tÜno
;

493 
$this
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Regi¡ro::Sš„esuÉados::'.
$sql0
.
$sql1
);

494  
FALSE
;

498 
	}
}

504 
funùiÚ
 
	$»gi¡ros_£siÚ
() {

506 iàĞ! 
	`is£t
(
$_SESSION
[
$this
->
sufijo
.'»gi¡ros']è|| 
	`em±y
($_SESSION[$this->sufijo.'»gi¡ros']èè{  
FALSE
; }

508 
$»gi¡ros
 = 
$_SESSION
[
$this
->
sufijo
.'registros'];

509 
	`un£t
(
$_SESSION
[
$this
->
sufijo
.'registros']);

510  
$»gi¡ros
;

512 
	}
}

520 
funùiÚ
 
	$bÜ¿do_»gi¡ros_ªtiguos
(
$dŸs
) {

522 iàĞ
$this
->
mÙÜ_bd
 == 'sqlite' ) {

524 
$hÜas
 = ( 
$dŸs
 * 24 );

525 
	`bÜ¿r_¬chivos_v›jos
(
$hÜas
, 
	`dœÇme
(
$this
->
ba£_d©os
).'/*' );

529 
$ãcha_unix_bÜ¿do
 = 
	`time
(è- ( 
$dŸs
 * 24 * 60 * 60 );

531 
$cÚdiciÚ
 = "ãch¨< ".
$ãcha_unix_bÜ¿do
;

533 
$sql
 = "DELETE FROM ".
$this
->
sufijo
.'»gi¡ro WHERE '.
$cÚdiciÚ
;

534 
$»suÉ
 = 
$this
->
cÚexiÚ
->
	`´•¬e
(
$sql
);

535 
$»suÉ
->
	`execu‹
();

539 
	}
}

	@gcm/lib/int/registro/RegistroFactory.php

1 <?
php


29 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/Registro.php');

31 şas 
	cRegi¡roFaùÜy
 {

33 
public
 
funùiÚ
 
g‘Regi¡ro
(
$ba£_d©os
=
NULL
,
$sufijo
='') {

35 
$key
 = 
md5
(
£rŸlize
(
$ba£_d©os
));

37 iàĞ! 
is£t
(
$GLOBALS
['Regi¡ro']è|| ! (
	m$GLOBALS
['Regi¡ro'][
$key
] 
š¡ªûof
 
	mRegi¡ro
) ) {

39 
	m$GLOBALS
['Regi¡ro'][
$key
] = 
Ãw
 
Regi¡ro
(
$ba£_d©os
,
$sufijo
);

43  
	m$GLOBALS
['Regi¡ro'][
$key
];

	@gcm/lib/int/registro/RegistroFactoryTest.php

1 <?
php


7 
	g»quœe_Úû
 'PHPUnit/Framework.php';

9 
»quœe
(
dœÇme
(
__FILE__
).'/RegistroFactory.php');

11 şas 
	cRegi¡roFaùÜyTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
{

13 
public
 
	m$»gi¡roFaùÜy
;

14 
public
 
	m$¬chivo
;

16 
funùiÚ
 
	$__cÚ¡ruù
() {

18 
$this
->
¬chivo
 = '/tmp/TestRegistroFactory.db';

19 
$this
->
»gi¡roFaùÜy
 = 
Regi¡roFaùÜy
::
	`g‘Regi¡ro
($this->
¬chivo
);

25 
funùiÚ
 
	$‹¡AnyadœRegi¡ros
() {

27 
$this
->
»gi¡roFaùÜy
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Test sobre Registro');

28 
$this
->
	`as£¹True
(
	`fe_exi¡s
($this->
¬chivo
), 'Archivo de„egistro creado');

32 
$this
->
¬chivo
 = '/tmp/TestRegistroFactory2.db';

33 
$this
->
»gi¡roFaùÜy
 = 
Regi¡roFaùÜy
::
	`g‘Regi¡ro
($this->
¬chivo
);

35 
$this
->
»gi¡roFaùÜy
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Test sobre Registro2');

36 
$this
->
	`as£¹True
(
	`fe_exi¡s
($this->
¬chivo
), 'Archivo de„egistro creado');

38 
	}
}

	@gcm/lib/int/registro/RegistroTest.php

1 <?
php


3 
	g»quœe_Úû
 'PHPUnit/Framework.php';

5 
»quœe_Úû
('Registro.php');

7 şas 
	cRegi¡roTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
{

9 
public
 
	m$»gi¡ro
 = '';

11 
funùiÚ
 
	$__cÚ¡ruù
() {

13 
$this
->
»gi¡ro
 = 
Ãw
 
	`Regi¡ro
('/tmp/test.bd');

17 
funùiÚ
 
	$‹¡C»ªdoNuevoRegi¡ro
() {

19 
$this
->
»gi¡ro
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Test sobre Registro');

21 
$this
->
	`as£¹True
(
	`fe_exi¡s
('/tmp/test.bd'), 'Archivo de„egistro creado');

23 
	}
}

29 
funùiÚ
 
	$‹¡In£¹ªdoA¼ay
() {

31 
$¬¿y
 = 
	`¬¿y
('Test deƒntrada de‡rray');

32 
$¬¿y
[1]['Li¡adØsubdœeùÜio'] = 
	`glob
("../*");

33 
$¬¿y
[2]['Li¡adØdœeùÜiØ‹mpÜ®'] = 
	`glob
("/tmp/*");

34 
$this
->
	`as£¹NÙNuÎ
($this->
»gi¡ro
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
$¬¿y
), 'Ingresar un‡rray');

36 
	}
}

40 
public
 
funùiÚ
 
	$‹¡Exû±iÚ
() {

42 
Œy
 {

43 @
$this
->
»gi¡ro
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Test sobre Registro','SIN_TIPO');

45 } 
	`ÿtch
 (
Exû±iÚ
 
$ex³ùed
) {

50 
$this
->
	`ç
('Seƒsperaba unƒrror que‚o se…rodujo');

51 
	}
}

55 
funùiÚ
 
	$‹¡Regi¡roNulo
() {

57 
Œy
 {

58 @
$this
->
»gi¡ro
->
	`»gi¡¿
();

60 } 
	`ÿtch
 (
Exû±iÚ
 
$ex³ùed
) {

65 
$this
->
	`ç
('Registro‚ulo sinƒrror');

67 
	}
}

71 
funùiÚ
 
	$‹¡Regi¡roG¿nde
() {

73 
$this
->
	`as£¹NÙNuÎ
($this->
»gi¡ro
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`¡r_»³©
("Test de Registro grande ",80)), 'Ingresar un„egistro grande');

75 
	}
}

79 
public
 
funùiÚ
 
	$‹¡SessiÚAùu®
() {

81 
$this
->
	`as£¹NÙNuÎ
($this->
»gi¡ro
->
	`v”_»gi¡ros
(), 'Registros de†a sesiÃ³n‡ctual');

82 
$this
->
	`as£¹NÙNuÎ
($this->
»gi¡ro
->
	`v”_»gi¡ros
(
	`¬¿y
('DEBUG','ADMIN')), 'Registros de†a sesiÃ³n‡ctual');

83 
$this
->
	`as£¹F®£
($this->
»gi¡ro
->
	`v”_»gi¡ros
(
	`¬¿y
('AVISO')), 'No debe heber„egistros de AVISO');

85 
	}
}

89 
funùiÚ
 
	$‹¡V®id¬_to
() {

91 
$this
->
	`as£¹True
($this->
»gi¡ro
->
	`v®id¬_to
('DEBUG'), 'Validaripo„egistros');

93 
Œy
 {

94 
$this
->
»gi¡ro
->
	`v®id¬_to
('TIPO_NO_VALIDO');

95 } 
	`ÿtch
 (
Exû±iÚ
 
$e
) {

99 
$this
->
	`ç
('Validador deipo de„egistro dio uno malo…or bueno');

101 
	}
}

105 
funùiÚ
 
	$‹¡Niv–
() {

107 
$this
->
	`as£¹True
($this->
»gi¡ro
->
	`niv–
('ADMIN'), 'Cambiamos‚ivel');

109 
	}
}

	@gcm/lib/int/rst2html/lib/Rst2html.php

1 <?
php


38 şas 
	cR¡2html
 {

40 
funùiÚ
 
	$cÚv”tœ
(
$šput
) {

42 
$r¡2html
 = '/usr/bin/rst2html';

44 ià(!
	`is_execubË
(
$r¡2html
)) {

50 #Ià
pe
 
”rÜs
 
¬e
 
»pÜ‹d
, 
’abË
 
ouut
 
to
 
the
 
fe
.

51 #Buˆ
make
 
û¹aš
 
the
 
fe
 
dÛ¢
't‡lreadyƒxist orƒlse

52 #th
web£rv”
 
may
 
nÙ
 
have
 
³rmissiÚ
 
to
 
ü—‹
 
™
.

53 
$io_desc
 = 
	`¬¿y
(

54 0 => 
	`¬¿y
('pipe', 'r'),

55 1 => 
	`¬¿y
('pipe', 'w'),

58 
$»s
 = 
	`´oc_İ’
(
$r¡2html
 . " --stylesheet-path='' " .

61 
$io_desc
, 
$pes
, '/tmp', 
NULL
);

63 ià(
	`is_»sourû
(
$»s
)) {

65 
	`fwr™e
(
$pes
[0], 
$šput
);

66 
	`fşo£
(
$pes
[0]);

68 
$html
 = 
	`¡»am_g‘_cÚ‹Ás
(
$pes
[1]);

69 
	`fşo£
(
$pes
[1]);

71 
$html
 = 
	`´eg_»¶aû
('/.*<body>\n(.*)<\/body>.*/s', '${1}', $html);

75 
$html
 = "<strong class='error'>" .

80  
$html
;

83 
	}
}

	@gcm/lib/int/solicitud/lib/Restricciones.php

1 <?
php


3 
»quœe_Úû
("constantes.php");

5 şas 
	cRe¡ricciÚes
 {

7 
´iv©e
 
	m$_štCÚ¡¿štTy³
;

8 
´iv©e
 
	m$_¡rCÚ¡¿štO³¿nd
;

10 
funùiÚ
 
	$__cÚ¡ruù
(
$štCÚ¡¿štTy³
, 
$¡rCÚ¡¿štO³¿nd
) {

11 
$this
->
_štCÚ¡¿štTy³
 = 
$štCÚ¡¿štTy³
;

12 
$this
->
_¡rCÚ¡¿štO³¿nd
 = 
$¡rCÚ¡¿štO³¿nd
;

15 
funùiÚ
 
	$G‘CÚ¡¿štTy³
() {

16 (
$this
->
_štCÚ¡¿štTy³
);

17 
	}
}

19 
funùiÚ
 
	$G‘CÚ¡¿štO³¿nd
() {

20 (
$this
->
_¡rCÚ¡¿štO³¿nd
);

21 
	}
}

	@gcm/lib/int/solicitud/lib/RestriccionesFallidas.php

1 <?
php


3 şas 
	cRe¡ricciÚesF®lidas
 {

5 
´iv©e
 
	m$_¡rP¬am‘”Name
;

6 
´iv©e
 
	m$_štV”bM‘hod
;

7 
´iv©e
 
	m$_objFaedCÚ¡¿štObjeù
;

9 
funùiÚ
 
	$__cÚ¡ruù
(
$¡rP¬am‘”Name
, 
$štV”bM‘hod
,

10 
$objFaedCÚ¡¿štObjeù
) {

11 
$this
->
_¡rP¬am‘”Name
 = 
$¡rP¬am‘”Name
;

12 
$this
->
_štV”bM‘hod
 = 
$štV”bM‘hod
;

13 
$this
->
_objFaedCÚ¡¿štObjeù
 = 
$objFaedCÚ¡¿štObjeù
;

16 
funùiÚ
 
	$G‘P¬am‘”Name
() {

17 (
$this
->
_¡rP¬am‘”Name
);

18 
	}
}

20 
funùiÚ
 
	$G‘V”bM‘hod
() {

21 (
$this
->
_štV”bM‘hod
);

22 
	}
}

24 
funùiÚ
 
	$G‘FaedCÚ¡¿štObjeù
() {

25 (
$this
->
_objFaedCÚ¡¿štObjeù
);

26 
	}
}

	@gcm/lib/int/solicitud/lib/Solicitud.php

1 <?
php


18 
»quœe_Úû
('constantes.php');

19 
»quœe_Úû
('Restricciones.php');

20 
»quœe_Úû
('RestriccionesFallidas.php');

27 şas 
	cSŞic™ud
 {

29 
´iv©e
 
	m$_¬G‘V¬s
;

30 
´iv©e
 
	m$_¬Po¡V¬s
;

31 
´iv©e
 
	m$_¬Cook›V¬s
;

32 
´iv©e
 
	m$_¬Reque¡V¬s
;

41 
´iv©e
 
	m$_objOrigš®Reque¡Objeù
;

48 
´iv©e
 
	m$_blIsRedœeùFŞlowšgCÚ¡¿štFau»
 = 
FALSE
;

55 
´iv©e
 
	m$_blRedœeùOnCÚ¡¿štFau»
;

64 
´iv©e
 
	m$_¡rCÚ¡¿štFau»RedœeùT¬g‘URL
;

73 
´iv©e
 
	m$_¡rCÚ¡¿štFau»DeçuÉRedœeùT¬g‘URL
;

83 
´iv©e
 
	m$_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
;

90 
´iv©e
 
	m$_¬ObjCÚ¡¿štFau»
;

96 
´iv©e
 
	m$_hasRunCÚ¡¿štTe¡s
;

112 
funùiÚ
 
	$__cÚ¡ruù
(
$check_fÜ_cook›
 = 
Œue
) {

115 
glob®
 
$_REQUEST
;

116 
glob®
 
$_GET
;

117 
glob®
 
$_POST
;

118 
glob®
 
$_COOKIE
;

119 
$this
->
_¬G‘V¬s
 = 
$_GET
;

120 
$this
->
_¬Po¡V¬s
 = 
$_POST
;

121 
$this
->
_¬Cook›V¬s
 = 
$_COOKIE
;

122 
$this
->
_¬Reque¡V¬s
 = 
$_REQUEST
;

124 ià(
$check_fÜ_cook›
) {

127 iàĞ
	`is£t
(
$_SESSION
['RESPUESTA_ERRONEA']) ) {

130 
$cook›V®
 = 
$_SESSION
['RESPUESTA_ERRONEA'];

131 
	`un£t
(
$_SESSION
['RESPUESTA_ERRONEA']);

132 
$this
->
_blIsRedœeùFŞlowšgCÚ¡¿štFau»
 = 
Œue
;

134 ià(
	`¡¾’
(
$cook›V®
) > 0) {

135 
$¡rResuÉ
 = 
	`£tcook›
 ("ph´qcOrigš®Reque¡Objeù", "",
	`time
() - 3600,'/');

136 
$ÜigObj
 = 
	`un£rŸlize
(
	`¡r¦ashes
(
$cook›V®
));

137 
$this
->
_objOrigš®Reque¡Objeù
 = &
$ÜigObj
;

138 
$this
->
_¬Reque¡V¬s
["phprqcOriginalRequestObject"] = "";

139 
$this
->
_¬G‘V¬s
["phprqcOriginalRequestObject"] = "";

140 
$this
->
_¬Po¡V¬s
["phprqcOriginalRequestObject"] = "";

142 
$this
->
_blIsRedœeùOnCÚ¡¿štFau»
 = 
Œue
;

144 
$this
->
_blIsRedœeùOnCÚ¡¿štFau»
 = 
çl£
;

147 
$this
->
_blIsRedœeùOnCÚ¡¿štFau»
 = 
çl£
;

149 
$this
->
_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
 = 
	`A¼ay
();

150 
$this
->
_¬ObjCÚ¡¿štFau»
 = 
	`A¼ay
();

151 
$this
->
_blHasRunCÚ¡¿štTe¡s
 = 
çl£
;

161 
funùiÚ
 
	$IsRedœeùFŞlowšgCÚ¡¿štFau»
() {

162 (
$this
->
_blIsRedœeùOnCÚ¡¿štFau»
);

163 
	}
}

172 
funùiÚ
 
	$G‘Origš®Reque¡ObjeùFŞlowšgCÚ¡¿štFau»
() {

173 ià(
$this
->
_blIsRedœeùOnCÚ¡¿štFau»
) {

174 (
$this
->
_objOrigš®Reque¡Objeù
);

176 
	}
}

187 
funùiÚ
 
	$S‘RedœeùOnCÚ¡¿štFau»
(
$blTrueOrF®£
) {

188 
$this
->
_blRedœeùOnCÚ¡¿štFau»
 = 
$blTrueOrF®£
;

189 
	}
}

199 
funùiÚ
 
	$S‘CÚ¡¿štFau»RedœeùT¬g‘URL
(
$¡rURL
) {

200 
$this
->
_¡rCÚ¡¿štFau»RedœeùT¬g‘URL
 = 
$¡rURL
;

201 
	}
}

211 
funùiÚ
 
	$S‘CÚ¡¿štFau»DeçuÉRedœeùT¬g‘URL
(
$¡rURL
) {

212 
$this
->
_¡rCÚ¡¿štFau»DeçuÉRedœeùT¬g‘URL
 = 
$¡rURL
;

213 
	}
}

221 
funùiÚ
 
	$G‘P¬am‘”V®ue
(
$¡rP¬am‘”
) {

222 (
$this
->
_¬Reque¡V¬s
[
$¡rP¬am‘”
]);

223 
	}
}

227 
funùiÚ
 
	$G‘P¬am‘”s
() {

228 (
$this
->
_¬Reque¡V¬s
);

229 
	}
}

233 
funùiÚ
 
	$G‘Cook›s
() {

234 (
$this
->
_¬Cook›V¬s
);

235 
	}
}

239 
funùiÚ
 
	$G‘Po¡V¬ŸbËs
() {

240 (
$this
->
_¬Po¡V¬ŸbËs
);

241 
	}
}

245 
funùiÚ
 
	$G‘G‘V¬ŸbËs
() {

246 (
$this
->
_¬G‘V¬ŸbËs
);

247 
	}
}

259 
funùiÚ
 
	$AddCÚ¡¿št
(
$¡rP¬am‘”
, 
$štM‘hod
, 
$objCÚ¡¿št
) {

260 
$ÃwHash
["PARAMETER"] = 
$¡rP¬am‘”
;

261 
$ÃwHash
["METHOD"] = 
$štM‘hod
;

262 
$ÃwHash
["CONSTRAINT"] = 
$objCÚ¡¿št
;

263 
$this
->
_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
[] = 
$ÃwHash
;

264 
	}
}

274 
funùiÚ
 
	$v®Ü_·¿m‘ro
(
$·¿m‘ro
) {

276 ià(
	`is£t
(
$this
->
_¬Cook›V¬s
[
$·¿m‘ro
])) {

277  
$this
->
_¬Cook›V¬s
[
$·¿m‘ro
];

278 } 
	`–£if
 (
	`is£t
(
$this
->
_¬G‘V¬s
[
$·¿m‘ro
])) {

279  
$this
->
_¬G‘V¬s
[
$·¿m‘ro
];

280 } 
	`–£if
 (
	`is£t
(
$this
->
_¬Po¡V¬s
[
$·¿m‘ro
])) {

281  
$this
->
_¬Po¡V¬s
[
$·¿m‘ro
];

283  
FALSE
;

285 
	}
}

295 
funùiÚ
 
	$Te¡CÚ¡¿šts
() {

297 
$this
->
_blHasRunCÚ¡¿štTe¡s
 = 
Œue
;

298 
$ªyFa
 = 
çl£
;

300 
$i
=0; $i<=(
$this
->
_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
) -1; $i++) {

302 
$¡rThisP¬am‘”
 =

303 
$this
->
_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
[
$i
] ["PARAMETER"];

304 
$štThisM‘hod
 = 
$this
->
_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
[
$i
]["METHOD"];

305 
$objThisCÚ¡¿št
 =

306 
$this
->
_¬ObjP¬am‘”M‘hodCÚ¡¿štHash
[
$i
] ["CONSTRAINT"];

307 
$v¬Aùu®V®ue
 = "";

308 ià(
$štThisM‘hod
 =ğ
ENTRADAS_COOKIE
) {

309 
$v¬Aùu®V®ue
 = 
$this
->
_¬Cook›V¬s
[
$¡rThisP¬am‘”
];

311 ià(
$štThisM‘hod
 =ğ
ENTRADAS_GET
) {

312 
$v¬Aùu®V®ue
 = 
$this
->
_¬G‘V¬s
[
$¡rThisP¬am‘”
];

314 ià(
$štThisM‘hod
 =ğ
ENTRADAS_POST
) {

315 
$v¬Aùu®V®ue
 = 
$this
->
_¬Po¡V¬s
[
$¡rThisP¬am‘”
];

317 
$štCÚ¡¿štTy³
 = 
$objThisCÚ¡¿št
->
	`G‘CÚ¡¿štTy³
();

318 
$¡rCÚ¡¿štO³¿nd
 = 
$objThisCÚ¡¿št
->
	`G‘CÚ¡¿štO³¿nd
();

319 
$thisFa
 = 
çl£
;

320 
$objFau»Objeù
 = 
Ãw
 
	`Re¡ricciÚesF®lidas
(
$¡rThisP¬am‘”
,

321 
$štThisM‘hod
, 
$objThisCÚ¡¿št
);

323 
$štCÚ¡¿štTy³
) {

325 
RT_MAIL
:

326 if(! 
	`”egi
("^([_a-z0-9-]+)(\.[_a-z0-9-]+)*@([a-z0-9-]+)(\.[a-z0-9-]+)*(\.[a-z]{2,4})$", (
¡ršg
)
$v¬Aùu®V®ue
)) {

327 
$thisFa
 = 
Œue
;

328 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Elƒmail‚o…arece valido');

332 
RT_LONG_MIN
:

333 ià(
	`¡¾’
((
¡ršg
)
$v¬Aùu®V®ue
è< (
š‹g”
è
$¡rCÚ¡¿štO³¿nd
) {

334 
$thisFa
 = 
Œue
;

335 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' su†Úg™udƒ m’Ü‡ '.
$¡rCÚ¡¿štO³¿nd
);

339 
RT_LONG_MAX
:

340 ià(
	`¡¾’
((
¡ršg
)
$v¬Aùu®V®ue
è> (
š‹g”
è
$¡rCÚ¡¿štO³¿nd
) {

341 
$thisFa
 = 
Œue
;

342 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' su†Úg™udƒ mayÜ‡ '.
$¡rCÚ¡¿štO³¿nd
);

346 
RT_CARACTERES_PERMITIDOS
:

347 
$j
=0; $j<=
	`¡¾’
(
$v¬Aùu®V®ue
)-1; $j++) {

348 
$thisCh¬
 = 
	`sub¡r
(
$v¬Aùu®V®ue
, 
$j
, 1);

349 ià(
	`¡½os
(
$¡rCÚ¡¿štO³¿nd
, 
$thisCh¬
è==ğ
çl£
) {

350 
$thisFa
 = 
Œue
;

351 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' con caracteres‚o…ermitidos');

356 
RT_CARACTERES_NO_PERMITIDOS
:

357 
$j
=0; $j<=
	`¡¾’
(
$v¬Aùu®V®ue
)-1; $j++) {

358 
$thisCh¬
 = 
	`sub¡r
(
$v¬Aùu®V®ue
, 
$j
, 1);

359 ià(!(
	`¡½os
(
$¡rCÚ¡¿štO³¿nd
, 
$thisCh¬
è==ğ
çl£
)) {

360 
$thisFa
 = 
Œue
;

361 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' con caracteres‚o…ermitidos');

366 
RT_MENOR_QUE
:

367 ià(
$v¬Aùu®V®ue
 >ğ
$¡rCÚ¡¿štO³¿nd
) {

368 
$thisFa
 = 
Œue
;

369 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' m’Ü‡ '.
$¡rCÚ¡¿štO³¿nd
);

373 
RT_MAYOR_QUE
:

374 ià(
$v¬Aùu®V®ue
 <ğ
$¡rCÚ¡¿štO³¿nd
) {

375 
$thisFa
 = 
Œue
;

376 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' mayÜ‡ '.
$¡rCÚ¡¿štO³¿nd
);

380 
RT_IGUAL_QUE
:

381 ià(
$v¬Aùu®V®ue
 !ğ
$¡rCÚ¡¿štO³¿nd
) {

382 
$thisFa
 = 
Œue
;

383 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' igu® qu'.
$¡rCÚ¡¿štO³¿nd
);

387 
RT_NO_IGUAL
:

388 ià(
$v¬Aùu®V®ue
 =ğ
$¡rCÚ¡¿štO³¿nd
) {

389 
$thisFa
 = 
Œue
;

390 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.'‚Øe igu®‡ '.
$¡rCÚ¡¿štO³¿nd
);

394 
RT_PASA_EXPRESION_REGULAR
:

395 ià(!(
	`´eg_m©ch
(
$¡rCÚ¡¿štO³¿nd
, 
$v¬Aùu®V®ue
))) {

396 
$thisFa
 = 
Œue
;

397 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.'…a§ƒx°'.
$¡rCÚ¡¿štO³¿nd
);

401 
RT_NO_PASA_EXPRESION_REGULAR
:

402 ià(
	`´eg_m©ch
(
$¡rCÚ¡¿štO³¿nd
, 
$v¬Aùu®V®ue
)) {

403 
$thisFa
 = 
Œue
;

404 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.'‚Ø·§ƒxp'.
$¡rCÚ¡¿štO³¿nd
);

408 
RT_NO_ES_NUMERO
:

409 iàĞ! 
	`is_num”ic
(
$v¬Aùu®V®ue
) ) {

410 
$thisFa
 = 
Œue
;

411 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' m’Ü‡ '.
$¡rCÚ¡¿štO³¿nd
);

415 
RT_REQUERIDO
:

416 iàĞ! 
	`is£t
(
$v¬Aùu®V®ue
è|| 
	`em±y
($varActualValue) ) {

417 
$thisFa
 = 
Œue
;

418 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.'ƒ »qu”idØ'.
$¡rCÚ¡¿štO³¿nd
);

422 
RT_PASSWORD
:

423 iàĞ! 
	`is£t
(
$_REQUEST
['verificacion']) ) {

424 
$thisFa
 = 
Œue
;

425 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Se‚ecesita un campo "verificacion"…ara…oder verificar†a contraseÃ±a ','ERROR');

427 iàĞ
$v¬Aùu®V®ue
 !ğ
$_REQUEST
['verificacion'] ) {

428 
$thisFa
 = 
Œue
;

429 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$¡rThisP¬am‘”
.' cÚŒa£Ã±¨diã»Á¨v”ifiÿciÃ³À'.
$¡rCÚ¡¿štO³¿nd
);

430 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$v¬Aùu®V®ue
.' !ğ'.
$_REQUEST
['verificacion'],'ADMIN');

436 ià(
$thisFa
) {

437 
$ªyFa
 = 
Œue
;

438 
$this
->
_¬ObjCÚ¡¿štFau»
[] = 
$objFau»Objeù
;

443 ià(
$ªyFa
) {

445 ià(
$this
->
_blRedœeùOnCÚ¡¿štFau»
) {

447 
$rg‘URL
 = 
$_SERVER
["REDIRECT_URL"];

448 ià(!
$rg‘URL
) {

449 
$rg‘URL
 = 
$this
->
_¡rCÚ¡¿štFau»DeçuÉRedœeùT¬g‘URL
;

451 ià(
$this
->
_¡rCÚ¡¿štFau»RedœeùT¬g‘URL
) {

452 
$rg‘URL
 = 
$this
->
_¡rCÚ¡¿štFau»RedœeùT¬g‘URL
;

454 ià(
$rg‘URL
) {

455 
$objToS”Ÿlize
 = 
$this
;

456 
$¡rS”Ÿliz©iÚ
 = 
	`£rŸlize
(
$objToS”Ÿlize
);

458 
$_SESSION
['RESPUESTA_ERRONEA'] = 
$¡rS”Ÿliz©iÚ
;

459 
	`h—d”
("Location: $targetURL");

460 
	`ex™
(0);

464 (!(
$ªyFa
));

466 
	}
}

476 
funùiÚ
 
	$G‘CÚ¡¿štFau»s
() {

477 ià(!
$this
->
_blHasRunCÚ¡¿štTe¡s
) {

478 
$this
->
	`Te¡CÚ¡¿šts
();

480 (
$this
->
_¬ObjCÚ¡¿štFau»
);

481 
	}
}

	@gcm/lib/int/solicitud/lib/constantes.php

1 <?
php


18 
defše
('ENTRADAS_COOKIE',1);

19 
defše
('ENTRADAS_GET',2);

20 
defše
('ENTRADAS_POST',4);

24 
defše
('RT_LONG_MIN',1);

25 
defše
('RT_LONG_MAX',2);

26 
defše
('RT_CARACTERES_PERMITIDOS',3);

27 
defše
('RT_CARACTERES_NO_PERMITIDOS',4);

28 
defše
('RT_MENOR_QUE',5);

29 
defše
('RT_MAYOR_QUE',6);

30 
defše
('RT_IGUAL_QUE',7);

31 
defše
('RT_NO_IGUAL',8);

32 
defše
('RT_PASA_EXPRESION_REGULAR',9);

33 
defše
('RT_NO_PASA_EXPRESION_REGULAR',10);

34 
defše
('RT_NO_ES_NUMERO',11);

35 
defše
('RT_REQUERIDO',12);

36 
defše
('RT_MAIL',13);

37 
defše
('RT_PASSWORD',14);

	@gcm/lib/int/temas/lib/TemaGcm.php

1 <?
php


22 şas 
	cTemaGcm
 {

26 
public
 
	m$fich”os
;

30 
public
 
	m$cŞÜes
;

34 
´Ùeùed
 
	m$cŞÜes_çÉª‹s
 = 
NULL
 ;

44 
public
 
funùiÚ
 
	$__cÚ¡ruù
(
$fich”os
, 
$cŞÜes
) {

46 
$this
->
fich”os
 = 
$fich”os
;

47 
$this
->
cŞÜes
 = 
$cŞÜes
;

63 
public
 
funùiÚ
 
	$šşuœ_javasüt
(
$fich”os
=
NULL
,
$lib»rŸs
=NULL,
$u¾_ba£
) {

65 
$fich”os
 = ( $fich”o è? $fich”o : 
$this
->
fich”os
[
js
];

67 
$li¡a
 = ( !
	`em±y
(
$fich”os
èè? 
	`im¶ode
(',',$fich”osè: 
NULL
 ;

69 iàĞ
$lib»rŸs
 && !
	`em±y
($librerias) ) {

70 
	`fÜ—ch
 ( 
$lib»rŸs
 
as
 
$™ems
 ) {

71 
	`li¡
(
$modulo
,
$nomb»
èğ
	`ex¶ode
(':',
$™ems
);

72 
$f
 = 
$this
->
	`ru
(
	`¡¹Şow”
(
$modulo
),'libjs',
$nomb»
);

73 
echo
 "\n".'<süˆ¤c="'.
$u¾_ba£
.
$f
.'"ype="text/javascript"></script>';

78 iàĞ
$li¡a
 ) 
echo
 "\n".'<script src="proyecto.js?arch='.$lista.'"ype="text/javascript"></script>';

80 iàĞ! 
$li¡a
 ) 
echo
 "\n<!-- sin javascript…ara‡Ã±adir -->";

82 
	}
}

94 
funùiÚ
 
	$cŞÜ
(
$cŞÜ
, 
$v®Ü
 = 
FALSE
) {

96 iàĞ
	`is£t
(
$this
->
cŞÜes
[
$cŞÜ
]) ) {

97  
$this
->
cŞÜes
[
$cŞÜ
];

100 iàĞ
$v®Ü
 ) {

101 
$this
->
cŞÜes
[
$cŞÜ
] = 
$v®Ü
;

102 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'CŞÜ…»defšidØ('.
$cŞÜ
.'): '.
$v®Ü
,'DEBUG');

103  
$v®Ü
;

106 
$this
->
cŞÜes_çÉª‹s
[
$cŞÜ
] = 
NULL
;

107 
$this
->
cŞÜes
[
$cŞÜ
] = 'red';

108 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$cŞÜ
.') Color‚o definido','ADMIN');

112 
	}
}

129 
funùiÚ
 
	$cÚ¡ruœ_css
() {

131 
glob®
 
$gcm
;

133 
echo
 "/* ArchivØg’”adØpÜ ".
__CLASS__
." */\n\n";

137 
$fich_v¬ŸbËs
 = 
	`dœÇme
(
$this
->
fich”os
['css']['temas/css/body.css']).'/../../../variables.php';

139 iàĞ
	`fe_exi¡s
Ğ
$fich_v¬ŸbËs
 ) ) 
	`šşude
 ($fich_variables);

144 iàĞ
	`is£t
(
$_GET
['css']è&& !
	`em±y
 ($_GET['css']) ) {

146 
$css
 = 
$_GET
['css'];

148 
echo
 "\n/* body */\n";

149 
	`šşude
(
$this
->
fich”os
['css']['temas/css/body.css']);

150 
echo
 "\n/* cs e¥ecifico: " . 
$css
 . " */\n\n";

151 
$šşuœ
 = 
$this
->
fich”os
['css'][
$css
];

152 iàĞ
$šşuœ
 ) {

153 
	`šşude
(
$šşuœ
);

156 
	`Œigg”_”rÜ
('ArchivØcs nØ’cÚŒado: ['.
$_GET
['css'].']',
E_USER_ERROR
);

158 
echo
 "\n";

162 
echo
 "\n/* fichero:temas/css/body.css: */\n";

163 
	`šşude
(
$this
->
fich”os
['css']['temas/css/body.css']);

164 
echo
 "\n/*‡caba:temas/css/body.css: */\n";

166 
	`fÜ—ch
 ( 
$this
->
fich”os
['css'] 
as
 
$Îave
 => 
$fich”o
) {

168 iàĞ
$Îave
 != 'temas/css/body.css' ) {

169 
echo
 "\n/* fich”o:".
$Îave
.": */\n";

170 
	`šşude
(
$fich”o
);

171 
echo
 "\n/*‡ÿba:".
$Îave
.": */\n";

178 
$SALIDA
 = 
	`ob_g‘_cÚ‹Ás
();

179 
	`ob_’d_ş—n
();

181 iàĞ
GCM_DEBUG
 ) {

182  
$SALIDA
;

184  
	`mšimiz¬_css
(
$SALIDA
);

187 
	}
}

200 
funùiÚ
 
	$cÚ¡ruœ_js
() {

202 
glob®
 
$gcm
;

206 
$fich”os
 = 
$gcm
->
	`li¡a_js
();

207 
$u¾_ba£
 = 
Rou‹r
::
$dœ
;

209 
$fich”os
 = ( $fich”o è? $fich”o : 
$this
->
fich”os
[
js
];

211 
$li¡a
 = ( !
	`em±y
(
$fich”os
èè? 
	`im¶ode
(',',$fich”osè: 
NULL
 ;

213 iàĞ!
	`is£t
(
$_GET
['arch']) ) {

214 
echo
 "\n /**********************************************/";

215 
echo
 "\n /* ERROR: No seƒspecifico‡rchivos‡ incluir */";

216 
echo
 "\n /**********************************************/";

217 
	`ex™
();

220 iàĞ
GCM_DEBUG
 ) 
echo
 "\n/* Fich”o javasüˆ¨šşuœ\n".
	`d•u¿r
(
$_GET
['arch'])."\n*/\n";

233 
$SALIDA
='';

236 
$fich”os_js
 = 
	`ex¶ode
(',',
$_GET
['arch']);

238 
echo
 "\n\n/* Archivo javascript de…royecto */\n\n";

242 
echo
 "/* Fich”os: ".
	`d•u¿r
(
$fich”os_js
)."*/";

244 iàĞ
$fich”os_js
 ) {

246 
	`fÜ—ch
 ( 
$fich”os_js
 
as
 
$™ems
 ) {

248 iàĞ
	`em±y
(
$™ems
) ) ;

249 
	`li¡
(
$modulo
,
$nomb»
èğ
	`ex¶ode
(':',
$™ems
);

250 
echo
 "\n/* $modulo: $nombre */\n\n";

251 
$f
 = 
$this
->
	`ru
(
	`¡¹Şow”
(
$modulo
),'js',
$nomb»
);

252 
	`šşude
 (
$f
);

253 
echo
 "\n";

258 
$SALIDA
 = 
	`ob_g‘_cÚ‹Ás
();

259 
	`ob_’d_ş—n
();

261  
$SALIDA
;

263 
	}
}

273 
funùiÚ
 
	$ru
(
$modulo
, 
$to
, 
$fich”o
) {

275 
$ru
 = 
$modulo
.'/'.
$to
.'/'.
$fich”o
;

276 
$fich”o_‹ma
 = ( 
	`is£t
(
$this
->
fich”os
[
$to
][
$ru
]èè? $this->fich”os[$to][$ru] : 
FALSE
;

278 iàĞ
$fich”o_‹ma
 ) {

279  
$fich”o_‹ma
;

282 
$ru
 = '‹mas/'.
$to
.'/'.
$fich”o
;

283 
$fich”o_‹ma
 = ( 
	`is£t
(
$this
->
fich”os
[
$to
][
$ru
]èè? $this->fich”os[$to][$ru] : 
FALSE
;

285 iàĞ
$fich”o_‹ma
 ) {

286  
$fich”o_‹ma
;

288 
$msg
 = 'Fich”Ød– mÃ³dulØ['.
$modulo
.']Ø['.
$to
.'] fich”Ø['.
$fich”o
.']„u ['.
$ru
.']‚oƒncontrado';

289 
	`Œigg”_”rÜ
(
$msg
,
E_USER_ERROR
);

293  
FALSE
;

294 
	}
}

304 
public
 
funùiÚ
 
	$devŞv”_cŞÜes_çÉª‹s
() {

305  ( 
$this
->
cŞÜes_çÉª‹s
 ) ? $this->cŞÜes_çÉª‹ : 
FALSE
 ;

306 
	}
}

317 
funùiÚ
 
	$icÚo
(
$nomb»
) {

319 iàĞ
	`em±y
(
$nomb»
èè 
FALSE
;

321 
glob®
 
$gcm
;

323 
$to_icÚos
 = 
	`¬¿y
('.gif','.png');

325 
	`fÜ—ch
 ( 
$to_icÚos
 
as
 
$to_icÚo
 ) {

327 
$icÚo
 = 
$nomb»
.
$to_icÚo
;

329 iàĞ
	`is£t
(
$this
->
fich”os
['icÚos']['‹mas/icÚos/'.
$icÚo
]) ) {

331 
$ru
 = 
$this
->
fich”os
['icÚos']['‹mas/icÚos/'.
$icÚo
];

333 iàĞ
	`is_fe
(
$ru
) ) {

334  
Rou‹r
::
$dœ
.
$ru
;

336  
FALSE
;

342  
FALSE
;

344 
	}
}

	@gcm/lib/int/temas/lib/TemaGcmTest.php

1 <?
php


2 
	g»quœe_Úû
 'PHPUnit/Framework.php';

4 
	g»quœe_Úû
 '/home/eduardo/SERVIDOR/subversion/gcm/trunk/gcm/modulos/temas/lib/TemaGcm.php';

10 şas 
	cTemaGcmTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£


15 
´Ùeùed
 
	m$objeù
;

21 
´Ùeùed
 
funùiÚ
 
	$£tUp
()

23 
$this
->
objeù
 = 
Ãw
 
TemaGcm
;

30 
´Ùeùed
 
funùiÚ
 
	$‹¬Down
()

32 
	}
}

37 
public
 
funùiÚ
 
	$‹¡_cÚ¡ruù
()

40 
$this
->
	`m¬kTe¡Incom¶‘e
(

43 
	}
}

48 
public
 
funùiÚ
 
	$‹¡Inşuœ_javasüt
()

51 
$this
->
	`m¬kTe¡Incom¶‘e
(

54 
	}
}

59 
public
 
funùiÚ
 
	$‹¡CŞÜ
()

62 
$this
->
	`m¬kTe¡Incom¶‘e
(

65 
	}
}

70 
public
 
funùiÚ
 
	$‹¡CÚ¡ruœ_css
()

73 
$this
->
	`m¬kTe¡Incom¶‘e
(

76 
	}
}

81 
public
 
funùiÚ
 
	$‹¡CÚ¡ruœ_js
()

84 
$this
->
	`m¬kTe¡Incom¶‘e
(

87 
	}
}

92 
public
 
funùiÚ
 
	$‹¡Ru
()

95 
$this
->
	`m¬kTe¡Incom¶‘e
(

98 
	}
}

103 
public
 
funùiÚ
 
	$‹¡DevŞv”_cŞÜes_çÉª‹s
()

106 
$this
->
	`m¬kTe¡Incom¶‘e
(

109 
	}
}

	@gcm/modulos/admin/config/config.php

1 <?
php


3 
	g$cÚfig
['Proyecto']='gcm';

4 
	g$cÚfig
['bd_conexion']='sqlite:DATOS/proyecto.db';

5 
	g$cÚfig
['bd_usuario'] = '';

6 
	g$cÚfig
['bd_pass']='';

7 
	g$cÚfig
['Sufijo…ara base de datos']='';

8 
	g$cÚfig
['Idioma…or defecto']='es';

9 
	g$cÚfig
['Palabra secreta…ara depurar']='debug';

10 
	g$cÚfig
['MÃ³dulos‡ctivados'][] = 'cache_http';

11 
	g$cÚfig
['MÃ³dulos‡ctivados'][] = 'comentarios';

12 
	g$cÚfig
['MÃ³dulos‡ctivados'][] = 'descargables';

13 
	g$cÚfig
['MÃ³dulos‡ctivados'][] = 'indexador';

14 
	g$cÚfig
['MÃ³dulos‡ctivados'][] = 'referencias';

15 
	g$cÚfig
['MÃ³dulos‡ctivados'][] = 'widgets';

17 
	g$cÚfig
['bd_conexion']='sqlite:DATOS/proyecto.db';

18 
	g$cÚfig
['bd_usuario'] = '';

19 
	g$cÚfig
['bd_pass']='';

20 
	g$cÚfig
['Sufijo…ara base de datos']='';

	@gcm/modulos/admin/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['Proyecto']='Dominio del…royecto';

3 
	g$cÚfig_DESC
['MÃ³dulos‡ctivados']='DesactivaciÃ³n de mÃ³dulos';

4 
	g$cÚfig_DESC
['Palabra secreta…ara depurar']='AÃ±adiendo†a…alabra seleccionada‡†a url (?<palabra_secreta>=1), se inicia sesiÃ³n de depuraciÃ³n, con un cero seermina';

6 
	g$cÚfig_DESC
['bd_conexion'] = 'ProducciÃ³n: Driver‡ usar…ara conexiÃ³n con base de datos (PDO). Ejemplos sqlite:/DATOS/proyecto.db o mysql:dbname=gcm';

7 
	g$cÚfig_DESC
['bd_usuario']='ProducciÃ³n: Usuario…araƒl servidor de base de datos,ƒn caso de utilizar sqlite‚oƒs‚ecesario';

8 
	g$cÚfig_DESC
['bd_pass']='ProducciÃ³n: ContraseÃ±a…ara servidor de base de datos,ƒn caso de sqlite‚oƒs‚ecesario';

9 
	g$cÚfig_DESC
['Sufijo…ara base de datos']='ProducciÃ³n: Nos…ermite diferenciar†asablas de†os diferentes…royectosƒn una misma base de datos';

	@gcm/modulos/admin/eventos_admin.php

1 <?
php


8 
	g$ev’tos
['menuadmin']['presentar_menu_administrativo'][1]='';

9 
	g$ev’tos
['infoserver']['infoserver'][1]='';

10 
	g$ev’tos
['test']['ejecutar_tests_modulos'][1]='';

14 
	g$ev’tos
['precarga']['activar_tema_admin'][1]='';

18 iàĞ! 
	g$gcm
->
cÚfig
('admin','configuracion_confirmada') ) {

20 
	g$ev’tos
['precontenido']['confirmar_configuracion'][1]='';

28 
	g$acciÚes
['admin']['presentar_menu_administrativo'][] = 'usuario';

29 
	g$acciÚes
['admin']['ejecutar_tests_modulos'][] = 'usuario';

30 
	g$acciÚes
['admin']['perfil_usuario'][] = 'usuario';

	@gcm/modulos/admin/eventos_usuario.php

1 <?
php


3 
	g$ev’tos
['menuadmin']['menuadmin_sin_login'][1]='';

4 
	g$ev’tos
['columna']['panel_login'][10]='';

5 
	g$ev’tos
['registro']['formulario_registro'][10]='';

	@gcm/modulos/admin/lib/Admin.php

1 <?
php


25 şas 
	cAdmš
 
ex‹nds
 
	mModulos
 {

27 
funùiÚ
 
	$__cÚ¡ruù
() {

29 
glob®
 
$gcm
;

31 
·»Á
::
	`__cÚ¡ruù
();

62 
funùiÚ
 
	$v®id¬_d©os
(
$aD©os
) {

64 
glob®
 
$gcm
;

66 
$v®e
 = 
TRUE
;

68 iàĞ
	`is£t
(
$aD©os
['usu¬io']è&& 
	`¡ros
($aDatos['usuario'],'javascript') ) {

69 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Este‚ombre de usuario‚oƒs…ermitido'),'ERROR');

70 
$v®e
 = 
NULL
;

73 iàĞ
	`is£t
(
$aD©os
['usu¬io']è&& 
	`¡ros
($aD©os['usu¬io'],'<?'è!=ğ
FALSE
 ) {

74 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Este‚ombre de usuario‚oƒs…ermitido'),'ERROR');

75 
$v®e
 = 
NULL
;

78 iàĞ
	`is£t
(
$aD©os
['pass']) && $aDatos['pass'] != $aDatos['pass2'] ) {

79 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('No coinciden†as contraseÃ±as'),'ERROR');

80 
$v®e
 = 
NULL
;

83 iàĞ
$v®e
 ) {

85  
$aD©os
;

89  
FALSE
;

93 
	}
}

99 
funùiÚ
 
	$ÿmbio_·sswÜd
(
$usu¬io_id
=
FALSE
) {

101 
glob®
 
$gcm
;

104 iàĞ! 
	`³rmiso
() ) {

105 
$usu¬io_id
 = 
$gcm
->
au
->
	`log—do
();

108 iàĞ! 
$usu¬io_id
 )  ;

111 <
fÜm
 
aùiÚ
="<?=$_SERVER['PHP_SELF'];?>" 
m‘hod
="post">

112 <?
php
 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('admin','html','form_cambio_pass.html')); ?>

113 <
šput
 
ty³
="hidd’" 
Çme
="a" 
v®ue
="ejecutar_cambio_password" />

114 <
šput
 
ty³
="hidd’" 
Çme
="m" 
v®ue
="admin" />

115 <
šput
 
ty³
="hidd’" 
Çme
="id" 
v®ue
="<?phpƒcho $usuario_id; ?>" />

116 </
fÜm
>

117 <?
php


119 
	}
}

125 
funùiÚ
 
	$ejecur_ÿmbio_·sswÜd
() {

127 
glob®
 
$gcm
;

129 
$usu¬io_id
 = 
	`is_num”ic
(
$_POST
['id'] );

132 iàĞ! 
	`³rmiso
(è&& 
$usu¬io_id
 !ğ
$gcm
->
au
->
	`log—do
())  ;

134 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/usuarios.php');

136 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

137 
$gcm
->
ev’t
->
	`unico
('titulo','admin');

138 
$gcm
->
t™ulo
 = 
	`l™”®
('Cambio de contraseÃ±a');

140 
$usu¬io
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
(), 
$usu¬io_id
);

142 
$»suÉado
 = 
$this
->
	`v®id¬_d©os
(
$_POST
);

144 iàĞ! 
$»suÉado
 ) {

145 
$this
->
	`ÿmbio_·sswÜd
();

146  
FALSE
;

149 
$usu¬io
->
	`£tPass_md5
(
	`md5
(
$»suÉado
['pass']));

150 
$usu¬io
->
	`§ve
();

152 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Usuario modificado'),'AVISO');

154 
$this
->
	`³rf_usu¬io
(
NULL
);

156 
	}
}

162 
funùiÚ
 
	$ge¡iÚ¬_usu¬io
(
$usu¬io_id
) {

164 
glob®
 
$gcm
;

167 iàĞ! 
	`³rmiso
(è&& 
$usu¬io_id
 !ğ
$gcm
->
au
->
	`log—do
())  ;

170 
$´e£Á¬_fÜm
 = 
TRUE
;

171 
$ªyadœ_usu¬io
 = 
FALSE
;

173 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/usuarios.php');

175 iàĞ
	`is£t
(
$_POST
['modificar'] ) ) {

177 
Œy
 {

179 
$usu¬io
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
(), 
$usu¬io_id
);

181 
$»suÉado
 = 
$this
->
	`v®id¬_d©os
(
$_POST
);

183 iàĞ
$»suÉado
 ) {

185 
$usu¬io
->
	`£tUsu¬io
(
$»suÉado
['usuario']);

186 
$usu¬io
->
	`£tNomb»
(
$»suÉado
['nombre']);

187 
$usu¬io
->
	`£tA³Îidos
(
$»suÉado
['apellidos']);

188 
$usu¬io
->
	`£tMa
(
$»suÉado
['mail']);

189 
$usu¬io
->
	`£tT–efÚo
(
$»suÉado
['telefono']);

190 
$usu¬io
->
	`£tFecha_modifiÿciÚ
(
	`d©e
('Y-m-d H:i'));

191 
$usu¬io
->
	`§ve
();

193 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Usuario modificado'),'AVISO');

197 
$»suÉado
 = 
$_POST
;

201 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
 ) {

203 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),$ex->
	`g‘Mes§ge
(),'AVISO');

208 } 
	`–£if
 ( 
	`is£t
(
$_POST
['borrar'] ) ) {

210 
$usu¬io
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
(), 
$_POST
['id']);

212 
$usu¬io
->
	`M¬kFÜD–‘iÚ
();

213 
$´e£Á¬_fÜm
 = 
FALSE
;

214 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Usuario borrado'),'AVISO');

216 } 
	`–£if
 ( 
	`is£t
(
$_POST
['anyadir'] ) ) {

218 
$ªyadœ_usu¬io
 = 
TRUE
;

220 } 
	`–£if
 ( 
	`is£t
(
$_POST
['insertar'] ) ) {

222 
$usu¬io
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
());

224 
$»suÉado
 = 
$this
->
	`v®id¬_d©os
(
$_POST
);

226 iàĞ
$»suÉado
 ) {

228 
$usu¬io
->
	`£tUsu¬io
(
$»suÉado
['usuario']);

229 
$usu¬io
->
	`£tPass_md5
(
	`md5
(
$»suÉado
['pass']));

230 
$usu¬io
->
	`£tNomb»
(
$»suÉado
['nombre']);

231 
$usu¬io
->
	`£tA³Îidos
(
$»suÉado
['apellidos']);

232 
$usu¬io
->
	`£tMa
(
$»suÉado
['mail']);

233 
$usu¬io
->
	`£tT–efÚo
(
$»suÉado
['telefono']);

234 
$usu¬io
->
	`§ve
();

235 
$»suÉado
['id'] = 
$usu¬io
->
	`uÉimo_id’tifiÿdÜ
();

237 
$gcm
->
au
->
	`š£¹¬_rŞ_usu¬io
(
$»suÉado
['id'],2);

239 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Usuario insertado'),'AVISO');

243 
$»suÉado
 = 
$_POST
;

250 
$usu¬io
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
(), 
$usu¬io_id
);

252 
$»suÉado
['id'] = 
$usu¬io
->
	`g‘ID
();

253 
$»suÉado
['usu¬io'] = 
$usu¬io
->
	`g‘Usu¬io
();

254 
$»suÉado
['nomb»'] = 
$usu¬io
->
	`g‘Nomb»
();

255 
$»suÉado
['­–lidos'] = 
$usu¬io
->
	`g‘A³Îidos
();

256 
$»suÉado
['ma'] = 
$usu¬io
->
	`g‘Ma
();

257 
$»suÉado
['‹ËfÚo'] = 
$usu¬io
->
	`g‘T–efÚo
();

262 <
¥ª
 
şass
="caja">

263 <
fÜm
 
aùiÚ
="<?=$_SERVER['PHP_SELF'];?>" 
m‘hod
="post">

264 <?
php
 iàĞ
$´e£Á¬_fÜm
 ) 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../html/form_perfil.html'); ?>

265 <
br
 />

266 <
šput
 
ty³
="hidd’" 
Çme
="id" 
v®ue
="<?=$resultado['id']?>" />

267 <
šput
 
ty³
="hidd’" 
Çme
="m" 
v®ue
="admin" />

268 <
šput
 
ty³
="hidd’" 
Çme
="a" 
v®ue
="usuarios" />

269 <?
php
 iàĞ
	`is£t
(
$»suÉado
['id']) ) { ?>

270 <
šput
 
ty³
='subm™' 
Çme
='modifiÿr' 
v®ue
='<?=literal("Modificar")?>' />

271 <
šput
 
ty³
='subm™' 
Çme
='bÜ¿r' 
v®ue
='<?=literal("Borrar")?>' />

272 <?
php
 } ?>

273 <?
php
 iàĞ
$ªyadœ_usu¬io
 ) { ?>

274 <
šput
 
ty³
='subm™' 
Çme
='š£¹¬' 
v®ue
='<?=literal("AÃ±adir")?>' />

275 <?
php
 } { ?>

276 <
šput
 
ty³
='subm™' 
Çme
='ªyadœ' 
v®ue
='<?=literal("AÃ±adir")?>' />

277 <?
php
 } ?>

278 <
br
 /><br />

279 </
fÜm
>

280 <
süt
 
Ïnguage
='javascript'>

281 
docum’t
.
	`g‘EËm’tById
('usu¬io').
	`focus
();

282 </
süt
>

283 </
¥ª
>

284 <?
php


286 
	}
}

315 
funùiÚ
 
	$´e£Á¬_m’u_admši¡¿tivo
() {

317 
glob®
 
$gcm
;

319 
$m’uAdmš
 = 
	`¬¿y
();

323 
$·th
=
GCM_DIR
."modulos/";

324 
$dœeùÜio_modulos
=
	`dœ
(
$·th
);

325 
$dœeùÜio
 = 
$dœeùÜio_modulos
->
	`»ad
()) {

326 iàĞ
$dœeùÜio
[0] !="." 
AND
 
	`is_dœ
(
$·th
.$directorio) ) {

327 
$fich_fš®
=
$·th
.
$dœeùÜio
.'/menuAdmin.php';

328 ià(
	`is_fe
(
$fich_fš®
)è
	`šşude
($fich_final);

332 
$·th
="modulos/";

333 iàĞ
	`fe_exi¡s
(
$·th
) ) {

334 
$dœeùÜio_modulos
=
	`dœ
(
$·th
);

335 
$dœeùÜio
 = 
$dœeùÜio_modulos
->
	`»ad
()) {

336 iàĞ
$dœeùÜio
[0] !="." 
AND
 
	`is_dœ
(
$·th
.$directorio) ) {

337 
$fich_fš®
=
$·th
.
$dœeùÜio
.'/menuAdmin.php';

338 ià(
	`is_fe
(
$fich_fš®
)è
	`šşude
($fich_final);

347 
$¬chivos_cÚfig
 = 
	`glob
(
GCM_DIR
.'modulos/*/config/config.php');

348 
	`fÜ—ch
 ( 
$¬chivos_cÚfig
 
as
 
$¬chivo
 ) {

350 
$¬¿y
 = 
	`ex¶ode
('/',
$¬chivo
);

351 
$modulo
 = 
$¬¿y
[
	`couÁ
($array)-3];

353 
$m’uAdmš
[
	`l™”®
('MÃ³dulos',3)]['bÙÚ'][l™”®(
$modulo
,3)]['activado']= 1;

354 
$m’uAdmš
[
	`l™”®
('MÃ³dulos',3)]['bÙÚ'][l™”®(
$modulo
,3)]['title']=literal("ConfiguraciÃ³n de ",3).literal($modulo,3);

355 
$m’uAdmš
[
	`l™”®
('MÃ³dulos',3)]['bÙÚ'][l™”®(
$modulo
,3)]['lšk']=
Rou‹r
::
$ba£
.$modulo."/configuracion";

362 
$¬chivos_cÚfig
 = 
	`glob
('modulos/*/config/config.php');

364 iàĞ! 
	`em±y
(
$¬chivos_cÚfig
) ) {

365 
	`fÜ—ch
 ( 
$¬chivos_cÚfig
 
as
 
$¬chivo
 ) {

367 
$¬¿y
 = 
	`ex¶ode
('/',
$¬chivo
);

368 
$modulo
 = 
$¬¿y
[
	`couÁ
($array)-3];

370 
$m’uAdmš
[
	`l™”®
('MÃ³dulos',3)]['bÙÚ'][l™”®(
$modulo
,3)]['activado']= 1;

371 
$m’uAdmš
[
	`l™”®
('MÃ³dulos',3)]['bÙÚ'][l™”®(
$modulo
,3)]['title']=literal("ConfiguraciÃ³n de ",3).literal($modulo,3);

372 
$m’uAdmš
[
	`l™”®
('MÃ³dulos',3)]['bÙÚ'][l™”®(
$modulo
,3)]['link']="?m=".$modulo."&a=configuracion";

379 
	`uasÜt
(
$m’uAdmš
, 'ordenar_por_peso');

381 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('admin','html','menuAdmin.html'));

382 
	}
}

388 
funùiÚ
 
	$m’uadmš_sš_logš
(
$e
, 
$¬gs
=
NULL
) {

390 
	}
}

397 
funùiÚ
 
	$·Ãl_logš
() {

399 
glob®
 
$gcm
;

401 ià(! 
$gcm
->
au
->
	`log—do
() ) {

402 
$·Ãl
 = 
	`¬¿y
();

403 
$·Ãl
['t™ulo'] = 
	`l™”®
('Administrar');

404 
$·Ãl
['ocuÉo'] = 
TRUE
;

405 
$·Ãl
['contenido'] =

407 <
br
 />'.literal("Usuario",3).':

408 <
br
 /><
šput
 
ty³
="‹xt" 
size
="10" 
Çme
="logšPro" 
id
="logšPro" 
v®ue
="" />

409 <
br
 />'.literal("ContraseÃ±a",3).':

410 <
br
 /><
šput
 
ty³
="·sswÜd" 
size
="10" 
Çme
="·sswd" 
id
="·sswd" 
v®ue
="" />

411 <
br
 /><br />

412 <
šput
 
ty³
="subm™" 
v®ue
="Entrar" />

413 </
fÜm
>';

415 
Temas
::
	`·Ãl
(
$·Ãl
);

418 
	}
}

429 
funùiÚ
 
	$fÜmuÏrio_»gi¡ro
(
$e
, 
$¬gs
=
NULL
) {

431 
glob®
 
$gcm
;

433 ià(! 
$gcm
->
au
->
	`log—do
() ) {

435 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

436 
$gcm
->
ev’t
->
	`unico
('titulo','admin');

437 
$gcm
->
t™ulo
 = 
	`l™”®
('Formulario deƒntrada');

440 
$fÜmuÏrio
 = '<form‚ame="entrada"‡ction="" method="post">

441 <
br
 />'.literal("Usuario",3).':

442 <
br
 /><
šput
 
ty³
="‹xt" 
size
="10" 
Çme
="logšPro" 
id
="logšPro" 
v®ue
="" />

443 <
br
 />'.literal("ContraseÃ±a",3).':

444 <
br
 /><
šput
 
ty³
="·sswÜd" 
size
="10" 
Çme
="·sswd" 
id
="·sswd" 
v®ue
="" />

445 <
br
 /><br />

446 <
šput
 
ty³
="subm™" 
v®ue
="Entrar" />

447 </
fÜm
>';

449 
echo
 
$fÜmuÏrio
;

452 
	}
}

465 
funùiÚ
 
	$³rf_usu¬io
(
$e
, 
$¬gs
=
FALSE
) {

467 
glob®
 
$gcm
;

469 
$usu¬io_id
 = ( 
$¬gs
 ) ? $¬g : 
$gcm
->
au
->
	`log—do
();

471 iàĞ
$usu¬io_id
 ) {

473 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

474 
$gcm
->
ev’t
->
	`unico
('titulo','admin');

475 
$gcm
->
t™ulo
 = 
	`l™”®
('Perfil de usuario');

477 
$this
->
	`ge¡iÚ¬_usu¬io
(
$usu¬io_id
);

479 
$this
->
	`ÿmbio_·sswÜd
();

483 
	}
}

494 
funùiÚ
 
	$cÚfœm¬_cÚfigu¿ciÚ
(
$e
, 
$¬gs
) {

496 
glob®
 
$gcm
;

498 
$usu¬io_id
 = 
$gcm
->
au
->
	`log—do
();

500 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/usuarios.php');

502 
Œy
 {

504 
$usu¬io
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
(), 
$usu¬io_id
);

506 iàĞ
$usu¬io
->
	`g‘Usu¬io
(è=ğ'admš' && $usu¬io->
	`g‘Pass_md5
(è=ğ
	`md5
('admin') ) {

508 
$aviso
 = 
	`l™”®
("Es‚ecesario modificar†os datos del‡dministrador…or seguridad");

510 iàĞ
	`em±y
(
$_POST
['·ss_md5']èè
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$aviso
,'AVISO');

512 
$usu¬ios
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
(),1);

513 
$usu¬ios
->
	`admši¡¿r
(
FALSE
,FALSE,FALSE,
TRUE
,'editar');

520 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

522 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),$ex->
	`g‘Mes§ge
());

526 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Sin usuario salimos'),'AVISO');

530 
	}
}

541 
funùiÚ
 
	$usu¬ios
(
$e
, 
$¬gs
) {

543 
glob®
 
$gcm
;

545 iàĞ
	`³rmiso
('administrar','admin') ) {

547 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

548 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

549 
$gcm
->
t™ulo
 = 
	`l™”®
('AdministraciÃ³n de usuarios');

551 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/usuarios.php');

552 
$usu¬ios
 = 
Ãw
 
	`Usu¬ios
(
$gcm
->
	`pdo_cÚexiÚ
());

553 
$usu¬ios
->
	`admši¡¿r
(
FALSE
,FALSE,FALSE,
TRUE
);

556 iàĞ
$usu¬ios
->
	`g‘ID
() ) {

557 
echo
'<br /><br />';

558 
echo
 '<h3>Roles de usuario</h3>';

559 
$this
->
	`rŞes_usu¬io
('š‹ºo', 
$usu¬ios
->
	`g‘ID
());

566 
$this
->
	`³rf_usu¬io
('interno');

570 
	}
}

576 
funùiÚ
 
	$rŞes_usu¬io
(
$e
, 
$¬gs
=
FALSE
) {

578 
glob®
 
$gcm
;

580 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

581 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

582 
$gcm
->
t™ulo
 = 
	`l™”®
('AdministraciÃ³n de„oles de usuarios');

584 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/usuarios.php');

586 
$cÚdiciÚ
 = ( 
$¬gs
 ) ? 'rur.usu¬ios_id = '.$¬g : 
FALSE
 ;

588 
$rŞes
 = 
Ãw
 
	`R_usu¬ios_rŞes
(
$gcm
->
	`pdo_cÚexiÚ
());

589 
$rŞes
->
	`admši¡¿r
(
$cÚdiciÚ
,
FALSE
,FALSE,
TRUE
);

590 
	}
}

607 
funùiÚ
 
	$šfo£rv”
(
$e
,
$¬gs
) {

609 
glob®
 
$gcm
;

611 
	`³rmiso
('admši¡¿r',
TRUE
);

613 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

614 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

616 
$gcm
->
t™ulo
 = "InformaciÃ³n de servidor";

619 <
¡yË
 
ty³
="text/css">

621 #phpšfØ
´e
 {}

622 #phpšfØ
a
:
lšk
 {}

623 #phpšfØ
a
:
hov”
 {}

624 #phpšfØ
bË
 {}

625 #phpšfØ.
ûÁ”
 {}

626 #phpšfØ.
ûÁ”
 
bË
 {}

627 #phpšfØ.
ûÁ”
 
th
 {}

628 #phpšfØ
td
, 
th
 {}

629 #phpšfØ
h1
 {}

630 #phpšfØ
h2
 {}

631 #phpšfØ.
p
 {}

632 #phpšfØ.
e
 {}

633 #phpšfØ.
h
 {}

634 #phpšfØ.
v
 {}

635 #phpšfØ.
vr
 {}

636 #phpšfØ
img
 {}

637 #phpšfØ
hr
 {}

638 </
¡yË
>

640 <
div
 
id
="phpinfo">

641 <?
php


643 
	`ob_¡¬t
 () ;

644 
	`phpšfo
 () ;

645 
$pšfo
 = 
	`ob_g‘_cÚ‹Ás
 () ;

646 
	`ob_’d_ş—n
 () ;

649 
	`echo
 ( 
	`¡r_»¶aû
 ( "moduË_Z’d O±imiz”", "moduË_Z’d_O±imiz”", 
	`´eg_»¶aû
 ( '%^.*<body>(.*)</body>.*$%ms', '$1', 
$pšfo
 ) ) ) ;

652 </
div
>

653 <?
php


654 
	}
}

665 
funùiÚ
 
	$ejecur_üÚ_modulos
(
$e
 = 
FALSE
, 
$¬gs
 = FALSE) {

667 
glob®
 
$gcm
;

669 
$modulos_aùivados
 = 
	`¬¿y_m”ge
(
$gcm
->
modulos_basicos
,$gcm->
	`cÚfig
('admin','MÃ³dulos‡ctivados'));

673 
echo
 '<tr /><h2>MÃ³dulos de gcm</h2>';

675 
	`fÜ—ch
 ( 
$modulos_aùivados
 
as
 
$modulo
 ) {

677 
$dœ_modulo
 = 
GCM_DIR
.'modulos/'.
$modulo
;

679 iàĞ! 
	`is_dœ
(
$dœ_modulo
) ) ;

681 
$şa£
 = 
	`ucfœ¡
(
$modulo
);

683 
$hay_admš
 = ( 
	`fe_exi¡s
(
$dœ_modulo
.'/lib/'.
$şa£
.'Admš.php'èè? 
TRUE
 : 
FALSE
 ;

686 iàĞ
$hay_admš
 ) {

687 
$şa£
 = 
	`ucfœ¡
(
$modulo
).'Admin';

688 
	`»quœe_Úû
(
$dœ_modulo
.'/lib/'.
$şa£
.'.php');

689 
$š¡ªcŸ
 = 
Ãw
 
	`$şa£
();

691 
	`»quœe_Úû
(
$dœ_modulo
.'/lib/'.
$şa£
.'.php');

692 
$š¡ªcŸ
 = 
Ãw
 
	`$şa£
();

695 ià(
	`m‘hod_exi¡s
(
$š¡ªcŸ
, 'cron') ) {

696 
echo
 '<b¸/><h3>'.
$modulo
.'</h3><br />';

697 
$š¡ªcŸ
->
	`üÚ
();

698 } 
	`–£if
 ( 
GCM_DEBUG
 ) {

699 
echo
 '<b¸/><h3>'.
$modulo
.'</h3><br />';

700 
echo
 'Sin mÃ©todo cron';

706 
echo
 '<tr /><h2>MÃ³dulos de…royecto</h2>';

708 
	`fÜ—ch
 ( 
	`glob
('modulos/*'è
as
 
$dœ_modulo
 ) {

710 iàĞ! 
	`is_dœ
(
$dœ_modulo
) ) ;

712 
$modulo
 = 
	`ba£Çme
(
$dœ_modulo
);

713 
$şa£
 = 
	`ucfœ¡
(
$modulo
);

714 
	`»quœe_Úû
(
$dœ_modulo
.'/lib/'.
$şa£
.'.php');

715 
$š¡ªcŸ
 = 
Ãw
 
	`$şa£
();

716 
echo
 '<b¸/><h3>'.
$modulo
.'</h3><br />';

717 ià(
	`m‘hod_exi¡s
(
$š¡ªcŸ
, 'üÚ'è&& 
$modulo
 != 'admin' ) {

718 
$š¡ªcŸ
->
	`üÚ
();

720 
echo
 'Sin mÃ©todo cron';

724 
	}
}

	@gcm/modulos/admin/lib/AdminAdmin.php

1 <?
php


10 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/Admin.php');

18 şas 
	cAdmšAdmš
 
ex‹nds
 
	mAdmš
 {

20 
funùiÚ
 
	$__cÚ¡ruù
() {

21 
·»Á
::
	`__cÚ¡ruù
();

31 
funùiÚ
 
	$aùiv¬_‹ma_admš
(
$e
, 
$¬gs
=
FALSE
) {

33 
glob®
 
$gcm
;

35 iàĞ
Rou‹r
::
$m
 && Rou‹r::
$a
 == 'configuracion' ) {

37 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Seleccionamosema…ara‡dministraciÃ³n');

38 
$gcm
->
‹ma
 = 'admin';

42 
	}
}

48 
funùiÚ
 
	$‹¡
() {

50 
	`³rmiso
('admši¡¿r',
TRUE
);

52 
glob®
 
$gcm
;

54 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

55 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

57 
$gcm
->
t™ulo
 = '<h1>Testeando…royecto</h1>';

60 
$£cciÚes
 = 
	`glob
(
Rou‹r
::
$dd
.'*/*html');

61 iàĞ! 
	`is£t
(
$£cciÚes
[0]) ) {

62 
echo
 '<div class="aviso">Sin una secciÃ³n‚o…odemos comprobar</div>';

65 
$cÚ‹nido
 = 
	`ba£Çme
(
$£cciÚes
[0]);

66 
$£cciÚ
 = 
	`ba£Çme
(
	`dœÇme
(
$£cciÚes
[0]));

68 iàĞ! 
	`em±y
(
$£cciÚ
) ) {

70 
$u¾
 = 'busÿr/·Ïb¿_a_busÿr/'.
$£cciÚ
.'/'.
$cÚ‹nido
;

71 
$rou‹r
 = 
Rou‹r
::
	`desglo§rU¾
(
$u¾
);

73 
echo
 '<b¸/>'.
$u¾
.'<br />';

75 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸u¾',
$rou‹r
['u¾'],
$£cciÚ
.'/'.
$cÚ‹nido
);

76 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸s',
$rou‹r
['s'],
$£cciÚ
.'/');

77 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸c',
$rou‹r
['c'],
$cÚ‹nido
);

78 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸dd',
$rou‹r
['dd'],'File/es/');

79 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸d',
$rou‹r
['d'],'File/es/');

80 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸ii',
$rou‹r
['ii'],'es');

81 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸i',
$rou‹r
['i'],'es');

82 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸a',
$rou‹r
['a'],
NULL
);

83 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸m',
$rou‹r
['m'],
NULL
);

84 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸¬gs',
$rou‹r
['¬gs'],
	`¬¿y
('palabra_a_buscar'));

85 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸e',
$rou‹r
['e'],'buscar');

86 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸’Ïû_»Ïtivo', 
$rou‹r
['enlace_relativo'],'./');

87 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸mime/ty³',
$rou‹r
['mime_type'],'text/html');

88 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸fÜm©o',
$rou‹r
['formato'],'html');

94 
$£cciÚes
 = 
	`glob
(
Rou‹r
::
$dd
.'*.html');

96 iàĞ! 
	`is£t
(
$£cciÚes
[0]) ) {

97 
echo
 '<div class="aviso">Sin un contenido creado‚o…odemos comprobar</div>';

100 
$cÚ‹nido
 = 
	`ba£Çme
(
$£cciÚes
[0]);

102 iàĞ! 
	`em±y
(
$cÚ‹nido
) ) {

104 
$u¾
 = 'ÿ/ajax/cÚ‹nidos/bÜ¿r/12/28/'.
$cÚ‹nido
;

105 
$rou‹r
 = 
Rou‹r
::
	`desglo§rU¾
(
$u¾
);

107 
echo
 '<b¸/>'.
$u¾
.'<br />';

109 
$this
->
	`ejecu_‹¡
('V”fiÿ¸u¾',
$rou‹r
['u¾'],
$cÚ‹nido
);

110 
$this
->
	`ejecu_‹¡
('V”fiÿ¸s',
$rou‹r
['s'],'');

111 
$this
->
	`ejecu_‹¡
('V”fiÿ¸c',
$rou‹r
['c'],
$cÚ‹nido
);

112 
$this
->
	`ejecu_‹¡
('V”fiÿ¸dd',
$rou‹r
['dd'],'File/es/');

113 
$this
->
	`ejecu_‹¡
('V”fiÿ¸d',
$rou‹r
['d'],'File/es/');

114 
$this
->
	`ejecu_‹¡
('V”fiÿ¸ii',
$rou‹r
['ii'],'es');

115 
$this
->
	`ejecu_‹¡
('V”fiÿ¸i',
$rou‹r
['i'],'ca');

116 
$this
->
	`ejecu_‹¡
('V”fiÿ¸a',
$rou‹r
['a'],'borrar');

117 
$this
->
	`ejecu_‹¡
('V”fiÿ¸m',
$rou‹r
['m'],'contenidos');

118 
$this
->
	`ejecu_‹¡
('V”fiÿ¸¬gs',
$rou‹r
['¬gs'],
	`¬¿y
('12','28'));

119 
$this
->
	`ejecu_‹¡
('V”fiÿ¸e',
$rou‹r
['e'],
NULL
);

120 
$this
->
	`ejecu_‹¡
('V”fiÿ¸’Ïû_»Ïtivo', 
$rou‹r
['enlace_relativo'],'./');

121 
$this
->
	`ejecu_‹¡
('V”fiÿ¸mime/ty³',
$rou‹r
['mime_type'],'text/html');

122 
$this
->
	`ejecu_‹¡
('V”fiÿ¸fÜm©o',
$rou‹r
['formato'],'ajax');

128 
$u¾
 = 'ca/ajax/buscar/literal/';

129 
$rou‹r
 = 
Rou‹r
::
	`desglo§rU¾
(
$u¾
);

131 
echo
 '<p>'.
$u¾
.'</p>';

133 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸u¾',
$rou‹r
['url'],'');

134 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸s',
$rou‹r
['s'],'');

135 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸c',
$rou‹r
['c'],'');

136 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸dd',
$rou‹r
['dd'],'File/es/');

137 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸d',
$rou‹r
['d'],'File/es/');

138 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸ii',
$rou‹r
['ii'],'es');

139 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸i',
$rou‹r
['i'],'ca');

140 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸a',
$rou‹r
['e'],'buscar');

141 
$this
->
	`ejecu_‹¡
('V”ifiÿ¸¬gs',
$rou‹r
['¬gs'],
	`¬¿y
('literal'));

143 
	}
}

154 
funùiÚ
 
	$ejecur_‹¡s_modulos
(
$e
 = 
FALSE
, 
$¬gs
 = FALSE) {

156 
glob®
 
$gcm
;

158 
$modulos_aùivados
 = 
	`¬¿y_m”ge
(
$gcm
->
modulos_basicos
,$gcm->
	`cÚfig
('admin','MÃ³dulos‡ctivados'));

162 
echo
 '<tr /><h2>MÃ³dulos de gcm</h2>';

164 
	`fÜ—ch
 ( 
$modulos_aùivados
 
as
 
$modulo
 ) {

166 
$dœ_modulo
 = 
GCM_DIR
.'modulos/'.
$modulo
;

168 iàĞ! 
	`is_dœ
(
$dœ_modulo
) ) ;

170 
$şa£
 = 
	`ucfœ¡
(
$modulo
);

172 
$hay_admš
 = ( 
	`fe_exi¡s
(
$dœ_modulo
.'/lib/'.
$şa£
.'Admš.php'èè? 
TRUE
 : 
FALSE
 ;

175 iàĞ
$hay_admš
 ) {

176 
$şa£
 = 
	`ucfœ¡
(
$modulo
).'Admin';

177 
	`»quœe_Úû
(
$dœ_modulo
.'/lib/'.
$şa£
.'.php');

178 
$š¡ªcŸ
 = 
Ãw
 
	`$şa£
();

180 
	`»quœe_Úû
(
$dœ_modulo
.'/lib/'.
$şa£
.'.php');

181 
$š¡ªcŸ
 = 
Ãw
 
	`$şa£
();

184 ià(
	`m‘hod_exi¡s
(
$š¡ªcŸ
, 'test') ) {

185 
echo
 '<b¸/><h3>'.
$modulo
.'</h3><br />';

186 
$š¡ªcŸ
->
	`‹¡
();

187 } 
	`–£if
 ( 
GCM_DEBUG
 ) {

188 
echo
 '<b¸/><h3>'.
$modulo
.'</h3><br />';

189 
echo
 'Sinests‡sociados';

195 
echo
 '<tr /><h2>MÃ³dulos de…royecto</h2>';

197 
	`fÜ—ch
 ( 
	`glob
('modulos/*'è
as
 
$dœ_modulo
 ) {

199 iàĞ! 
	`is_dœ
(
$dœ_modulo
) ) ;

201 
$modulo
 = 
	`ba£Çme
(
$dœ_modulo
);

202 
$şa£
 = 
	`ucfœ¡
(
$modulo
);

203 
	`»quœe_Úû
(
$dœ_modulo
.'/lib/'.
$şa£
.'.php');

204 
$š¡ªcŸ
 = 
Ãw
 
	`$şa£
();

205 
echo
 '<b¸/><h3>'.
$modulo
.'</h3><br />';

206 ià(
	`m‘hod_exi¡s
(
$š¡ªcŸ
, '‹¡'è&& 
$modulo
 != 'admin' ) {

207 
$š¡ªcŸ
->
	`‹¡
();

209 
echo
 'Sinests‡sociados';

213 
	}
}

219 
funùiÚ
 
	$cÚfigu¿r_cÚexiÚes
(
$e
, 
$¬gs
=
NULL
) {

221 
glob®
 
$gcm
;

223 
	`³rmiso
('admši¡¿r',
TRUE
);

225 
$gcm
->
‹ma
 = 'admin';

226 
$gcm
->
¶ªtÏ
 = 'administrando.html';

228 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

229 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

231 
$gcm
->
t™ulo
 = 'Visualizar conexiones';

233 
$u¾
 = 'h‰p://'.
$_SERVER
['HTTP_HOST'].
	`dœÇme
($_SERVER['PHP_SELF']).'/?eVisualizar';

235 
echo
 '<p id="ver_plantilla"><a id="boton_ver_plantilla" class="boton" href="?eVisualizar=1" onclick="ver_plantilla();return false;">Ver…lantilla</a></p>';

238 <
süt
>

239 
funùiÚ
 
	`v”_¶ªtÏ
() {

241 
v¬
 
cÚ‹ÃdÜ
 = 
	`$
('p#ver_plantilla');

242 
v¬
 
u¾
 = 
	`$
('a#bÙÚ_v”_¶ªtÏ').
	`©Œ
("href");

243 
cÚ‹ÃdÜ
.
	`html
("Cargando...");

245 
$
.
	`g‘
(
u¾
,
	`funùiÚ
(
d©a
){

246 
cÚ‹ÃdÜ
.
	`»¶aûW™h
(
d©a
);

248  
çl£
;

250 </
süt
>

251 <?
php


253 
	}
}

263 
funùiÚ
 
	$ed™¬_cÚexiÚ
(
$e
,
$¬gs
=
NULL
) {

265 
glob®
 
$gcm
;

267 
$diff_usu¬io
 = 
FALSE
;

268 
$diff_admš
 = 
FALSE
;

270 
$modulo
 = 
$_GET
['md'];

272 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

273 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

275 
$gcm
->
t™ulo
 = 'CÚexiÚe d'.
$modulo
;

277 
$fich”o_usu¬io
 = 'DATOS/ev’tos/'.
$modulo
.'/eventos_usuario.php';

278 
$fich”o_admš
 = 'DATOS/ev’tos/'.
$modulo
.'/eventos_admin.php';

280 
$fich”o_usu¬io_modulo
 = 
$gcm
->
ev’t
->
ubiÿciÚes
[
$modulo
].'/eventos_usuario.php';

281 
$fich”o_admš_modulo
 = 
$gcm
->
ev’t
->
ubiÿciÚes
[
$modulo
].'/eventos_admin.php';

283 
$cÚ‹nido_usu¬io_modulo
 = 
FALSE
;

284 
$cÚ‹nido_admš_modulo
 = 
FALSE
;

286 iàĞ
	`fe_exi¡s
(
$fich”o_usu¬io
) ) {

287 
$cÚ‹nido_usu¬io
 = 
	`fe_g‘_cÚ‹Ás
(
$fich”o_usu¬io
);

288 
$cÚ‹nido_usu¬io_modulo
 = 
	`fe_g‘_cÚ‹Ás
(
$fich”o_usu¬io_modulo
);

289 iàĞ
$cÚ‹nido_usu¬io
 !ğ
$cÚ‹nido_usu¬io_modulo
 ) 
$diff_usu¬io
 = 
TRUE
;

291 
$cÚ‹nido_usu¬io
 = 
	`fe_g‘_cÚ‹Ás
(
$fich”o_usu¬io_modulo
);

294 iàĞ
	`fe_exi¡s
(
$fich”o_admš
) ) {

295 
$cÚ‹nido_admš
 = 
	`fe_g‘_cÚ‹Ás
(
$fich”o_admš
);

296 
$cÚ‹nido_admš_modulo
 = 
	`fe_g‘_cÚ‹Ás
(
$fich”o_admš_modulo
);

297 iàĞ
$cÚ‹nido_admš
 !ğ
$cÚ‹nido_admš_modulo
è
$diff_admš
 = 
TRUE
;

299 iàĞ
	`fe_exi¡s
(
$fich”o_admš_modulo
) ) {

300 
$cÚ‹nido_admš
 = 
	`fe_g‘_cÚ‹Ás
(
$fich”o_admš_modulo
);

302 
$cÚ‹nido_admš
 = 
FALSE
;

307 <
fÜm
 
aùiÚ
="<?ƒchØ$_SERVER['SCRIPT_NAME'] ?>" 
m‘hod
="post">

308 <
f›ld£t
>

309 <
Ëg’d
 
acûsskey
="s">
Ev’tos
 
·¿
 
usu¬io
</legend>

310 <?
php
 iàĞ! 
$diff_usu¬io
 ) 
echo
 '<div class="aviso">Sin diferencias con†a versiÃ³n…or defecto</div>'; ?>

311 <
‹x»a
 
Çme
="cÚ‹nido" 
¡yË
="width:100%;height:300px"><?=
$cÚ‹nido_usu¬io
?></textarea>

312 <
br
 /><br />

313 <
šput
 
ty³
="hidd’" 
Çme
="m" 
v®ue
="admin">

314 <
šput
 
ty³
="hidd’" 
Çme
="a" 
v®ue
="modificar_conexion">

315 <
šput
 
ty³
="hidd’" 
Çme
="modulo" 
v®ue
="<?=$modulo?>">

316 <
šput
 
ty³
="hidd’" 
Çme
="to" 
v®ue
="usuario">

317 <
f›ld£t
>

318 <
šput
 
ty³
='subm™' 
v®ue
='<?ö™”®('
Gu¬d¬
')?>' />

319 </
f›ld£t
>

320 <?
php


321 iàĞ
$cÚ‹nido_usu¬io
 !ğ
$cÚ‹nido_usu¬io_modulo
 ) {

323 <
br
 />
CÚ‹nido
 
´ed‘”mšado
 
d–
 
m
Ã³
dulo


324 <
‹x»a
 
¡yË
="width:100%;height:300px"><?=
$cÚ‹nido_usu¬io_modulo
?></textarea>

325 <?
php


328 </
f›ld£t
>

329 </
fÜm
>

330 <?
php


332 iàĞ
$cÚ‹nido_admš
 ) {

336 <
fÜm
 
aùiÚ
="<?ƒchØ$_SERVER['SCRIPT_NAME'] ?>" 
m‘hod
="post">

337 <
f›ld£t
>

338 <
Ëg’d
 
acûsskey
="s">
Ev’tos
 
·¿
 
admši¡¿ci
Ã³
n
</legend>

339 <?
php
 iàĞ! 
$diff_admš
 ) 
echo
 '<div class="aviso">Sin diferencias con†a versiÃ³n…or defecto</div>'; ?>

340 <
‹x»a
 
Çme
="cÚ‹nido" 
¡yË
="width:100%;height:300px"><?=
$cÚ‹nido_admš
?></textarea>

341 <
br
 /><br />

342 <
šput
 
ty³
="hidd’" 
Çme
="m" 
v®ue
="admin">

343 <
šput
 
ty³
="hidd’" 
Çme
="a" 
v®ue
="modificar_conexion">

344 <
šput
 
ty³
="hidd’" 
Çme
="modulo" 
v®ue
="<?=$modulo?>">

345 <
šput
 
ty³
="hidd’" 
Çme
="to" 
v®ue
="admin">

346 <
f›ld£t
>

347 <
šput
 
ty³
='subm™' 
v®ue
='<?ö™”®('
Gu¬d¬
')?>' />

348 </
f›ld£t
>

349 <?
php


350 iàĞ
$cÚ‹nido_admš
 !ğ
$cÚ‹nido_admš_modulo
 ) {

352 <
br
 />
CÚ‹nido
 
´ed‘”mšado
 
d–
 
m
Ã³
dulo


353 <
‹x»a
 
¡yË
="width:100%;height:300px"><?=
$cÚ‹nido_admš_modulo
?></textarea>

354 <?
php


357 </
f›ld£t
>

358 </
fÜm
>

359 <?
php


362 
	}
}

372 
funùiÚ
 
	$modifiÿr_cÚexiÚ
(
$e
,
$¬gs
=
NULL
) {

374 
glob®
 
$gcm
;

376 
	`³rmiso
('admši¡¿r',
TRUE
);

378 
$modulo
 = 
$_POST
['modulo'];

379 
$to
 = 
$_POST
['tipo'];

380 
$cÚ‹nido
 = 
	`¡rc¦ashes
(
$_POST
['contenido']);

382 
$fich”o
 = 'DATOS/ev’tos/'.
$modulo
.'/ev’tos_'.
$to
.'.php';

384 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

385 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

387 
$gcm
->
t™ulo
 = 'Gu¬d¬ '.
$modulo
.'o: '.
$to
;

389 iàĞ
	`fe_put_cÚ‹Ás
(
$fich”o
, 
$cÚ‹nido
) ) {

390 
echo
 '<°şass="ok">'.
$fich”o
.' modifcado</p>';

392 
echo
 'No se…udo„ealizar‡ctualizaciÃ³n';

395 
	}
}

402 
funùiÚ
 
	$rŞes
(
$e
, 
$¬gs
 = 
FALSE
) {

404 
glob®
 
$gcm
;

406 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','admin');

407 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','admin');

408 
$gcm
->
t™ulo
 = 
	`l™”®
('Roles');

410 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/usuarios.php');

411 
$usu¬ios
 = 
Ãw
 
	`RŞes
(
$gcm
->
	`pdo_cÚexiÚ
());

412 
$usu¬ios
->
	`admši¡¿r
(
FALSE
,FALSE,FALSE,
TRUE
);

414 
	}
}

	@gcm/modulos/admin/menuAdmin.php

1 <?
	gphp


5 
	g$usu¬io
 = 
$_SESSION
[
$gcm
->
sufijo
.'usuario'];

7 
	g$m’uAdmš2
[
$usu¬io
]['boton']['Editar…erfil']['activado']= 1;

8 
	g$m’uAdmš2
[
$usu¬io
]['boton']['Editar…erfil']['title']="Editar informaciÃ³n de usuario";

9 
	g$m’uAdmš2
[
$usu¬io
]['bÙÚ']['Ed™¬…”f']['lšk']=
dœÇme
(
$_SERVER
['PHP_SELF'])."/admin/perfil_usuario";

11 
	g$m’uAdmš2
['Salir']['title']="Cerrar sessiÃ³n";

12 
	g$m’uAdmš2
['Salir']['link']='./?salir=1';

14 iàĞ
³rmiso
('test','admin') ) {

16 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Tests']['activado']= 1;

17 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Tests']['title']="Ejecutarests";

18 
	g$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['Te¡s']['lšk']=
dœÇme
(
$_SERVER
['PHP_SELF'])."/test";

22 iàĞ
	$³rmiso
() ) {

24 
$m’uAdmš
['AdministraciÃ³n']['boton']['Roles']['activado']= 1;

25 
$m’uAdmš
['AdministraciÃ³n']['boton']['Roles']['title']="AdministraciÃ³n de„oles";

26 
$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['RŞes']['lšk']=
	`dœÇme
(
$_SERVER
['PHP_SELF'])."/admin/roles/";

28 
$m’uAdmš
['AdministraciÃ³n']['boton']['Usuarios']['activado']= 1;

29 
$m’uAdmš
['AdministraciÃ³n']['boton']['Usuarios']['title']="AdministraciÃ³n de usuarios";

30 
$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['Usu¬ios']['lšk']=
	`dœÇme
(
$_SERVER
['PHP_SELF'])."/admin/usuarios/";

32 
$m’uAdmš
['AdministraciÃ³n']['boton']['Info server']['activado']= 1;

33 
$m’uAdmš
['AdministraciÃ³n']['boton']['Info server']['title']="InformaciÃ³n de servidor";

34 
$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['InfØ£rv”']['lšk']=
	`dœÇme
(
$_SERVER
['PHP_SELF'])."/admin/infoserver";

36 
$m’uAdmš
['AdministraciÃ³n']['boton']['Visualizar conexiones']['activado']= 1;

37 
$m’uAdmš
['AdministraciÃ³n']['boton']['Visualizar conexiones']['title']="Visualizar conexionesƒntre Eventos y mÃ³dulos";

38 
$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['Visu®iz¬ cÚexiÚes']['lšk']=
	`dœÇme
(
$_SERVER
['PHP_SELF'])."/admin/configurar_conexiones";

40 
	}
}

	@gcm/modulos/admin/modelos/usuarios.php

1 <?
php


8 
»quœe_Úû
(
GCM_DIR
.'lib/int/databoundobject/lib/Crud.php');

21 şas 
	cUsu¬ios
 
ex‹nds
 
	mCrud
 {

23 
funùiÚ
 
	$DefšeTabËName
() {

25 
glob®
 
$gcm
;

27  
$gcm
->
au
->
sufijo
.'usuarios';

30 
funùiÚ
 
	$__cÚ¡ruù
(
PDO
 
$objPDO
, 
$id
=
NULL
) {

32 
glob®
 
$gcm
;

34 
$this
->
sql_li¡ado
 = 'SELECT u.id, u.usu¬io, u.nomb»,u.­–lidos, fecha_modifiÿciÚ‡ modifiÿciÃ³ÀFROM '.
$gcm
->
au
->
sufijo
.'usuarios u';

36 
$this
->
ev’to_gu¬d¬
 = 'rol_minimo';

38 
·»Á
::
	`__cÚ¡ruù
(
$objPDO
, 
$id
);

40 
	}
}

48 
funùiÚ
 
	$rŞ_mšimo
(
$id
) {

50 
glob®
 
$gcm
;

52 
$gcm
->
au
->
	`š£¹¬_rŞ_usu¬io
(
$id
,2);

54 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'AÃ±adimos„ol "usuario"','AVISO');

56 
	}
}

64 şas 
	cRŞes
 
ex‹nds
 
	mCrud
 {

66 
funùiÚ
 
	$li¡ado_·¿_£Ëù
() {

67  
$this
->
	`fšd
(
NULL
,
	`¬¿y
('id', 'nombre'),'id');

71 
funùiÚ
 
	$DefšeTabËName
() {

73 
glob®
 
$gcm
;

75  
$gcm
->
au
->
sufijo
.'roles';

76 
	}
}

84 şas 
	cR_usu¬ios_rŞes
 
ex‹nds
 
	mCrud
 {

86 
funùiÚ
 
	$__cÚ¡ruù
(
PDO
 
$objPDO
, 
$id
=
NULL
) {

88 
glob®
 
$gcm
;

90 
$this
->
to_bÏ
 = 'combinatoria';

92 
$this
->
sql_li¡ado
 = "

93 
SELECT
 
	`CONCAT
(
rur
.
usu¬ios_id
,',',rur.
rŞes_id
è
as
 
id
, 
u
.
nomb»
 
AS
 
usu¬io
, 
r
.nomb» AS 
rŞ


94 
FROM
 ".$gcm->sufijo."
r_usu¬ios_rŞes
 
rur


95 
LEFT
 
JOIN
 ".$gcm->sufijo."
usu¬ios
 
u
 
ON
 u.
id
=
rur
.
usu¬ios_id


96 
LEFT
 
JOIN
 ".$gcm->sufijo."
rŞes
 
r
 
ON
„.
id
=
rur
.
rŞes_id
";

98 
$this
->
İciÚes_¬¿y2bË
 = 
	`¬¿y
(

100 'İ' => 
	`¬¿y
 (

101 'ocuÉ¬_id'=>
TRUE


102 ,'u¾'=>
Rou‹r
::
$ba£
.'admin/roles_usuario?gmas_r_usuarios_roles_id='

104 , '’Ïûs'=> 
	`¬¿y
(

105 'u¾' => 
	`¬¿y
(

108 ,'ba£_u¾'=>
Rou‹r
::
$ba£
.'/admin/roles_usuario/'

114 
·»Á
::
	`__cÚ¡ruù
(
$objPDO
, 
$id
);

118 
funùiÚ
 
	$DefšeTabËName
() {

120 
glob®
 
$gcm
;

122  
$gcm
->
au
->
sufijo
.'r_usuarios_roles';

123 
	}
}

125 
funùiÚ
 
	$DefšeR–©iÚM­
(
$pdo
) {

127 
$»tÜno
['usuarios_id,roles_id'] = 'ID';

129  
$»tÜno
;

131 
	}
}

	@gcm/modulos/aplicar_SEO/eventos_admin.php

1 <?
php


30 
	g$ev’tos
['seo']['seo'][1] = "";

	@gcm/modulos/aplicar_SEO/eventos_usuario.php

1 <?
	gphp


	@gcm/modulos/aplicar_SEO/lib/Aplicar_SEO.php

1 <?
php


28 şas 
	cA¶iÿr_SEO
 
ex‹nds
 
	mModulos
 {

32 
funùiÚ
 
	$__cÚ¡ruù
() {

34 
·»Á
::
	`__cÚ¡ruù
();

38 
funùiÚ
 
	$£o
(
$e
, 
$¬gs
=
FALSE
) {

40 
glob®
 
$gcm
;

42 
$u¾
 = 
	`¡r_»¶aû
('£o','',
$_SERVER
['HTTP_REFERER']);

44 
$t™ulo
 = 'SEO';

45 
$cÚ‹nido
 = '

46 <
p
>

47 
P’d›Áe
 
de
 
haûr
 
que
 
e¡e
 
m
Ã³
dulo
 
com´uebe
 
y
 
ayude
 
a
 
‹Ãr
 
lo
 
Ãû§rio
 
·¿
 
un
 
bu’


48 
posiciÚamš‘o
.

49 </
p
>

51 
InfÜmaci
Ã³
n
 
sob»
 
SEO
 
’


52 <
a
 
h»f
="http://mamedu.com/dev/gcm/proyecto/Documentacion/SEO.html">

53 
h‰p
:

54 </
a
>

56 <
br
 /><br />

57 <
h2
>
H”¿mš‘as
</h2>

58 <
br
 />

59 <
a
 
h»f
="h‰ps://dev–İ”s.googË.com/¥“d/·ge¥“d/šsights#u¾='.$u¾.'&mobe=çl£" >
Te¡
 
de
 
v–ocidad
</a>

60 <
br
 /><br />

64 
$gcm
->
cÚ‹nido
 = 
$cÚ‹nido
;

65 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','aplicar_SEO');

66 
$gcm
->
t™ulo
 = 
$t™ulo
;

67 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','aplicar_SEO');

70 
	}
}

	@gcm/modulos/aplicar_SEO/menuAdmin.php

1 <?
	gphp


	@gcm/modulos/cache_http/eventos_admin.php

1 <?
	gphp


	@gcm/modulos/cache_http/eventos_usuario.php

1 <?
php


29 
	g$ev’tos
['precarga']['alInicio'][1] = '';

30 
	g$ev’tos
['postcarga']['alFinal'][1] = '';

31 
	g$ev’tos
['borrar_cache']['borrar'][1] = 'todo';

	@gcm/modulos/cache_http/lib/Cache_http.php

1 <?
php


31 şas 
	cCache_h‰p
 
ex‹nds
 
	mModulos
 {

37 
´iv©e
 
	m$dœ_ÿche
;

45 
´iv©e
 
	m$du¿ciÚ
;

51 
´iv©e
 
	m$du¿ciÚ_v¬ŸbËs
 = 3000 ;

57 
´iv©e
 
	m$¬chivo_ÿche
;

63 
´iv©e
 
	m$ex‹nsiÚ
 = '.cache';

67 
funùiÚ
 
	$__cÚ¡ruù
() {

69 
·»Á
::
	`__cÚ¡ruù
();

71 
$this
->
dœ_ÿche
 = 'cache/';

72 
$this
->
du¿ciÚ
 = 60*60*2;

74 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ_ÿche
) ) {

75 iàĞ! 
	`mkdœ
(
$this
->
dœ_ÿche
) ) {

76 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'No se…udo crear directorio…ara cache','ERROR');

82 
funùiÚ
 
	$‹¡
() {

84 
$this
->
	`ejecu_‹¡
('DœeùÜiØ·¿ cache: '.$this->
dœ_ÿche
, 
	`fe_exi¡s
($this->dœ_ÿche), 
TRUE
);

85 
$this
->
	`ejecu_‹¡
('P”miso ddœeùÜio: '.$this->
dœ_ÿche
,
	`is_»adabË
($this->dœ_ÿche), 
TRUE
);

87 
	}
}

103 
funùiÚ
 
	$®Inicio
() {

105 
glob®
 
$gcm
;

108 iàĞ
$gcm
->
au
->
	`log—do
(èè
$this
->
	`javasüts
('cache_http.js');

110 iàĞ
$gcm
->
au
->
	`log—do
() ) {

111 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'() En modo debug‚o cacheamos');

115 iàĞ
GCM_DEBUG
 ) {

116 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'() En modo debug‚o cacheamos');

120 iàĞ
	`is£t
(
$_SESSION
[
$gcm
->
sufijo
.'registros']) ) {

121 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'() Conƒrrores o‡visos‚o cacheamos');

125 
	`»quœe_Úû
(
GCM_DIR
.'lib/ext/detectar_navegador/browser_class_inc.php');

127 
$b
 = 
Ãw
 
	`brow£r
();

128 
$bb
 = 
$b
->
	`wh©Brow£r
();

130 
$ÇvegadÜ
 = 
$bb
['browsertype'];

131 
$v”siÚ
 = 
$bb
['version'];

132 
$¶©afÜma
 = 
$bb
['platform'];

134 
$u¾
 = 
$_SERVER
['HTTP_HOST'].$_SERVER['REQUEST_URI'];

136 
$sŞic™ud
 = 
	`¬¿y
 ('u¾' => 
$u¾
, 
$_POST
, 
$_GET
);

138 
$aBa£Çme
 = 
	`ex¶ode
('?',
$u¾
);

139 
$aDœÇme
 = 
	`ex¶ode
('?',
$u¾
);

140 
$ba£Çme
 = 
	`ba£Çme
(
$aBa£Çme
[0]);

141 
$dœÇme
 = 
$this
->
dœ_ÿche
.
	`dœÇme
(
$aDœÇme
[0]);

142 
	`mkdœ_»cursivo
(
$dœÇme
);

144 
$this
->
¬chivo_ÿche
 = 
$dœÇme
.'/'.
$ba£Çme
.'_'.

145 
$¶©afÜma
.'_'.
$ÇvegadÜ
.'_'.
$v”siÚ
.'_'.

146 
	`md5
(
	`£rŸlize
(
$sŞic™ud
)).
$this
->
ex‹nsiÚ
;

148 ià(@
	`fe_exi¡s
(
$this
->
¬chivo_ÿche
)) {

149 
$ãcha_ÿche
 = @
	`femtime
(
$this
->
¬chivo_ÿche
);

151 
$ãcha_ÿche
 = 0;

155 @
	`ş—r¡©ÿche
();

158 ià(
	`time
(è- 
$this
->
du¿ciÚ
 < 
$ãcha_ÿche
) {

159 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'ArchivØ’ cache: '.
$this
->
¬chivo_ÿche
,'ADMIN');

161 
$aExt
 = 
	`ex¶ode
('.',
Rou‹r
::
$u¾
);

162 
$ext
 = 
	`’d
(
$aExt
);

163 
$ext
) {

165 
	`h—d”
('Content-Type:ext/css');

166 
$§lida
 = "\n".'/* ArchivØ’ cach'.
$this
->
¬chivo_ÿche
.' */'."\n";

169 
	`h—d”
('Content-Type:ext/javascript');

170 
$§lida
 = "\n".'/* ArchivØ’ cach'.
$this
->
¬chivo_ÿche
.' */'."\n";

173 
$§lida
 = "\n".'<!-- ArchivØ’ cach'.
$this
->
¬chivo_ÿche
.' -->'."\n";

176 
	`»adfe
(
$this
->
¬chivo_ÿche
);

177 
echo
 
$§lida
;

178 
	`ex™
();

183 
	}
}

194 
funùiÚ
 
	$®Fš®
() {

196 
glob®
 
$gcm
;

198 iàĞ
	`is£t
(
$_SESSION
[
$gcm
->
sufijo
.'»gi¡ros']è|| $gcm->
»g
->
	`”rÜes
(è|| $gcm->
au
->
	`log—do
(è|| 
GCM_DEBUG
 ) ;

200 
$§lida
 = 
$gcm
->
§lida
;

203 iàĞ
	`em±y
(
$gcm
->
§lida
) ) ;

205 iàĞ
	`em±y
(
$this
->
¬chivo_ÿche
) ) ;

208 
$å
 = 
	`fİ’
(
$this
->
¬chivo_ÿche
, "w");

210 iàĞ
$å
 ) {

213 @
	`fwr™e
(
$å
, 
$§lida
);

214 @
	`fşo£
(
$å
);

218 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(èArchivØgu¬dadØ’ cache: '.
$this
->
¬chivo_ÿche
);

219 
	}
}

231 
funùiÚ
 
	$bÜ¿r
(
$e
, 
$¬gs
) {

233 
glob®
 
$gcm
;

235 iàĞ
$¬gs
 !ğ'todo' && !
	`em±y
($args) ) {

236 
$u¾
 = 
	`¡r_»¶aû
('/','_',
$¬gs
);

237 
$¬chivos
 = 
	`glob
(
$this
->
dœ_ÿche
.'*'.
$u¾
.'*');

239 
$¬chivos
 = 
	`glob
(
$this
->
dœ_ÿche
.'*');

240 iàĞ
	`funùiÚ_exi¡s
('­c_ş—r_ÿche'èè
	`­c_ş—r_ÿche
();

243 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

244 
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'èArchivo ¨bÜ¿r: '.d•u¿r(
$¬chivos
));

246 iàĞ!
	`is£t
(
$¬chivos
è|| 
	`em±y
($archivos) ) {

249 
	`ex™
();

250 
$gcm
->
	`§lœ
();

253 
	`fÜ—ch
 ( 
$¬chivos
 
as
 
$¬chivo
 ) {

254 iàĞ
	`is_dœ
(
$¬chivo
) ) {

255 
	`rmdœ_»cursivo
(
$¬chivo
);

257 @
	`uÆšk
(
$¬chivo
);

261 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Archivo bÜ¿do ’ cache: '.
	`couÁ
(
$¬chivos
));

265 iàĞ
$e
 == 'borrar_cache' ) {

268 
	`ex™
();

269 
$gcm
->
	`§lœ
();

272 
	}
}

286 
funùiÚ
 
	$»cu³¿r_v¬ŸbË
(
$nomb»_v¬ŸbË
, 
$t›mpo_expœaciÚ
=
NULL
) {

288 
$t›mpo_expœaciÚ
 = ( $t›mpo_expœaciÚ ) ? $t›mpo_expœaciÚ : 
$this
->
du¿ciÚ_v¬ŸbËs
;

290 iàĞ
	`funùiÚ_exi¡s
('apc_fetch') ) {

291 
$»tÜno
 = 
	`­c_ãtch
(
$nomb»_v¬ŸbË
);

292 iàĞ
$»tÜno
 )  $retorno;

295 
$¬chivo_v¬ŸbË
 = 
$this
->
dœ_ÿche
.
$nomb»_v¬ŸbË
.$this->
ex‹nsiÚ
;

297 ià(@
	`fe_exi¡s
(
$¬chivo_v¬ŸbË
)) {

298 
$ãcha_ÿche
 = @
	`femtime
(
$¬chivo_v¬ŸbË
);

300 
$ãcha_ÿche
 = 0;

304 @
	`ş—r¡©ÿche
();

307 ià(
	`time
(è- 
$t›mpo_expœaciÚ
 < 
$ãcha_ÿche
) {

308 
$cÚ‹nido
 = 
	`fe_g‘_cÚ‹Ás
(
$¬chivo_v¬ŸbË
);

309 
$»tÜno
 = 
	`un£rŸlize
(
$cÚ‹nido
);

310 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Recu³¿mo v¬ŸbËƒÀÿch['.
$nomb»_v¬ŸbË
.'] '."\n".
	`d•u¿r
(
$»tÜno
));

311  
$»tÜno
;

314  
FALSE
;

316 
	}
}

322 
funùiÚ
 
	$gu¬d¬_v¬ŸbË
(
$nomb»_v¬ŸbË
,
$v®Ü
) {

324 iàĞ
	`funùiÚ_exi¡s
('­c_add'èè 
	`­c_add
(
$nomb»_v¬ŸbË
, 
$v®Ü
);

326 
$¬chivo_v¬ŸbË
 = 
$this
->
dœ_ÿche
.
$nomb»_v¬ŸbË
.$this->
ex‹nsiÚ
;

328 
$å
 = @
	`fİ’
(
$¬chivo_v¬ŸbË
, "w");

329 @
	`fwr™e
(
$å
, 
	`£rŸlize
(
$v®Ü
));

330 @
	`fşo£
(
$å
);

332 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Gu¬damo v¬ŸbËƒÀÿch['.
$nomb»_v¬ŸbË
.'] '."\n".
	`d•u¿r
(
$v®Ü
));

333 
	}
}

	@gcm/modulos/cache_http/menuAdmin.php

1 <?
php


31 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Borrar cache']['activado']= 1;

32 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Borrar cache']['title']="Borrar cache";

33 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Borrar cache']['link'] =

34 "javasüt:³dœD©os(\"".
Rou‹r
::
$dœ
."ajax/borrar_cache\",\"respuesta_borrar_cache\");";

	@gcm/modulos/comentarios/config/config.php

1 <?
php


15 
	g$cÚfig
['mod”aciÃ³n'] = 
Œue
;

	@gcm/modulos/comentarios/config/config_es.php

1 <?
php


11 
	g$cÚfig_DESC
['moderaciÃ³n'] = 'Si‡ctivamos†a moderaciÃ³n de comentarios, soloƒstaran disponibles cuandoƒl moderador de su visto bueno';

	@gcm/modulos/comentarios/eventos_admin.php

1 <?
	gphp


	@gcm/modulos/comentarios/eventos_usuario.php

1 <?
php


12 
	g$ev’tos
['columna']['ultimos'][6]='';

15 
	g$ev’tos
['postcontenido']['presentar_comentarios'][3]='';

18 
	g$ev’tos
['postcontenido']['formulario'][4]='';

21 
	g$ev’tos
['modifiÿr_com’rio']['modifiÿr'][1] = ( 
is£t
(
$_REQUEST
['id']èè? $_REQUEST['id'] : 
NULL
 ;

	@gcm/modulos/comentarios/lib/Comentarios.php

1 <?
php


32 şas 
	cCom’rios
 
ex‹nds
 
	mModulos
 {

34 
´Ùeùed
 
	m$pdo
 = 
NULL
;

35 
´Ùeùed
 
	m$´efijo
 = 
NULL
;

36 
´Ùeùed
 
	m$bÏ
 = 
NULL
;

37 
´Ùeùed
 
	m$to_ba£_d©os
 ;

39 
´iv©e
 
	m$mod”aciÚ
;

45 
´iv©e
 
	m$ÿrgado_javasüt
 = 
FALSE
;

49 
funùiÚ
 
	$__cÚ¡ruù
() {

51 
glob®
 
$gcm
;

53 
$this
->
pdo
 = 
$gcm
->
	`pdo_cÚexiÚ
();

54 
$this
->
´efijo
 = 
$gcm
->
sufijo
;

55 
$this
->
bÏ
 = $this->
´efijo
.'comentarios';

57 
$this
->
to_ba£_d©os
 = $this->
pdo
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

61 
$SQL
 = 'SELECT COUNT(*èFROM '.
$this
->
bÏ
;

63 iàĞ!
$this
->
pdo
 ) {  
FALSE
; }

65 
Œy
 {

67 
$¡h
 = 
$this
->
pdo
->
	`´•¬e
(
$SQL
);

68 
$¡h
->
	`execu‹
();

70 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

72 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'() Creamosabla comentarios');

73 
$this
->
	`g’”¬TabÏCom’rios
($this->
pdo
);

77 
·»Á
::
	`__cÚ¡ruù
();

79 
$this
->
mod”aciÚ
 = $this->
	`cÚfig
('moderaciÃ³n');

91 
funùiÚ
 
	$uÉimos
(
$e
, 
$¬gs
=
NULL
) {

93 
glob®
 
$gcm
;

95 
$num_™ems_df
 = 5;

97 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
$¬gs
);

99 
$num
 = ( 
	`is£t
(
$·¿m‘ros
['num']èè? $·¿m‘ros['num'] : 
$num_™ems_df
 ;

101 iàĞ!
$this
->
pdo
 ) {  
FALSE
; }

103 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmPDO/lib/paginarPDO.php');

105 
$SQL
 = "SELECT fecha_ü—ciÚ,‚omb», u¾, cÚ‹nido, com’rio,‡ùivado, usu¬ios_id FROM ".
$this
->
bÏ
;

106 iàĞ
$this
->
mod”aciÚ
 && ! 
	`³rmiso
('moderacion_comentarios') )

107 
$SQL
 .ğ" WHERE (‡ùivadØğ1 OR usu¬ios_id = '".
	`£ssiÚ_id
()."')";

109 
$SQL
 .= " ORDER BY fecha_creacion desc";

111 
$pd
 = 
Ãw
 
	`Pagš¬PDO
(
$this
->
pdo
, 
$SQL
, 'uÉ_', 
$num
);

113 iàĞ
$pd
->
	`v®id¬
() ) {

115 
	`ob_¡¬t
();

116 
$pd
->
¶ªtÏ_»suÉados
=
	`dœÇme
(
__FILE__
).'/../html/ultimos.html';

117 
$pd
->
	`·gša
();

118 
$§lida
 = 
	`ob_g‘_cÚ‹Ás
();

119 
	`ob_’d_ş—n
();

120 iàĞ
$§lida
 ) {

121 
$·Ãl
 = 
	`¬¿y
();

122 
$·Ãl
['t™ulo'] = 
	`l™”®
('Ãšltimos comentarios');

123 
$·Ãl
['cÚ‹nido'] =
$§lida
;

124 
Temas
::
	`·Ãl
(
$·Ãl
);

131 
	}
}

142 
funùiÚ
 
	$com´ob¬_³rmisos
(
$autÜ_id
=
FALSE
) {

144 
glob®
 
$gcm
;

146 iàĞ
	`³rmiso
('mod”¬_com’rios'èè 
TRUE
 ;

148 iàĞ
$autÜ_id
 && $autÜ_id =ğ
$gcm
->
au
->
	`id
(èè 
TRUE
;

150 iàĞ
$autÜ_id
 && $autÜ_id =ğ
	`£siÚ
('autÜ_com’rio'èè 
TRUE
;

152  
FALSE
 ;

154 
	}
}

161 
funùiÚ
 
	$´e£Á¬_com’rios
(
$e
, 
$¬gs
=
NULL
) {

163 
glob®
 
$gcm
;

165 
$num_™ems_df
 = 5;

167 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
$¬gs
);

169 
$num
 = ( 
	`is£t
(
$·¿m‘ros
['num']èè? $·¿m‘ros['num'] : 
$num_™ems_df
 ;

172 
$this
->
	`javasüts
('comentarios.js');

174 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmPDO/lib/paginarPDO.php');

176 
$SQL
 = "SELECT id, fecha_creacion,‚ombre, url, contenido, comentario,‡ctivado, usuarios_id

177 
FROM
 ".$this->bÏ." 
WHERE
 
u¾
='".Router::$url."'";

181 iàĞ
$this
->
mod”aciÚ
 && ! 
	`³rmiso
('moderacion_comentarios') )

182 
$SQL
 .ğ" AND (‡ùivadØğ1 OR usu¬ios_id = '".
	`£ssiÚ_id
()."')";

184 
$SQL
 .= " ORDER BY fecha_creacion desc";

186 
$pd
 = 
Ãw
 
	`Pagš¬PDO
(
$this
->
pdo
, 
$SQL
, 'comentarios_');

188 iàĞ
$pd
->
	`v®id¬
() ) {

190 
$pd
->
–em’tos_·gša
=
$num
;

191 
$pd
->
¶ªtÏ_»suÉados
=
	`dœÇme
(
__FILE__
).'/../html/listado.html';

192 iàĞ
Rou‹r
::
$fÜm©o
 !ğ'ajax' ) 
echo
 '<h2>Comentarios</h2>';

193 
$pd
->
	`g’”¬_·gša
('&m=comentarios&a=presentar_comentarios&formato=ajax');

196 
	}
}

203 
funùiÚ
 
	$fÜmuÏrio
(
$e
, 
$¬gs
=
NULL
) {

205 
glob®
 
$gcm
;

209 iàĞ!
$this
->
ÿrgado_javasüt
 && 
Rou‹r
::
$fÜm©o
 != 'ajax') {

210 
$this
->
ÿrgado_javasüt
 = 
TRUE
;

211 
echo
 '<süˆty³="javasüt" src="'.
Rou‹r
::
$dœ
.
GCM_DIR
.'lib/ext/tiny_mce/tiny_mce.js"></script>';

214 
	`šşude_Úû
(
GCM_DIR
.'lib/int/captcha/captcha.php');

216 
$id
 = 
$¬gs
;

217 
$acciÚ
 = (
$id
) ? 'ejecutar_modificar_comentario' : 'verificar_entrada';

219 iàĞ
Rou‹r
::
$c
 && Router::$c !== 'index.html' ) {

222 
$usu¬io
 = 
FALSE
;

223 
$ma
 = 
FALSE
;

224 
$‹xto
 = 
FALSE
;

226 iàĞ
$e
 == 'modificar_comentario' ) {

228 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/comentarios_dbo.php');

230 
$com’rio
 = 
Ãw
 
	`Com’rios_dbo
(
$this
->
pdo
, 
$id
);

231 
$usu¬io
 = 
$com’rio
->
	`g‘Nomb»
();

232 
$ma
 = 
$com’rio
->
	`g‘Ma
();

233 
$‹xto
 = 
$com’rio
->
	`g‘Com’rio
();

234 
$id_u£r
 = 
$com’rio
->
	`g‘Usu¬ios_id
();

236 iàĞ! 
	`³rmiso
('mod”¬_com’rios'è&& 
$id_u£r
 !ğ
	`£ssiÚ_id
() )  ;

238 
$t™ulo
 = 
	`l™”®
('Modificar comentario');

239 
$ocuÉ¬
 = 
FALSE
;

243 
$t™ulo
 = 
	`l™”®
('AÃ±adir comentario');

244 
$ocuÉ¬
 = 
TRUE
;

248 
	`ob_¡¬t
();

249 
echo
 "<div id='fÜm_com_".
Rou‹r
::
$u¾
."' class='form_comentario' style='label: AÃ±adir comentario;'>\n";

250 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('comentarios','html','form_comentario.html'));

251 
echo
 "</div>\n";

255 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

257 <
süt
 
ty³
="text/javascript">

258 <?
php
 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('comentarios','js','editorweb.js')); ?>

259 </
süt
>

260 <?
php


263 <
süt
 
Ïnguage
="javasüt" 
ty³
="text/javascript"

264 
¤c
="<?ph°echØGCM_DIR_P ?>lib/ext/tšy_mû/tšy_mû.js"></
süt
>

265 <?
php


266 
$this
->
	`javasüts
('editorweb.js');

269 
$§lida
 = 
	`ob_g‘_cÚ‹Ás
();

270 
	`ob_’d_ş—n
();

272 
$·Ãl
 = 
	`¬¿y
();

273 
$·Ãl
['t™ulo'] = 
$t™ulo
;

274 
$·Ãl
['cÚ‹nido'] = 
$§lida
;

275 
$·Ãl
['ocuÉo'] = 
$ocuÉ¬
;

276 
Temas
::
	`·Ãl
(
$·Ãl
);

278 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

280 <
süt
 
ty³
="text/javascript">

281 
	`$
(".sub·Ãl_ocuÉo").
	`hide
(3000);

282 
	`·ÃËs
();

283 </
süt
>

284 <?
php


287 
	}
}

293 
funùiÚ
 
	$g’”¬TabÏCom’rios
() {

295 
glob®
 
$gcm
;

297 
$this
->
to_ba£_d©os
) {

301 
$m’s
="creamos†aabla de comentarios";

302 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(è'.
$m’s
);

303 
$SQL
="CREATE TABLE ".
$this
->
bÏ
." (

304 
id
 
INTEGER
 
PRIMARY
 
KEY
 ,

305 
u¾
 
	`CHAR
(150) ,

306 
ãcha_ü—ciÚ
 
TIME
 
NOT
 
NULL
 
DEFAULT
 
CURRENT_TIMESTAMP
 ,

307 
nomb»
 
	`CHAR
(60) ,

308 
ma
 
	`CHAR
(60) ,

309 
cÚ‹nido
 
	`CHAR
(100),

310 
com’rio
 
	`CHAR
(500),

311 
aùivado
 
INTEGER
,

312 
·d»
 
INTEGER
,

313 
usu¬ios_id
 
	`CHAR
(40)

316 iàĞ! 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

318 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(èERROR‡Èü—¸bÏ '.
$this
->
bÏ
.' '.
$pdo_”rÜ
,'ERROR');

319  
FALSE
;

322 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(èSüeØÏabÏ '.
$this
->
bÏ
 );

323  
TRUE
;

330 
$m’s
="creamos†aabla de comentarios";

331 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(è'.
$m’s
);

332 
$SQL
="CREATE TABLE ".
$this
->
bÏ
." (

333 
id
 
MEDIUMINT
 
NOT
 
NULL
 
AUTO_INCREMENT
 ,

334 
u¾
 
	`CHAR
(150) ,

335 
ãcha_ü—ciÚ
 
TIMESTAMP
 
NOT
 
NULL
 
DEFAULT
 
CURRENT_TIMESTAMP
,

336 
nomb»
 
	`CHAR
(60) ,

337 
ma
 
	`CHAR
(60) ,

338 
cÚ‹nido
 
	`CHAR
(100),

339 
com’rio
 
TEXT
,

340 
aùivado
 
TINYINT
,

341 
·d»
 
MEDIUMINT
,

342 
usu¬ios_id
 
	`CHAR
(40),

343 
PRIMARY
 
	`KEY
 (
id
)

346 iàĞ! 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

348 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(èERROR‡Èü—¸bÏ '.
$this
->
bÏ
.' '.
$pdo_”rÜ
,'ERROR');

349  
FALSE
;

352 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'(èSüeØÏabÏ '.
$this
->
bÏ
 );

353  
TRUE
;

359 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'EÈdriv” ['.
$driv”
.']…ara†a base de datos‚oƒstÃ¡ soportado','ERROR');

364 
	}
}

372 
funùiÚ
 
	$v®id¬_d©os
(
$aD©os
) {

374 
$·§_com’rios
 = 
TRUE
;

377 
$gs_aû±ados
 = '<br><p><u>,<li>,<ul>,<em>,<strike>,<strong>,<blockquote>,<ol>';

379 iàĞ
	`em±y
(
$aD©os
['texto']) ) {

380 
$·§_com’rios
 = 
FALSE
;

381 
$m’s
 = 
	`l™”®
('Campo de comentario vacio',3);

382 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

385 
$aD©os
['‹xto'] = 
	`¡r_gs
($aD©os['‹xto'], 
$gs_aû±ados
);

387 iàĞ
	`em±y
(
$aD©os
['texto']) ) {

388 
$·§_com’rios
 = 
FALSE
;

389 
$m’s
 = 
	`l™”®
('Campo de comentario conƒtiquetas‚o…ermitidas',3);

390 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

393 iàĞ
	`em±y
(
$aD©os
['usu¬io']è|| ! 
	`is£t
($aDatos['usuario']) ) {

394 
$·§_com’rios
 = 
FALSE
;

395 
$m’s
=
	`l™”®
("Se‚ecesita un‚ombre de usuario");

396 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

399 iàĞ
	`em±y
(
$aD©os
['‹xto']è|| ! 
	`is£t
($aDatos['texto']) ) {

400 
$·§_com’rios
 = 
FALSE
;

401 
$m’s
=
	`l™”®
("No hay contenidoƒnƒl comentario");

402 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

405 iàĞ! 
$·§_com’rios
 )  
FALSE
;

407  
$aD©os
;

409 
	}
}

415 
funùiÚ
 
	$v”ifiÿr_’Œada
(
$e
, 
$¬gs
=
NULL
) {

417 
glob®
 
$gcm
;

423 
$m’s
="AÃ±adir‚uevo comentario";

424 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'è'.
$m’s
);

428 
	`šşude_Úû
(
GCM_DIR
.'lib/int/captcha/captcha.php');

430 iàĞ! 
	`v”ifiÿrC­tcha
(4) ) {

431 
$m’s
 = 
	`l™”®
('No se…udo‡Ã±adir comentario. ');

432 
$m’s
 .ğ
	`l™”®
('Si‚oƒstas haciendo spam…uedesƒnviar un correo‡l‡utor');

433 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

434  
FALSE
;

437 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/comentarios_dbo.php');

439 
$com’rio
 = 
Ãw
 
	`Com’rios_dbo
(
$this
->
pdo
);

441 
$»suÉado
 = 
$this
->
	`v®id¬_d©os
(
$_POST
);

443 iàĞ
$»suÉado
 ) {

445 
$com’rio
->
	`£tNomb»
(
$»suÉado
['usuario']);

446 
$com’rio
->
	`£tMa
(
$»suÉado
['mail']);

447 
$com’rio
->
	`£tU¾
(
Rou‹r
::
$s
.Rou‹r::
$c
);

448 
$com’rio
->
	`£tCÚ‹nido
(
	`¡r_»¶aû
('.html','',
Rou‹r
::
$c
));

449 
$com’rio
->
	`£tCom’rio
(
$»suÉado
['texto']);

450 iàĞ
$gcm
->
au
->
	`id
() ) {

451 
$com’rio
->
	`£tAùivado
(1);

452 
$com’rio
->
	`£tUsu¬ios_id
(
$gcm
->
au
->
	`id
());

454 
$com’rio
->
	`£tUsu¬ios_id
(
	`£ssiÚ_id
());

456 
$com’rio
->
	`§ve
();

457 
$»suÉado
['id'] = 
$com’rio
->
	`uÉimo_id’tifiÿdÜ
();

459 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Comentario insertado'),'AVISO');

463 
$¬gs
['cu”po'] = "<h1>".
	`l™”®
(
Rou‹r
::
$c
)."</h1>";

464 
$¬gs
['cuerpo'] = "\n";

465 
$¬gs
['cu”po'] .ğ"\n<b¸/>Usu¬io: <b>".
$»suÉado
['usuario']."</b>";

466 
$¬gs
['cu”po'] .ğ"\n<b¸/>Ma: <b>".
$»suÉado
['mail']."</b>";

467 
$¬gs
['cuerpo'] .= "\n<br />Texto: ";

468 
$¬gs
['cu”po'] .ğ"\n<b>".
$»suÉado
['texto']."</b>";

469 
$¬gs
['cuerpo'] .= "\n<br />";

470 
$¬gs
['cu”po'] .ğ"\n<¨h»f='".
$_SERVER
['HTTP_REFERER']."'>Ir‡ƒntrada</a>";

471 
$¬gs
['cuerpo'] .= "\n<br />";

472 
$¬gs
['cu”po'] .ğ"\n<b¸/><em>I°dusu¬io: ".
	`mo¡¿r_
()."</em>";

474 
$¬gs
['asunto'] = 'Comentario‡Ã±adido';

476 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('’vioma','’vŸr_ema','com’rio_aÃ±adido',
$¬gs
);

477 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','com’rio_š£¹ado',
Rou‹r
::
$u¾
);

481 
	}
}

487 
funùiÚ
 
	$–imš¬
(
$e
, 
$¬gs
=
NULL
) {

490 iàĞ! 
	`³rmiso
('mod”¬_com’rios'è&& 
$fa
->
usu¬ios_id
 !ğ
	`£ssiÚ_id
() )  ;

492 
glob®
 
$gcm
;

494 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/comentarios_dbo.php');

496 iàĞ!
	`em±y
(
$¬gs
è&& 
	`is_¬¿y
($args) ) {

497 
$id
 = 
$¬gs
[0] ;

498 } 
	`–£if
 ( !
	`em±y
(
$¬gs
è&& ! 
	`is_¬¿y
($args) ) {

499 
$id
 = 
$¬gs
 ;

500 } 
	`–£if
 ( !
	`em±y
(
Rou‹r
::
$¬gs
) ) {

501 
$id
 = 
Rou‹r
::
$¬gs
[0];

503 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).') Sin identificaor‚o se…uede borrar comentario','ERROR');

504 
echo
 "FALSE";

505 
	`ex™
();

508 
$com’rio
 = 
Ãw
 
	`Com’rios_dbo
(
$this
->
pdo
, 
$id
);

509 
$com’rio
->
	`M¬kFÜD–‘iÚ
();

510 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','com’rio_–imšado',
Rou‹r
::
$s
.Rou‹r::
$c
);

511 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

512 
echo
 
$id
;

513 
	`ex™
();

515 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Comentario borrado'),'AVISO');

518 
	}
}

524 
funùiÚ
 
	$modifiÿr
(
$e
, 
$¬gs
=
NULL
) {

526 
glob®
 
$gcm
;

528 
$id
 = 
$¬gs
;

529 
$this
->
	`fÜmuÏrio
('modifiÿr_com’rio',
$id
);

531 
	}
}

537 
funùiÚ
 
	$ejecur_modifiÿr_com’rio
(
$e
, 
$¬gs
=
NULL
) {

539 
glob®
 
$gcm
;

541 
$m’s
="Modificar comentario";

542 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'è'.
$m’s
);

544 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/comentarios_dbo.php');

546 
$»suÉado
 = 
$this
->
	`v®id¬_d©os
(
$_POST
);

548 iàĞ
	`is£t
(
$»suÉado
['id']) ) {

550 
$com’rio
 = 
Ãw
 
	`Com’rios_dbo
(
$this
->
pdo
, 
$»suÉado
['id']);

552 iàĞ! 
	`³rmiso
('mod”¬_com’rios'è&& 
$com’rio
->
	`g‘Usu¬ios_id
(è!ğ
	`£ssiÚ_id
() ) {

553 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'AcciÃ³n‚o…ermitida','ERROR');

557 iàĞ
$»suÉado
 ) {

559 
$com’rio
->
	`£tNomb»
(
$»suÉado
['usuario']);

560 
$com’rio
->
	`£tMa
(
$»suÉado
['mail']);

561 
$com’rio
->
	`£tCom’rio
(
$»suÉado
['texto']);

562 
$com’rio
->
	`§ve
();

564 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Comentario Modificado'),'AVISO');

566 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','com’rio_modifiÿdo',
Rou‹r
::
$u¾
);

571 
$m’s
=
	`l™”®
("Sin Identificador‚o se…uede borrar comentario",3);

572 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'è'.
$m’s
);

577 
	}
}

	@gcm/modulos/comentarios/lib/ComentariosAdmin.php

1 <?
php


8 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/Comentarios.php');

9 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/Comentarios.php');

18 şas 
	cCom’riosAdmš
 
ex‹nds
 
	mCom’rios
 {

22 
funùiÚ
 
	$__cÚ¡ruù
() {

24 
·»Á
::
	`__cÚ¡ruù
();

32 
funùiÚ
 
	$li¡¬
(
$e
, 
$¬gs
) {

34 
glob®
 
$gcm
;

36 
	`³rmiso
('moderar_comentarios');

38 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenido');

39 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenido');

41 iàĞ
	`is£t
(
$_GET
['accion']) && $_GET['accion'] == 'eliminar' ) {

42 
$this
->
	`–imš¬
('š‹ºo',
$_GET
['comentario']);

45 
$gcm
->
t™ulo
 = 
	`l™”®
('Listado de comentarios',3);

47 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/comentarios_dbo.php');

49 
$com’rios
 = 
Ãw
 
	`Com’rios_dbo
(
$this
->
pdo
, 
$¬gs
['id']);

51 
$this
->
cÚf_·gšadÜ
 = 
	`¬¿y
 ('url'=>'?comentario='

57 , 'ocuÉ¬_id'=>
TRUE


60 , '’Ïûs'=> 
	`¬¿y
('url' =>‡rray('campo_enlazado'=>'contenido'

62 ,'ba£_u¾'=>
Rou‹r
::
$ba£


67 
$com’rios
->
	`admši¡¿r
(
FALSE
,'ãcha_ü—ciÚ desc',FALSE,
TRUE
);

71 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/array2table/lib/Array2table.php');

72 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmPDO/lib/GcmPDO.php');

74 
$cÚdiciÚ
 = ( 
$¬gs
['id'] ) ? " AND c.id=".$args['id'] : '';

77 
$sql
 = 'SELECT c.id,c. fecha_creacion `fecha creaciÃ³n`,

78 
c
.
u¾
, c.
cÚ‹nido
 ,

79 
c
.
nomb»
, c.
ma
, c.
com’rio


80 
FROM
 '.$this->bÏ.' 
c
 
ORDER
 
BY
 c.
ãcha_ü—ciÚ
 
desc
';

82 
$gcmpdo
 = 
Ãw
 
	`GcmPDO
(
$this
->
pdo
, 
$sql
);

83 
$¬¿y
 = 
$gcmpdo
->
	`to_¬¿y
();

84 
$İciÚes
 = 
	`¬¿y
 ('url'=>'?comentario='

90 , 'ocuÉ¬_id'=>
TRUE


93 , '’Ïûs'=> 
	`¬¿y
('url' =>‡rray('campo_enlazado'=>'contenido'

95 ,'ba£_u¾'=>
Rou‹r
::
$ba£


101 iàĞ
$gcmpdo
->
	`v®id¬
() ) {

102 
$¬¿y2bË
 = 
Ãw
 
	`A¼ay2bË
();

103 
$¬¿y2bË
->
	`g’”¬_bÏ
(
$¬¿y
, 
$İciÚes
);

105 
echo
 
	`l™”®
('No hay comentarios…ara†istar');

110 
	}
}

116 
funùiÚ
 
	$aùiv¬
(
$e
, 
$¬gs
) {

118 iàĞ! 
	`³rmiso
('moderar_comentarios') )  ;

120 
glob®
 
$gcm
;

122 
	`»quœe_Úû
(
	`dœÇme
(
__FILE__
).'/../modelos/comentarios_dbo.php');

124 iàĞ!
	`em±y
(
$¬gs
è&& 
	`is_¬¿y
($args) ) {

125 
$id
 = 
$¬gs
[0] ;

126 } 
	`–£if
 ( !
	`em±y
(
$¬gs
è&& ! 
	`is_¬¿y
($args) ) {

127 
$id
 = 
$¬gs
 ;

128 } 
	`–£if
 ( !
	`em±y
(
Rou‹r
::
$¬gs
) ) {

129 
$id
 = 
Rou‹r
::
$¬gs
[0];

131 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).') Sin identificaor‚o se…uede borrar comentario','ERROR');

132 
echo
 "FALSE";

133 
	`ex™
();

136 
$com’rio
 = 
Ãw
 
	`Com’rios_dbo
(
$this
->
pdo
, 
$id
);

137 
$com’rio
->
	`£tAùivado
(1);

138 
$com’rio
->
	`§ve
();

140 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','com’rio_aùivado',
Rou‹r
::
$s
.Rou‹r::
$c
);

141 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

142 
echo
 
$id
;

143 
	`ex™
();

145 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('comentario').' '.literal('activado'),'AVISO');

148 
	}
}

	@gcm/modulos/comentarios/menuAdmin.php

1 <?
php


11 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Comentarios']['activado']= 1;

12 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Comentarios']['title']="Listado de comentarios";

13 
	g$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['Com’rios']['lšk'] = 
Rou‹r
::
$ba£
.'comentarios/listar';

	@gcm/modulos/comentarios/modelos/comentarios_dbo.php

1 <?
php


20 
»quœe_Úû
(
GCM_DIR
.'lib/int/databoundobject/lib/Crud.php');

24 
»quœe_Úû
(
GCM_DIR
.'modulos/admin/modelos/usuarios.php');

32 şas 
	cCom’rios_dbo
 
ex‹nds
 
	mCrud
 {

34 
funùiÚ
 
	$__cÚ¡ruù
(
PDO
 
$objPdo
, 
$id
 = 
NULL
) {

36 
glob®
 
$gcm
;

38 
·»Á
::
	`__cÚ¡ruù
(
$objPdo
, 
$id
);

40 
$this
->
u¾_ajax
 = '&formato=ajax';

42 
$this
->
sql_li¡ado
 = 'SELECT c.id, c.fecha_creacion `fecha creaciÃ³n`,

43 
c
.
u¾
, c.
cÚ‹nido
 ,

44 
c
.
nomb»
, c.
ma
, c.
com’rio


45 
FROM
 '.$gcm->sufijo.'
com’rios
 
c
';

47 
$this
->
İciÚes_¬¿y2bË
 = 
	`¬¿y
(

48 'İ' => 
	`¬¿y
 (

49 'ocuÉ¬_id'=>
TRUE


52 , '’Ïûs'=> 
	`¬¿y
(

53 'u¾' => 
	`¬¿y
(

56 ,'ba£_u¾'=>
Rou‹r
::
$ba£


64 
funùiÚ
 
	$DefšeTabËName
() {

65 
glob®
 
$gcm
;

66 (
$gcm
->
sufijo
.'comentarios');

67 
	}
}

	@gcm/modulos/contenidos/config/config.php

1 <?
php


6 
	g$cÚfig
['sistema'] = 'Files';

7 
	g$cÚfig
['descartar'][] = 'gdoxygen';

	@gcm/modulos/contenidos/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['descartar'] = 'Si un‡rchivo o carpeta contiene uno de†os contenidos‡ descartar‚o se indexara';

	@gcm/modulos/contenidos/eventos_admin.php

1 <?
php


13 
	g$ev’tos
['guardar_como_borrador']['guardar'][10]='';

16 
	g$ev’tos
['postguardar_como_borrador']['enrutar'][100]='';

22 
	g$ev’tos
['publicar_borrador']['ejecutar_mover'][1]='';

25 
	g$ev’tos
['postpublicar_borrador']['enrutar'][100]='';

28 
	g$ev’tos
['actualizar_contenido']['guardar'][1]='';

31 
	g$ev’tos
['postactualizar_contenido']['enrutar'][100]='';

34 
	g$ev’tos
['borrar']['borrar'][1]='';

37 
	g$ev’tos
['ejecutar_borrar']['ejecutar_borrar'][1]='';

40 
	g$ev’tos
['postejecutar_borrar']['enrutar'][100]='';

43 
	g$ev’tos
['nueva_seccion']['nueva_seccion'][1]='';

46 
	g$ev’tos
['ejecutar_nueva_seccion']['ejecutar_nueva_seccion'][1]='';

49 
	g$ev’tos
['postejecutar_nueva_seccion']['enrutar'][100]='';

55 
	g$ev’tos
['guardar_como']['guardar_como'][1]='';

61 
	g$ev’tos
['vertodo']['vertodo'][1]='';

64 
	g$ev’tos
['traducir']['editar'][1]='';

67 
	g$ev’tos
['ejecutar_traducir']['guardar'][1]='';

70 
	g$ev’tos
['postejecutar_traducir']['enrutar'][100]='';

73 
	g$ev’tos
['mover']['mover'][1]='';

76 
	g$ev’tos
['ejecutar_mover']['ejecutar_mover'][1]='';

79 
	g$ev’tos
['postejecutar_mover']['enrutar'][100]='';

82 
	g$ev’tos
['mover_seccion']['mover_seccion'][1]='';

85 
	g$ev’tos
['ejecutar_mover_seccion']['ejecutar_mover_seccion'][1]='';

88 
	g$ev’tos
['postejecutar_mover_seccion']['enrutar'][100]='';

91 
	g$ev’tos
['nuevo']['nuevo'][1]='';

94 
	g$ev’tos
['ejecutar_nuevo']['guardar'][1]='';

97 
	g$ev’tos
['postejecutar_nuevo']['enrutar'][100]='';

100 
	g$ev’tos
['editar_contenido']['editar'][1]='';

	@gcm/modulos/contenidos/eventos_usuario.php

1 <?
php


10 
	g$ev’tos
['contenido']['contenido'][1]='';

13 
	g$ev’tos
['titulo']['titulo'][1]='';

16 
	g$ev’tos
['titulo_articulo']['titulo_articulo'][1]='';

19 
	g$ev’tos
['pie_articulo']['pie_articulo'][1]='';

22 
	g$ev’tos
['contenido_dinamico']['listar_contenido_seccion'][5]='';

25 
	g$ev’tos
['subcabecera']['camino'][2]='';

28 
	g$ev’tos
['precarga']['comprobar_permisos'][1]='';

31 
	g$ev’tos
['contenido_ajax']['contenido_ajax'][1]='';

34 
	g$ev’tos
['sin_contenido']['sin_contenido'][1]='';

37 
	g$ev’tos
['sin_seccion']['sin_seccion'][1]='';

	@gcm/modulos/contenidos/lib/ContenidoColeccion.php

1 <?
php


18 iàĞ! 
	$defšed
(
GCM_DIR
èè
	`defše
('GCM_DIR',
	`dœÇme
(
__FILE__
).'/../../../');

25 şas 
	cCÚ‹nidoCŞecciÚ
 
ex‹nds
 
Modulos
 
im¶em’ts
 
I‹¿tÜ
 {

27 
´iv©e
 
$–em’tos
 = 
NULL
 ;

29 
funùiÚ
 
	$__cÚ¡ruù
() {

31 
$this
->
–em’tos
 = 
	`¬¿y
();

33 
·»Á
::
	`__cÚ¡ruù
();

37 
public
 
funùiÚ
 
	$addI‹m
(
$i
){

38 
$this
->
–em’tos
[] = 
$i
;

39 
	}
}

41 
public
 
funùiÚ
 
	$»moveI‹m
(
$i
){

42 
	`un£t
(
$this
->
–em’tos
[
	`¬¿y_£¬ch
(
$i
, $this->elementos)]);

43 
	}
}

45 
public
 
funùiÚ
 
	$»wšd
() {

46 
	`»£t
(
$this
->
–em’tos
);

47 
	}
}

49 
public
 
funùiÚ
 
	$cu¼’t
() {

50  
	`cu¼’t
(
$this
->
–em’tos
);

51 
	}
}

53 
public
 
funùiÚ
 
	$key
() {

54  
	`key
(
$this
->
–em’tos
);

55 
	}
}

57 
public
 
funùiÚ
 
	$Ãxt
() {

58  
	`Ãxt
(
$this
->
–em’tos
);

59 
	}
}

61 
public
 
funùiÚ
 
	$v®id
() {

62  
$this
->
	`cu¼’t
(è!=ğ
çl£
;

63 
	}
}

	@gcm/modulos/contenidos/lib/Contenidos.php

1 <?
php


3 
»quœe
(
dœÇme
(
__FILE__
).'/../config/config.php');

5 
»quœe
('CÚ‹nidos'.
$cÚfig
['sistema'].'.php');

	@gcm/modulos/contenidos/lib/ContenidosAbstract.php

1 <?
php


18 iàĞ
defšed
('GCM_DIR'è==ğ
FALSE
 ) 
defše
('GCM_DIR',
dœÇme
(
__FILE__
).'/../../../');

22 
»quœe_Úû
(
GCM_DIR
.'lib/int/gcm/lib/GUtil.php');

34 
ab¡¿ù
 cÏs 
	cCÚ‹nidosAb¡¿ù
 
ex‹nds
 
	mModulos
 {

36 
public
 
	m$desÿ¹¬
;

38 
funùiÚ
 
	$__cÚ¡ruù
() {

40 
·»Á
::
	`__cÚ¡ruù
();

42 
$this
->
desÿ¹¬
 = $this->
	`cÚfig
('descartar');

47 
ab¡¿ù
 
funùiÚ
 
	`gu¬d¬_cÚ‹nido
(
$u¾
, 
$cÚ‹nido
);

50 
ab¡¿ù
 
funùiÚ
 
	`g‘CÚ‹nido
(
$ru
);

53 
ab¡¿ù
 
funùiÚ
 
	`devŞv”_t™ulo
(
$u¾
=
NULL
);

56 
ab¡¿ù
 
funùiÚ
 
	`v”ifiÿr_£cciÚ
(
$u¾
);

59 
ab¡¿ù
 
funùiÚ
 
	`£cciÚ_m©riz
(
$£cciÚ
);

62 
ab¡¿ù
 
funùiÚ
 
	`ü—r_nueva_£cciÚ
(
$ru
);

65 
ab¡¿ù
 
funùiÚ
 
	`v”ifiÿr_cÚ‹nido
(
$ru
);

68 
ab¡¿ù
 
funùiÚ
 
	`bÜ¿r_cÚ‹nido
(
$ru
);

71 
ab¡¿ù
 
funùiÚ
 
	`»nomb¿r_£cciÚ
(
$ru_Üig’
, 
$ru_de¡šo
);

74 
ab¡¿ù
 
funùiÚ
 
	`g‘FechaAùu®izaciÚ
(
$ru
);

86 
funùiÚ
 
	$gu¬d¬_como
(
$e
, 
$¬gs
) {

88 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

90 
glob®
 
$gcm
;

92 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

94 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

95 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

96 
$gcm
->
t™ulo
 = 
	`l™”®
('Guardar como',3);

98 
$cÚ‹nido
 = 
$this
->
	`devŞv”_cÚ‹nido
(
$gcm
->
£ËcciÚado
[0]);

99 
$t™ulo
 = 
$this
->
	`devŞv”_t™ulo
(
$gcm
->
£ËcciÚado
);

101 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_guardar_como.html'));

103 
	}
}

116 
funùiÚ
 
	$bÜ¿r
(
$e
, 
$¬gs
) {

118 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

120 
glob®
 
$GCM_LG
, 
$gcm
 ;

122 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

124 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

125 
$gcm
->
t™ulo
 = 
	`l™”®
('Confirmar†ista de contenidos‡ borrar');

126 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

133 
$cÚ‹nidos_bÜ¿r
 = 
$this
->
	`£cciÚ_m©riz
(
$gcm
->
£ËcciÚado
);

135 iàĞ
	`em±y
(
$cÚ‹nidos_bÜ¿r
) ) {

137 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Noƒxiste contenido seleccionado…ara borrar','AVISO');

138  
FALSE
;

141 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_borrar.html'));

143 
	}
}

154 
funùiÚ
 
	$ed™¬
(
$e
, 
$¬gs
) {

156 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

158 
glob®
 
$gcm
;

160 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

162 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

164 
$cÚ‹nido
 = 
$this
->
	`devŞv”_cÚ‹nido
();

166 
$e
) {

169 
$t™ulo
 = 
$this
->
	`devŞv”_t™ulo
();

170 
$ev’to
 = 'ejecutar_traducir';

171 
$bÙÚ
 = 'Traducir';

174 
$ev’to
 = 'actualizar_contenido';

175 
$bÙÚ
 = 'Guardar';

179 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_editar.html'));

181 
	}
}

196 
funùiÚ
 
	$mov”
(
$e
, 
$¬gs
) {

198 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

200 
glob®
 
$gcm
;

202 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

204 
$cÚ‹nido
 = 
$this
->
	`devŞv”_cÚ‹nido
(
$gcm
->
£ËcciÚado
[0]);

206 
$t™ulo
 = 
$this
->
	`devŞv”_t™ulo
(
$gcm
->
£ËcciÚado
[0]);

208 
$gcm
->
rou‹r
->
	`šicŸ
($gcm->
£ËcciÚado
[0]);

210 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

211 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

212 
$gcm
->
t™ulo
 = 
$t™ulo
;

214 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_mover.html'));

216 
	}
}

227 
funùiÚ
 
	$nuevo
(
$e
, 
$¬gs
) {

229 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

231 
glob®
 
$gcm
;

233 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

235 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

237 
$t™ulo
 = '';

238 
$cÚ‹nido
 = '';

240 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_nuevo.html'));

242 
	}
}

251 
funùiÚ
 
	$cÚ‹nido
(
$e
, 
$¬gs
) {

253 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

255 
glob®
 
$gcm
;

259 iàĞ
Rou‹r
::
$sš_ŒaducciÚ
 ) {

260 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Contenido…endiente deraducciÃ³n',3),'AVISO');

263 
$cÚ‹nido
 = 
$this
->
	`devŞv”_cÚ‹nido
(
Rou‹r
::
$f
);

267 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

269 
$ba£
 = 
	`dœÇme
(
Rou‹r
::
$u¾
).'/';

271 
$bufãr
 = 
$cÚ‹nido
;

273 
$·ŒÚ
 = '/src=["\'](.*?)["\']/';

274 
$su¡™uciÚ
 = '¤c="'.
$ba£
.'${1}"';

275 
$bufãr
 = 
	`´eg_»¶aû
(
$·ŒÚ
, 
$su¡™uciÚ
, $bufãr,-1,
$num”o
);

277 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'èNum”Ødsu¡™uciÚes: '.
$num”o
 );

278 
$gcm
->
cÚ‹nido
=
$bufãr
;

281 
echo
 
$cÚ‹nido
;

284 
	}
}

293 
funùiÚ
 
	$sš_cÚ‹nido
(
$e
, 
$¬gs
) {

295 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

297 
glob®
 
$gcm
;

299 
$gcm
->
t™ulo
 = 
	`l™”®
('Sin Contenido',3);

301 
$ru
 = 
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('temas','html','sin_contenido.html');

303 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('CÚ‹nido').' ['.
Rou‹r
::
$s
.Rou‹r::
$c
.'] '.literal('noƒncontrado',3),'ERROR');

306 iàĞ
$ru
 ) {

307 
	`šşude
(
$ru
);

309 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Contenido‚oƒncontrado',3),'AVISO');

312 
	}
}

321 
funùiÚ
 
	$sš_£cciÚ
(
$e
, 
$¬gs
) {

323 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

325 
glob®
 
$gcm
;

329 iàĞ
	`fe_exi¡s
(
Rou‹r
::
$dd
) ) {

330 
$gcm
->
t™ulo
 = 
	`l™”®
('Sin secciÃ³n',3);

331 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('SecciÃ³n',3).' ['.
Rou‹r
::
$s
.'] '.literal('noƒncontrada',3),'ERROR');

333 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('C»amo dœeùÜiØ·¿ cÚ‹nido',3).' ['.
Rou‹r
::
$dd
.']','ERROR');

334 
	`mkdœ_»cursivo
(
Rou‹r
::
$dd
);

339 
$ru
 = 
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('temas','html','sin_seccion.html');

341 iàĞ
$ru
 ) {

342 
	`šşude
(
$ru
);

344 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('SecciÃ³n‚oƒncontrada',3),'AVISO');

347 
	}
}

356 
funùiÚ
 
	$t™ulo
(
$e
, 
$¬gs
) {

358 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

360 
$this
->
	`t™ulo_¬ticulo
();

361 
	}
}

371 
funùiÚ
 
	$ÿmšo
(
$e
 , 
$¬gs
=
NULL
) {

373 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

375 
glob®
 
$gcm
;

378 
$ÿmšo
 = 
	`ex¶ode
('/',
Rou‹r
::
$s
);

380 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','camino.html'));

382 
	}
}

394 
funùiÚ
 
	$nueva_£cciÚ
(
$e
, 
$¬gs
) {

396 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

398 
glob®
 
$gcm
;

400 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

402 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

403 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

404 
$gcm
->
t™ulo
 = 
	`l™”®
('Nueva secciÃ³n');

406 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_nueva_seccion.html'));

408 
	}
}

420 
funùiÚ
 
	$mov”_£cciÚ
(
$e
, 
$¬gs
) {

422 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
$¬gs
.')');

424 
glob®
 
$gcm
;

426 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

428 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

429 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

430 
$gcm
->
t™ulo
 = 
	`l™”®
('Mover o„enombrar secciÃ³n');

432 
$t™ulo_£cciÚ
 = 
	`com´ob¬_b¬¿
(
	`ba£Çme
(
Rou‹r
::
$s
),'eliminar');

433 
$t™ulo_£cciÚ
 = 
	`l™”®
($titulo_seccion);

435 
$£cciÚ_desÿ¹ada
 = 
	`com´ob¬_b¬¿
(
Rou‹r
::
$dd
.
	`¡r_»¶aû
(
$t™ulo_£cciÚ
,'',Rou‹r::
$s
));

436 
$£cciÚ_£ËcciÚada
 = 
FALSE
;

438 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_mover_seccion.html'));

440 
	}
}

462 
funùiÚ
 
	$’rur
(
$e
, 
$¬gs
) {

464 
glob®
 
$gcm
;

466 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'EÄu¸desdev’to: ['.
$e
.']');

472 iàĞ
GCM_DEBUG
 ) {

474 
echo
 '<div cÏss="aviso">EÄu¸desdev’to: ['.
$e
.'] Desddebug‚Ø’rumo <¨h»f="'.
Rou‹r
::
$dœ
.Rou‹r::
$u¾
.'?m’s='.
$gcm
->
»g
->
£siÚ
.'">[enrutar]</a></div>';

479 
$e
) {

483 
$u¾
 = 
Rou‹r
::
$s
.Rou‹r::
$c
;

487  ! 
	`fe_exi¡s
(
$u¾
) ) {

488 iàĞ
$u¾
 == '' || $url == '/' ) {

489 
$u¾
=
Rou‹r
::
$s
;

492 
$£cs
 = 
	`ex¶ode
('/',
$u¾
);

493 iàĞ
	`is£t
(
$£cs
[
	`couÁ
($secs)-1]) ) {

494 
	`un£t
(
$£cs
[
	`couÁ
($secs)-1]);

496 
$u¾
 = 
Rou‹r
::
$s
;

499 
$u¾
 = 
	`im¶ode
('/',
$£cs
);

502 
$u¾
 = 
	`¡r_»¶aû
(
Rou‹r
::
$d
,'',$url);

504 
$gcm
->
rou‹r
->
	`šicŸ
(
$u¾
);

506 
	`h—d”
 ("LoÿtiÚ:".
Rou‹r
::
$dœ
.Rou‹r::
$u¾
);

507 
	`ex™
();

511 
	`h—d”
 ("LoÿtiÚ:".
Rou‹r
::
$dœ
.Rou‹r::
$u¾
);

512 
	`ex™
();

516 
	}
}

526 
funùiÚ
 
	$gu¬d¬
(
$e
, 
$¬gs
) {

528 
glob®
 
$gcm
;

530 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).')');

532 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

534 
$cÚ‹nido
 = 
$_POST
['areaTexto'];

536 
$e
) {

541 
$this
->
	`ü—r_nueva_£cciÚ
(
Rou‹r
::
$d
.Rou‹r::
$s
);

543 
$t™ulo
 = 
$_POST
['titulo'];

544 
$nomb»_cÚ‹nido
 = 
$this
->
	`devŞv”_t™ulo
();

545 
$de¡šo
 = 
Rou‹r
::
$d
.Rou‹r::
$s
.
$nomb»_cÚ‹nido
;

546 iàĞ
	`sub¡r_couÁ
(
$de¡šo
,".html") == 0) $destino .= ".html";

547 
$m’s
 = 
	`l™”®
('Contenidoraducido',3);

552 
$t™ulo
 = 
$_POST
['titulo'];

553 
$nomb»_cÚ‹nido
 = 
GUt
::
	`‹xtİÏno
(
$t™ulo
);

554 
$cÚ‹nido
 = 
$_POST
['areaTexto'];

555 
$de¡šo
 = 
$gcm
->
£ËcciÚado
[0].'/'.
$nomb»_cÚ‹nido
;

556 iàĞ
	`sub¡r_couÁ
(
$de¡šo
,".html"è=ğ0è$de¡šØğ
	`¡r_»¶aû
('.html','',$destino);

557 iàĞ
	`sub¡r_couÁ
(
$de¡šo
,".btml") == 0) $destino .= ".btml";

558 
$m’s
 = 
	`l™”®
('Borrador‡Ã±adido',3);

563 
$t™ulo
 = 
$_POST
['titulo'];

564 
$nomb»_cÚ‹nido
 = 
GUt
::
	`‹xtİÏno
(
$_POST
['titulo']);

565 
$de¡šo
 = 
$_POST
['£ËcciÚado'][0].'/'.
$nomb»_cÚ‹nido
;

566 iàĞ
	`sub¡r_couÁ
(
$de¡šo
,".html") == 0) $destino .= ".html";

570 iàĞ
$this
->
	`v”ifiÿr_cÚ‹nido
(
$de¡šo
) ) {

571 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
(

573 .' '.
	`l™”®
('Se debe cambiarƒl‚ombre')

575 
$this
->
	`exi¡e_cÚ‹nido
(
$cÚ‹nido
, 
$t™ulo
);

576  
FALSE
;

578 
$m’s
 = 
	`l™”®
('Contenido‡Ã±adido',3);

583 
$de¡šo
 = 
$gcm
->
£ËcciÚado
[0];

584 
$m’s
 = 
	`l™”®
('Contenido‡ctualizado',3);

589 
$de¡šo
 = 
Rou‹r
::
$’Ïû_»Ïtivo
.Rou‹r::
$d
.Rou‹r::
$u¾
;

590 iàĞ
	`sub¡r_couÁ
(
$de¡šo
,".html") == 0) $destino .= ".html";

591 
$m’s
 = 
	`l™”®
('Contenido guardado',3);

596 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

597 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

598 
$gcm
->
t™ulo
 = ( 
	`is£t
(
$t™ulo
èè? 
	`¡r¦ashes
($t™uloè: 
	`l™”®
('Guardar contenido',3);

599 
$gcm
->
cÚ‹nido
 = 
	`¡r¦ashes
(
$cÚ‹nido
);

601 iàĞ! 
$this
->
	`gu¬d¬_cÚ‹nido
(
$de¡šo
, 
$cÚ‹nido
) ) {

603 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

604 
	`l™”®
('E¼Ü').' '.l™”®('gu¬dªdØcÚ‹nido').': '.
$de¡šo
,'ERROR');

605  
FALSE
;

607 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

611 iàĞ
	`is£t
(
$t™ulo
è&& !
	`em±y
($t™uloè&& is£t(
$nomb»_cÚ‹nido
) ) {

612 
	`l™”®
(
$nomb»_cÚ‹nido
,1,
$t™ulo
);

617 
$gcm
->
rou‹r
->
	`šicŸ
(
$de¡šo
);

619 
	}
}

634 
funùiÚ
 
	$exi¡e_cÚ‹nido
(
$cÚ‹nido
, 
$t™ulo
){

636 
glob®
 
$gcm
;

638 
$cÚ‹nido
 = 
	`limpŸrCÚ‹nido
($contenido);

640 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

641 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

642 
$gcm
->
t™ulo
 = 
$t™ulo
;

644 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','form_nuevo.html'));

647 
	}
}

658 
funùiÚ
 
	$v”todo
(
$e
, 
$¬gs
=
NULL
) {

660 
glob®
 
$gcm
;

662 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

663 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

664 
$gcm
->
t™ulo
 = 
	`l™”®
('Listado completo de contenido',3);

666 
$·th
 = "File";

667 
$acciÚ
 = "editar_doc";

668 
$·th_£ËcciÚado
 = 
Rou‹r
::
$d
.Rou‹r::
$s
;

670 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','vertodo.html'));

672 
	}
}

681 
funùiÚ
 
	$ejecur_mov”
(
$e
, 
$¬gs
=
NULL
) {

683 
glob®
 
$gcm
;

685 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

687 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).')');

689 
$e
) {

693 
$Üig’
 = 
Rou‹r
::
$f
;

694 
$de¡šo
 = 
	`¡r_»¶aû
('.btml','.html',
$Üig’
);

695 
$t™ulo_cÚ‹nido
 = 
	`¡r_»¶aû
('.btml','',
Rou‹r
::
$c
);

696 
$m’s
 = 
	`l™”®
('Borrador…ublicado',3);

701 
$Üig’
 = 
$_POST
['origen'];

702 
$t™ulo
 = 
$_POST
['titulo'];

703 
$t™ulo_cÚ‹nido
 = 
GUt
::
	`‹xtİÏno
(
$_POST
['titulo']);

704 
$de¡šo
 = 
$gcm
->
£ËcciÚado
[0].'/'.
$t™ulo_cÚ‹nido
;

705 iàĞ
	`sub¡r_couÁ
(
$de¡šo
,".html") == 0) $destino .= ".html";

706 
$m’s
 = 
	`l™”®
('Contenido„enombrado o movido',3);

710 iàĞ
$this
->
	`mov”_cÚ‹nido
(
$Üig’
, 
$de¡šo
) ) {

711 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

712 
	`l™”®
(
$t™ulo_cÚ‹nido
,1,
$t™ulo
);

713 
$gcm
->
memÜŸ
['de¡šo'] = 
$de¡šo
;

714 
$gcm
->
memÜŸ
['Üig’'] = 
$Üig’
;

715 
$gcm
->
memÜŸ
['t™ulo_cÚ‹nido'] = 
$t™ulo_cÚ‹nido
;

716 
$gcm
->
rou‹r
->
	`šicŸ
(
$de¡šo
);

718  
FALSE
;

721 
	}
}

733 
funùiÚ
 
	$ejecur_mov”_£cciÚ
(
$e
, 
$¬gs
=
NULL
) {

735 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).')');

737 
glob®
 
$gcm
;

739 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

741 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

742 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

743 
$gcm
->
t™ulo
 = 
	`l™”®
('Renombrando o moviendo secciÃ³n',3);

745 iàĞ
	`couÁ
(
$gcm
->
£ËcciÚado
) > 1 ) {

746 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Solo se…uede seleccionar una secciÃ³n, cogemos†a…rimera como vÃ¡lida','AVISO');

749 
$l™”®
 = 
$_POST
['titulo_seccion'];

750 
$nomb»_£cciÚ
 = 
GUt
::
	`‹xtİÏno
(
$l™”®
);

751 
$£cciÚ_nueva
 = ( 
$gcm
->
£ËcciÚado
[0] ) ? $gcm->£ËcciÚado[0] : 
Rou‹r
::
$dd
.Rou‹r::
$s
;

752 
$£cciÚ_nueva
 = 
	`com´ob¬_b¬¿
($£cciÚ_nueva).
$nomb»_£cciÚ
;

753 
$ru_Üig’
 = 
Rou‹r
::
$dd
.Rou‹r::
$s
;

754 
$gcm
->
memÜŸ
['£cciÚ_movida'] = 
Rou‹r
::
$s
;

756 iàĞ
$this
->
	`»nomb¿r_£cciÚ
(
$ru_Üig’
,
$£cciÚ_nueva
) ) {

757 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Cambio de‚ombre„ealizado','AVISO');

758 
	`l™”®
(
$nomb»_£cciÚ
,1,
$l™”®
);

760 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Error‡l„enombrar secciÃ³n','ERROR');

761  
FALSE
;

764 
$gcm
->
rou‹r
->
	`šicŸ
(
$£cciÚ_nueva
);

766 
	}
}

775 
funùiÚ
 
	$ejecur_nueva_£cciÚ
(
$e
, 
$¬gs
=
NULL
) {

777 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).')');

779 
glob®
 
$gcm
;

781 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

783 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

784 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

785 
$gcm
->
t™ulo
 = 
	`l™”®
('Nueva secciÃ³n');

787 
$£cciÚ_mad»
 = 
$gcm
->
£ËcciÚado
[0];

788 
$£cciÚ_nueva
 = 
GUt
::
	`‹xtİÏno
(
$_POST
['titulo_seccion']);

789 
$l™”®_nuevo
 = 
$_POST
['titulo_seccion'];

790 
$ru_nueva_£cciÚ
 = 
	`com´ob¬_b¬¿
(
$£cciÚ_mad»
).
$£cciÚ_nueva
;

792 iàĞ
$this
->
	`ü—r_nueva_£cciÚ
(
$ru_nueva_£cciÚ
) ) {

793 
$m’s
="Nuev¨£cciÃ³Àü—d¨[".
	`l™”®
(
$£cciÚ_nueva
,1,
$l™”®_nuevo
).']';

794 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
,'AVISO');

795 
$gcm
->
rou‹r
->
	`šicŸ
(
$ru_nueva_£cciÚ
);

797  
FALSE
;

800 
	}
}

811 
funùiÚ
 
	$ejecur_bÜ¿r
(
$e
, 
$¬gs
=
NULL
) {

813 
glob®
 
$gcm
;

815 
	`³rmiso
('ed™¬_cÚ‹nido',
TRUE
);

817 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','contenidos');

818 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','contenidos');

819 
$gcm
->
t™ulo
 = 
	`l™”®
('Borrado de contenido',3);

821 
	`fÜ—ch
 ( 
$gcm
->
£ËcciÚado
 
as
 
$™em
 ) {

823 iàĞ
	`is_dœ
(
$™em
) ) {

825 iàĞ!
$this
->
	`–imš¬DœeùÜio
(
$™em
) ) {

826 
	`Œigg”_”rÜ
(
	`l™”®
('DœeùÜio').': '.
$™em
.' '.l™”®('NØ£…udØbÜ¿r'), 
E_USER_ERROR
);

835 iàĞ!
$this
->
	`v”ifiÿr_cÚ‹nido
(
$™em
è|| !$this->
	`bÜ¿r_cÚ‹nido
($item) ) {

836 iàĞ
	`couÁ
(
$gcm
->
£ËcciÚado
è=ğ1 && !
$this
->
	`v”ifiÿr_cÚ‹nido
(
$™em
) ) {

837 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
("Noƒxiste contenido‡ borrar",3),'AVISO');

844 
	`¬¿y_li¡a
(
$gcm
->
£ËcciÚado
,
NULL
,
FALSE
);

845 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
("Contenido borrado",3),'AVISO');

846 
	}
}

855 
funùiÚ
 
	$devŞv”_cÚ‹nido
(
$u¾
=
NULL
) {

857 
glob®
 
$gcm
;

859 
$u¾
 = ( $u¾ ) ? $u¾ : 
Rou‹r
::
$f
;

863 iàĞ! 
$this
->
	`v”ifiÿr_£cciÚ
(
Rou‹r
::
$dd
.Rou‹r::
$s
) ) {

864 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$u¾
.') Noƒxisteƒl documento†anzamosƒvento sincontenido');

865 
$gcm
->
ev’t
->
	`Ïnz¬Ev’to
('sin_seccion');

866  
FALSE
;

871 iàĞ
Rou‹r
::
$c
 && Rou‹r::$ø!ğ'šdex.html' && ! 
$this
->
	`v”ifiÿr_cÚ‹nido
(Rou‹r::
$dd
.Rou‹r::
$s
.Router::$c) ) {

872 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$u¾
.') Noƒxisteƒl documento†anzamosƒvento sincontenido');

873 
$gcm
->
ev’t
->
	`Ïnz¬Ev’to
('sin_contenido');

874  
FALSE
;

880 iàĞ
$this
->
	`v”ifiÿr_cÚ‹nido
(
$u¾
) ) {

882  
$this
->
	`g‘CÚ‹nido
(
$u¾
);

884 } 
	`–£if
 ( 
Rou‹r
::
$c
 == 'index.html' ) {

886 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$u¾
.') Estamosƒn uns secciÃ³n sin index.html,†anzamos contenido_dinamico');

887 
$gcm
->
ev’t
->
	`Ïnz¬Ev’to
('contenido_dinamico');

891 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$u¾
.') Noƒxiste fichero ['.$url.']');

892  
FALSE
;

896 
	}
}

902 
funùiÚ
 
	$t™ulo_¬ticulo
() {

904 
glob®
 
$gcm
;

906 
$esBÜ¿dÜ
 = 
FALSE
;

908 iàĞ
Rou‹r
::
$c
 == 'index.html' || ! Router::$c ) {

909 
$t™ulo
=
Rou‹r
::
$e¡amos
;

912 iàĞ
	`¡ros
(
Rou‹r
::
$c
,'.html') ) {

913 
$t™ulo
=
	`¡r_»¶aû
('.html','',
Rou‹r
::
$c
);

914 } 
	`–£if
 ( 
	`¡ros
(
Rou‹r
::
$c
,'.btml') ) {

915 
$t™ulo
=
	`¡r_»¶aû
('.btml','',
Rou‹r
::
$c
);

918 
Œy
 {

919 ià(
$this
->
	`v”ifiÿr_cÚ‹nido
(
Rou‹r
::
$f
è!=ğ
FALSE
) {

920 
$ãcha
 = 
	`´e£Á¬Fecha
(
$this
->
	`g‘FechaAùu®izaciÚ
(
Rou‹r
::
$f
),1,'unix');

922 
throw
 
Ãw
 
	`Exû±iÚ
('EÈcÚ‹ndØnØexi¡[ '.
Rou‹r
::
$f
.' ]');

924 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

925 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ£…udØ»cog” fecha: '.
$ex
->
	`g‘Mes§ge
(),'ADMIN');

929 
$t™ulo
 = ( 
	`is£t
($t™uloèè? 
	`l™”®
($t™ulo,1è: 
NULL
;

931 iàĞ
$gcm
->
au
->
	`log—do
() ) {

933 iàĞ
Rou‹r
::
$esBÜ¿dÜ
 ) 
$t™ulo
 = '<b™Ë="'.
	`l™”®
('Borrador').'">(B)</b> '.$titulo;

937 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../html/titulo_articulo.html');

939 
	}
}

	@gcm/modulos/contenidos/lib/ContenidosFiles.php

1 <?
php


18 iàĞ
defšed
('GCM_DIR'è==ğ
FALSE
 ) 
defše
('GCM_DIR',
dœÇme
(
__FILE__
).'/../../../');

22 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/ContenidosAbstract.php');

34 şas 
	cCÚ‹nidos
 
ex‹nds
 
	mCÚ‹nidosAb¡¿ù
 {

42 
´iv©e
 
	m$fŒo_£cciÚes
 = 
¬¿y
('thumbnail');

44 
funùiÚ
 
	$__cÚ¡ruù
() {

46 
·»Á
::
	`__cÚ¡ruù
();

57 
funùiÚ
 
	$mov”_cÚ‹nido
(
$Üig’
, 
$de¡šo
) {

58 
glob®
 
$gcm
;

59 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$Üig’
.','.
$de¡šo
.')');

60 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','mov”_cÚ‹nido',
$Üig’
);

61  
	`»Çme
(
$Üig’
, 
$de¡šo
);

62 
	}
}

70 
funùiÚ
 
	$com´ob¬_³rmisos
(
$e
, 
$¬gs
) {

74 iàĞ
	`¡½os
(
Rou‹r
::
$c
,'.btml'èè
	`³rmiso
('editar_contenido');

76 
	}
}

84 
funùiÚ
 
	$ü—r_nueva_£cciÚ
(
$ru
) {

86 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$ru
.')');

88  
	`mkdœ_»cursivo
(
$ru
);

90 
	}
}

98 
funùiÚ
 
	$bÜ¿r_cÚ‹nido
(
$ru
) {

99 
glob®
 
$gcm
;

100 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','bÜ¿r_cÚ‹nido',
$ru
);

101  
	`uÆšk
(
$ru
);

102 
	}
}

110 
funùiÚ
 
	$v”ifiÿr_cÚ‹nido
(
$ru
) {

111 iàĞ
	`fe_exi¡s
(
$ru
èè{  
TRUE
; }

112 iàĞ
	`fe_exi¡s
(
Rou‹r
::
$d
.
$ru
èè{  
TRUE
; }

113  
FALSE
;

114 
	}
}

122 
funùiÚ
 
	$v”ifiÿr_£cciÚ
(
$ru
) {

123 iàĞ
	`fe_exi¡s
(
$ru
èè{  
TRUE
; }

124 iàĞ
	`fe_exi¡s
(
Rou‹r
::
$d
.
$ru
èè{  
TRUE
; }

125  
FALSE
;

126 
	}
}

134 
funùiÚ
 
	$g‘CÚ‹nido
(
$ru
) {

135  
	`fe_g‘_cÚ‹Ás
(
$ru
);

136 
	}
}

159 
funùiÚ
 
	$£cciÚ_m©riz
(
$cÚ‹nido
) {

161 
glob®
 
$gcm
;

163 
$cÚ‹nidos
 = 
	`¬¿y
();

165 
$idiomaXdeãùo
 = 
FALSE
;

167 iàĞ
$cÚ‹nido
 == "" ) {

168 
	`»gi¡¿r
(
__FILE__
,
__LINE__


175 iàĞ!
	`is_¬¿y
(
$cÚ‹nido
) ) {

176 
$cÚ‹nido
 = 
	`¬¿y
($contenido);

179 
	`fÜ—ch
 ( 
$cÚ‹nido
 
as
 
$dœ
 ) {

181 
$dœ
 = 
	`¡r¦ashes
($dir);

182 
$desglo£
 = 
Rou‹r
::
	`desglo§rU¾
(
$dœ
);

183 
$idioma
 = 
$desglo£
['i'];

184 iàĞ
$idioma
 =ğ
Rou‹r
::
$ii
 ) 
$idiomaXdeãùo
 = 
TRUE
;

186 ià(
	`fe_exi¡s
(
$dœ
)) {

188 iàĞ
	`is_dœ
(
$dœ
) ) {

189 
$cÚ‹nidos
[
$idioma
][
$dœ
]=
	`dœ_¬¿y
($dir);

191 
$cÚ‹nidos
[
$idioma
][
$dœ
]=$dir;

194 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"NØexi¡cÚ‹nidØ[ ".
$dœ
." ]",'ADMIN');

197 iàĞ
$idiomaXdeãùo
 ) {

199 
$todosLosIdiomas
 = 
	`glob
('File/*');

202 
	`fÜ—ch
 (
$todosLosIdiomas
 
as
 
$™em
 => 
$ÿ½‘a_idioma
) {

204 
$Ùro_idioma
 = 
	`¡r_»¶aû
('Fe/','',
$ÿ½‘a_idioma
);

207 
$dœ_Ùros_idiomas
 = 
	`¡r_»¶aû
("Fe/".
Rou‹r
::
$ii
, 
$ÿ½‘a_idioma
, 
$dœ
);

209 ià(
	`fe_exi¡s
(
$dœ_Ùros_idiomas
)) {

211 iàĞ
	`is_dœ
(
$dœ_Ùros_idiomas
) ) {

212 
$cÚ‹nidos
[
$Ùro_idioma
][
$dœ_Ùros_idiomas
]=
	`dœ_¬¿y
($dir_otros_idiomas);

214 
$cÚ‹nidos
[
$Ùro_idioma
][
$dœ_Ùros_idiomas
]=$dir_otros_idiomas;

222  
$cÚ‹nidos
;

223 
	}
}

233 
funùiÚ
 
	$devŞv”_t™ulo
(
$u¾
=
NULL
) {

235 
glob®
 
$gcm
;

237 
$u¾
 = ( $u¾ ) ? $u¾ : 
Rou‹r
::
$f
;

239 iàĞ
	`is_fe
(
$u¾
) ) {

240 
$u¾s
 = 
	`ex¶ode
('/',
$u¾
);

241 
$t™ulo
 = 
	`’d
(
$u¾s
);

242 
$t™ulo
 = 
	`¡r_»¶aû
('.html','',$titulo);

243  
$t™ulo
;

245  
FALSE
;

248 
	}
}

283 
funùiÚ
 
	$mo¡¿rSecciÚes
(
$·th
, 
$·th_visibË
=
FALSE
, 
$v”Docum’tos
=FALSE, 
$£ËcciÚabË
=
TRUE
,

284 
$fŒo
=
FALSE
, 
$»cursivo
=
TRUE
, 
$checkqued
=
NULL
, 
$muÉË
=TRUE, 
$ocuÉ¬
 = FALSE) {

286 
glob®
 
$gcm
;

289 iàĞ!
	`³rmiso
('ed™¬_cÚ‹nido'èè
$£ËcciÚabË
 = 
FALSE
;

294 
$™ems_a_desÿ¹¬
 = 
$this
->
desÿ¹¬
 ;

295 iàĞ
$ocuÉ¬
 ) 
$™ems_a_desÿ¹¬
[] = $ocultar;

297 iàĞ(
$™ems_a_desÿ¹¬
) ) {

299 
$desÿ¹¬
 = 
FALSE
;

300 
	`fÜ—ch
 ( 
$™ems_a_desÿ¹¬
 
as
 
$desÿ¹ado
 ) {

301 iàĞ
	`¡½os
(
$·th
,
$desÿ¹ado
è!=ğ
FALSE
 ) {

302 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Desÿ¹ado: '.
$·th
. ' cošcidcÚ '.
$desÿ¹ado
);

303 
$desÿ¹¬
 = 
TRUE
;

306 
	`fÜ—ch
 ( 
$this
->
fŒo_£cciÚes
 
as
 
$desÿ¹ado
 ) {

307 iàĞ
	`¡½os
(
$·th
,
$desÿ¹ado
è!=ğ
FALSE
 ) {

308 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Desÿ¹ado: '.
$·th
. ' cošcidcÚ '.
$desÿ¹ado
);

309 
$desÿ¹¬
 = 
TRUE
;

313 iàĞ
$desÿ¹¬
 ) {

318 iàĞ
$ocuÉ¬
 ) $ocuÉ¬ = 
	`com´ob¬_b¬¿
($ocultar,'eliminar');

319 
$·th
 = 
	`com´ob¬_b¬¿
($path,'eliminar');

320 
$nomb»_ÿmpo
 = 'seleccionado[]';

322 iàĞ
$muÉË
 ) {

323 
$to_ÿmpo
 = 'checkbox';

325 
$to_ÿmpo
 = 'radio';

329 iàĞ
$checkqued
 ) {

330 
$checkqued
 = 
	`com´ob¬_b¬¿
($checkqued,'eliminar');

333 
$v”
='NO';

335 
$dœ_pÜ_deãùo
='Fe/'.
Rou‹r
::
$ii
;

336 
$d
 = 
	`dœ
(
$·th
);

337 
$HAY
="NO";

338 
$sub£cciÚes
 = 
	`¬¿y
();

339 
$docum’tos
 = 
	`¬¿y
();

340 
$’Œy
=
$d
->
	`»ad
()) {

342 ià(
	`is_dœ
(
$·th
."/".
$’Œy
) && $entry{0} != "." ) {

343 
$HAY
="SI";

344 
$sub£cciÚes
[]=
$·th
."/".
$’Œy
;

345 } 
	`–£if
 ( 
$v”Docum’tos
 && 
$’Œy
{0} != "." ) {

346 
$docum’tos
[
$·th
][]=
$’Œy
;

350 
$d
->
	`şo£
();

353 iàĞ
$·th_visibË
 ) {

354 
$·th1
 = 
	`ex¶ode
('/',
$d
->
·th
);

355 
$·th2
 = 
	`ex¶ode
('/',
$·th_visibË
);

359 iàĞ
	`š_¬¿y
(
$·th1
[
	`couÁ
($·th1)-1],
$·th2
) ) {

360 
$v”
='SI';

364 
echo
 "\n<ul>";

367 iàĞ
$£ËcciÚabË
 ) {

368 iàĞĞ
$v”
 =ğ'SI' ) || 
$d
->
·th
 =ğ
$dœ_pÜ_deãùo
) {

370 iàĞ
$d
->
·th
 =ğ
$checkqued
 ) {

371 
echo
 " <špuˆcheckedy³='".
$to_ÿmpo
."'‚ame='".
$nomb»_ÿmpo
."' v®ue='", 
	`htmËÁ™›s
(
$d
->
·th
), "' />";

372 } 
	`–£if
 ( 
$d
->
·th
 =ğ
$ocuÉ¬
 ) {

373 
echo
 "Descartado";

375 
echo
 " <špuˆty³='".
$to_ÿmpo
."'‚ame='".
$nomb»_ÿmpo
."' v®ue='", 
	`htmËÁ™›s
(
$d
->
·th
), "' />";

379 
echo
 " <špuˆty³='".
$to_ÿmpo
."'‚ame='".
$nomb»_ÿmpo
."' v®ue='", 
	`htmËÁ™›s
(
$d
->
·th
), "' />";

383 
echo
 " <špuˆty³='".
$to_ÿmpo
."'‚ame='".
$nomb»_ÿmpo
."' v®ue='", 
	`htmËÁ™›s
(
$d
->
·th
), "' />";

387 iàĞ
$HAY
 =ğ"SI" || 
$v”Docum’tos
) {

388 
echo
 "<¨h»f='#' cÏss='š‹¼ogª‹' onşick=\"visu®iz¬('",
	`htmËÁ™›s
(
$d
->
·th
),"');„eturn false;\" >";

389 
echo
 
	`ba£Çme
(
$d
->
·th
);

390 
echo
 "</a>";

392 
echo
 
	`ba£Çme
(
$d
->
·th
);

394 iàĞĞ
$v”
 =ğ'SI' ) || 
$d
->
·th
 =ğ
$dœ_pÜ_deãùo
 ) {

395 
echo
 "<div id='",
$d
->
·th
,"' class='toggle'>";

397 
echo
 "<div id='",
$d
->
·th
,"' class='toggle' style='display:‚one' >";

401 iàĞ
$v”Docum’tos
 ) {

402 iàĞ! 
	`em±y
(
$docum’tos
[
$d
->
·th
]è&& 
	`couÁ
($documentos[$d->path]) > 0 ) {

403 
	`fÜ—ch
Ğ
$docum’tos
[
$d
->
·th
] 
as
 
$doc
 ) {

404 
echo
 '<li>';

405 iàĞ
GUt
::
	`to_de_¬chivo
(
$d
->
·th
.'/'.
$doc
) == 'text/html' ) {

406 
echo
 '<span class="datos_fichero_html">';

408 
echo
 '<span class="datos_fichero">';

410 iàĞ
$£ËcciÚabË
 ) {

411 
echo
 "<špuˆty³='".
$to_ÿmpo
."'‚ame='".
$nomb»_ÿmpo
."' ";

412 
echo
 'v®ue="'.
	`htmËÁ™›s
(
$d
->
·th
."/".
$doc
).'" />';

416 iàĞ
	`esImag’
(
$d
->
·th
.'/'.
$doc
) ) {

417 
echo
 "<img‡lign='ûÁ”' width='50px' src='".
	`htmËÁ™›s
(
$d
->
·th
."/".
$doc
)."' />";

419 
echo
 '<¨t™Ë="'.
	`l™”®
('Visu®iz¬').'" h»f="?ed™òo&u¾='.
	`htmËÁ™›s
(
$d
->
·th
.'/'.
$doc
).'">';

420 
echo
 
$doc
;

421 
echo
 "</a>";

423 iàĞ
	`³rmiso
('ed™¬_cÚ‹nido'è&& 
GUt
::
	`to_de_¬chivo
(
$d
->
·th
.'/'.
$doc
) == 'text/html' ) {

424 
echo
 '<¨t™Ë="'.
	`l™”®
('Ed™¬').'" h»f="?eód™¬_cÚ‹nido&u¾='.
	`htmËÁ™›s
(
$d
->
·th
.'/'.
$doc
).'"> [#]</a>';

426 
echo
 '<span class="detalles_fichero">';

427 
echo
 ' ['.
	`´e£Á¬By‹s
(
	`fesize
(
$d
->
·th
.'/'.
$doc
)).', '.
	`´e£Á¬Fecha
(
	`femtime
($d->path.'/'.$doc),2).']';

428 
echo
 '</span>';

429 
echo
 '</span>';

430 
echo
 '</li>';

435 
	`fÜ—ch
(
$sub£cciÚes
 
as
 
$x
) {

436 
$this
->
	`mo¡¿rSecciÚes
(
$x
, 
$·th_visibË
, 
$v”Docum’tos
, 
$£ËcciÚabË
, 
$fŒo
, 
$»cursivo
, 
$checkqued
, 
$muÉË
, 
$ocuÉ¬
);

439 
echo
 "</div>";

440 
echo
 "\n</ul>";

441 
	}
}

453 
funùiÚ
 
	$gu¬d¬_cÚ‹nido
(
$fich”o
, 
$cÚ‹nido
){

455 
glob®
 
$gcm
;

457 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$fich”o
.','.
$cÚ‹nido
.')');

459 
$fich
 = 
$fich”o
;

461 
$cÚ‹nido
 = 
	`limpŸrCÚ‹nido
($contenido);

462 iàĞ! 
$nuevoDoc
 = @
	`fİ’
(
$fich
, 'w') ) {

463 
	`»gi¡¿r
(
__FILE__
, 
__LINE__
,

464 "NØ£…uedabrœƒÈ¬chivØ[".
$fich
."]…araƒscribir

465 
La
 
ÿu§
 
m
Ã¡
s
 
´obabË
 
es
 
que
 
no
 
‹ngamos
 
³rmisos
 
’
 
–
 
dœeùÜio
 
de¡šo
.

467 
Com´ueba
 
los
 
³rmisos
 
y
 
»ÿrga
 
Ï
 
·gša
 
·¿
 
pod”
 
gu¬d¬
 
–
 
cÚ‹nido


469  
FALSE
;

472 iàĞ
	`fwr™e
(
$nuevoDoc
, 
$cÚ‹nido
è==ğ
FALSE
 ) {

473 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
("NØ£…uedesüibœƒÀ–‡rchivo")." [".
$fich
."]",'ERROR');

474  
FALSE
;

477 
	`fşo£
(
$nuevoDoc
);

479 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
("Fich”Øesü™o").' ['.
$fich
.']');

481  
TRUE
;

483 
	}
}

495 
funùiÚ
 
	$li¡¬_cÚ‹nido_£cciÚ
(
$e
, 
$£cciÚ
=
NULL
) {

497 
glob®
 
$gcm
;

501 iàĞ
$gcm
->
ev’t
->
	`ªuÏdo
('contenido') ) {

505 iàĞ! 
$£cciÚ
 ) $£cciÚ = 
Rou‹r
::
$dd
.Rou‹r::
$s
;

507 
$£cciÚ
 = 
	`com´ob¬_b¬¿
($seccion);

508 
$d
 = 
	`dœ
(
$£cciÚ
);

509 
$sub£cciÚes
 = 
	`¬¿y
();

510 
$docum’tos
 = 
	`¬¿y
();

514 iàĞ
Rou‹r
::
$s
 != '' ) {

515 
$sub£cciÚes
[] = '..';

518 
$’Œy
=
$d
->
	`»ad
()) {

520 ià(
	`is_dœ
(
$£cciÚ
.
$’Œy
) && $entry{0} != "." ) {

521 
$sub£cciÚes
[]=
$’Œy
;

522 } 
	`–£if
 ( 
$’Œy
{0} !ğ"." && 
GUt
::
	`to_de_¬chivo
($entry) == 'text/html' ) {

523 
$docum’tos
[]=
$’Œy
;

526 
$d
->
	`şo£
();

528 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('contenidos','html','listar_contenido_seccion.html'));

530 
	}
}

541 
funùiÚ
 
	$»nomb¿r_£cciÚ
(
$ru_Üig’
, 
$ru_de¡šo
) {

543 
glob®
 
$gcm
;

544 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','»nomb¿r_£cciÚ',
$ru_Üig’
);

546 iàĞ
	`»Çme
(
$ru_Üig’
,
$ru_de¡šo
) ) {

547  
TRUE
;

549  
FALSE
;

551 
	}
}

567 
funùiÚ
 
	$–imš¬DœeùÜio
(
$dœeùÜio
) {

569 
glob®
 
$gcm
;

571 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('ÿche_h‰p','bÜ¿r','–imš¬DœeùÜio',
$dœeùÜio
);

573  
	`rmdœ_»cursivo
(
$dœeùÜio
);

575 
	}
}

583 
funùiÚ
 
	$g‘FechaAùu®izaciÚ
(
$ru
) {

584 
$ãcha
 = 
	`femtime
(
$ru
);

585 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Recu³¿¸ãch¨dcÚ‹nidØ['.
$ru
.'] fecha: ['.
$ãcha
.']');

586  
$ãcha
;

587 
	}
}

	@gcm/modulos/contenidos/menuAdmin.php

1 <?
php


5 iàĞ
³rmiso
('editar_contenido') ) {

9 
	g$m’uAdmš
['Contenidos']['boton']['Nuevo']['activado']= 1;

10 
	g$m’uAdmš
['Contenidos']['boton']['Nuevo']['title']="Crear‚uevo contenido";

11 
	g$m’uAdmš
['Contenidos']['boton']['Nuevo']['link']="?e=nuevo";

13 
	g$m’uAdmš
['Contenidos']['boton']['Editar']['activado']= 1;

14 
	g$m’uAdmš
['Contenidos']['boton']['Editar']['title']="Editar documento‡ctual";

15 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['Ed™¬']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=editar_contenido";

17 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['T¿ducœ']['aùivado']ğ(
Rou‹r
::
$sš_ŒaducciÚ
) ? 1 : 0;

18 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['T¿ducœ']['t™Ë']=
l™”®
("Traducir documento‡ctual",3);

19 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['T¿ducœ']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=traducir";

21 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['BÜ¿r']['aùivado'] = ( 
is_fe
Ğ
Rou‹r
::
$f
 ) ) ? 1 : 0;

22 
	g$m’uAdmš
['Contenidos']['boton']['Borrar']['title']="Borrar documento‡ctual";

23 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['BÜ¿r']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=borrar";

25 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['R’omb¿¸/ Mov”']['aùivado']ğĞ
is_fe
(
Rou‹r
::
$f
) ) ? 1 : 0;

26 
	g$m’uAdmš
['Contenidos']['boton']['Renombrar / Mover']['title']="Mover o cambiar‚ombre de contenido";

27 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['R’omb¿¸/ Mov”']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=mover";

29 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['Gu¬d¬ como']['aùivado']ğĞ
is_fe
Ğ
Rou‹r
::
$f
 ) ) ? 1 : 0;

30 
	g$m’uAdmš
['Contenidos']['boton']['Guardar como']['title']="Guardar contenido con otro‚ombre";

31 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['Gu¬d¬ como']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=guardar_como";

33 
	g$m’uAdmš
['Contenidos']['boton']['Nueva secciÃ³n']['activado']=1;

34 
	g$m’uAdmš
['Contenidos']['boton']['Nueva secciÃ³n']['title']="Crear una‚ueva secciÃ³n";

35 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['Nuev¨£cciÃ³n']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=nueva_seccion";

37 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['R’omb¿¸£cciÃ³n']['aùivado']ğĞ
Rou‹r
::
$s
 ) ? 1 : 0;

38 
	g$m’uAdmš
['Contenidos']['boton']['Renombrar secciÃ³n']['title']="Renombrar o mover secciÃ³n‡ctual";

39 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['R’omb¿¸£cciÃ³n']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=mover_seccion";

41 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['BÜ¿¸£cciÃ³n']['aùivado']ğĞ
Rou‹r
::
$s
 ) ? 1 : 0;

42 
	g$m’uAdmš
['Contenidos']['boton']['Borrar secciÃ³n']['title']="Borrar secciÃ³n";

43 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['BÜ¿¸£cciÃ³n']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=borrar_seccion";

47 
	g$m’uAdmš
['Contenidos']['boton']['Verodo']['activado']= 1;

48 
	g$m’uAdmš
['Contenidos']['boton']['Verodo']['title']="Listar contenido";

49 
	g$m’uAdmš
['CÚ‹nidos']['bÙÚ']['V”odo']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?e=vertodo";

52 
	g$m’uAdmš
['AdministraciÃ³n']['title']='Administrar…royecto';

53 
	g$m’uAdmš
['ConfiguraciÃ³n']['title']='Configurar…royecto';

54 
	g$m’uAdmš
['Seguimiento']['title']='Seguimiento del…royecto';

58 
	g$m’uAdmš
['Contenidos'] ['peso'] = -10;

59 
	g$m’uAdmš
['AdministraciÃ³n'] ['peso'] = -8;

60 
	g$m’uAdmš
['ConfiguraciÃ³n'] ['peso'] = -6;

61 
	g$m’uAdmš
['Seguimiento'] ['peso'] = -4;

	@gcm/modulos/contenidos/test/ContenidoTest.php

1 <?
php


3 ià(!
defšed
("PHPUnit_MAIN_METHOD")) {

4 
defše
("PHPUnit_MAIN_METHOD", "ContenidoTest::main");

9 iàĞ
fe_exi¡s
('/tmp/‹¡s'èè
sy¡em
('rm -fr /tmp/tests') ;

11 
	g»quœe_Úû
 "PHPUnit/Framework/TestCase.php";

12 
	g»quœe_Úû
 "PHPUnit/Framework/TestSuite.php";

14 
	g»quœe_Úû
 '../lib/Contenido.php';

20 şas 
	cCÚ‹nidoTe¡
 
ex‹nds
 
	mPHPUn™_F¿mewÜk_Te¡Ca£
 {

22 
public
 
	m$c
 ;

23 
public
 
	m$dœ
;

31 
public
 
funùiÚ
 
	$maš
() {

32 
»quœe_Úû
 "PHPUnit/TextUI/TestRunner.php";

34 
$su™e
 = 
Ãw
 
	`PHPUn™_F¿mewÜk_Te¡Su™e
("ContenidoTest");

35 
$»suÉ
 = 
PHPUn™_TextUI_Te¡RuÂ”
::
	`run
(
$su™e
);

44 
´Ùeùed
 
funùiÚ
 
	$£tUp
() {

46 
$this
->
dœ
 = '/tmp/tests/';

48 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ
èè
	`mkdœ
($this->dir);

50 
	`chdœ
(
$this
->
dœ
);

52 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ
.'log'èè
	`mkdœ
($this->dir.'log');

54 
$this
->
c
 = 
Ãw
 
	`CÚ‹nido
();

56 
	}
}

65 
´Ùeùed
 
funùiÚ
 
	$‹¬Down
() {

67 
	}
}

71 
public
 
funùiÚ
 
	$‹¡NuevaSecciÚ
() {

73 
$this
->
	`as£¹True
($this->
c
->
	`nuevaSecciÚ
($this->
dœ
.'seccion'),'Creamos‚ueva secciÃ³n');

75 
	}
}

79 
public
 
funùiÚ
 
	$‹¡EsüibœArchivo
() {

81 
$this
->
	`as£¹True
($this->
c
->
	`esüibœArchivo
($this->
dœ
.'seccion/prueba_test.html','<p>Contenido deƒjemplo</p>'), 'Comprobar disponibilidad de‡rchivo');

83 
	}
}

87 
public
 
funùiÚ
 
	$‹¡CİŸrDœeùÜio
() {

89 
$this
->
	`as£¹True
($this->
c
->
	`cİŸrDœeùÜio
($this->
dœ
.'seccion',$this->dir.'seccion_copiada'));

90 
	}
}

95 
public
 
funùiÚ
 
	$‹¡Dœ_¬¿y
() {

97 
$¬¿y_cÚ_cÚ‹nido
 = 
$this
->
c
->
	`dœ_¬¿y
($this->
dœ
);

98 
$this
->
	`as£¹F®£
(
	`em±y
(
$¬¿y_cÚ_cÚ‹nido
));

100 
	}
}

104 
public
 
funùiÚ
 
	$‹¡Elimš¬DœeùÜio
() {

106 
$this
->
	`as£¹True
(
	`fe_exi¡s
($this->
dœ
.'seccion'));

108 
$this
->
c
->
	`–imš¬DœeùÜio
($this->
dœ
.'seccion');

110 
$this
->
	`as£¹F®£
(
	`fe_exi¡s
($this->
dœ
.'seccion'));

112 
	}
}

117 ià(
	gPHPUn™_MAIN_METHOD
 == "ContenidoTest::main") {

118 
CÚ‹nidoTe¡
::
maš
();

	@gcm/modulos/descargables/config.php

1 <?
php


9 
	g$ex‹nsiÚes_³rm™idas
 = 
¬¿y
 ('php','js','css','sh');

13 
	g$tos_mime_³rm™idos
 = 
¬¿y
('text/php','text/css','application/x-javascript','text/x-sh');

	@gcm/modulos/descargables/eventos_usuario.php

1 <?
php


2 iàĞ!
is£t
(
$_SESSION
['ed™']è|| 
	g$_SESSION
['edit'] != 'si' ) {

3 
$ev’tos
['postcontenido']['procesar_texto'][1] = '';

5 
	g$ev’tos
['precarga']['presenta_contenido'][1] = '';

6 
	g$ev’tos
['postcontenido']['lista_descargables'][1] = '';

	@gcm/modulos/descargables/lib/Descargables.php

1 <?
php


27 şas 
	cDesÿrgabËs
 
ex‹nds
 
	mModulos
 {

29 
´iv©e
 
	m$‘iqu‘a_šicio
;

30 
´iv©e
 
	m$‘iqu‘a_fš®
;

32 
funùiÚ
 
	$__cÚ¡ruù
() {

34 
·»Á
::
	`__cÚ¡ruù
();

36 
$this
->
‘iqu‘a_šicio
 = '{desc{';

37 
$this
->
‘iqu‘a_fš®
 = '}}';

47 
funùiÚ
 
	$es_desÿrgabË
(
$¬chivo
=
FALSE
) {

49 
	`šşude
 ( 
	`dœÇme
(
__FILE__
).'/../config.php');

51 iàĞ! 
$¬chivo
 || 
	`em±y
($¬chivoèè 
FALSE
;

53 iàĞ
	`esImag’
(
$¬chivo
èè 
FALSE
;

56 
$feInfo
 = 
	`·thšfo
(
$¬chivo
);

57 
$ext
 = ( 
	`is£t
(
$feInfo
['ex‹nsiÚ']èè? $feInfo['ex‹nsiÚ'] : 
NULL
 ;

58 iàĞ
	`is£t
(
$ext
èè$exˆğ
	`Œim
(
	`¡¹Şow”
($ext));

60 iàĞ
	`š_¬¿y
(
$ext
,
$ex‹nsiÚes_³rm™idas
èè 
TRUE
;

62 
$to
 = 
	`Œim
(
GUt
::
	`to_de_¬chivo
(
$¬chivo
));

64 iàĞ
$to
 !ğ'' && 
	`š_¬¿y
($to,
$tos_mime_³rm™idos
èè 
TRUE
;

66  
FALSE
;

68 
	}
}

85 
funùiÚ
 
	$´e£Á¬ArchivosDesÿrgabËs
(
$dœ
, 
$sufijo
) {

87 
glob®
 
$gcm
;

89 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'dœ: ['.
$dœ
.'] sufijØ¨busÿr: ['.
$sufijo
.']');

91 iàĞ
	`em±y
(
$dœ
è||ƒm±y(
$sufijo
èè{  
FALSE
; }

93 iàĞ! 
	`fe_exi¡s
(
$dœ
) ) {

94 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'dœ: ['.
$dœ
.'] Noƒxisteƒl directorio');

95  
FALSE
;

98 
Œy
 {

100 
$dd
 = @
	`dœ
(
$dœ
);

102  
$¬chivos
 = 
$dd
->
	`»ad
() ) {

104 
$¯
 = 
$dœ
.'/'.
$¬chivos
 ;

105 iàĞ
$¬chivos
{0} !ğ"." && 
	`sub¡r_couÁ
($¬chivos,'.html')==0 && sub¡r_couÁ($¬chivos,
$sufijo
è> 0 && ! 
	`is_dœ
(
$¯
) ) {

107 iàĞ
$this
->
	`es_desÿrgabË
(
$dœ
.'/'.
$¬chivos
) ) {

108 
$desÿrgabËs
[]="$archivos";

115 iàĞ
	`is£t
(
$desÿrgabËs
è&& 
	`couÁ
($descargables) > 0 ) {

117 
$this
->
	`javasüts
('descargables.js');

119 
$¬chivos_´e£Á¬_codigo
 = 
	`¬¿y
();

121 
$§lida
 = 
	`¬¿y
();

122 
	`fÜ—ch
 ( 
$desÿrgabËs
 
as
 
$¬ch
 ) {

124 
$Ç
 = 
$dœ
.'/'.
$¬ch
 ;

125 
$to
 = 
GUt
::
	`to_de_¬chivo
(
$Ç
);

127 
$§lida
[
$¬ch
]['nombre'] = $arch;

128 
$§lida
[
$¬ch
]['u¾']=
$dœ
.'/'.$arch;

129 
$§lida
[
$¬ch
]['mªyo']=
	`´e£Á¬By‹s
(
	`fesize
(
$Ç
));

130 
$§lida
[
$¬ch
]['ãcha']=
	`´e£Á¬Fecha
(
	`f—time
(
$Ç
));

131 
$§lida
[
$¬ch
]['to']=
$to
;

136 
$to
) {

140 
$§lida
[
$¬ch
]['codigo'] = 0;

164 
$§lida
[
$¬ch
]['codigo'] = 1;

172 iàĞ
	`couÁ
(
$§lida
) > 0 ) {

173 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../html/descargables.html');

177 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

178 
echo
 '<script>init_descargables();</script>';

185 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

186 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),'E¼Ü‡È´e£Á¬‡rchivo: '.$ex->
	`g‘Mes§ge
(),'ERROR');

189 
	}
}

208 
funùiÚ
 
	$exŒ«rArchivos
(
$Ç
, 
$li¡aZ
) {

210 
glob®
 
$gcm
;

212 
	`»quœe_Úû
(
GCM_DIR
."funciones/zip.php");

214 iàĞ!
	`z_exŒaù_to
(
$Ç
,
	`sys_g‘_‹mp_dœ
().'/', 
Œue
) ) {

215 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'ArchivØ'.
$Ç
.'‚o se…udo descomprimir','ERROR');

216  
NULL
 ;

219 
$num
 = 
	`couÁ
(
$li¡aZ
);

221 iàĞ
$num
 > 0 ) {

222 
$i
=0 ; $i!=
$num
; $i++) {

223 
$¬chivo_codigo
 = 
$dœFš®
.
$li¡aZ
[
$i
] ;

224 
$§lida
.=
$¬chivo_codigo
.'\n';

227 
echo
 
$this
->
	`´e£Á¬_cÚ‹nido_¬chivo
(
$¬chivo_codigo
);

232 
echo
 '<süt>·»Á.»suÉadoU¶ßd (\'0\', \''.
$Ç
.' '.
$num
.' imag’es\\n'.
$§lida
.'\');</script>';

234  
TRUE
 ;

235 
	}
}

250 
funùiÚ
 
	$mim‘y³2geshi
(
$mim‘y³
) {

252  
$mim‘y³
) {

271  
FALSE
;

275 
	}
}

281 
funùiÚ
 
	$li¡a_desÿrgabËs
(
$e
, 
$¬gs
) {

283 
$this
->
	`´e£Á¬ArchivosDesÿrgabËs
(
Rou‹r
::
$dd
.Rou‹r::
$s
,
	`¡r_»¶aû
('.html','',Rou‹r::
$c
));

285 
	}
}

289 
funùiÚ
 
	$´e£Áa_cÚ‹nido
(
$e
, 
$¬gs
) {

294 
$this
->
	`javasüts
('descargables.js');

296 iàĞ!
	`em±y
(
$_GET
['p']) ) {

298 
echo
 
$this
->
	`´e£Á¬_cÚ‹nido_¬chivo
(
$_GET
['p']);

299 
	`ex™
();

303 
	}
}

310 
funùiÚ
 
	$´oû§r_‹xto
() {

312 
glob®
 
$gcm
;

314 
$bufãr
 = 
$gcm
->
cÚ‹nido
;

316  
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_šicio
è!=ğ
çl£
 ) {

318 
$pos1
 = 
NULL
;

319 
$pos2
 = 
NULL
;

320 
$¬chivo
 = 
NULL
;

321 
$»m¶az¬
 = 
NULL
;

322 
$¬chivo
 = 
NULL
;

324 
$pos1
 = 
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_šicio
);

325 
$pos2
 = 
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_fš®
, 
$pos1
);

326 
$»m¶az¬
 = 
	`sub¡r
(
$bufãr
, 
$pos1
, 
$pos2
 - $pos1 + 2);

327 
$¬chivo
 = 
	`¡r_»¶aû
(
$this
->
‘iqu‘a_šicio
,'',
$»m¶az¬
);

328 
$¬chivo
 = 
	`¡r_»¶aû
(
$this
->
‘iqu‘a_fš®
,'',$archivo);

330 
$¬chivo
 = 
Rou‹r
::
$dd
.Rou‹r::
$s
.$archivo;

332 iàĞ
$pos1
 && 
$pos2
 && 
$¬chivo
 && 
$»m¶az¬
 ) {

334 
$cÚ‹nido_¬chivo
 = 
$this
->
	`´e£Á¬_cÚ‹nido_¬chivo
(
$¬chivo
);

336 
$bufãr
 = 
	`¡r_»¶aû
(
$»m¶az¬
,
$cÚ‹nido_¬chivo
,$buffer);

342 
$gcm
->
cÚ‹nido
=
$bufãr
;

344 
	}
}

361 
funùiÚ
 
´e£Á¬_cÚ‹nido_¬chivo
(
$¬chivo
, 
$geshi
='si') {

363 
glob®
 
$gcm
;

365 iàĞ! 
is_fe
(
$¬chivo
) ) {

366 
»gi¡¿r
(
__FILE__
,
__LINE__
,"ArchivØnØ’cÚŒado".' ['.
$¬chivo
.']');

367  
	gFALSE
;

370 
	g$nomb»
 = 
ba£Çme
(
$¬chivo
);

371 
	g$mime
 = 
GUt
::
to_de_¬chivo
(
$¬chivo
);

372 
	g$to
 = 
$this
->
mim‘y³2geshi
(
$mime
) ? $this->mimetype2geshi($mime) : 'txt';

373 
	g$ge¡Ü
 = 
fİ’
(
$¬chivo
, "r");

374 
	g$cÚ‹nido
 = 
¡»am_g‘_cÚ‹Ás
(
$ge¡Ü
);

375 
fşo£
(
$ge¡Ü
);

377 iàĞ
	g$geshi
 == 'si' ) {

379 iàĞ
em±y
(
$cÚ‹nido
è||ƒm±y(
$to
) ) {

381 
»gi¡¿r
(
__FILE__
,
__LINE__
,"Falta contenido oipo, contenido: [$contenido],ipo: [$tipo]",'ADMIN');

383  
	gFALSE
;

386 
»quœe_Úû
(
GCM_DIR
.'lib/ext/geshi/geshi.php');

388 
	g$migeshi
ğ
Ãw
 
GeSHi
(
$cÚ‹nido
,
$to
);

390 
	g$migeshi
->
’abË_şas£s
();

392 
	g$migeshi
->
’abË_lše_numb”s
(
GESHI_NORMAL_LINE_NUMBERS
);

393 
	g$cÚ‹nido
 = 
$migeshi
->
·r£_code
();

395 
ob_¡¬t
();

397 
šşude
(
dœÇme
(
__FILE__
)."/../html/codigo_decorado.html");

399 
	g$§lida
=
ob_g‘_cÚ‹Ás
();

404 
ob_¡¬t
();

406 
šşude
(
dœÇme
(
__FILE__
)."/../html/presentar_codigo.html");

408 
	g$§lida
=
ob_g‘_cÚ‹Ás
();

412 
ob_’d_ş—n
();

414  
	g$§lida
 ;

	@gcm/modulos/editar/eventos_admin.php

1 <?
php


8 
	g$ev’tos
['editar_contenido']['editor_web'][10]='';

9 
	g$ev’tos
['traducir']['editor_web'][10]='';

10 
	g$ev’tos
['nuevo']['editor_web'][10]='';

16 
	g$acciÚes
['editar']['editar_contenido'][] = 'editor';

17 
	g$acciÚes
['editar']['nuevo'][] = 'editor';

18 
	g$acciÚes
['editar']['traducir'][] = 'editor';

19 
	g$acciÚes
['editar']['traducir'][] = 'traductor';

	@gcm/modulos/editar/lib/Editar.php

1 <?
php


26 
»quœe_Úû
(
GCM_DIR
."lib/int/GcmConfig/lib/GcmConfigFactory.php");

40 şas 
	cEd™¬
 
ex‹nds
 
	mModulos
 {

42 
funùiÚ
 
	$__cÚ¡ruù
(è{ 
·»Á
::
	`__cÚ¡ruù
() ; }

59 
funùiÚ
 
	$ed™Ü_web
(
$e
, 
$¬gs
=
NULL
) {

61 
glob®
 
$gcm
;

63 
$idiomaxdeãùo
 = 
$gcm
->
	`cÚfig
('idiomas','Idioma…or defecto');

67 
$gcm
->
ev’t
->
	`acciÚ2ev’to
('columna','editar','panel_insertarEmail',6);

68 
$gcm
->
ev’t
->
	`acciÚ2ev’to
('columna','editar','panel_constantes',6);

71 <
süt
 
Ïnguage
="javasüt" 
ty³
="‹xt/javasüt" 
¤c
="<?phpƒcho GCM_DIR_P ?>lib/ext/tiny_mce/tiny_mce.js"></script>

73 <
süt
 
Ïnguage
="javasüt" 
ty³
="text/javascript">

74 
tšyMCE
.
	`š™
({

75 
mode
 : "textareas",

76 
ed™Ü_£ËùÜ
 : "editor_completo",

77 
theme
 : "advanced",

78 
Ïnguages
 : 'es',

79 
­¶y_sourû_fÜm©tšg
 : 
Œue
,

80 
cÚ‹Á_css
 : "proyectos.css?css=contenidos/css/contenido.css",

81 
¶ugšs
 : "table,advhr,advimage,advlink,insertdatetime,preview,searchreplace,print,contextmenu,fullscreen,spellchecker",

82 
theme_advªûd_bu‰Ús1_add
 : "fontselect,fontsizeselect",

83 
theme_advªûd_bu‰Ús2_add
 : "separator,insertdate,inserttime,preview,separator,forecolor,backcolor",

84 
theme_advªûd_bu‰Ús2_add_befÜe
: "cut,copy,paste,code,separator,search,replace,separator",

85 
theme_advªûd_bu‰Ús3_add_befÜe
 : "tablecontrols,separator",

86 
theme_advªûd_bu‰Ús3_add
 : "emotions,iespell,advhr,separator,print,fullscreen,spellchecker",

87 
theme_advªûd_toŞb¬_loÿtiÚ
 : "top",

88 
theme_advªûd_toŞb¬_®ign
 : "left",

89 
theme_advªûd_·th_loÿtiÚ
 : "bottom",

90 
¶ugš_š£¹d©e_d©eFÜm©
 : "%Y-%m-%d",

91 
¶ugš_š£¹d©e_timeFÜm©
 : "%H:%M:%S",

92 
ex‹nded_v®id_–em’ts
 : "a[name|href|target|title|onclick],img[class|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name],hr[class|width|size|noshade],font[face|size|color|style],span[class|align|style]",

93 
fe_brow£r_ÿÎback
 : "fileBrowserCallBack",

94 
ex‹º®_lšk_li¡_u¾
 : "example_data/example_link_list.js",

95 
ex‹º®_image_li¡_u¾
 : "<?='File/'.$idiomaxdefecto.'/'.Router::$s ?>/.listaImg.js",

96 
¥–lcheck”_Ïnguages
 : "+spanish=es,Catala=ca,English=en,Swedish=sv"

99 
funùiÚ
 
	`feBrow£rC®lBack
(
f›ld_Çme
, 
u¾
, 
ty³
, 
wš
) {

101 
	`®”t
("Exam¶oàfebrow£¸ÿÎback: f›ld_Çme: " + 
f›ld_Çme
 + ", u¾: " + 
u¾
 + ",y³: " + 
ty³
);

104 
wš
.
docum’t
.
fÜms
[0].
–em’ts
[
f›ld_Çme
].
v®ue
 = "someurl.htm";

107 </
süt
>

108 <?
php


110 
	}
}

118 
funùiÚ
 
	$·Ãl_š£¹¬Ema
() {

120 
glob®
 
$gcm
;

122 
$·Ãl
 = 
	`¬¿y
();

123 
$·Ãl
['t™ulo'] = 
	`l™”®
('Insertar Email');

124 
$·Ãl
['ocuÉo'] = 
TRUE
;

125 
$·Ãl
['cÚ‹nido'] = 
	`g‘_šşude_cÚ‹Ás
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('editar','html','form_insertar_email.html',$gcm));

127 
Temas
::
	`·Ãl
(
$·Ãl
);

129 
	}
}

140 
funùiÚ
 
	$devŞv”A¼ay
(
$fe
=
NULL
) {

142 
$fe
 = ( 
	`is£t
($feèè? $f: 
$_GET
['file'];

144 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

146 
´št
 
	`jsÚ_’code
(
$¬r
->
	`v¬ŸbËs
());

148 
	}
}

161 
funùiÚ
 
	$ªyadœA¼ay
() {

163 
$fe
=
$_GET
['file'];

164 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

165 
$¬r
->
	`£t
(
$_GET
['elemento'],$_GET['valor']);

166 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

168 
echo
 "EËm’tØ[ ".
$_GET
['elemento']." ]‡Ã±adido o modificado…or [ ".$_GET['valor']." ]";

170 
	}
}

185 
funùiÚ
 
	$modifiÿrA¼ay
() {

187 
glob®
 
$gcm
;

189 
$fe
=
$_GET
['file'];

191 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

193 
$¬r
->
	`£t
(
$_GET
['elemento'],$_GET['valor']);

195 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

197 
echo
 "EËm’tØ[ ".
$_GET
['elemento']." ]‡Ã±adido o modificado…or [ ".$_GET['valor']." ]";

199 
	}
}

214 
funùiÚ
 
ÿmbio_nomb»_cÚ‹nido
(
$e
,
$¬gs
='') {

216 
glob®
 
$gcm
, 
$LG
;

218 
	g$Üigš®
 = 
$_POST
['original'];

219 
	g$de¡šo
 = 
$_POST
['destino'];

221 
	g$Üigš®_r
 = 
$gcm
->
rou‹r
->
desglo§rU¾
(
$Üigš®
);

222 
	g$de¡šo_r
 = 
$gcm
->
rou‹r
->
desglo§rU¾
(
$de¡šo
);

224 
	g$Üigš®
 = 
¡r_»¶aû
('\.html','',
$Üigš®_r
['c']);

225 
	g$de¡šo
 = 
¡r_»¶aû
('\.html','',
$de¡šo_r
['c']);

227 
	g$fe
=
$gcm
->
cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
	gRou‹r
::
$ii
.".php";

229 
	g$¬r
 = 
GcmCÚfigFaùÜy
::
G‘GcmCÚfig
(
$fe
);

231 
	g$¬r
->
d–
(
$Üigš®
);

232 
	g$¬r
->
£t
(
GUt
::
‹xtİÏno
(
$de¡šo
),$destino);

234 
	g$¬r
->
gu¬d¬_v¬ŸbËs
();

236 
glob®
 
	g$LG
;

237 
	g$LG
[
GUt
::
‹xtİÏno
(
$de¡šo
)]=$destino;

247 
funùiÚ
 
	$·Ãl_cÚ¡ª‹s
() {

249 
glob®
 
$gcm
;

251 
$this
->
	`javasüts
('generico.js');

253 iàĞ
$gcm
->
au
->
	`log—do
() ) {

255 
$·Ãl
 = 
	`¬¿y
();

256 
$·Ãl
['t™ulo'] = 
	`l™”®
('Constantes',3);

257 
$·Ãl
['ocuÉo'] = 
TRUE
;

258 
$·Ãl
['ajax'] = "pedirDatos('?formato=ajax&m=editar&a=devolverArray&file=DATOS/constantes/GCM_CONS.php','presentaConstantes');";

259 
$·Ãl
['contenido'] = '<div id="panelConstantes"></div>';

260 
Temas
::
	`·Ãl
(
$·Ãl
);

263 
	}
}

269 
funùiÚ
 
	$fÜmAdmšCÚ¡ª‹s
() {

271 
glob®
 
$gcm
;

273 
$this
->
	`javasüts
('generico.js');

276 <
br
 />

277 <
fÜm
 
m‘hod
='post' >

278 <
f›ld£t
>

279 <
Ëg’d
><?
php
 
	`l™”®
('AdministraciÃ³n de constantes',3);?></legend>

280 <
šput
 
ty³
='hidd’' 
Çme
='m' 
v®ue
='editar' />

281 <
šput
 
ty³
='hidd’' 
Çme
='a' 
v®ue
='administrar_constantes' />

282 <
šput
 
ty³
='subm™' 
Çme
='cÚf' 
v®ue
='Configurar' />

283 <
šput
 
ty³
='subm™' 
Çme
='cİŸ' 
v®ue
='Recuperar copia de seguridad' />

284 </
f›ld£t
>

285 </
fÜm
>

286 <
br
 />

287 <?
php


288 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','editar');

290 
	}
}

299 
funùiÚ
 
	$admši¡¿r_cÚ¡ª‹s
() {

301 
glob®
 
$gcm
;

303 iàĞ
$gcm
->
au
->
	`log—do
() ) {

305 
$ARCHIVO
="DATOS/constantes/GCM_CONS.php";

307 
	`šşude_Úû
(
$ARCHIVO
);

309 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','editar');

311 iàĞ
	`is£t
(
$_POST
['conf'])) {

313 
	`šşude_Úû
(
GCM_DIR
."funciones/gcm_arrayFile.php");

314 
	`gcm_Ë”A¼ay
(
$ARCHIVO
, 'es', 'si', 'si');

316 } 
	`–£if
 ( 
$_POST
['accion'] == 'escribir') {

318 
	`šşude_Úû
(
GCM_DIR
."funciones/gcm_arrayFile.php");

320 ià(
	`gcm_esüibœA¼ay
(
$ARCHIVO
è==ğ
FALSE
){

321 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"No se…udo guardar†os cambios",'ERROR');

322  
çl£
;

324 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"Archivo modificado",'AVISO');

326 
$this
->
	`fÜmAdmšCÚ¡ª‹s
();

327  
Œue
;

331 
$this
->
	`fÜmAdmšCÚ¡ª‹s
();

336 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"Las constantes solo…ueden ser‡dministradas…or†os‡dministradores",'AVISO');

339 
	}
}

	@gcm/modulos/editar/menuAdmin.php

1 <?
php


4 
	g$m’uAdmš
['ConfiguraciÃ³n']['boton']['Constantes']['activado']=1;

5 
	g$m’uAdmš
['ConfiguraciÃ³n']['boton']['Constantes']['title']="Editar constantes";

6 
	g$m’uAdmš
['ConfiguraciÃ³n']['boton']['Constantes']['link']="?m=editar&a=administrar_constantes";

9 
	g$m’uAdmš
['ConfiguraciÃ³n']['boton']['Literales']['activado']=1;

10 
	g$m’uAdmš
['ConfiguraciÃ³n']['boton']['Literales']['title']="Editar†iterales";

11 
	g$m’uAdmš
['ConfiguraciÃ³n']['boton']['Literales']['link']="?m=editar&a=administrar_literales";

	@gcm/modulos/enviomail/eventos_admin.php

1 <?
php


7 
	g$ev’tos
['columna']['formulario']['10']='';

8 
	g$ev’tos
['enviar_email_error']['enviar_email_error'][1]='';

14 
	g$acciÚes
['enviomail']['enviar_email_error'][] = 'usuario';

	@gcm/modulos/enviomail/lib/Enviomail.php

1 <?
php


14 
šşude_Úû
(
GCM_DIR
.'lib/ext/phpMailer/class.phpmailer.php');

25 şas 
	cEnvioma
 
ex‹nds
 
	mModulos
 {

45 
funùiÚ
 
’vŸMaHtml
(
$asuÁo
,
$cÚ‹nidoMa
,
$nomb»De¡š©¬io
,
$emaDe¡š©¬io
,
$nomb»Rem™e
,
$emaRem™’‹
,
$ocuÉos
=
NULL
,
$html
='true'){

47 
glob®
 
$gcm
;

49 
	m$´oyeùo
 = 
$gcm
->
cÚfig
('admin','Proyecto');

51 iàĞ
	m$html
 == 'true' ) {

53 
$¶ªtÏ
['u¾_absŞu'] = 'h‰p://'.
$_SERVER
['HTTP_HOST'].
dœÇme
($_SERVER['REQUEST_URI']).'/';

54 
	m$¶ªtÏ
['t™ulo'] = 
l™”®
(
$´oyeùo
,1);

55 
	m$¶ªtÏ
['ãcha'] = 
´e£Á¬Fecha
(
time
());

56 
	m$¶ªtÏ
['cÚ‹nido'] = 
$cÚ‹nidoMa
;

58 
	m$cÚ‹nido
 = 
g‘_šşude_cÚ‹Ás
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
ru
('’vioma','html','ma.html'),
$¶ªtÏ
);

62 
	m$cÚ‹nido
 = 
$cÚ‹nidoMa
;

65 iàĞ
	m$this
->
´oû§EnvioMa
(
$asuÁo
,
$cÚ‹nido
,
$nomb»De¡š©¬io
,
$emaDe¡š©¬io
,
$nomb»Rem™e
,
$emaRem™’‹
,
$ocuÉos
,
$html
) ) {

66  
	mTRUE
;

68  
	mFALSE
;

90 
funùiÚ
 
´oû§EnvioMa
(
$asuÁo
,
$cÚ‹nidoMa
,
$nomb»De¡š©¬io
,
$emaDe¡š©¬io
,
$nomb»Rem™e
,
$emaRem™’‹
,
$ocuÉos
=
NULL
, 
$html
='true'){

92 
glob®
 
$gcm
;

95 
	g$idioma
 = (
$_SESSION
[
$gcm
->
cÚfig
('admš','Proyeùo')."-idioma"]è? 
	g$_SESSION
[$gcm->cÚfig('admš','Proyeùo')."-idioma"] : 
LG_PRE
;

100 iàĞ
	g$html
 == 'true' ) {

102 
$cÚ‹nidos
 = 
ex¶ode
(' ',
$cÚ‹nidoMa
);

103 
	g$cÚ‹nido
 = '';

104 
fÜ—ch
 ( 
$cÚ‹nidos
 
as
 
$·Ïb¿
 ) {

105 iàĞ
¡ros
(
$·Ïb¿
,'¤c'è!=ğ
FALSE
 ) {

106 
$cÚ‹nido
 .ğ
”eg_»¶aû
Ğ"¤c=('|\")(.*)Fe/(.*)('|\")", "¤c=\"Fe/\\3\"", 
$·Ïb¿
 );

107 
	g$cÚ‹nido
 .= ' ';

108 } 
–£if
 ( 
¡ros
(
$·Ïb¿
,'h»f'è!=ğ
FALSE
 ){

109 
$cÚ‹nido
 .ğ
´eg_»¶aû
("/h»f=('|\")(.*)Fe\/(.*)('|\")/", "h»f=\"Fe/\3\"", 
$·Ïb¿
 );

110 
	g$cÚ‹nido
 .= ' ';

112 
	g$cÚ‹nido
 .ğ
$·Ïb¿
.' ';

118 
	g$cÚ‹nido
 = 
$cÚ‹nidoMa
;

122 
	g$ma
 = 
Ãw
 
PHPMa”
();

124 
	g$ma
->
S‘Lªguage
(
$idioma
);

125 
	g$ma
->
	gCh¬S‘
 = "UTF-8";

126 
	g$ma
->
	gFrom
 = 
$emaRem™’‹
;

127 
	g$ma
->
	gFromName
 = 
$nomb»Rem™e
;

128 
	g$ma
->
	gSubjeù
 = 
$asuÁo
;

129 
	g$ma
->
AddAdd»ss
(
$emaDe¡š©¬io
,
$nomb»De¡š©¬io
);

130 iàĞ
	g$html
 == 'true' ) {

131 
$ma
->
IsHTML
(
$html
);

132 
	g$ma
->
	gAÉBody
 = 
l™”®
('Para verƒlƒmail,‚ecesita compatibilidad con html');

133 
	g$ma
->
MsgHTML
(
$cÚ‹nido
);

135 
	g$ma
->
	gBody
 = 
$cÚ‹nido
;

139 iàĞ
	g$ocuÉos
 ) {

140 
fÜ—ch
Ğ
$ocuÉos
 
as
 
$ema
 => 
$nom
 ) {

141 
$ma
->
AddBCC
(
$ema
, 
$nom
);

145 if(!
	g$ma
->
S’d
()) {

146 
Œigg”_”rÜ
(
l™”®
('E¼Ü').' '.l™”®('’vŸndØema').': '.
$ma
->
E¼ÜInfo
, 
E_USER_ERROR
);

147  
	gFALSE
;

149 
	g$m’s
 = 'EmaƒnvŸdØ¨['.
$emaDe¡š©¬io
.']';

150 
	g$m’s
 .ğ'D ['.
$emaRem™’‹
.']';

151 
	g$m’s
 .ğ'AsuÁØ ['.
$asuÁo
.']';

152 
»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’s
);

153  
	gTRUE
;

160 
funùiÚ
 
	$fÜmuÏrio
() {

161 
	`ob_¡¬t
();

162 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../html/form_enviomail.html');

163 
$§lida
 = 
	`ob_g‘_cÚ‹Ás
();

164 
	`ob_’d_ş—n
();

166 
$·Ãl
 = 
	`¬¿y
();

167 
$·Ãl
['t™ulo'] = 
	`l™”®
('Informe deƒrrores',3);

168 
$·Ãl
['ocuÉo'] = 
TRUE
;

169 
$·Ãl
['cÚ‹nido'] =
$§lida
;

171 
Temas
::
	`·Ãl
(
$·Ãl
);

175 
	}
}

182 
funùiÚ
 
	$’vŸr_ema_”rÜ
() {

184 
glob®
 
$gcm
;

186 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Enviando mail de usuario conƒrror');

190 iàĞ!
$gcm
->
au
->
	`log—do
() ) {

192 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'No se…uedeƒnviar informe sin ser‡dministrador','AVISO');

197 iàĞ
$_SERVER
['HTTP_HOST'] == 'localhost' ) {

198 
$ma_dev
 = 'eduardo@localhost';

200 
$ma_dev
 = 'eduardo@mamedu.com';

203 
$§lida
 = 
	`v¬_expÜt
(
$_SESSION
,
TRUE
);

205 iàĞ!
	`em±y
(
$_POST
['comentario_usuario']) ) {

206 
$cÚ‹nido_ma
 .= "\n".'------------------';

207 
$cÚ‹nido_ma
 = "\n".'Comentario usuario';

208 
$cÚ‹nido_ma
 .= "\n".'------------------';

209 
$cÚ‹nido_ma
 .= "\n";

210 
$cÚ‹nido_ma
 .ğ"\n".
	`¡r_gs
(
$_POST
['comentario_usuario']);

211 
$cÚ‹nido_ma
 .= "\n";

214 
$cÚ‹nido_ma
 .ğ"\n".
$§lida
;

216 iàĞ
$this
->
	`’vŸMaHtml
('E¼ÜƒÀgcm', 
$cÚ‹nido_ma
, 'Edu¬do', 
$ma_dev
, 'RobÙ dgcm', 'admš@mamedu.com',
NULL
,'false') ) {

218 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('Elƒmail‡ sidoƒnviado',3).' '.literal('Gracias',3),'AVISO');

219  
TRUE
;

221  
FALSE
;

226 
	}
}

230 
funùiÚ
 
	$’vŸr_ema
(
$e
, 
$¬gs
) {

232 
glob®
 
$gcm
;

234 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).') ');

236 iàĞ
	`is£t
(
$¬gs
['mail']) ) {

237 
$ma
 = 
$¬gs
['mail'];

240 iàĞ
$_SERVER
['HTTP_HOST'] == 'localhost' ) {

241 
$ma
 = 'eduardo@mamedu.com';

243 
$ma
 = 'eduardo@mamedu.com';

247 iàĞ!
	`is£t
(
$¬gs
['cuerpo']) ) {

248 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).')

249 
Sš
 
cÚ‹nido
 
·¿
 
’vŸr
','
ERROR
');

250  
FALSE
;

253 iàĞ
	`is£t
(
$¬gs
['nombre_destinatario']) ) {

254 
$nomb»_de¡š©¬io
 = 
$¬gs
['nombre_destinatario'];

256 
$nomb»_de¡š©¬io
 = 'Eduardo';

259 iàĞ
	`is£t
(
$¬gs
['nombre_remitente']) ) {

260 
$nomb»_»m™’‹
 = 
$¬gs
['nombre_remitente'];

262 
$nomb»_»m™’‹
 = 'Eduardo';

265 iàĞ
	`is£t
(
$¬gs
['mail_remitente']) ) {

266 
$ma_»m™’‹
 = 
$¬gs
['mail_remitente'];

268 
$ma_»m™’‹
 = 'eduardo@mamedu.com';

272 
$cÚ‹nido_ma
 = 
$¬gs
['cuerpo'];

273 
$asuÁo_ma
 = 
$¬gs
['asunto'];

275 iàĞ
$this
->
	`’vŸMaHtml
(
$asuÁo_ma
, 
$cÚ‹nido_ma
, 
$nomb»_de¡š©¬io
, 
$ma
, 
$nomb»_»m™’‹
, 
$ma_»m™’‹
,
NULL
,
TRUE
) ) {

277  
TRUE
;

279  
FALSE
;

282 
	}
}

	@gcm/modulos/gdoxygen/eventos_admin.php

1 <?
php


7 
	g$ev’tos
['postreindexar']['reindexar'][1] = '';

8 
	g$ev’tos
['reindexado_completo']['reindexado_completo'][2] = '';

	@gcm/modulos/gdoxygen/eventos_usuario.php

1 <?
php


22 
	g$ev’tos
['buscar']['presentar_busquedas'][5]='';

24 
	g$ev’tos
['precarga']['detectar_gdoxygen'][5] = '';

	@gcm/modulos/gdoxygen/lib/Gdoxygen.php

1 <?
php


37 şas 
	cGdoxyg’
 
ex‹nds
 
	mModulos
 {

44 
´iv©e
 
	m$nomb»_ÿ½‘as_doxyg’
 = 'gdoxygen';

48 
funùiÚ
 
	$__cÚ¡ruù
() {

50 
·»Á
::
	`__cÚ¡ruù
();

62 
funùiÚ
 
	$d‘eù¬_gdoxyg’
(
$e
, 
$¬gs
) {

64 
glob®
 
$gcm
;

66 
$šicio
 = 'index.htm';

68 iàĞ
Rou‹r
::
$e¡amos
 =ğ
$this
->
nomb»_ÿ½‘as_doxyg’
 ) {

70 iàĞ
Rou‹r
::
$e
 == 'indexar' ) {

71 
$this
->
	`ªuÏrEv’to
('indexar');

72 
$this
->
	`šdexado
(
$_GET
['url']);

73 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) ;

76 
$this
->
	`ªuÏrEv’to
('titulo');

77 
$gcm
->
ev’t
->
	`unico
('cÚ‹nido',
$this
->
nomb»_ÿ½‘as_doxyg’
);

78 
$this
->
	`ªuÏrEv’to
('columna');

80 iàĞ
	`fe_exi¡s
(
Rou‹r
::
$d
.Rou‹r::
$s
.'šdex.htm'è==ğ
FALSE
 ) {

82 
$šicio
 = 'main.htm';

86 iàĞ
Rou‹r
::
$fÜm©o
 != 'ajax' ) {

87 
echo
 '<style>#contenedor { width: 100%;}</style>';

89 
echo
 '<b¸/><iäamsüŞlšg="auto" f¿mebÜd”="0" width="99%" height="1000" src="h‰p://'.
$_SERVER
['HTTP_HOST'].'/'.
	`dœÇme
($_SERVER['PHP_SELF']).'/'.
Rou‹r
::
$dd
.Rou‹r::
$s
.'">';

92 
	}
}

100 
funùiÚ
 
	$»šdexado_com¶‘o
(
$e
, 
$¬gs
=
NULL
) {

102 
$this
->
	`li¡¬_gdoxyg’
();

118 
	}
}

127 
funùiÚ
 
	$»šdex¬
(
$e
, 
$¬gs
) {

129 
$this
->
	`li¡¬_gdoxyg’
();

131 
	}
}

142 
funùiÚ
 
	$šdexado
(
$¬chivo
) {

144 
glob®
 
$gcm
;

146 
$ÿ½‘a
 = 
	`dœÇme
(
$¬chivo
);

147 
$aCamšo
 = 
	`ex¶ode
('/',
$ÿ½‘a
);

148 
$´oyeùo
 = 
$aCamšo
[
	`couÁ
($aCamino)-2];

149 
$¬chivo_cÚ‹nido
 = 
$ÿ½‘a
.'/main.htm';

151 iàĞ
	`fe_exi¡s
(
$¬chivo_cÚ‹nido
è==ğ
FALSE
 ) {

152 
$¬chivo_cÚ‹nido
 = 
$¬chivo
;

155 iàĞ
	`fe_exi¡s
(
$¬chivo
è==ğ
FALSE
 ) {

156 
$m’
 = "No seƒncuentra‚i $archivo";

157 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$m’
,'ERROR');

158  
FALSE
;

161 
$·¿m‘ros
 = 'u¾='.
$¬chivo
;

162 
$·¿m‘ros
 .ğ'&l™”®=Docum’ciÃ³À'.
$´oyeùo
;

163 
$·¿m‘ros
 .= '&sin_comprobar_extension=1';

164 
$·¿m‘ros
 .ğ'&¬chivo_desüciÚ='.
$¬chivo_cÚ‹nido
;

165 
$·¿m‘ros
 .= '&inicio_descripcion="contents">';

167 iàĞ
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('šdexadÜ','šdex¬_¬chivo_pdo','gdoxyg’',
$·¿m‘ros
è!=ğ
FALSE
 ) {

168 
$§lida
 = "CÚ‹nidØ»šdexado: Docum’ciÃ³À".
$´oyeùo
;

170 
$§lida
 = '<p class="error">';

171 
$§lida
 .= 'Error‡l indexar contenido';

172 
$§lida
 .= '</p>';

173  
FALSE
;

176 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

177 
echo
 
$§lida
;

179 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$§lida
,'AVISO');

182 
	}
}

189 
funùiÚ
 
	$li¡¬_gdoxyg’
() {

191 
glob®
 
$gcm
;

193 
$funciÚ_js_šdex¬
 = 'indexar';

195 
$ÿ½‘as_doxyg’
 = 
	`rglob
('Fe/*/'.
$this
->
nomb»_ÿ½‘as_doxyg’
);

197 iàĞ! 
$ÿ½‘as_doxyg’
 ) { ; }

199 
echo
 '<h2>Listado de gdoxygen</h2>';

201 
	`fÜ—ch
 ( 
$ÿ½‘as_doxyg’
 
as
 
$ÿ½‘a
 ) {

203 
$¬chivo
 = 
$ÿ½‘a
.'/'.'index.htm';

204 
$aCamšo
 = 
	`ex¶ode
('/',
$ÿ½‘a
);

205 
$´oyeùo
 = 
$aCamšo
[
	`couÁ
($aCamino)-2];

207 
$ÿmšo
 = 
$¬chivo
;

208 
$–em’to
 = 
$¬chivo
;

210 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('indexador','html','elemento_lista_indexar.html'));

214 
	}
}

220 
funùiÚ
 
	$´e£Á¬_busquedas
(
$e
, 
$¬gs
) {

222 iàĞ
	`is£t
(
$_GET
['buscar']) ) {

224 
$qu”y
 = 
$_GET
['buscar'];

226 
	`šşude
('search_doxygen.php');

228 
$ÿ½‘as_doxyg’
 = 
	`rglob
('Fe/*/'.
$this
->
nomb»_ÿ½‘as_doxyg’
);

230 iàĞ! 
$ÿ½‘as_doxyg’
 ) { ; }

232 
	`fÜ—ch
 ( 
$ÿ½‘as_doxyg’
 
as
 
$ÿ½‘a
 ) {

234 
$´oyeùos
 = 
	`ex¶ode
('/',
$ÿ½‘a
);

235 
$´oyeùo
 = 
$´oyeùos
[3];

236 
echo
 '<h2>ResuÉado ’ƒÈcÃ³digØd'.
$´oyeùo
.'</h2>';

238 ià(!(
$fe
=
	`fİ’
(
$ÿ½‘a
."/search/search.idx","rb")))

240 
	`d›
("Error: Search index file could NOT be opened!");

242 
$»suÉs
 = 
	`¬¿y
();

243 
$»quœedWÜds
 = 
	`¬¿y
();

244 
$fÜbidd’WÜds
 = 
	`¬¿y
();

245 
$foundWÜds
 = 
	`¬¿y
();

246 
$wÜd
=
	`¡¹ok
(
$qu”y
," ");

247 
$wÜd
)

249 ià((
$wÜd
{0}=='+')è{ $wÜd=
	`sub¡r
($wÜd,1); 
$»quœedWÜds
[]=$word; }

250 ià((
$wÜd
{0}=='-')è{ $wÜd=
	`sub¡r
($wÜd,1); 
$fÜbidd’WÜds
[]=$word; }

251 ià(!
	`š_¬¿y
(
$wÜd
,
$foundWÜds
))

253 
$foundWÜds
[]=
$wÜd
;

254 
	`£¬ch
(
$fe
,
	`¡¹Şow”
(
$wÜd
),
$»suÉs
);

256 
$wÜd
=
	`¡¹ok
(" ");

258 
$docs
 = 
	`¬¿y
();

259 
	`combše_»suÉs
(
$»suÉs
,
$docs
);

262 
$f‹»dDocs
 = 
	`f‹r_»suÉs
(
$docs
,
$»quœedWÜds
,
$fÜbidd’WÜds
);

264 
$sÜ‹d
 = 
	`¬¿y
();

265 
	`sÜt_»suÉs
(
$f‹»dDocs
,
$sÜ‹d
);

267 
$´efijo_u¾
 = 
	`¡r_»¶aû
(
Rou‹r
::
$dd
,'',
$ÿ½‘a
);

268 iàĞ!
	`em±y
(
$sÜ‹d
) ) {

269  
$i
=0; $˜< (
$sÜ‹d
); ++$i ) {

270 
$sÜ‹d
[
$i
]['u¾'] = 
$´efijo_u¾
.'/'.$sorted[$i]['url'];

273 
	`»pÜt_»suÉs
(
$sÜ‹d
);

274 
echo
 "</div>\n";

275 
	`’d_·ge
();

276 
	`fşo£
(
$fe
);

279 
	}
}

	@gcm/modulos/gdoxygen/lib/search_doxygen.php

1 <?
php


3 
funùiÚ
 
	$m©ches_‹xt
(
$num
)

5 ià(
$num
==0)

9 ià(
$num
==1)

17 
	}
}

19 
funùiÚ
 
	$»pÜt_m©ches
()

22 
	}
}

23 
funùiÚ
 
	$’d_·ge
()

26 
echo
 "\n\n";

27 
	}
}

29 
funùiÚ
 
	$»adIÁ
(
$fe
)

31 
$b1
 = 
	`Üd
(
	`fg‘c
(
$fe
)); 
$b2
 = ord(fgetc($file));

32 
$b3
 = 
	`Üd
(
	`fg‘c
(
$fe
)); 
$b4
 = ord(fgetc($file));

33  (
$b1
<<24)|(
$b2
<<16)|(
$b3
<<8)|
$b4
;

34 
	}
}

36 
funùiÚ
 
	$»adSŒšg
(
$fe
)

38 
$»suÉ
="";

39 
	`Üd
(
$c
=
	`fg‘c
(
$fe
))è
$»suÉ
.=$c;

40  
$»suÉ
;

41 
	}
}

43 
funùiÚ
 
	$compu‹Index
(
$wÜd
)

46 ià(
	`¡¾’
(
$wÜd
)<2)  -1;

48 
$hi
 = 
	`Üd
(
$wÜd
{0});

49 ià(
$hi
==0)  -1;

51 
$lo
 = 
	`Üd
(
$wÜd
{1});

52 ià(
$lo
==0)  -1;

54  
$hi
*256+
$lo
;

55 
	}
}

57 
funùiÚ
 
	$£¬ch
(
$fe
,
$wÜd
,&
$¡©sLi¡
)

59 
$šdex
 = 
	`compu‹Index
(
$wÜd
);

60 ià(
$šdex
!=-1)

62 
	`f£ek
(
$fe
,
$šdex
*4+4);

63 
$šdex
 = 
	`»adIÁ
(
$fe
);

64 ià(
$šdex
)

66 
$¡¬t
=(
$¡©sLi¡
);

67 
$couÁ
=
$¡¬t
;

68 
	`f£ek
(
$fe
,
$šdex
);

69 
$w
 = 
	`»adSŒšg
(
$fe
);

70 
$w
)

72 
$¡©Idx
 = 
	`»adIÁ
(
$fe
);

73 ià(
$wÜd
==
	`sub¡r
(
$w
,0,
	`¡¾’
($word)))

75 
$¡©sLi¡
[
$couÁ
++]=
	`¬¿y
(

76 "wÜd"=>
$wÜd
,

77 "m©ch"=>
$w
,

78 "šdex"=>
$¡©Idx
,

79 "fuÎ"=>
	`¡¾’
(
$w
)==¡¾’(
$wÜd
),

80 "docs"=>
	`¬¿y
()

83 
$w
 = 
	`»adSŒšg
(
$fe
);

85 
$tÙ®Hi
=0;

86 
$tÙ®F»qHi
=0;

87 
$tÙ®F»qLo
=0;

88 
$couÁ
=
$¡¬t
;$couÁ<(
$¡©sLi¡
);$count++)

90 
$¡©Info
 = &
$¡©sLi¡
[
$couÁ
];

91 
$muÉl›r
 = 1;

93 ià(
$¡©Info
["fuÎ"]è
$muÉl›r
=2;

94 
	`f£ek
(
$fe
,
$¡©Info
["index"]);

95 
$numDocs
 = 
	`»adIÁ
(
$fe
);

96 
$docInfo
 = 
	`¬¿y
();

98 
$i
=0;$i<
$numDocs
;$i++)

100 
$idx
=
	`»adIÁ
(
$fe
);

101 
$äeq
=
	`»adIÁ
(
$fe
);

102 
$docInfo
[
$i
]=
	`¬¿y
("idx" => 
$idx
,

103 "äeq" => 
$äeq
>>1,

105 "hi" => 
$äeq
&1

107 ià(
$äeq
&1)

109 
$tÙ®Hi
++;

110 
$tÙ®F»qHi
+=
$äeq
*
$muÉl›r
;

114 
$tÙ®F»qLo
+=
$äeq
*
$muÉl›r
;

118 
$i
=0;$i<
$numDocs
;$i++)

120 
	`f£ek
(
$fe
,
$docInfo
[
$i
]["idx"]);

121 
$docInfo
[
$i
]["Çme"]=
	`»adSŒšg
(
$fe
);

122 
$docInfo
[
$i
]["u¾"]=
	`»adSŒšg
(
$fe
);

124 
$¡©Info
["docs"]=
$docInfo
;

126 
$tÙ®F»q
=(
$tÙ®Hi
+1)*
$tÙ®F»qLo
 + 
$tÙ®F»qHi
;

127 
$couÁ
=
$¡¬t
;$couÁ<(
$¡©sLi¡
);$count++)

129 
$¡©Info
 = &
$¡©sLi¡
[
$couÁ
];

130 
$muÉl›r
 = 1;

132 ià(
$¡©Info
["fuÎ"]è
$muÉl›r
=2;

133 
$i
=0;$i<(
$¡©Info
["docs"]);$i++)

135 
$docInfo
 = &
$¡©Info
["docs"];

137 
$äeq
=
$docInfo
[
$i
]["freq"];

138 ià(
$docInfo
[
$i
]["hi"])

140 
$¡©Info
["docs"][
$i
]["rank"]=

141 ()(
$äeq
*
$muÉl›r
+
$tÙ®F»qLo
)/
$tÙ®F»q
;

145 
$¡©Info
["docs"][
$i
]["rank"]=

146 ()(
$äeq
*
$muÉl›r
)/
$tÙ®F»q
;

152  
$¡©sLi¡
;

153 
	}
}

155 
funùiÚ
 
	$combše_»suÉs
(
$»suÉs
,&
$docs
)

157 
	`fÜ—ch
 (
$»suÉs
 
as
 
$wÜdInfo
)

159 
$docsLi¡
 = &
$wÜdInfo
["docs"];

160 
	`fÜ—ch
 (
$docsLi¡
 
as
 
$di
)

162 
$key
=
$di
["url"];

163 
$¿nk
=
$di
["rank"];

164 ià(
	`is£t
(
$docs
[
$key
]))

166 
$docs
[
$key
]["¿nk"]+=
$¿nk
;

170 
$docs
[
$key
] = 
	`¬¿y
("url"=>$key,

171 "Çme"=>
$di
["name"],

172 "¿nk"=>
$¿nk


175 
$docs
[
$key
]["wÜds"][] = 
	`¬¿y
(

176 "wÜd"=>
$wÜdInfo
["word"],

177 "m©ch"=>
$wÜdInfo
["match"],

178 "äeq"=>
$di
["freq"]

182  
$docs
;

183 
	}
}

185 
funùiÚ
 
	$f‹r_»suÉs
(
$docs
,&
$»quœedWÜds
,&
$fÜbidd’WÜds
)

187 
$f‹»dDocs
=
	`¬¿y
();

188 
	`li¡
 (
$key
, 
$v®
èğ
	`—ch
 (
$docs
))

190 
$wÜds
 = &
$docs
[
$key
]["words"];

191 
$cİy
=1;

192 ià((
$»quœedWÜds
)>0)

194 
	`fÜ—ch
 (
$»quœedWÜds
 
as
 
$»qWÜd
)

196 
$found
=0;

197 
	`fÜ—ch
 (
$wÜds
 
as
 
$wÜdInfo
)

199 
$found
 = 
$wÜdInfo
["wÜd"]==
$»qWÜd
;

200 ià(
$found
) ;

202 ià(!
$found
)

204 
$cİy
=0;

209 ià((
$fÜbidd’WÜds
)>0)

211 
	`fÜ—ch
 (
$wÜds
 
as
 
$wÜdInfo
)

213 ià(
	`š_¬¿y
(
$wÜdInfo
["wÜd"],
$fÜbidd’WÜds
))

215 
$cİy
=0;

220 ià(
$cİy
è
$f‹»dDocs
[
$key
]=
$docs
[$key];

222  
$f‹»dDocs
;

223 
	}
}

225 
funùiÚ
 
	$com·»_¿nk
(
$a
,
$b
)

227 ià(
$a
["¿nk"] =ğ
$b
["rank"])

231  (
$a
["¿nk"]>
$b
["rank"]) ? -1 : 1;

232 
	}
}

234 
funùiÚ
 
	$sÜt_»suÉs
(
$docs
,&
$sÜ‹d
)

236 
$sÜ‹d
 = 
$docs
;

237 
	`usÜt
(
$sÜ‹d
,"compare_rank");

238  
$sÜ‹d
;

239 
	}
}

241 
funùiÚ
 
	$»pÜt_»suÉs
(&
$docs
)

243 
echo
 "<div class=\"searchresults\">\n";

244 
echo
 "<table cellspacing=\"2\">\n";

245 
$numDocs
 = (
$docs
);

246 ià(
$numDocs
==0)

248 
echo
 " <tr>\n";

249 
echo
 " <td cŞ¥ª=\"2\">".
	`m©ches_‹xt
(0)."</td>\n";

250 
echo
 " </tr>\n";

254 
echo
 " <tr>\n";

255 
echo
 " <td cŞ¥ª=\"2\">".
	`m©ches_‹xt
(
$numDocs
);

256 
echo
 "\n";

257 
echo
 " </td>\n";

258 
echo
 " </tr>\n";

259 
$num
=1;

260 
	`fÜ—ch
 (
$docs
 
as
 
$doc
)

262 
echo
 " <tr>\n";

263 
echo
 " <td‡lign=\"right\">$num.</td>";

264 
echo
 "<td><¨şass=\"–\" h»f=\"".
$doc
["url"]."\">".$doc["name"]."</a></td>\n";

265 
echo
 " <tr>\n";

266 
echo
 " <td></td><td cÏss=\"tšy\">".
	`»pÜt_m©ches
()." ";

267 
	`fÜ—ch
 (
$doc
["wÜds"] 
as
 
$wÜdInfo
)

269 
$wÜd
 = 
$wÜdInfo
["word"];

270 
$m©chRight
 = 
	`sub¡r
(
$wÜdInfo
["m©ch"],
	`¡¾’
(
$wÜd
));

271 
echo
 "<b>$wÜd</b>$m©chRight(".
$wÜdInfo
["freq"].") ";

273 
echo
 " </td>\n";

274 
echo
 " </tr>\n";

275 
$num
++;

278 
echo
 "</table>\n";

279 
	}
}

281 
funùiÚ
 
	$maš
()

283 if(
	`¡rcmp
('4.1.0', 
	`phpv”siÚ
()) > 0)

285 
	`d›
("Error: PHP version 4.1.0 or‡bove„equired!");

287 ià(!(
$fe
=
	`fİ’
("search/search.idx","rb")))

289 
	`d›
("Error: Search index file could NOT be opened!");

291 ià(
	`»adH—d”
(
$fe
)!="DOXS")

293 
	`d›
("Error: Header of index file is invalid!");

295 
$qu”y
="";

296 ià(
	`¬¿y_key_exi¡s
("qu”y", 
$_GET
))

298 
$qu”y
=
$_GET
["query"];

300 
	`’d_fÜm
(
	`´eg_»¶aû
("/[^a-zA-Z0-9\-\_\.]/i", " ", 
$qu”y
 ));

301 
$»suÉs
 = 
	`¬¿y
();

302 
$»quœedWÜds
 = 
	`¬¿y
();

303 
$fÜbidd’WÜds
 = 
	`¬¿y
();

304 
$foundWÜds
 = 
	`¬¿y
();

305 
$wÜd
=
	`¡¹ok
(
$qu”y
," ");

306 
$wÜd
)

308 ià((
$wÜd
{0}=='+')è{ $wÜd=
	`sub¡r
($wÜd,1); 
$»quœedWÜds
[]=$word; }

309 ià((
$wÜd
{0}=='-')è{ $wÜd=
	`sub¡r
($wÜd,1); 
$fÜbidd’WÜds
[]=$word; }

310 ià(!
	`š_¬¿y
(
$wÜd
,
$foundWÜds
))

312 
$foundWÜds
[]=
$wÜd
;

313 
	`£¬ch
(
$fe
,
	`¡¹Şow”
(
$wÜd
),
$»suÉs
);

315 
$wÜd
=
	`¡¹ok
(" ");

317 
$docs
 = 
	`¬¿y
();

318 
	`combše_»suÉs
(
$»suÉs
,
$docs
);

321 
$f‹»dDocs
 = 
	`f‹r_»suÉs
(
$docs
,
$»quœedWÜds
,
$fÜbidd’WÜds
);

323 
$sÜ‹d
 = 
	`¬¿y
();

324 
	`sÜt_»suÉs
(
$f‹»dDocs
,
$sÜ‹d
);

326 
	`»pÜt_»suÉs
(
$sÜ‹d
);

327 
echo
 "</div>\n";

328 
	`’d_·ge
();

329 
	`fşo£
(
$fe
);

330 
	}
}

	@gcm/modulos/idiomas/config/config.php

1 <?
php


2 
	g$cÚfig
['Idioma…or defecto'] = 'es';

3 
	g$cÚfig
['Idiomas‡ctivados'][] = 'ca';

4 
	g$cÚfig
['Idiomas‡ctivados'][] = 'es';

5 
	g$cÚfig
['Directorio idiomas'] = 'DATOS/configuracion/idiomas/';

	@gcm/modulos/idiomas/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['Idioma…or defecto']='Idioma…redeterminado';

	@gcm/modulos/idiomas/eventos_usuario.php

1 <?
php


5 
	g$ev’tos
['precarga']['seleccion_idioma'][1] = '';

6 
	g$ev’tos
['precarga']['definir_idioma'][2] = '';

7 
	g$ev’tos
['cabeceraDerecha']['selector_idiomas'][1] = '';

	@gcm/modulos/idiomas/info.php

1 <?
php


2 
	g$idiomas
['nombre']="Idiomas";

3 
	g$idiomas
['title']="Administrar idiomas";

	@gcm/modulos/idiomas/lib/Idiomas.php

1 <?
php


18 
»quœe_Úû
(
GCM_DIR
.'lib/int/idiomas/lib/IdiomasCore.php');

40 şas 
	cIdiomas
 
ex‹nds
 
	mModulos
 {

42 
´iv©e
 
	m$iIdiomas
;

44 
funùiÚ
 
	$__cÚ¡ruù
() {

46 
·»Á
::
	`__cÚ¡ruù
();

48 
glob®
 
$gcm
;

50 
$´oyeùo
 = 
$gcm
->
	`cÚfig
('admin','Proyecto');

52 
$dœ_idiomas
 = 
$gcm
->
	`cÚfig
('idiomas','Directorio idiomas');

54 
$idiomaxdeãùo
 = 
$gcm
->
	`cÚfig
('idiomas','Idioma…or defecto');

56 
$idiomas_aùivados
 = 
$gcm
->
	`cÚfig
('idiomas','Idiomas‡ctivados');

58 
$cÚfigu¿ciÚ
 = 
	`¬¿y
Ğ'dœ_idiomas' => 
$dœ_idiomas


59 , 'idiomaxdeãùo' => 
$idiomaxdeãùo


60 , 'idiomas_aùivados' => 
$idiomas_aùivados


61 , '´oyeùo' => 
$´oyeùo


64 
$this
->
iIdiomas
 = 
Ãw
 
	`IdiomasCÜe
(
$cÚfigu¿ciÚ
);

74 
funùiÚ
 
	$š¡®aciÚ
(è{  
$this
->
iIdiomas
->
	`š¡®aciÚ
(); 
	}
}

82 
funùiÚ
 
	$defšœ_idioma
(){

84 
glob®
 
$gcm
;

86 iàĞ! 
	`is_fe
(
Rou‹r
::
$f
) ) {

89 
Rou‹r
::
$f
=Rou‹r::
$dd
.Rou‹r::
$s
.Rou‹r::
$c
;

91 iàĞ! 
	`is_fe
(
Rou‹r
::
$f
) ) {

98 
$gcm
->
	`»gi¡¿
(
__FILE__
, 
__LINE__
, 'Buscamosƒn otros idioamas');

100 
	`fÜ—ch
(
$this
->
iIdiomas
->
	`g‘IdiomasAùivados
(è
as
 
$key
 => 
$idioma
) {

101 
$fich”o_posibË
='Fe/'.
$key
.
Rou‹r
::
$s
.Rou‹r::
$c
;

102 iàĞ
	`is_fe
(
$fich”o_posibË
) ) {

103 
$idiomas_posibËs
[
$idioma
]=
$fich”o_posibË
;

108 iàĞ! 
	`is£t
(
$idiomas_posibËs
) ) {

109 
Rou‹r
::
$sš_cÚ‹nido
=
TRUE
;

112 } 
	`–£if
 ( 
	`couÁ
(
$idiomas_posibËs
) == 1 ) {

114 
	`li¡
(
$idioma
, 
Rou‹r
::
$f
èğ
	`—ch
(
$idiomas_posibËs
);

115 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"NØ£ƒncÚŒØcÚ‹nidØcÚƒÈidiom¨´ed‘”mšado, s´e£Á¨’ ".
$idioma
,'AVISO');

120 
	`li¡
(
$idioma
, 
Rou‹r
::
$f
èğ
	`—ch
(
$idiomas_posibËs
);

127 
Rou‹r
::
$sš_ŒaducciÚ
 = 
TRUE
;

131 
	}
}

143 
public
 
funùiÚ
 
	$£ËcciÚ_idioma
(è{  
$this
->
iIdiomas
->
	`£ËcciÚ_idioma
(); 
	}
}

149 
funùiÚ
 
	$´štFÜm
() {

151 
glob®
 
$_POST
, 
$gcm
 ;

153 
echo
 'MÃ³dulo sin‡cabar';

155 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','idiomas');

160 
	`šşude
(
$this
->
dœ_idiomas
."idiomas.php");

164 
	`šşude
(
$this
->
dœ_idiomas
."desactivados.php");

166 
	`šşude
 (
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('idiomas','html','form_idiomas.html'));

168 
	}
}

177 
public
 
funùiÚ
 
	$admši¡¿r
() {

179 
glob®
 
$gcm
;

182 
$´e£Á¬_cÚ‹nido
 = 
FALSE
;

184 iàĞ
	`is£t
(
$_POST
['conf'])) {

186 
	`šşude
(
GCM_DIR
."funciones/gcm_arrayFile.php");

187 
	`gcm_Ë”A¼ay
(
$ARCHIVO
, 
$_SESSION
[
$gcm
->
	`cÚfig
('admin','Proyecto').'-idioma'], 'si', 'si');

189 } 
	`–£if
 ( 
	`is£t
(
$_POST
['accion']) && $_POST['accion'] == 'escribir') {

191 
	`šşude
(
GCM_DIR
."funciones/gcm_arrayFile.php");

193 iàĞ! 
	`cİŸSeguridad
(
$ARCHIVO
) ) {

194 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'No se…udo hacer copia de seguridad','ADMIN');

198 ià(
	`gcm_esüibœA¼ay
(
$ARCHIVO
è==ğ
FALSE
){

199 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'No se…udo guardar†os cambios','ERROR');

200  
çl£
;

202 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Archivo modificado','AVISO');

204 
$this
->
	`´štFÜm
();

205  
Œue
;

207 } 
	`–£if
 ( 
	`is£t
(
$_POST
['idioma']) ) {

209 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'SÿmbŸ idiom¨´ed‘”mšadØ¨'.
$_POST
['idioma'],'AVISO');

211 
$gcm
->
	`cÚfig
('idiomas','Idiom¨pÜ deãùo',
$_POST
['idioma']);

213 
$this
->
	`´štFÜm
();

215 } 
	`–£if
 ( 
	`is£t
(
$_POST
['nuevoIdioma']) ) {

216 
$nomb»Idioma
=
$_POST
['idiomaNombre'];

217 
$codIdioma
=
	`sub¡r
(
$_POST
['idiomaNombre'],0,3);

220 
$¬chivoIdioma
=
$this
->
dœ_idiomas
."LG_".
$codIdioma
.".php";

221 ià(!
$fe
 = 
	`fİ’
(
$¬chivoIdioma
, "w")) {

222 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"NØ£…uedü—¸¬chivØidiom¨".
$¬chivoIdioma
,'ERROR');

223  
FALSE
;

225 
	`åuts
(
$fe
, "<?php\n");

226 
	`åuts
(
$fe
, "?>");

227 
	`fşo£
(
$fe
);

230 iàĞ
	`is£t
(
$_FILES
['imagenIdioma'])) {

231 
	`šşude
(
GCM_DIR
."lib/int/gcm_imagen.php");

232 
echo
 "CİŸndØimag’‡ DATOS/idiomas/".
$codIdioma
.".gif";

233 iàĞ! 
	`gcm_imag’_cİŸr
(
$_FILES
["imag’Idioma"],
$this
->
dœ_idiomas
."".
$codIdioma
.".gif") ) {

234 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'No se…udo subir imÃ¡gen','AVISO');

238 
	`šşude_Úû
(
GCM_DIR
."funciones/gcm_arrayFile.php");

239 iàĞ
	`gcm_ªyadœEËm’to
(
$this
->
dœ_idiomas
."idiomas.php", 
$codIdioma
, 
$nomb»Idioma
è==ğ
FALSE
 ) {

240 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'No se…udo‡Ã±adir idioma‚uevo','ERROR');

243 } 
	`–£if
 ( 
	`is£t
(
$_POST
['modificarIdioma']) ) {

244 
$nomb»Idioma
=
$_POST
['idiomaNombre'];

245 
$codIdioma
=
$_POST
['codIdioma'];

248 iàĞ
	`is£t
(
$_FILES
['imagenIdioma'])) {

249 
	`šşude
(
GCM_DIR
."lib/int/gcm_imagen.php");

250 
echo
 "CİŸndØimag’‡ DATOS/idiomas/".
$codIdioma
.".gif";

251 iàĞ! 
	`gcm_imag’_cİŸr
(
$_FILES
["imag’Idioma"],
$this
->
dœ_idiomas
."".
$codIdioma
.".gif") ) {

252 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'No se…udo subir imÃ¡gen','AVISO');

256 
	`šşude_Úû
(
GCM_DIR
."funciones/gcm_arrayFile.php");

257 iàĞ
	`gcm_ªyadœEËm’to
(
$this
->
dœ_idiomas
."idiomas.php", 
$codIdioma
, 
$nomb»Idioma
è==ğ
FALSE
 ) {

258 
$GCM_ERROR
[]="Mod:idiomas::No se…udo‡Ã±adir idioma‚uevo‡ DATOS/idiomas/idiomas.php";

260 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Idioma modificado','AVISO');

261 
$this
->
	`´štFÜm
();

263 } 
	`–£if
 ( 
	`is£t
(
$_POST
['eliminarIdioma']) ) {

265 
echo
 "PENDIENTE DE PROGRAMAR: Elimš¬ ".
$_POST
['codIdioma'];

271 } 
	`–£if
 ( 
	`is£t
(
$_POST
['desactivarIdioma']) ) {

273 
	`šşude
(
GCM_DIR
."funciones/gcm_arrayFile.php");

276 
$feIdiomas
=
$this
->
dœ_idiomas
."idiomas.php";

277 
$feDe§ùivados
=
$this
->
dœ_idiomas
."desactivados.php";

278 
$codIdioma
=
$_POST
['codIdioma'];

279 
$ÇmeIdioma
=
$_POST
['nameIdioma'];

281 iàĞ
	`gcm_ªyadœEËm’to
(
$feDe§ùivados
, 
$codIdioma
, 
$ÇmeIdioma
è==ğ
FALSE
 ) {

282 
$gcm
->
	`»gi¡¿
(
__FILE__
, 
__LINE__
, "NØ£…udØaÃ±adœƒËm’tØ’ ".
$feIdiomas
,'ERROR');

285 
	`gcm_–imš¬EËm’to
(
$feIdiomas
, 
$codIdioma
);

286 
$gcm
->
	`»gi¡¿
(
__FILE__
, 
__LINE__
, 'Idioma: '.
$ÇmeIdioma
." desactivado",'AVISO');

288 
$this
->
	`´štFÜm
();

290 } 
	`–£if
 ( 
	`is£t
(
$_POST
['activarIdioma']) ) {

292 
	`šşude
(
GCM_DIR
."funciones/gcm_arrayFile.php");

295 
$feIdiomas
=
$this
->
dœ_idiomas
."idiomas.php";

296 
$feDe§ùivados
=
$this
->
dœ_idiomas
."desactivados.php";

297 
$codIdioma
=
$_POST
['codIdioma'];

298 
$ÇmeIdioma
=
$_POST
['nameIdioma'];

300 iàĞ
	`gcm_ªyadœEËm’to
(
$feIdiomas
, 
$codIdioma
, 
$ÇmeIdioma
è==ğ
FALSE
 ) {

301 
$gcm
->
	`»gi¡¿
(
__FILE__
, 
__LINE__
, "NØ£…udØaÃ±adœƒËm’tØ’ ".
$feIdiomas
, 'ERROR');

304 
	`gcm_–imš¬EËm’to
(
$feDe§ùivados
, 
$codIdioma
);

305 
$gcm
->
	`»gi¡¿
(
__FILE__
, 
__LINE__
, 'Idioma: '.
$ÇmeIdioma
."‡ctivado",'AVISO');

307 
$this
->
	`´štFÜm
();

311 
$this
->
	`´štFÜm
();

315 
	}
}

323 
funùiÚ
 
	$£ËùÜ_idiomas
(è{ 
$this
->
iIdiomas
->
	`£ËùÜ_idiomas
(); 
	}
}

330 
funùiÚ
 
	$bªd”as
() {

332 
glob®
 
$gcm
;

334 
$this
->
iIdiomas
->
	`bªd”as
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('idiomas','html','banderas.html'));

335 
	}
}

	@gcm/modulos/idiomas/menuAdmin.php

1 <?
php


2 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['idiomas']['activado']=1;

3 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['idiomas']['nombre']="Idiomas";

4 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['idiomas']['title']="Administracion de†os diferentes idiomas";

5 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['idiomas']['link']="?m=idiomas&a=administrar";

	@gcm/modulos/imagenes/config/config.php

1 <?
php


2 
	g$cÚfig
['altoMaxImg']='800';

3 
	g$cÚfig
['altoMaxMiniatura']='200';

4 
	g$cÚfig
['anchoMaxImg']='1000';

5 
	g$cÚfig
['anchoMaxMiniatura']='300';

	@gcm/modulos/imagenes/config/config_ca.php

1 <?
php


2 
	g$cÚfig_DESC
['anchoMaxImg']='amplada mÃ xima de†es imatges';

3 
	g$cÚfig_DESC
['altoMaxImg']='Altura mÃ xima de†es imatges';

4 
	g$cÚfig_DESC
['anchoMaxMiniatura']='';

5 
	g$cÚfig_DESC
['altoMaxMiniatura']='';

	@gcm/modulos/imagenes/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['anchoMaxImg']='';

3 
	g$cÚfig_DESC
['altoMaxImg']='';

4 
	g$cÚfig_DESC
['anchoMaxMiniatura']='';

5 
	g$cÚfig_DESC
['altoMaxMiniatura']='';

	@gcm/modulos/imagenes/eventos_admin.php

1 <?
php


7 
	g$ev’tos
['columna']['formulario'][3] = '';

13 
	g$acciÚes
['imagenes']['formulario'][] = 'editor';

	@gcm/modulos/imagenes/eventos_usuario.php

1 <?
php


19 
	g$ev’tos
['postcontenido']['imagenes2thickbox'][3] = '';

	@gcm/modulos/imagenes/lib/Imagenes.php

1 <?
php


21 şas 
	cImag’es
 
ex‹nds
 
	mModulos
 {

23 
public
 
	m$®toMaxImg
;

24 
public
 
	m$ªchoMaxImg
;

25 
public
 
	m$®toMaxMšŸtu¿
;

26 
public
 
	m$ªchoMaxMšŸtu¿
;

30 
´iv©e
 
	m$´oyeùo
;

34 
´iv©e
 
	m$idioma
;

38 
funùiÚ
 
	$__cÚ¡ruù
() {

40 
glob®
 
$gcm
;

42 
·»Á
::
	`__cÚ¡ruù
();

44 
$this
->
®toMaxImg
 = $this->
	`cÚfig
('altoMaxImg');

45 
$this
->
ªchoMaxImg
 = $this->
	`cÚfig
('anchoMaxImg');

46 
$this
->
®toMaxMšŸtu¿
 = $this->
	`cÚfig
('altoMaxMiniatura');

47 
$this
->
ªchoMaxMšŸtu¿
 = $this->
	`cÚfig
('anchoMaxMiniatura');

49 
$this
->
´oyeùo
 = 
$gcm
->
	`cÚfig
('admin','Proyecto');

50 
$this
->
idioma
 = 
$gcm
->
	`cÚfig
('idiomas','Idioma…or defecto');

63 
funùiÚ
 
	$g®”Ÿ
(
$e
, 
$¬gs
 = 
FALSE
) {

65 
glob®
 
$gcm
;

67 
$£cciÚ
 = ( 
	`is£t
(
$_REQUEST
['s']èè? $_REQUEST['s'] : 
FALSE
;

68 iàĞ! 
$£cciÚ
 ) $£cciÚ = 
Rou‹r
::
$dd
.Rou‹r::
$s
 ;

69 
$£cciÚ
 = 
	`com´ob¬_b¬¿
($seccion);

70 iàĞ
	`¡½os
(
$£cciÚ
,
Rou‹r
::
$dd
è==ğ
FALSE
 ) {

71 
$£cciÚ
 = 
Rou‹r
::
$dd
.$seccion;

74 
$imag’_aùu®
 = ( 
	`is£t
(
$_GET
['img']èè? $_GET['img'] : 
FALSE
 ;

76 iàĞ
Rou‹r
::
$fÜm©o
 != 'ajax' ) {

78 
$gcm
->
t™ulo
 = 
	`l™”®
('GalerÃ­a de imÃ¡genes',3);

79 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','imagenes');

80 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','imagenes');

84 
$this
->
	`lib»rŸs_js
('jquery.ui.widget.js');

85 
$this
->
	`lib»rŸs_js
('jquery.iframe-transport.js');

86 
$this
->
	`lib»rŸs_js
('jquery.fileupload.js');

88 
$this
->
	`lib»rŸs_js
('jquery.colorbox.js');

89 
$this
->
	`javasüts
('imagenes.js');

90 
$this
->
	`javasüts
('aplicar_colorbox.js');

94 <
div
 
id
='thumbnails' >

96 <?
php


99 iàĞ
	`³rmiso
('administrar_imagenes') ) {

103 <
fÜm
>

104 <
šput
 
¡yË
="di¥Ïy:‚Úe;" 
Úşick
="subida_imag’es_jqu”y('feu¶ßd','´ogeso','g®”Ÿ','<?ph°echØ$£cciÚ ?>');" 
id
="feu¶ßd" 
ty³
="fe" 
Çme
="fes[]" 
¶aûhŞd”
="Subœ imÃ¡g’es" 
d©a
-
u¾
="?fÜm©o÷jax&m=imag’es&a=u¶ßd&£cciÚ=<?ph°echØ$£cciÚ;?>" 
muÉË
>

105 <
šput
 
Úşick
="$('#feu¶ßd').şick();»tuº f®£;" 
ty³
="subm™" 
v®ue
="<?phpƒcho†iteral('Subir imagen');?>">

106 </
fÜm
>

107 <
div
 
id
="progreso">

108 <
div
 
şass
="b¬" 
¡yË
="width: 0%;"></div>

109 </
div
>

110 <
div
 
id
="mensajes"></div>

112 <?
php
 } ?>

114 <
div
 
id
='cajaImg'>

116 <?
php


117 
	`šşude_Úû
(
GCM_DIR
.'lib/int/gcm_imagen.php');

118 
$d©os
 = 
	`gcm_li¡aImag’es
(
$£cciÚ
, 5);

119 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('imagenes','html','contenido.phtml'));

121 </
div
> <!-- 
Aÿba
 
ÿjaImg
 -->

122 </
div
> <!-- 
Aÿba
 
thumbÇs
 -->

123 <?
php


125 
	}
}

134 
funùiÚ
 
	$imag’es2thickbox
(
$e
, 
$¬gs
=
FALSE
) {

136 
glob®
 
$gcm
;

138 
$this
->
	`lib»rŸs_js
('jquery.colorbox.js');

139 
$this
->
	`javasüts
('imagenes.js');

141 <
süt
>

142 
	`addLßdEv’t
(
	`funùiÚ
(){

143 
	`img2thickbox
();

145 </
süt
>

146 <?
php


147 
	}
}

	@gcm/modulos/imagenes/lib/ImagenesAdmin.php

1 <?
php


8 
»quœe_Úû
 ( 'Imagenes.php' );

14 şas 
	cImag’esAdmš
 
ex‹nds
 
	mImag’es
 {

18 
funùiÚ
 
	$__cÚ¡ruù
() {

20 
glob®
 
$gcm
;

22 
·»Á
::
	`__cÚ¡ruù
();

35 
funùiÚ
 
	$fÜmuÏrio
(
$e
, 
$¬gs
 = 
FALSE
) {

37 iàĞ! 
	`³rmiso
('administrar_imagenes') )  ;

40 
$this
->
	`lib»rŸs_js
('jquery.ui.widget.js');

41 
$this
->
	`lib»rŸs_js
('jquery.iframe-transport.js');

42 
$this
->
	`lib»rŸs_js
('jquery.fileupload.js');

43 
$this
->
	`lib»rŸs_js
('jquery.colorbox.js');

44 
$this
->
	`javasüts
('imagenes.js');

45 
$this
->
	`javasüts
('aplicar_colorbox.js');

46 
$cÚ‹nido
 = '<div id="thumbnails_columna"></div>';

48 
$·Ãl
 = 
	`¬¿y
();

49 
$·Ãl
['t™ulo'] = 
	`l™”®
('ImÃ¡genes',3);

50 
$·Ãl
['href'] = '/imagenes/galeria';

51 
$·Ãl
['ocuÉo'] = 
TRUE
;

52 
$·Ãl
['jajax'] = 
Rou‹r
::
$dœ
.'?fÜm©o÷jax&m=imag’es&a=g®”Ÿ_cŞumÇ&s='.Rou‹r::
$dd
.Rou‹r::
$s
;

53 
$·Ãl
['cÚ‹nido'] = 
$cÚ‹nido
;

55 
Temas
::
	`·Ãl
(
$·Ãl
);

58 
	}
}

64 
funùiÚ
 
	$bÜ¿rImg
() {

66 
glob®
 
$gcm
;

68 
	`ob_’d_ş—n
();

69 
	`šşude_Úû
(
GCM_DIR
.'lib/int/gcm_imagen.php');

70 iàĞ! 
	`gcm_bÜ¿rImag’
(
$_GET
['img']) ) {

71 
´št
 
	`jsÚ_’code
(
	`¬¿y
('Error‡l borrar imagen'));

73 
$»s
[] = 0;

74 
$»s
[] = 
	`dœÇme
(
$_GET
['img']) ;

75 
´št
 
	`jsÚ_’code
(
$»s
);

77 
	`ex™
();

78 
	}
}

84 
funùiÚ
 
	$g®”Ÿ_cŞumÇ
(
$e
, 
$¬gs
 = 
FALSE
) {

86 
glob®
 
$gcm
;

88 
$£cciÚ
 = ( 
	`is£t
(
$_REQUEST
['s']èè? $_REQUEST['s'] : 
FALSE
;

89 iàĞ! 
$£cciÚ
 ) $£cciÚ = 
Rou‹r
::
$dd
.Rou‹r::
$s
 ;

90 
$£cciÚ
 = 
	`com´ob¬_b¬¿
($seccion);

91 iàĞ
	`¡½os
(
$£cciÚ
,
Rou‹r
::
$dd
è==ğ
FALSE
 ) {

92 
$£cciÚ
 = 
Rou‹r
::
$dd
.$seccion;

96 <
div
 
id
='thumbnails_columna' >

98 <?
php


101 iàĞ
	`³rmiso
('administrar_imagenes') ) {

105 <
fÜm
>

106 <
šput
 
¡yË
="di¥Ïy:‚Úe;" 
Úşick
="subida_imag’es_jqu”y('feu¶ßd_cŞumÇ','´og»so_cŞumÇ','g®”Ÿ_cŞumÇ','<?ph°echØ$£cciÚ ?>');" 
id
="feu¶ßd_cŞumÇ" 
ty³
="fe" 
Çme
="fes[]" 
¶aûhŞd”
="Subœ imÃ¡g’es" 
d©a
-
u¾
="?fÜm©o÷jax&m=imag’es&a=u¶ßd&£cciÚ=<?ph°echØ$£cciÚ;?>" 
muÉË
>

107 <
šput
 
Úşick
="$('#feu¶ßd_cŞumÇ').şick();»tuº f®£;" 
ty³
="subm™" 
v®ue
="<?phpƒcho†iteral('Subir imagen');?>">

108 </
fÜm
>

109 <
div
 
id
="progreso_columna">

110 <
div
 
şass
="b¬" 
¡yË
="width: 0%;"></div>

111 </
div
>

112 <
div
 
id
="mensajes"></div>

114 <?
php
 } ?>

116 <
div
 
id
='cajaImg'>

118 <?
php


119 
	`šşude_Úû
(
GCM_DIR
.'lib/int/gcm_imagen.php');

120 
$d©os
 = 
	`gcm_li¡aImag’es
(
$£cciÚ
, 5);

121 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('imagenes','html','columna.phtml'));

123 </
div
> <!-- 
Aÿba
 
ÿjaImg
 -->

124 </
div
> <!-- 
Aÿba
 
thumbÇs
 -->

125 <?
php


127 
	}
}

133 
funùiÚ
 
	$u¶ßd
(
$e
, 
$¬gs
 = 
FALSE
) {

135 
glob®
 
$gcm
;

137 
	`»quœe
('UploadHandler.php');

138 
$İciÚes
 = 
	`¬¿y
(

139 'image_v”siÚs' => 
	`¬¿y
(

140 '' => 
	`¬¿y
(

141 'max_width' => 
$this
->
ªchoMaxImg
,

142 'max_height' => 
$this
->
®toMaxImg
,

145 'thumbÇ' => 
	`¬¿y
(

146 'max_width' => 
$this
->
ªchoMaxMšŸtu¿
,

147 'max_height' => 
$this
->
®toMaxMšŸtu¿


152 
$u¶ßd_hªdËr
 = 
Ãw
 
	`U¶ßdHªdËr
(
$İciÚes
);

155 
	}
}

	@gcm/modulos/imagenes/lib/UploadHandler.php

1 <?
php


13 şas 
	cU¶ßdHªdËr


15 
´Ùeùed
 
	m$İtiÚs
;

18 
´Ùeùed
 
	m$”rÜ_mes§ges
 = 
¬¿y
(

37 
funùiÚ
 
	$__cÚ¡ruù
(
$İtiÚs
 = 
nuÎ
, 
$š™Ÿlize
 = 
Œue
) {

39 
glob®
 
$gcm
;

41 
$£cciÚ
 = ( 
	`is£t
(
$_REQUEST
['£cciÚ']èè? $_REQUEST['£cciÚ'] : 
Rou‹r
::
$dd
.Rou‹r::
$s
;

43 
$this
->
İtiÚs
 = 
	`¬¿y
(

44 'süt_u¾' => 
$this
->
	`g‘_fuÎ_u¾
().'/',

45 'u¶ßd_dœ' => 
$£cciÚ
,

46 'u¶ßd_u¾' => 
$this
->
	`g‘_fuÎ_u¾
().'/'.
$£cciÚ
,

47 'u£r_dœs' => 
çl£
,

54 'acûss_cÚŒŞ_®low_üed’tŸls' => 
çl£
,

55 'acûss_cÚŒŞ_®low_m‘hods' => 
	`¬¿y
(

64 'acûss_cÚŒŞ_®low_h—d”s' => 
	`¬¿y
(

70 'dowÆßd_vŸ_php' => 
çl£
,

77 'max_fe_size' => 
nuÎ
,

80 'max_numb”_of_fes' => 
nuÎ
,

82 'max_width' => 
nuÎ
,

83 'max_height' => 
nuÎ
,

87 'disÿrd_abÜ‹d_u¶ßds' => 
Œue
,

89 'Ü›Á_image' => 
çl£
,

90 'image_v”siÚs' => 
	`¬¿y
(

108 'thumbÇ' => 
	`¬¿y
(

114 ià(
$İtiÚs
) {

115 
$this
->
İtiÚs
 = 
	`¬¿y_m”ge
($this->İtiÚs, 
$İtiÚs
);

117 ià(
$š™Ÿlize
) {

118 
$this
->
	`š™Ÿlize
();

122 
´Ùeùed
 
funùiÚ
 
	$š™Ÿlize
() {

123 
$_SERVER
['REQUEST_METHOD']) {

126 
$this
->
	`h—d
();

129 
$this
->
	`g‘
();

134 
$this
->
	`po¡
();

137 
$this
->
	`d–‘e
();

140 
$this
->
	`h—d”
('HTTP/1.1 405 Method Not Allowed');

142 
	}
}

144 
´Ùeùed
 
funùiÚ
 
	$g‘_fuÎ_u¾
() {

145 
$h‰ps
 = !
	`em±y
(
$_SERVER
['HTTPS']) && $_SERVER['HTTPS'] !== 'off';

147 (
$h‰ps
 ? 'https://' : 'http://').

148 (!
	`em±y
(
$_SERVER
['REMOTE_USER']) ? $_SERVER['REMOTE_USER'].'@' : '').

149 (
	`is£t
(
$_SERVER
['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : ($_SERVER['SERVER_NAME'].

150 (
$h‰ps
 && 
$_SERVER
['SERVER_PORT'] === 443 ||

151 
$_SERVER
['SERVER_PORT'] === 80 ? '' : ':'.$_SERVER['SERVER_PORT']))).

152 
	`sub¡r
(
$_SERVER
['SCRIPT_NAME'],0, 
	`¡¼pos
($_SERVER['SCRIPT_NAME'], '/'));

153 
	}
}

155 
´Ùeùed
 
funùiÚ
 
	$g‘_u£r_id
() {

156 @
	`£ssiÚ_¡¬t
();

157  
	`£ssiÚ_id
();

158 
	}
}

160 
´Ùeùed
 
funùiÚ
 
	$g‘_u£r_·th
() {

161 ià(
$this
->
İtiÚs
['user_dirs']) {

162  
$this
->
	`g‘_u£r_id
().'/';

165 
	}
}

167 
´Ùeùed
 
funùiÚ
 
	$g‘_u¶ßd_·th
(
$fe_Çme
 = 
nuÎ
, 
$v”siÚ
 =‚ull) {

168 
$fe_Çme
 = $file_name ? $file_name : '';

169 
$v”siÚ_·th
 = 
	`em±y
(
$v”siÚ
) ? '' : $version.'/';

170  
$this
->
İtiÚs
['u¶ßd_dœ'].$this->
	`g‘_u£r_·th
()

171 .
$v”siÚ_·th
.
$fe_Çme
;

172 
	}
}

174 
´Ùeùed
 
funùiÚ
 
	$g‘_qu”y_£·¿tÜ
(
$u¾
) {

175  
	`¡½os
(
$u¾
, '?'è==ğ
çl£
 ? '?' : '&';

176 
	}
}

178 
´Ùeùed
 
funùiÚ
 
	$g‘_dowÆßd_u¾
(
$fe_Çme
, 
$v”siÚ
 = 
nuÎ
) {

179 ià(
$this
->
İtiÚs
['download_via_php']) {

180 
$u¾
 = 
$this
->
İtiÚs
['script_url']

181 .
$this
->
	`g‘_qu”y_£·¿tÜ
($this->
İtiÚs
['script_url'])

182 .'fe='.
	`¿wu¾’code
(
$fe_Çme
);

183 ià(
$v”siÚ
) {

184 
$u¾
 .ğ'&v”siÚ='.
	`¿wu¾’code
(
$v”siÚ
);

186  
$u¾
.'&download=1';

188 
$v”siÚ_·th
 = 
	`em±y
(
$v”siÚ
è? '' : 
	`¿wu¾’code
($version).'/';

189  
$this
->
İtiÚs
['u¶ßd_u¾'].$this->
	`g‘_u£r_·th
()

190 .
$v”siÚ_·th
.
	`¿wu¾’code
(
$fe_Çme
);

191 
	}
}

193 
´Ùeùed
 
funùiÚ
 
	$£t_fe_d–‘e_´İ”t›s
(
$fe
) {

194 
$fe
->
d–‘e_u¾
 = 
$this
->
İtiÚs
['script_url']

195 .
$this
->
	`g‘_qu”y_£·¿tÜ
($this->
İtiÚs
['script_url'])

196 .'fe='.
	`¿wu¾’code
(
$fe
->
Çme
);

197 
$fe
->
d–‘e_ty³
 = 
$this
->
İtiÚs
['delete_type'];

198 ià(
$fe
->
d–‘e_ty³
 !== 'DELETE') {

199 
$fe
->
d–‘e_u¾
 .= '&_method=DELETE';

201 ià(
$this
->
İtiÚs
['access_control_allow_credentials']) {

202 
$fe
->
d–‘e_w™h_üed’tŸls
 = 
Œue
;

204 
	}
}

208 
´Ùeùed
 
funùiÚ
 
	$fix_š‹g”_ov”æow
(
$size
) {

209 ià(
$size
 < 0) {

210 
$size
 +ğ2.0 * (
PHP_INT_MAX
 + 1);

212  
$size
;

213 
	}
}

215 
´Ùeùed
 
funùiÚ
 
	$g‘_fe_size
(
$fe_·th
, 
$ş—r_¡©_ÿche
 = 
çl£
) {

216 ià(
$ş—r_¡©_ÿche
) {

217 
	`ş—r¡©ÿche
(
Œue
, 
$fe_·th
);

219  
$this
->
	`fix_š‹g”_ov”æow
(
	`fesize
(
$fe_·th
));

221 
	}
}

223 
´Ùeùed
 
funùiÚ
 
	$is_v®id_fe_objeù
(
$fe_Çme
) {

224 
$fe_·th
 = 
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
);

225 ià(
	`is_fe
(
$fe_·th
è&& 
$fe_Çme
[0] !== '.') {

226  
Œue
;

228  
çl£
;

229 
	}
}

231 
´Ùeùed
 
funùiÚ
 
	$g‘_fe_objeù
(
$fe_Çme
) {

232 ià(
$this
->
	`is_v®id_fe_objeù
(
$fe_Çme
)) {

233 
$fe
 = 
Ãw
 
	`¡dCÏss
();

234 
$fe
->
Çme
 = 
$fe_Çme
;

235 
$fe
->
size
 = 
$this
->
	`g‘_fe_size
(

236 
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
)

238 
$fe
->
u¾
 = 
$this
->
	`g‘_dowÆßd_u¾
($fe->
Çme
);

239 
	`fÜ—ch
(
$this
->
İtiÚs
['image_v”siÚs'] 
as
 
$v”siÚ
 => 
$İtiÚs
) {

240 ià(!
	`em±y
(
$v”siÚ
)) {

241 ià(
	`is_fe
(
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
, 
$v”siÚ
))) {

242 
$fe
->{
$v”siÚ
.'_u¾'} = 
$this
->
	`g‘_dowÆßd_u¾
(

243 
$fe
->
Çme
,

244 
$v”siÚ


249 
$this
->
	`£t_fe_d–‘e_´İ”t›s
(
$fe
);

250  
$fe
;

252  
nuÎ
;

253 
	}
}

255 
´Ùeùed
 
funùiÚ
 
g‘_fe_objeùs
(
$™”©iÚ_m‘hod
 = 'get_file_object') {

256 
$u¶ßd_dœ
 = 
$this
->
g‘_u¶ßd_·th
();

257 ià(!
is_dœ
(
$u¶ßd_dœ
)) {

258  
¬¿y
();

260  
¬¿y_v®ues
(
¬¿y_f‹r
(
¬¿y_m­
(

261 
¬¿y
(
$this
, 
$™”©iÚ_m‘hod
),

262 
sÿndœ
(
$u¶ßd_dœ
)

266 
´Ùeùed
 
funùiÚ
 
	$couÁ_fe_objeùs
() {

267  
	`couÁ
(
$this
->
	`g‘_fe_objeùs
('is_valid_file_object'));

268 
	}
}

270 
´Ùeùed
 
funùiÚ
 
	$ü—‹_sÿËd_image
(
$fe_Çme
, 
$v”siÚ
, 
$İtiÚs
) {

271 
$fe_·th
 = 
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
);

272 ià(!
	`em±y
(
$v”siÚ
)) {

273 
$v”siÚ_dœ
 = 
$this
->
	`g‘_u¶ßd_·th
(
nuÎ
, 
$v”siÚ
);

274 ià(!
	`is_dœ
(
$v”siÚ_dœ
)) {

275 
	`mkdœ
(
$v”siÚ_dœ
, 
$this
->
İtiÚs
['mkdœ_mode'], 
Œue
);

277 
$Ãw_fe_·th
 = 
$v”siÚ_dœ
.'/'.
$fe_Çme
;

279 
$Ãw_fe_·th
 = 
$fe_·th
;

281 
	`li¡
(
$img_width
, 
$img_height
èğ@
	`g‘imagesize
(
$fe_·th
);

282 ià(!
$img_width
 || !
$img_height
) {

283  
çl£
;

285 
$sÿË
 = 
	`mš
(

286 
$İtiÚs
['max_width'] / 
$img_width
,

287 
$İtiÚs
['max_height'] / 
$img_height


289 ià(
$sÿË
 >= 1) {

290 ià(
$fe_·th
 !=ğ
$Ãw_fe_·th
) {

291  
	`cİy
(
$fe_·th
, 
$Ãw_fe_·th
);

293  
Œue
;

295 
$Ãw_width
 = 
$img_width
 * 
$sÿË
;

296 
$Ãw_height
 = 
$img_height
 * 
$sÿË
;

297 
$Ãw_img
 = @
	`imageü—‹ŒuecŞÜ
(
$Ãw_width
, 
$Ãw_height
);

298 
	`¡¹Şow”
(
	`sub¡r
(
	`¡¼chr
(
$fe_Çme
, '.'), 1))) {

301 
$¤c_img
 = @
	`imageü—‹äomj³g
(
$fe_·th
);

302 
$wr™e_image
 = 'imagejpeg';

303 
$image_qu®™y
 = 
	`is£t
(
$İtiÚs
['jpeg_quality']) ?

304 
$İtiÚs
['jpeg_quality'] : 75;

307 @
	`imagecŞÜŒª¥¬’t
(
$Ãw_img
, @
	`imagecŞÜ®loÿ‹
($new_img, 0, 0, 0));

308 
$¤c_img
 = @
	`imageü—‹äomgif
(
$fe_·th
);

309 
$wr™e_image
 = 'imagegif';

310 
$image_qu®™y
 = 
nuÎ
;

313 @
	`imagecŞÜŒª¥¬’t
(
$Ãw_img
, @
	`imagecŞÜ®loÿ‹
($new_img, 0, 0, 0));

314 @
	`imag—ÍhabËndšg
(
$Ãw_img
, 
çl£
);

315 @
	`image§v—Íha
(
$Ãw_img
, 
Œue
);

316 
$¤c_img
 = @
	`imageü—‹äom²g
(
$fe_·th
);

317 
$wr™e_image
 = 'imagepng';

318 
$image_qu®™y
 = 
	`is£t
(
$İtiÚs
['png_quality']) ?

319 
$İtiÚs
['png_quality'] : 9;

322 
$¤c_img
 = 
nuÎ
;

324 
$sucûss
 = 
$¤c_img
 && @
	`imagecİy»§m¶ed
(

325 
$Ãw_img
,

326 
$¤c_img
,

328 
$Ãw_width
,

329 
$Ãw_height
,

330 
$img_width
,

331 
$img_height


332 è&& 
	`$wr™e_image
(
$Ãw_img
, 
$Ãw_fe_·th
, 
$image_qu®™y
);

334 @
	`imagede¡roy
(
$¤c_img
);

335 @
	`imagede¡roy
(
$Ãw_img
);

336  
$sucûss
;

337 
	}
}

339 
´Ùeùed
 
funùiÚ
 
	$g‘_”rÜ_mes§ge
(
$”rÜ
) {

340  
	`¬¿y_key_exi¡s
(
$”rÜ
, 
$this
->
”rÜ_mes§ges
) ?

341 
$this
->
”rÜ_mes§ges
[
$”rÜ
] : $error;

342 
	}
}

344 
funùiÚ
 
	$g‘_cÚfig_by‹s
(
$v®
) {

345 
$v®
 = 
	`Œim
($val);

346 
$Ï¡
 = 
	`¡¹Şow”
(
$v®
[
	`¡¾’
($val)-1]);

347 
$Ï¡
) {

349 
$v®
 *= 1024;

351 
$v®
 *= 1024;

353 
$v®
 *= 1024;

355  
$this
->
	`fix_š‹g”_ov”æow
(
$v®
);

356 
	}
}

358 
´Ùeùed
 
funùiÚ
 
	$v®id©e
(
$u¶ßded_fe
, 
$fe
, 
$”rÜ
, 
$šdex
) {

359 ià(
$”rÜ
) {

360 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
(
$”rÜ
);

361  
çl£
;

363 
$cÚ‹Á_Ëngth
 = 
$this
->
	`fix_š‹g”_ov”æow
(
	`štv®
(
$_SERVER
['CONTENT_LENGTH']));

364 
$po¡_max_size
 = 
$this
->
	`g‘_cÚfig_by‹s
(
	`ši_g‘
('post_max_size'));

365 ià(
$po¡_max_size
 && (
$cÚ‹Á_Ëngth
 > $post_max_size)) {

366 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('post_max_size');

367  
çl£
;

369 ià(!
	`´eg_m©ch
(
$this
->
İtiÚs
['acû±_fe_ty³s'], 
$fe
->
Çme
)) {

370 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('accept_file_types');

371  
çl£
;

373 ià(
$u¶ßded_fe
 && 
	`is_u¶ßded_fe
($uploaded_file)) {

374 
$fe_size
 = 
$this
->
	`g‘_fe_size
(
$u¶ßded_fe
);

376 
$fe_size
 = 
$cÚ‹Á_Ëngth
;

378 ià(
$this
->
İtiÚs
['max_file_size'] && (

379 
$fe_size
 > 
$this
->
İtiÚs
['max_file_size'] ||

380 
$fe
->
size
 > 
$this
->
İtiÚs
['max_file_size'])

382 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('max_file_size');

383  
çl£
;

385 ià(
$this
->
İtiÚs
['min_file_size'] &&

386 
$fe_size
 < 
$this
->
İtiÚs
['min_file_size']) {

387 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('min_file_size');

388  
çl£
;

390 ià(
	`is_št
(
$this
->
İtiÚs
['max_number_of_files']) && (

391 
$this
->
	`couÁ_fe_objeùs
(è>ğ$this->
İtiÚs
['max_number_of_files'])

393 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('max_number_of_files');

394  
çl£
;

396 
	`li¡
(
$img_width
, 
$img_height
èğ@
	`g‘imagesize
(
$u¶ßded_fe
);

397 ià(
	`is_št
(
$img_width
)) {

398 ià(
$this
->
İtiÚs
['max_width'] && 
$img_width
 > $this->options['max_width']) {

399 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('max_width');

400  
çl£
;

402 ià(
$this
->
İtiÚs
['max_height'] && 
$img_height
 > $this->options['max_height']) {

403 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('max_height');

404  
çl£
;

406 ià(
$this
->
İtiÚs
['mš_width'] && 
$img_width
 < $this->options['min_width']) {

407 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('min_width');

408  
çl£
;

410 ià(
$this
->
İtiÚs
['mš_height'] && 
$img_height
 < $this->options['min_height']) {

411 
$fe
->
”rÜ
 = 
$this
->
	`g‘_”rÜ_mes§ge
('min_height');

412  
çl£
;

415  
Œue
;

416 
	}
}

418 
´Ùeùed
 
funùiÚ
 
	$upcouÁ_Çme_ÿÎback
(
$m©ches
) {

419 
$šdex
 = 
	`is£t
(
$m©ches
[1]è? 
	`štv®
($matches[1]) + 1 : 1;

420 
$ext
 = 
	`is£t
(
$m©ches
[2]) ? $matches[2] : '';

421  ' ('.
$šdex
.')'.
$ext
;

422 
	}
}

424 
´Ùeùed
 
funùiÚ
 
	$upcouÁ_Çme
(
$Çme
) {

425  
	`´eg_»¶aû_ÿÎback
(

427 
	`¬¿y
(
$this
, 'upcount_name_callback'),

428 
$Çme
,

431 
	}
}

433 
´Ùeùed
 
funùiÚ
 
	$g‘_unique_f’ame
(
$Çme
, 
$ty³
, 
$šdex
, 
$cÚ‹Á_¿nge
) {

434 
	`is_dœ
(
$this
->
	`g‘_u¶ßd_·th
(
$Çme
))) {

435 
$Çme
 = 
$this
->
	`upcouÁ_Çme
($name);

438 
$u¶ßded_by‹s
 = 
$this
->
	`fix_š‹g”_ov”æow
(
	`štv®
(
$cÚ‹Á_¿nge
[1]));

439 
	`is_fe
(
$this
->
	`g‘_u¶ßd_·th
(
$Çme
))) {

440 ià(
$u¶ßded_by‹s
 ==ğ
$this
->
	`g‘_fe_size
(

441 
$this
->
	`g‘_u¶ßd_·th
(
$Çme
))) {

444 
$Çme
 = 
$this
->
	`upcouÁ_Çme
($name);

446  
$Çme
;

447 
	}
}

449 
´Ùeùed
 
funùiÚ
 
	$Œim_fe_Çme
(
$Çme
, 
$ty³
, 
$šdex
, 
$cÚ‹Á_¿nge
) {

453 
$Çme
 = 
	`Œim
(
	`ba£Çme
(
	`¡r¦ashes
($name)), ".\x00..\x20");

455 ià(!
$Çme
) {

456 
$Çme
 = 
	`¡r_»¶aû
('.', '-', 
	`miüÙime
(
Œue
));

459 ià(
	`¡½os
(
$Çme
, '.'è==ğ
çl£
 &&

460 
	`´eg_m©ch
('/^image\/(gif|j³?g|²g)/', 
$ty³
, 
$m©ches
)) {

461 
$Çme
 .ğ'.'.
$m©ches
[1];

463  
$Çme
;

464 
	}
}

466 
´Ùeùed
 
funùiÚ
 
	$g‘_fe_Çme
(
$Çme
, 
$ty³
, 
$šdex
, 
$cÚ‹Á_¿nge
) {

467  
$this
->
	`g‘_unique_f’ame
(

468 
$this
->
	`Œim_fe_Çme
(
$Çme
, 
$ty³
, 
$šdex
, 
$cÚ‹Á_¿nge
),

469 
$ty³
,

470 
$šdex
,

471 
$cÚ‹Á_¿nge


473 
	}
}

475 
´Ùeùed
 
funùiÚ
 
	$hªdË_fÜm_d©a
(
$fe
, 
$šdex
) {

477 
	}
}

479 
´Ùeùed
 
funùiÚ
 
	$Ü›Á_image
(
$fe_·th
) {

480 ià(!
	`funùiÚ_exi¡s
('exif_read_data')) {

481  
çl£
;

483 
$exif
 = @
	`exif_»ad_d©a
(
$fe_·th
);

484 ià(
$exif
 ==ğ
çl£
) {

485  
çl£
;

487 
$Ü›Á©iÚ
 = 
	`štv®
(@
$exif
['Orientation']);

488 ià(!
	`š_¬¿y
(
$Ü›Á©iÚ
, 
	`¬¿y
(3, 6, 8))) {

489  
çl£
;

491 
$image
 = @
	`imageü—‹äomj³g
(
$fe_·th
);

492 
$Ü›Á©iÚ
) {

494 
$image
 = @
	`imag”Ù©e
($image, 180, 0);

497 
$image
 = @
	`imag”Ù©e
($image, 270, 0);

500 
$image
 = @
	`imag”Ù©e
($image, 90, 0);

503  
çl£
;

505 
$sucûss
 = 
	`imagej³g
(
$image
, 
$fe_·th
);

507 @
	`imagede¡roy
(
$image
);

508  
$sucûss
;

509 
	}
}

511 
´Ùeùed
 
funùiÚ
 
	$hªdË_fe_u¶ßd
(
$u¶ßded_fe
, 
$Çme
, 
$size
, 
$ty³
, 
$”rÜ
,

512 
$šdex
 = 
nuÎ
, 
$cÚ‹Á_¿nge
 =‚ull) {

513 
$fe
 = 
Ãw
 
	`¡dCÏss
();

514 
$fe
->
Çme
 = 
$this
->
	`g‘_fe_Çme
(
$Çme
, 
$ty³
, 
$šdex
, 
$cÚ‹Á_¿nge
);

515 
$fe
->
size
 = 
$this
->
	`fix_š‹g”_ov”æow
(
	`štv®
(
$size
));

516 
$fe
->
ty³
 = 
$ty³
;

517 ià(
$this
->
	`v®id©e
(
$u¶ßded_fe
, 
$fe
, 
$”rÜ
, 
$šdex
)) {

518 
$this
->
	`hªdË_fÜm_d©a
(
$fe
, 
$šdex
);

519 
$u¶ßd_dœ
 = 
$this
->
	`g‘_u¶ßd_·th
();

520 ià(!
	`is_dœ
(
$u¶ßd_dœ
)) {

521 
	`mkdœ
(
$u¶ßd_dœ
, 
$this
->
İtiÚs
['mkdœ_mode'], 
Œue
);

523 
$fe_·th
 = 
$this
->
	`g‘_u¶ßd_·th
(
$fe
->
Çme
);

524 
$­³nd_fe
 = 
$cÚ‹Á_¿nge
 && 
	`is_fe
(
$fe_·th
) &&

525 
$fe
->
size
 > 
$this
->
	`g‘_fe_size
(
$fe_·th
);

526 ià(
$u¶ßded_fe
 && 
	`is_u¶ßded_fe
($uploaded_file)) {

528 ià(
$­³nd_fe
) {

529 
	`fe_put_cÚ‹Ás
(

530 
$fe_·th
,

531 
	`fİ’
(
$u¶ßded_fe
, 'r'),

532 
FILE_APPEND


535 
	`move_u¶ßded_fe
(
$u¶ßded_fe
, 
$fe_·th
);

539 
	`fe_put_cÚ‹Ás
(

540 
$fe_·th
,

541 
	`fİ’
('php://input', 'r'),

542 
$­³nd_fe
 ? 
FILE_APPEND
 : 0

545 
$fe_size
 = 
$this
->
	`g‘_fe_size
(
$fe_·th
, 
$­³nd_fe
);

546 ià(
$fe_size
 ==ğ
$fe
->
size
) {

547 ià(
$this
->
İtiÚs
['orient_image']) {

548 
$this
->
	`Ü›Á_image
(
$fe_·th
);

550 
$fe
->
u¾
 = 
$this
->
	`g‘_dowÆßd_u¾
($fe->
Çme
);

551 
	`fÜ—ch
(
$this
->
İtiÚs
['image_v”siÚs'] 
as
 
$v”siÚ
 => 
$İtiÚs
) {

552 ià(
$this
->
	`ü—‹_sÿËd_image
(
$fe
->
Çme
, 
$v”siÚ
, 
$İtiÚs
)) {

553 ià(!
	`em±y
(
$v”siÚ
)) {

554 
$fe
->{
$v”siÚ
.'_u¾'} = 
$this
->
	`g‘_dowÆßd_u¾
(

555 
$fe
->
Çme
,

556 
$v”siÚ


559 
$fe_size
 = 
$this
->
	`g‘_fe_size
(
$fe_·th
, 
Œue
);

563 } ià(!
$cÚ‹Á_¿nge
 && 
$this
->
İtiÚs
['discard_aborted_uploads']) {

564 
	`uÆšk
(
$fe_·th
);

565 
$fe
->
”rÜ
 = 'abort';

567 
$fe
->
size
 = 
$fe_size
;

568 
$this
->
	`£t_fe_d–‘e_´İ”t›s
(
$fe
);

570  
$fe
;

571 
	}
}

573 
´Ùeùed
 
funùiÚ
 
	$»adfe
(
$fe_·th
) {

574  
	`»adfe
(
$fe_·th
);

575 
	}
}

577 
´Ùeùed
 
funùiÚ
 
	$body
(
$¡r
) {

578 
echo
 
$¡r
;

579 
	}
}

581 
´Ùeùed
 
funùiÚ
 
	$h—d”
(
$¡r
) {

582 
	`h—d”
(
$¡r
);

583 
	}
}

585 
´Ùeùed
 
funùiÚ
 
	$g’”©e_»¥Ú£
(
$cÚ‹Á
, 
$´št_»¥Ú£
 = 
Œue
) {

586 ià(
$´št_»¥Ú£
) {

587 
$jsÚ
 = 
	`jsÚ_’code
(
$cÚ‹Á
);

588 
$»dœeù
 = 
	`is£t
(
$_REQUEST
['redirect']) ?

589 
	`¡r¦ashes
(
$_REQUEST
['»dœeù']è: 
nuÎ
;

590 ià(
$»dœeù
) {

591 
$this
->
	`h—d”
('LoÿtiÚ: '.
	`¥rštf
(
$»dœeù
, 
	`¿wu¾’code
(
$jsÚ
)));

594 
$this
->
	`h—d
();

595 ià(
	`is£t
(
$_SERVER
['HTTP_CONTENT_RANGE'])) {

596 
$fes
 = 
	`is£t
(
$cÚ‹Á
[
$this
->
İtiÚs
['param_name']]) ?

597 
$cÚ‹Á
[
$this
->
İtiÚs
['·¿m_Çme']] : 
nuÎ
;

598 ià(
$fes
 && 
	`is_¬¿y
($fesè&& 
	`is_objeù
($fes[0]è&& $fes[0]->
size
) {

599 
$this
->
	`h—d”
('Rªge: 0-'.($this->
	`fix_š‹g”_ov”æow
(
	`štv®
(
$fes
[0]->
size
)) - 1));

602 
$this
->
	`body
(
$jsÚ
);

604  
$cÚ‹Á
;

605 
	}
}

607 
´Ùeùed
 
funùiÚ
 
	$g‘_v”siÚ_·¿m
() {

608  
	`is£t
(
$_GET
['v”siÚ']è? 
	`ba£Çme
(
	`¡r¦ashes
($_GET['v”siÚ'])è: 
nuÎ
;

609 
	}
}

611 
´Ùeùed
 
funùiÚ
 
	$g‘_fe_Çme_·¿m
() {

612  
	`is£t
(
$_GET
['fe']è? 
	`ba£Çme
(
	`¡r¦ashes
($_GET['fe'])è: 
nuÎ
;

613 
	}
}

615 
´Ùeùed
 
funùiÚ
 
	$g‘_fe_ty³
(
$fe_·th
) {

616 
	`¡¹Şow”
(
	`·thšfo
(
$fe_·th
, 
PATHINFO_EXTENSION
))) {

627 
	}
}

629 
´Ùeùed
 
funùiÚ
 
	$dowÆßd
() {

630 ià(!
$this
->
İtiÚs
['download_via_php']) {

631 
$this
->
	`h—d”
('HTTP/1.1 403 Forbidden');

634 
$fe_Çme
 = 
$this
->
	`g‘_fe_Çme_·¿m
();

635 ià(
$this
->
	`is_v®id_fe_objeù
(
$fe_Çme
)) {

636 
$fe_·th
 = 
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
, $this->
	`g‘_v”siÚ_·¿m
());

637 ià(
	`is_fe
(
$fe_·th
)) {

638 ià(!
	`´eg_m©ch
(
$this
->
İtiÚs
['šlše_fe_ty³s'], 
$fe_Çme
)) {

639 
$this
->
	`h—d”
('Content-Description: File Transfer');

640 
$this
->
	`h—d”
('Content-Type:‡pplication/octet-stream');

641 
$this
->
	`h—d”
('CÚ‹Á-Di¥os™iÚ:‡‰achm’t; f’ame="'.
$fe_Çme
.'"');

642 
$this
->
	`h—d”
('Content-Transfer-Encoding: binary');

645 
$this
->
	`h—d”
('X-Content-Type-Options:‚osniff');

646 
$this
->
	`h—d”
('CÚ‹Á-Ty³: '.$this->
	`g‘_fe_ty³
(
$fe_·th
));

647 
$this
->
	`h—d”
('CÚ‹Á-Di¥os™iÚ: iÆše; f’ame="'.
$fe_Çme
.'"');

649 
$this
->
	`h—d”
('CÚ‹Á-L’gth: '.$this->
	`g‘_fe_size
(
$fe_·th
));

650 
$this
->
	`h—d”
('La¡-Modif›d: '.
	`gmd©e
('D, d M Y H:i: T', 
	`femtime
(
$fe_·th
)));

651 
$this
->
	`»adfe
(
$fe_·th
);

654 
	}
}

656 
´Ùeùed
 
funùiÚ
 
	$£nd_cÚ‹Á_ty³_h—d”
() {

657 
$this
->
	`h—d”
('Vary: Accept');

658 ià(
	`is£t
(
$_SERVER
['HTTP_ACCEPT']) &&

659 (
	`¡½os
(
$_SERVER
['HTTP_ACCEPT'], '­¶iÿtiÚ/jsÚ'è!=ğ
çl£
)) {

660 
$this
->
	`h—d”
('Content-type:‡pplication/json');

662 
$this
->
	`h—d”
('Content-type:ext/plain');

664 
	}
}

666 
´Ùeùed
 
funùiÚ
 
	$£nd_acûss_cÚŒŞ_h—d”s
() {

667 
$this
->
	`h—d”
('Acûss-CÚŒŞ-AÎow-Origš: '.$this->
İtiÚs
['access_control_allow_origin']);

668 
$this
->
	`h—d”
('Access-Control-Allow-Credentials: '

669 .(
$this
->
İtiÚs
['access_control_allow_credentials'] ? 'true' : 'false'));

670 
$this
->
	`h—d”
('Access-Control-Allow-Methods: '

671 .
	`im¶ode
(', ', 
$this
->
İtiÚs
['access_control_allow_methods']));

672 
$this
->
	`h—d”
('Access-Control-Allow-Headers: '

673 .
	`im¶ode
(', ', 
$this
->
İtiÚs
['access_control_allow_headers']));

674 
	}
}

676 
public
 
funùiÚ
 
	$h—d
() {

677 
$this
->
	`h—d”
('Pragma:‚o-cache');

678 
$this
->
	`h—d”
('Cache-Control:‚o-store,‚o-cache, must-revalidate');

679 
$this
->
	`h—d”
('Content-Disposition: inline; filename="files.json"');

681 
$this
->
	`h—d”
('X-Content-Type-Options:‚osniff');

682 ià(
$this
->
İtiÚs
['access_control_allow_origin']) {

683 
$this
->
	`£nd_acûss_cÚŒŞ_h—d”s
();

685 
$this
->
	`£nd_cÚ‹Á_ty³_h—d”
();

686 
	}
}

688 
public
 
funùiÚ
 
	$g‘
(
$´št_»¥Ú£
 = 
Œue
) {

689 ià(
$´št_»¥Ú£
 && 
	`is£t
(
$_GET
['download'])) {

690  
$this
->
	`dowÆßd
();

692 
$fe_Çme
 = 
$this
->
	`g‘_fe_Çme_·¿m
();

693 ià(
$fe_Çme
) {

694 
$»¥Ú£
 = 
	`¬¿y
(

695 
	`sub¡r
(
$this
->
İtiÚs
['·¿m_Çme'], 0, -1è=> $this->
	`g‘_fe_objeù
(
$fe_Çme
)

698 
$»¥Ú£
 = 
	`¬¿y
(

699 
$this
->
İtiÚs
['·¿m_Çme'] => $this->
	`g‘_fe_objeùs
()

702  
$this
->
	`g’”©e_»¥Ú£
(
$»¥Ú£
, 
$´št_»¥Ú£
);

703 
	}
}

705 
public
 
funùiÚ
 
	$po¡
(
$´št_»¥Ú£
 = 
Œue
) {

706 ià(
	`is£t
(
$_REQUEST
['_method']) && $_REQUEST['_method'] === 'DELETE') {

707  
$this
->
	`d–‘e
(
$´št_»¥Ú£
);

709 
$u¶ßd
 = 
	`is£t
(
$_FILES
[
$this
->
İtiÚs
['param_name']]) ?

710 
$_FILES
[
$this
->
İtiÚs
['·¿m_Çme']] : 
nuÎ
;

712 
$fe_Çme
 = 
	`is£t
(
$_SERVER
['HTTP_CONTENT_DISPOSITION']) ?

713 
	`¿wu¾decode
(
	`´eg_»¶aû
(

716 
$_SERVER
['HTTP_CONTENT_DISPOSITION']

717 )è: 
nuÎ
;

720 
$cÚ‹Á_¿nge
 = 
	`is£t
(
$_SERVER
['HTTP_CONTENT_RANGE']) ?

721 
	`´eg_¥l™
('/[^0-9]+/', 
$_SERVER
['HTTP_CONTENT_RANGE']è: 
nuÎ
;

722 
$size
 = 
$cÚ‹Á_¿nge
 ? $cÚ‹Á_¿nge[3] : 
nuÎ
;

723 
$fes
 = 
	`¬¿y
();

724 ià(
$u¶ßd
 && 
	`is_¬¿y
($upload['tmp_name'])) {

727 
	`fÜ—ch
 (
$u¶ßd
['tmp_Çme'] 
as
 
$šdex
 => 
$v®ue
) {

728 
$fes
[] = 
$this
->
	`hªdË_fe_u¶ßd
(

729 
$u¶ßd
['tmp_Çme'][
$šdex
],

730 
$fe_Çme
 ? $fe_Çm: 
$u¶ßd
['Çme'][
$šdex
],

731 
$size
 ? $siz: 
$u¶ßd
['size'][
$šdex
],

732 
$u¶ßd
['ty³'][
$šdex
],

733 
$u¶ßd
['”rÜ'][
$šdex
],

734 
$šdex
,

735 
$cÚ‹Á_¿nge


741 
$fes
[] = 
$this
->
	`hªdË_fe_u¶ßd
(

742 
	`is£t
(
$u¶ßd
['tmp_Çme']è? $u¶ßd['tmp_Çme'] : 
nuÎ
,

743 
$fe_Çme
 ? $fe_Çm: (
	`is£t
(
$u¶ßd
['name']) ?

744 
$u¶ßd
['Çme'] : 
nuÎ
),

745 
$size
 ? $siz: (
	`is£t
(
$u¶ßd
['size']) ?

746 
$u¶ßd
['size'] : 
$_SERVER
['CONTENT_LENGTH']),

747 
	`is£t
(
$u¶ßd
['type']) ?

748 
$u¶ßd
['ty³'] : 
$_SERVER
['CONTENT_TYPE'],

749 
	`is£t
(
$u¶ßd
['”rÜ']è? $u¶ßd['”rÜ'] : 
nuÎ
,

750 
nuÎ
,

751 
$cÚ‹Á_¿nge


754  
$this
->
	`g’”©e_»¥Ú£
(

755 
	`¬¿y
(
$this
->
İtiÚs
['·¿m_Çme'] => 
$fes
),

756 
$´št_»¥Ú£


758 
	}
}

760 
public
 
funùiÚ
 
	$d–‘e
(
$´št_»¥Ú£
 = 
Œue
) {

761 
$fe_Çme
 = 
$this
->
	`g‘_fe_Çme_·¿m
();

762 
$fe_·th
 = 
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
);

763 
$sucûss
 = 
	`is_fe
(
$fe_·th
è&& 
$fe_Çme
[0] !=ğ'.' && 
	`uÆšk
($file_path);

764 ià(
$sucûss
) {

765 
	`fÜ—ch
(
$this
->
İtiÚs
['image_v”siÚs'] 
as
 
$v”siÚ
 => 
$İtiÚs
) {

766 ià(!
	`em±y
(
$v”siÚ
)) {

767 
$fe
 = 
$this
->
	`g‘_u¶ßd_·th
(
$fe_Çme
, 
$v”siÚ
);

768 ià(
	`is_fe
(
$fe
)) {

769 
	`uÆšk
(
$fe
);

774  
$this
->
	`g’”©e_»¥Ú£
(
	`¬¿y
('sucûss' => 
$sucûss
), 
$´št_»¥Ú£
);

775 
	}
}

	@gcm/modulos/imagenes/lib/presentar_galeria.php

1 <?
php


8 iàĞ
	g$a
 == 'verImg' ) {

10 
ob_’d_ş—n
();

11 
	g$img
 = 
$_GET
['img'];

13 
šşude
(
GCM_DIR
."includes/cabecera.php");

14 
´e£Á¬T™ulo
();

19 
šşude_Úû
(
GCM_DIR
.'lib/int/gcm_imagen.php');

20 
	gecho
 "\n<script†anguage='javascript'>";

21 
gcm_li¡aImag’es
(
$dd
.
$s
, 4);

22 
	gecho
 "\n</script>";

25 
	gecho
 '<süˆ¤c="'.
	gGCM_DIR_P
.'modulos/gcmImgs/gcmImgs.js'.'"ype="text/javascript"†anguage="JavaScript">';

26 
	gecho
 "\n</script>";

34 
	gecho
 '<div id="contenido" >';

37 
	gecho
 "\n<script†anguage='javascript'>";

38 
	gecho
 "\npresentar_contenido();";

39 
	gecho
 "\n</script>";

40 
	gecho
 '</div>';

41 
	gecho
 '</body></html>';

42 
ex™
();

	@gcm/modulos/imagenes/menuAdmin.php

1 <?
php


2 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Imagenes']['activado']= 1;

3 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Imagenes']['title']="Administrar imÃ¡genes";

4 
	g$m’uAdmš
['Admši¡¿ciÃ³n']['bÙÚ']['Imag’es']['lšk']=
Rou‹r
::
$dœ
.Rou‹r::
$u¾
."?m=imagenes&a=galeria";

	@gcm/modulos/indexador/config/config.php

1 <?
php


2 
	g$cÚfig
['maxLong'] = 200;

	@gcm/modulos/indexador/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['maxLong'] = 'TamaÃ±o de†a descripciÃ³n‡ indezarƒn caracteres';

	@gcm/modulos/indexador/eventos_admin.php

1 <?
php


2 
	g$ev’tos
['postejecutar_borrar']['borrar_archivo_pdo'][1] = '';

3 
	g$ev’tos
['postejecutar_nuevo']['indexar_archivo_pdo'][1] = '' ;

4 
	g$ev’tos
['postactualizar_contenido']['indexar_archivo_pdo'][1] = '';

5 
	g$ev’tos
['postejecutar_mover']['borrar_archivo_pdo'][1] = '';

6 
	g$ev’tos
['postejecutar_mover']['indexar_archivo_pdo'][2] = '';

7 
	g$ev’tos
['postpublicar_borrador']['indexar_archivo_pdo'][2] = '';

8 
	g$ev’tos
['postejecutar_mover_seccion']['cambio_ruta_seccion'][2] = '';

9 
	g$ev’tos
['reindexar']['reindexar'][1] = '';

10 
	g$ev’tos
['reindexado_completo']['reindexado_completo'][1] = '';

11 
	g$ev’tos
['indexar']['indexado'][1] = '';

	@gcm/modulos/indexador/eventos_usuario.php

1 <?
php


2 
	g$ev’tos
['cabeceraDerecha']['formulario_busqueda'][1]='';

3 
	g$ev’tos
['cŞumÇ']['uÉimas_’Œadas'][5]="num=4&£cciÚ=".
Rou‹r
::
$s
."&formato=1";

4 
	g$ev’tos
['contenido_dinamico']['contenido_dinamico'][1]='';

6 
	g$ev’tos
['buscar']['presentar_busquedas'][1]='';

8 
	g$ev’tos
['indexar']['indexado'][3] = '';

	@gcm/modulos/indexador/info.php

1 <?
php


2 
	g$šdexadÜ
['nombre']="Indexador de contenido";

3 
	g$šdexadÜ
['title']="Indexarƒl contenido de†os directorios";

	@gcm/modulos/indexador/lib/Indexador.php

1 <?
php


32 şas 
	cIndexadÜ
 
ex‹nds
 
	mModulos
 {

34 
public
 
	m$desÿ¹¬
;

35 
public
 
	m$maxLÚg
 = 200;

37 
´iv©e
 
	m$pdo
 = 
NULL
;

38 
´iv©e
 
	m$BD
 = 'DATOS/proyecto.db';

39 
´iv©e
 
	m$´efijo
 = '';

46 
´iv©e
 
	m$uÉimos_’_cÚ‹nido
 = 
FALSE
;

50 
funùiÚ
 
	$__cÚ¡ruù
() {

52 
glob®
 
$gcm
;

54 
·»Á
::
	`__cÚ¡ruù
();

56 
$this
->
pdo
 = 
$gcm
->
	`pdo_cÚexiÚ
($this->
BD
);

57 
$this
->
´efijo
 = 
$gcm
->
sufijo
;

59 
$this
->
desÿ¹¬
 = 
$gcm
->
	`cÚfig
('contenidos','descartar');

60 
$this
->
maxLÚg
 = $this->
	`cÚfig
('maxLong');

64 iàĞ! 
	`exi¡e_bÏ
(
$this
->
pdo
, $this->
´efijo
.'etiquetas') ) {

66 
$this
->
	`g’”¬_bÏs
();

76 
funùiÚ
 
	$‹¡
() {

78 
$sql
 = 'SELECT COUNT(*èFROM '.
$this
->
´efijo
.'etiquetas';

80 
$this
->
	`ejecu_‹¡
('TabÏ ü—das', $this->
pdo
->
	`´•¬e
(
$sql
));

82 
	}
}

88 
funùiÚ
 
	$g’”¬_bÏs
() {

90 
glob®
 
$gcm
;

92 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'CreaciÃ³n de base de datos…ara indexaciÃ³n');

94 
$driv”
 = 
$this
->
pdo
->
	`g‘A‰ribu‹
(
	`cÚ¡ªt
("PDO::ATTR_DRIVER_NAME"));

96 
$driv”
) {

100 
$SQL
 = "CREATE TABLE ".
$this
->
´efijo
."etiquetas (

101 
id
 
INTEGER
 
PRIMARY
 
KEY
,

102 
nomb»
 
	`CHAR
(20è
UNIQUE
,

103 
desüciÚ
 
	`VARCHAR
(80)

105 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
);

107 
$SQL
="CREATE TABLE ".
$this
->
´efijo
."archivos (

108 
id
 
INTEGER
 
PRIMARY
 
KEY
,

109 
nomb»
 
	`CHAR
(150) ,

110 
desüciÚ
 
	`VARCHAR
(".$this->maxLong."),

111 
u¾
 
	`CHAR
(200è
UNIQUE
,

112 
ãcha_ü—ciÚ_©
 
TIME
 
NOT
 
NULL
 
DEFAULT
 
CURRENT_TIMESTAMP
,

113 
ãcha_aùu®izaciÚ_š
 
TIME


115 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
);

117 
$SQL
="CREATE TABLE ".
$this
->
´efijo
."r_etiqueta_archivo (

118 
‘iqu‘as_id
 
INTEGER
,

119 
¬chivos_id
 
INTEGER
,

120 
PRIMARY
 
	`KEY
 (
‘iqu‘as_id
, 
¬chivos_id
)

122 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
);

127 
$SQL
 = "CREATE TABLE ".
$this
->
´efijo
."etiquetas (

128 
id
 
MEDIUMINT
 
NOT
 
NULL
 
AUTO_INCREMENT
,

129 
nomb»
 
	`CHAR
(20è
UNIQUE
,

130 
desüciÚ
 
	`VARCHAR
(80),

131 
PRIMARY
 
	`KEY
 (
id
)

133 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
);

135 
$SQL
="CREATE TABLE ".
$this
->
´efijo
."archivos (

136 
id
 
MEDIUMINT
 
NOT
 
NULL
 
AUTO_INCREMENT
,

137 
nomb»
 
	`CHAR
(150) ,

138 
desüciÚ
 
	`VARCHAR
(".$this->maxLong."),

139 
u¾
 
	`CHAR
(200è
UNIQUE
,

140 
ãcha_ü—ciÚ_©
 
TIMESTAMP
 
NOT
 
NULL
 
DEFAULT
 
CURRENT_TIMESTAMP
,

141 
ãcha_aùu®izaciÚ_š
 
TIMESTAMP
,

142 
PRIMARY
 
	`KEY
 (
id
)

144 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
);

146 
$SQL
="CREATE TABLE ".
$this
->
´efijo
."r_etiqueta_archivo (

147 
‘iqu‘as_id
 
MEDIUMINT
 
NOT
 
NULL
,

148 
¬chivos_id
 
MEDIUMINT
 
NOT
 
NULL
,

149 
PRIMARY
 
	`KEY
 (
‘iqu‘as_id
, 
¬chivos_id
)

151 
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
);

155 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'EÈdriv” ['.
$driv”
.']…ara†a base de datos‚oƒstÃ¡ soportado','ERROR');

160 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'TabÏ ü—da ·¿ '.
$driv”
.' y…reparadas…ara indexaciÃ³n','ADMIN');

162 
	}
}

169 
funùiÚ
 
	$fÜmuÏrio_busqueda
() {

171 
glob®
 
$gcm
;

173 
$this
->
	`javasüts
('indexador.js');

175 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('indexador','html','caja_buscar.html'));

177 
	}
}

194 
funùiÚ
 
	$sql_quÙe
(
$v®Ü
) {

196 
$v®Ü
 = 
	`sql™e_esÿ³_¡ršg
($valor);

197  
$v®Ü
;

199 
	}
}

220 
funùiÚ
 
	$šdex¬_¬chivo_pdo
(
$e
, 
$¬gs
) {

222 
glob®
 
$gcm
;

224 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
$¬gs
);

226 iàĞ
	`is£t
(
$·¿m‘ros
['url']) ) {

227 
$fe
 = 
$·¿m‘ros
['url'] ;

228 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Recibimo uÀ¬chivØ·¿ index¬ desd¬gs[u¾] '.
$fe
);

229 } 
	`–£if
 ( ! 
	`is_¬¿y
(
$¬gs
è&& 
	`is_fe
($args) ) {

230 
$fe
 = 
$¬gs
 ;

231 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Recibimo uÀ¬chivØ·¿ index¬ desd¬gs='.
$fe
);

232 } 
	`–£if
 ( 
	`is£t
(
$gcm
->
memÜŸ
['destino']) ) {

233 
$fe
 = 
$gcm
->
memÜŸ
['destino'] ;

234 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Recibimo uÀ¬chivØ·¿ index¬ desdgcm->memÜŸ[de¡šo] '.
$fe
);

235 } 
	`–£if
 ( 
Rou‹r
::
$f
 ) {

236 
$fe
 = 
Rou‹r
::
$f
 ;

237 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Indexamo cÚ‹nidØaùu®: '.
$fe
);

239 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'SÃûs™¨u¾ dcÚ‹nidØ·¿ index¬::'.
$¬gs
,'ERROR');

240  
FALSE
;

243 
$fe
 = 
	`¡r_»¶aû
('//','/',$file);

247 iàĞ! 
	`is£t
(
$·¿m‘ros
['sš_com´ob¬_ex‹nsiÚ']è&& 
	`sub¡r
(
$fe
, -5) !== '.html' ) {

248 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).

250  
FALSE
;

255 iàĞ
	`is£t
(
$·¿m‘ros
['literal']) ) {

256 
$nomb»
 = 
$·¿m‘ros
['literal'];

258 
$nomb»
 = 
	`¡r_»¶aû
('.html','',
	`ba£Çme
(
$fe
) );

259 
$nomb»
 = 
	`l™”®
($nombre);

262 
$desüciÚ
='';

265 
$u¾
=
	`¡r_»¶aû
('Fe/'.
$gcm
->
	`cÚfig
('idiomas','Idiom¨pÜ deãùo').'/','',
$fe
);

267 
$fich”o
 = 'Fe/'.
Rou‹r
::
$ii
.'/'.
	`¡r¦ashes
(
	`html_’t™y_decode
(
$u¾
));

270 iàĞ! @
	`fe_exi¡s
(
$fich”o
) ) {

271 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).

272 'NØexi¡['.
$fich”o
.']‡rchivo, salimos');

276 
$ãcha_ü—ciÚ_©
 = 
	`d©e
('Y-m-d H:i:s', 
	`femtime
(
$fich”o
));

277 
$ãcha_aùu®izaciÚ_š
 = 
$ãcha_ü—ciÚ_©
;

278 
$gs
 = 
	`¬¿y
();

280 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"Indexamos $file $fecha_creacion_at $fecha_actualizacion_in ");

285 
$¬chivo_cÚ‹nido
 = 
$fich”o
;

291 iàĞĞ
	`is£t
(
$·¿m‘ros
['archivo_descripcion']) ) ) {

292 
$¬chivo_cÚ‹nido
 = 
$·¿m‘ros
['archivo_descripcion'];

295 iàĞĞ
	`is£t
(
$·¿m‘ros
['inicio_descripcion']) ) ) {

297 
$cÚ‹nido
 = 
	`fe_g‘_cÚ‹Ás
(
$¬chivo_cÚ‹nido
);

298 
$posiciÚ
 = 
	`¡½os
(
$cÚ‹nido
,
$·¿m‘ros
['inicio_descripcion']);

299 iàĞ
$posiciÚ
 ==ğ
FALSE
 ) {

300 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ£ƒncÚŒØ['.
$·¿m‘ros
['šicio_desüciÚ'].']ƒÀ['.
$¬chivo_cÚ‹nido
.']','ADMIN');

302 
$posiciÚ
 = $posiciÚ + 
	`¡¾’
(
$·¿m‘ros
['inicio_descripcion']);

305 
$cÚ‹nido
 = 
	`Œim
(
	`sub¡r
($cÚ‹nido,
$posiciÚ
));

306 
$cÚ‹nido
 = 
	`¡r_gs
($contenido);

308 } 
	`–£if
 ( 
	`is£t
(
$·¿m‘ros
['descripcion'])) {

312 
$cÚ‹nido
 = 
	`¡r_gs
(
$·¿m‘ros
['descripcion']);

316 
$cÚ‹nido
 = 
	`¡r_gs
(
	`fe_g‘_cÚ‹Ás
(
$¬chivo_cÚ‹nido
));

319  
$pos1
 = 
	`¡½os
(
$cÚ‹nido
, "{Tags{") ) {

320 
$pos2
 = 
	`¡½os
(
$cÚ‹nido
, "}}", 
$pos1
);

321 iàĞ
$pos1
 > 0 && 
$pos2
 < $pos1 ) {

322 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'E¼Ü dfÜm©Ø’ƒtiqu‘a ['.
$u¾
.']','ERROR');

323 
$cÚ‹nido
 = 
	`¡r_»¶aû
('{Tags{','',$contenido);

325 
$»m¶az¬
 = 
	`sub¡r
(
$cÚ‹nido
, 
$pos1
, 
$pos2
 - $pos1 + 2);

326 
$l™
 = 
	`¡r_»¶aû
('{Tags{','',
$»m¶az¬
);

327 
$l™
 = 
	`¡r_»¶aû
('}}','',$lit);

328 
$cÚ‹nido
 = 
	`¡r_»¶aû
(
$»m¶az¬
,
	`l™”®
(
$l™
),$contenido);

329 
$gs
 = 
	`¬¿y_m”ge
($gs,
	`ex¶ode
(',',
$l™
));

333 iàĞ
$pos1
 && $pos1 < 
$this
->
maxLÚg
 ) { $this->maxLong = $pos1; }

336 
$posRef
 = 
	`¡½os
(
$cÚ‹nido
, "{Ref{");

337 iàĞ
$posRef
 && $posReà< 
$this
->
maxLÚg
 ) { $this->maxLong = $posRef; }

339 
$desüciÚ
=
	`Œim
(
	`sub¡r
(
$cÚ‹nido
,0,
$this
->
maxLÚg
))."...";

342 
$SQL
 = "SELECT id from ".
$this
->
´efijo
."archivos WHERE url=?";

343 iàĞ
$sqlResuÉ
 = 
$this
->
pdo
->
	`´•¬e
(
$SQL
) ) {

344 
$sqlResuÉ
->
	`execu‹
(
	`¬¿y
(
$u¾
));

345 
$»s
 = 
$sqlResuÉ
->
	`ãtch
();

346 
$¬chivo_id
 = 
$»s
[0];

348 
$¬chivo_id
 = 
FALSE
 ;

351 iàĞ
$¬chivo_id
 ) {

352 
$SQL
 = "UPDATE ".
$this
->
´efijo
."archivos SET‚ombre=?, descripcion=?, fecha_actualizacion_in=?";

353 
$SQL
 .= " WHERE id=? ";

354 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Aùu®izamos: '.
$u¾
);

355 
$comªdo
 = 
$this
->
pdo
->
	`´•¬e
(
$SQL
);

356 iàĞ! 
$comªdo
->
	`execu‹
(
	`¬¿y
(
$nomb»
,
$desüciÚ
, 
$ãcha_aùu®izaciÚ_š
, 
$¬chivo_id
) ) ) {

357 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

358 
$”r_msg
 = 
$”r
[2];

359 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'ERROR‡Èejecu¸'.
$SQL
,'ERROR');

360 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
$”r_msg
,'ERROR');

361  
FALSE
;

365 
$SQL
 = "INSERT INTO ".
$this
->
´efijo
."archivos (‚ombre, descripcion, url, fecha_creacion_at, fecha_actualizacion_in ) VALUES ";

366 
$SQL
 .= "(?,?,?,?,?)";

367 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'IndexadÜ::In£¹amos: '.
$u¾
);

369 
Œy
 {

371 
$comªdo
 = 
$this
->
pdo
->
	`´•¬e
(
$SQL
);

372 
$comªdo
->
	`execu‹
(
	`¬¿y
(
$nomb»
,
$desüciÚ
,
$u¾
, 
$ãcha_ü—ciÚ_©
, 
$ãcha_aùu®izaciÚ_š
) );

374 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

376 
$m’s
 = 
$ex
->
	`g‘Mes§ge
()."\nsql: ".
$SQL
.

378 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'è'."\n".
$m’s
,'ERROR');

379  
FALSE
;

385 iàĞ
	`couÁ
(
$gs
) > 0 ) {

387 iàĞ! 
$¬chivo_id
 ) {

388 
$¬chivo_id
 = 
$this
->
pdo
->
	`Ï¡In£¹Id
();

391 
	`fÜ—ch
 ( 
$gs
 
as
 
$t
 ) {

394 
$SQL
="SELECT id FROM ".
$this
->
´efijo
."‘iqu‘a WHERE‚omb»='".
	`Œim
(
$t
)."'";

395 iàĞ
$sqlResuÉ
 = 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

396 
$»s
 = 
$sqlResuÉ
->
	`ãtch
();

397 
$‘iqu‘a_id
 = 
$»s
[0];

399 
$‘iqu‘a_id
 = 
FALSE
 ;

402 iàĞ! 
$‘iqu‘a_id
 ) {

403 
$SQL
="INSERT INTO ".
$this
->
´efijo
."‘iqu‘a Òomb»èVALUES ('".
	`Œim
(
$t
)."')";

404 iàĞ! 
$this
->
pdo
->
	`qu”y
(
$SQL
) ) {

405 
$”r
 = 
$this
->
pdo
->
	`”rÜInfo
();

406 
$”r_msg
 = 
$”r
[2];

407 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'ERROR‡Èejecu¸'.
$SQL
,'ERROR');

408 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
$”r_msg
,'ERROR');

411 
$‘iqu‘a_id
 = 
$this
->
pdo
->
	`Ï¡In£¹Id
();

414 
$SQL
 = "INSERT INTO ".
$this
->
´efijo
."r_‘iqu‘a_¬chivØVALUES (".
$‘iqu‘a_id
.",".
$¬chivo_id
.")";

416 
Œy
 {

418 
$this
->
pdo
->
	`qu”y
(
$SQL
);

420 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

422 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'ERROR‡Èejecu¸'.
$SQL
);

423 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
$ex
->
	`g‘Mes§ge
());

430 iàĞĞ
$e
 == 'indexar' ) ) {

431 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Archivo indexado','AVISO');

433 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`l™”®
('Archivo indexado'));

435  
TRUE
;

437 
	}
}

457 
funùiÚ
 
	$uÉimas_’Œadas
(
$e
, 
$¬gs
) {

459 
glob®
 
$gcm
;

461 
$this
->
	`javasüts
('indexador.js');

463 
$sufijo
 = 'uec_';

466 
$num_™ems_df
 = 5;

467 
$fÜm©o_df
 = 0;

469 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
$¬gs
);

471 
$num
 = ( 
	`is£t
(
$·¿m‘ros
['num']èè? $·¿m‘ros['num'] : 
$num_™ems_df
 ;

472 
$£cciÚ
 = ( 
	`is£t
(
$·¿m‘ros
['£cciÚ']èè? $·¿m‘ros['£cciÚ'] : 
Rou‹r
::
$s
 ;

473 
$fÜm©o
 = ( 
	`is£t
(
$·¿m‘ros
['fÜm©o']èè? $·¿m‘ros['fÜm©o'] : 
$fÜm©o_df
 ;

475 iàĞ
$fÜm©o
 =ğ0 ) 
$this
->
uÉimos_’_cÚ‹nido
 = 
TRUE
;

477 iàĞ
$fÜm©o
 =ğ1 && 
$this
->
uÉimos_’_cÚ‹nido
 ) {

478 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

479 
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).') Yaenemos ultimasƒntradas

480 
’
 
cÚ‹nido
, 
no
 
Ïs
 
pÚemos
ƒÀ
cŞumÇ
');

484 iàĞ!
	`em±y
(
$£cciÚ
) ) {

485 
$aSecciÚ_aùu®
 = 
	`ex¶ode
('/',
	`com´ob¬_b¬¿
(
$£cciÚ
));

486 
$£cciÚ_aùu®
 = ( 
$aSecciÚ_aùu®
[
	`couÁ
($aSecciÚ_aùu®)-2] ) ? 
	`l™”®
($aSecciÚ_aùu®[couÁ($aSecciÚ_aùu®)-2],1è: 
NULL
 ;

489 
$e¡amos
 = ( 
	`is£t
(
$£cciÚ_aùu®
) ) ? $seccion_actual : 'inicio' ;

491 
$cÚdiciÚ
 = ( 
$£cciÚ
 ) ? "u¾†ik'".$£cciÚ."%'" : 
NULL
 ;

493 
$sql
 = "SELECT‚omb», u¾, desüciÚ, fecha_aùu®izaciÚ_š, fecha_ü—ciÚ_© FROM ".
$this
->
´efijo
."archivos ";

494 iàĞ
$cÚdiciÚ
è
$sql
 .= "WHERE $condicion";

495 
$sql
 .= " ORDER BY fecha_actualizacion_in desc";

497 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmPDO/lib/paginarPDO.php');

499 iàĞ
$fÜm©o
 == 0 ) {

501 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','indexador');

502 iàĞ
$e¡amos
 =ğ'šicio' || 
	`em±y
(
$£cciÚ
) ) {

503 
$gcm
->
t™ulo
=
	`l™”®
('Ãšltimasƒntradas');

505 
$gcm
->
t™ulo
=
	`l™”®
('ÃšÉima ’Œada ’',3).' '.
$£cciÚ_aùu®
;

508 
$pd
 = 
Ãw
 
	`Pagš¬PDO
(
$this
->
pdo
, 
$sql
, 
$sufijo
);

510 iàĞ
$pd
->
	`v®id¬
() ) {

512 
$gcm
->
ev’t
->
	`ªuÏr
('contenido_dinamico','indexador');

514 
$pd
->
–em’tos_·gša
=
$num
;

515 
$pd
->
¶ªtÏ_»suÉados
=
	`dœÇme
(
__FILE__
).'/../html/listado_contenido.html';

520 
$pd
->
	`g’”¬_·gša
('&formato=ajax&m=indexador&a=ultimas_entradas');

528 
$sufijo
 = 'uecl_';

530 iàĞ
$e¡amos
 =ğ'šicio' || 
	`em±y
(
$£cciÚ
) ) {

531 
$t™ulo
=
	`l™”®
('Ãšltimasƒntradas');

533 
$t™ulo
=
	`l™”®
('ÃšÉima ’Œada ’',3).' '.
$£cciÚ_aùu®
;

536 
$pd
 = 
Ãw
 
	`Pagš¬PDO
(
$this
->
pdo
, 
$sql
, 
$sufijo
);

538 iàĞ
$pd
->
	`v®id¬
() ) {

540 
$pd
->
¶ªtÏ_»suÉados
=
	`dœÇme
(
__FILE__
).'/../html/listado_columna.html';

541 
$pd
->
–em’tos_·gša
=
$num
;

542 
	`ob_¡¬t
();

543 
$pd
->
	`·gša
();

544 
$cÚ‹nido
 = 
	`ob_g‘_cÚ‹Ás
();

545 
	`ob_’d_ş—n
();

547 
$·Ãl
 = 
	`¬¿y
();

548 
$·Ãl
['t™ulo'] = 
$t™ulo
;

549 
$·Ãl
['ocuÉo'] = 
TRUE
;

550 
$·Ãl
['h»f'] = 
Rou‹r
::
$dœ
.'šdexadÜ/uÉimas_’Œadas/'.Rou‹r::
$s
;

551 
$·Ãl
['subpanel'] ='list_ultimas_entradas';

552 
$·Ãl
['cÚ‹nido'] =
$cÚ‹nido
;

554 
Temas
::
	`·Ãl
(
$·Ãl
);

559 
	}
}

576 
funùiÚ
 
	$bÜ¿r_¬chivo_pdo
(
$e
, 
$¬gs
) {

578 
glob®
 
$gcm
;

580 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
$¬gs
);

582 iàĞ
	`is£t
(
$·¿m‘ros
['url']) ) {

583 
$u¾s
 = 
	`¬¿y
(
$·¿m‘ros
['url']) ;

584 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Recibimo uÀ¬chivØ·¿ bÜ¿¸desdu¾ ['.
$u¾
.']');

585 } 
	`–£if
 ( 
	`is£t
(
$·¿m‘ros
['ruta_origen']) ) {

586 
$u¾s
 = 
	`¬¿y
(
$·¿m‘ros
['ruta_origen']) ;

587 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Recibimo uÀ¬chivØ·¿ bÜ¿¸desdru_Üig’['.
$u¾
.']');

588 } 
	`–£if
 ( 
	`is£t
(
$gcm
->
memÜŸ
['origen']) ) {

589 
$u¾s
 = 
	`¬¿y
(
$gcm
->
memÜŸ
['origen']) ;

590 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Recibimo uÀ¬chivØ·¿ bÜ¿¸desdgcm->memÜŸ[Üig’] '.
$u¾s
[0]);

591 } 
	`–£if
 ( 
	`is£t
(
$_POST
['seleccionado']) ) {

592 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Recibimos†ista„achivos‡ borrar desde POST[seleccionado]: ');

593 
	`fÜ—ch
 ( 
$_POST
['£ËcciÚado'] 
as
 
$v®
 ) {

594 
$u¾s
[]=
	`¡r¦ashes
(
$v®
);

597 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Se‚ecesita url de contenido…ara borrar','ERROR');

600 
	`fÜ—ch
 ( 
$u¾s
 
as
 
$u¾
 ) {

602 
$u¾
 = 
GUt
::
	`desglo§r_u¾
($url);

604 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Elimšamo ¬chivØdÏ bd: '.
$u¾
);

606 
$SQL
 = "DELETE FROM ".
$this
->
´efijo
."archivos WHERE url=?";

608 iàĞ
$sqlResuÉ
 = 
$this
->
pdo
->
	`´•¬e
(
$SQL
) ) {

609 iàĞ
$sqlResuÉ
->
	`execu‹
(
	`¬¿y
(
$u¾
)) ) {

610 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'ElimšadØdÏ ba£ dd©o [ '.
$u¾
.' ]');

612 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'ERROR: BÜ¿ndØ¬chivØdÏ ba£ dd©os: ['.
$u¾
.']. '.
$SQL
,'ERROR');

616 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'NØ£…udØbÜ¿¸dÏ ba£ dd©o ['.
$u¾
.']'."\nsql: ".
$SQL
,'ADMIN');

621  
TRUE
;

622 
	}
}

638 
funùiÚ
 
	$gcm_bÜ¿r_bÏ_pdo
(
$bÏ
) {

640 
glob®
 
$gcm
;

642 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'Elimšamo bÏ dÏ bd: '.
$bÏ
);

644 
$SQL
 = "DROP TABLE $tabla";

646 iàĞ
$sqlResuÉ
 = 
$this
->
pdo
->
	`´•¬e
(
$SQL
) ) {

647 
$sqlResuÉ
->
	`execu‹
();

648  
TRUE
;

651 iàĞ
$this
->
pdo_”rÜ
) {

652 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"No se…udo borrar‡rchivo de†a base de datos",'ERROR');

653 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
$this
->
pdo_”rÜ
);

654 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"SQL::".
$SQL
);

657  
FALSE
;

661 
	}
}

671 
funùiÚ
 
	$´e£Á¬_busquedas
(
$e
, 
$¬gs
) {

673 
glob®
 
$gcm
;

675 
$this
->
	`javasüts
('indexador.js');

677 iàĞ
	`is£t
(
$_REQUEST
['buscar']) ) {

678 
$·Ïb¿s
 = 
	`ex¶ode
(' ',
$_REQUEST
['buscar']);

680 
$·Ïb¿s
 = 
Rou‹r
::
$¬gs
;

683 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,"BusÿndØ".
	`d•u¿r
(
$·Ïb¿s
));

685 iàĞ!
	`em±y
(
$·Ïb¿s
) ) {

687 
$CONDICION
 = "";

688 
$ORDER
 = " fecha_actualizacion_in desc ";

689 
$cÚ
 = 0;

690 
$fš
 = 
	`couÁ
(
$·Ïb¿s
);

691 
	`fÜ—ch
 ( 
$·Ïb¿s
 
as
 
$·l
 ) {

693 iàĞ
	`g‘_magic_quÙes_gpc
() ) {

694 
$·l
 = 
	`¡r¦ashes
($pal);

696 
$·l
 = 
	`add¦ashes
($pal);

697 
$·l
 = 
	`¡r_»¶aû
('"','',$pal);

699 iàĞ
$cÚ
 != 0 ) {

700 
$CONDICION
 .= ' OR ';

702 
$CONDICION
 .ğ" (‚omb»†ik'%".
$·l
."%' OR descripcion†ike '%".$pal."%' ) ";

703 
$cÚ
++;

706 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/GcmPDO/lib/paginarPDO.php');

710 
$gcm
->
t™ulo
 = 
	`l™”®
('Busqued¨·¿').': <i>'.
	`im¶ode
(' ',
$·Ïb¿s
).'</i>';

711 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','Indexador');

713 
$sql
 = "SELECT‚omb», u¾, desüciÚ, fecha_aùu®izaciÚ_š, fecha_ü—ciÚ_© FROM ".
$this
->
´efijo
."archivos WHERE $CONDICION ORDER BY fecha_actualizacion_in desc ";

715 
$pd
 = 
Ãw
 
	`Pagš¬PDO
(
$this
->
pdo
, 
$sql
);

717 iàĞ
$pd
->
	`v®id¬
() ) {

719 iàĞ
$pd
->
	`num”o_»gi¡ros
() == 1 ) {

721 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`l™”®
('Solo hubo un„esultado, se…resenta'),'AVISO');

722  
$fa
 = 
$pd
->
	`to_¬¿y
() ) {

723 
$u¾
 = 
GUt
::
	`gcm_g’”¬_u¾
(
$fa
[0]['url']);

724 
	`h—d”
 ("LoÿtiÚ:".
$u¾
.'?m’s='.
$gcm
->
»g
->
£siÚ
);

725 
	`ex™
();

730 
$gcm
->
ev’t
->
	`ªuÏr
('contenido_dinamico','Indexador');

732 
$pd
->
u¾_ba£
 = '?e=busÿr&busÿr='.
	`htmËÁ™›s
(
	`im¶ode
('+',
$·Ïb¿s
));

733 
$pd
->
–em’tos_·gša
=8;

734 
$pd
->
¶ªtÏ_»suÉados
=
	`dœÇme
(
__FILE__
).'/../html/listado_contenido.html';

736 
$pd
->
	`bÙÚ”a
();

737 
$pd
->
	`·gša
();

738 
$pd
->
	`bÙÚ”a
();

742 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`l™”®
('NØhubØ»suÉado d’ŒØd– cÚ‹nidØ<b>'.
	`im¶ode
(' ',
$·Ïb¿s
)).'</b>','AVISO');

745 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Indexador->presentar_resultados() Sin contenido‡ buscar');

748 
	}
}

755 
funùiÚ
 
	$cÚ‹nido_dšamico
() {

757 
glob®
 
$gcm
;

761 iàĞ
$gcm
->
ev’t
->
	`ªuÏdo
('contenido') ) {

765 
$this
->
	`javasüts
('indexador.js');

768 
$num_™ems_df
 = 5;

769 
$£ccciÚ_df
 = 
Rou‹r
::
$s
;

770 
$fÜm©o_df
 = 0;

772 
$·¿m‘ros
 = 
	`»cog”_·¿m‘ros
(
	`func_g‘_¬gs
());

774 
$num
 = ( 
	`is£t
(
$·¿m‘ros
['num']èè? $·¿m‘ros['num'] : 
$num_™ems_df
 ;

775 
$£cciÚ
 = ( 
	`is£t
(
$·¿m‘ros
['£cciÚ']èè? $·¿m‘ros['£cciÚ'] : 
$£ccciÚ_df
 ;

776 
$fÜm©o
 = ( 
	`is£t
(
$·¿m‘ros
['fÜm©o']èè? $·¿m‘ros['fÜm©o'] : 
$fÜm©o_df
 ;

778 
$this
->
	`uÉimas_’Œadas
(
NULL
,'num='.
$num
.'&£cciÚ='.
$£cciÚ
.'&fÜm©o='.
$fÜm©o
);

780 
	}
}

792 
funùiÚ
 
	$gcm_šdex¬_·gšas
(
$cÚ‹nido
) {

794 
glob®
 
$gcm
;

796 
$funciÚ_js_šdex¬
 = 'indexar';

798 
	`fÜ—ch
 ( 
$cÚ‹nido
 
as
 
$™em
 => 
$–em’to
 ) {

800 iàĞ
	`is_¬¿y
(
$–em’to
) ) {

802 
$nomb»
 = 
	`ba£Çme
(
$™em
);

803 iàĞ
$nomb»
[0] != '.' ) {

804 
$this
->
	`gcm_šdex¬_·gšas
(
$–em’to
);

807 } 
	`–£if
 ( !
	`esImag’
(
$–em’to
è&& 
	`sub¡r_couÁ
($elemento,'.html') > 0 ) {

809 
$nomb»
 = 
	`ba£Çme
(
$–em’to
);

810 iàĞ
$nomb»
[0] != '.' ) {

812 
$ÿmšo
 = 
GUt
::
	`ÿmšo
(
$–em’to
);

814 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('indexador','html','elemento_lista_indexar.html'));

819  
TRUE
;

821 
	}
}

832 
funùiÚ
 
	$šdexado
() {

834 
glob®
 
$gcm
;

836 iàĞ
$this
->
	`šdex¬_¬chivo_pdo
('šdexado',
Rou‹r
::
$f
è!=ğ
FALSE
 ) {

837 
$§lida
 = "Contenido„eindexado";

839 
$§lida
 = '<p class="error">';

840 
$§lida
 .= 'Error‡l indexar contenido';

841 
$§lida
 .= '</p>';

844 iàĞ
Rou‹r
::
$fÜm©o
 == 'ajax' ) {

845 
echo
 
$§lida
;

847 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
$§lida
,'AVISO');

850 
	}
}

860 
funùiÚ
 
	$»šdexado_com¶‘o
(
$e
, 
$¬gs
=
NULL
) {

862 
glob®
 
$gcm
;

864 
$this
->
	`javasüts
('listado_reindexado.js');

865 
$this
->
	`javasüts
('reindexador_completo.js');

867 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','indexador');

868 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','indexador');

869 
$gcm
->
´e£Á¬_cÚ‹nido_dšamico
 = 
FALSE
;

871 
$gcm
->
t™ulo
 = 
	`l™”®
('Reindexar contenido');

874 
$cÚ‹nido
 = 
	`dœ_¬¿y
('Fe/'.
Rou‹r
::
$ii
, 
$this
->
desÿ¹¬
) ;

877 
	`bÜ¿r_bÏ
(
$this
->
pdo
,$this->
´efijo
.'archivos');

878 
	`bÜ¿r_bÏ
(
$this
->
pdo
,$this->
´efijo
.'etiquetas');

879 
	`bÜ¿r_bÏ
(
$this
->
pdo
,$this->
´efijo
.'r_etiqueta_archivo');

880 
$this
->
	`g’”¬_bÏs
();

882 
$this
->
	`li¡a_cÚ‹nido_»šdex¬
();

884 
	}
}

892 
funùiÚ
 
	$li¡a_cÚ‹nido_»šdex¬
() {

895 
$cÚ‹nido
 = 
	`dœ_¬¿y
('Fe/'.
Rou‹r
::
$ii
, 
$this
->
desÿ¹¬
) ;

897 
echo
 "\n",'<div style="display:‚one;" class="error" id="errores_reindexando"></div>';

899 
echo
 "\n".'<div id="panel_indexado">Indexados: 0</div>';

900 
echo
 "\n".'<div id="listado_reindexar">';

902 iàĞ!
$this
->
	`gcm_šdex¬_·gšas
(
$cÚ‹nido
) ) {

903 
	`Œigg”_”rÜ
(
	`l™”®
('E¼Ü').' '.l™”®('NØ£…udØ»šdex¬'), 
E_USER_ERROR
);

906 
echo
 "\n".'</div> <!--†istado_reindexar -->';

908 
	}
}

920 
funùiÚ
 
	$»šdex¬
(
$e
, 
$¬gs
=
NULL
) {

922 
glob®
 
$gcm
;

924 
$this
->
	`javasüts
('listado_reindexado.js');

926 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','indexador');

927 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','indexador');

928 
$gcm
->
´e£Á¬_cÚ‹nido_dšamico
 = 
FALSE
;

930 
$gcm
->
t™ulo
 = 
	`l™”®
('Reindexar contenido');

932 
echo
 "\n<br />";

933 
echo
 "\n<br />Directorios descartados de„eindexado";

934 
echo
 "\n<ul>";

935 
	`fÜ—ch
 (
$this
->
desÿ¹¬
 
as
 
$desÿ¹ado
è
echo
 "<li>".$descartado."</li>";

936 
echo
 "\n</ul>";

937 
echo
 "\nTamaÃ±ØdesüciÃ³n: <b>".
$this
->
maxLÚg
."</b>";

938 
echo
 "\n<br />";

939 
echo
 "\n<b¸/>",'<¥ª cÏss="bÙÚ"><¨h»f="'.
Rou‹r
::
$ba£
.'?e=reindexado_completo" >Ejecutar„eindexado completo</a></span>';

940 
echo
 '<br /><br />';

942 
$this
->
	`li¡a_cÚ‹nido_»šdex¬
(
$e
,
$¬gs
);

944 
	}
}

951 
funùiÚ
 
	$šdex¬_cÚ‹nido
(
$e
,
$¬gs
) {

953 
glob®
 
$gcm
;

955 iàĞ
$this
->
	`šdex¬_¬chivo_pdo
('šdex¬_cÚ‹nido',
Rou‹r
::
$f
è==ğ
FALSE
 ) {

956 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'E¼Ü‡Èšdex¬ ['.
Rou‹r
::
$f
.']','ERROR');

959 
	}
}

968 
funùiÚ
 
	$ÿmbio_ru_£cciÚ
(
$e
, 
$¬gs
=
NULL
) {

970 
$£cciÚ
 = ( 
$_POST
['seleccionado'][0] ) ? $_POST['seleccionado'][0] : '';

971 
$£cciÚ
 = 
	`com´ob¬_b¬¿
($£cciÚ).
$_POST
['nuevo_nombre'];

973 iàĞ
	`em±y
(
$£cciÚ
) ) {

974 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Sin secciÃ³n…ara seleccionada…ara„enombrar','ERROR');

975  
FALSE
;

979 
$ru_de¡šo
=
GUt
::
	`‹xtİÏno
(
$£cciÚ
);

980 
$ru_de¡šo
=
	`¡r_»¶aû
(
Rou‹r
::
$dd
,'',$ruta_destino);

981 
$ru_Üig’
 = 
Rou‹r
::
$s
;

983 
$sql
 = "SELECT id, u¾ FROM ".
$this
->
´efijo
."¬chivo WHERE u¾†ik'%".
$ru_Üig’
."%'";

984 
$»suÉ
 = 
$this
->
pdo
->
	`qu”y
(
$sql
);

985 
$num_aãùados
 = 
$»suÉ
->
	`ãtchCŞumn
();

987 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modifiÿ¸u¾ [ '.
$ru_Üig’
.' ]…Ü [ '.
$ru_de¡šo
.' ],‡ãùados: [ '.
$num_aãùados
.' ]');

989 iàĞ
$num_aãùados
 > 0 ) {

991 iàĞ
$sqlResuÉ
 = 
$this
->
pdo
->
	`´•¬e
(
$sql
) ) {

993 
$sqlResuÉ
->
	`execu‹
();

995 
$fa
 = 
$sqlResuÉ
->
	`ãtch
(
PDO
::
FETCH_OBJ
)) {

997 
$nueva_ru
 = 
	`¡r_»¶aû
(
$ru_Üig’
,
$ru_de¡šo
.'/',
$fa
->
u¾
);

998 
$subsql
="UPDATE ".
$this
->
´efijo
."archivos SET url=? WHERE id=?";

999 
$sub»suÉ
 = 
$this
->
pdo
->
	`´•¬e
(
$subsql
);

1000 iàĞ
$sub»suÉ
->
	`execu‹
(
	`¬¿y
(
$nueva_ru
,
$fa
->
id
)) ) {

1001 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Modifiÿd¨u¾ d£cciÃ³À[ '.
$nueva_ru
.' ]');

1003 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Sš„esuÉado ·¿ ['.
$nueva_ru
.']','ERROR');

1012 
	}
}

	@gcm/modulos/indexador/menuAdmin.php

1 <?
php


2 
	g$m’uAdmš
['Seguimiento']['boton']['indexador']['activado']=1;

3 
	g$m’uAdmš
['Seguimiento']['boton']['indexador']['nombre']="Reindexador";

4 
	g$m’uAdmš
['Seguimiento']['boton']['indexador']['title']="Reindexarƒl contenido";

5 
	g$m’uAdmš
['Seguim›Áo']['bÙÚ']['šdexadÜ']['lšk']=
Rou‹r
::
$ba£
."?e=reindexar";

	@gcm/modulos/literales/eventos_admin.php

1 <?
php


19 
	g$ev’tos
['columna']['panel_literales'][5] = '';

33 
	g$acciÚes
['literales']['panel_literales'][] = 'editor';

34 
	g$acciÚes
['literales']['panel_literales'][] = 'traductor';

	@gcm/modulos/literales/eventos_usuario.php

1 <?
php


20 iàĞ!
is£t
(
$_SESSION
['ed™']è|| 
	g$_SESSION
['edit'] != 'si' ) {

21 
$ev’tos
['postcontenido']['procesar_texto'][1] = '';

	@gcm/modulos/literales/lib/Literales.php

1 <?
php


20 
»quœe_Úû
(
GCM_DIR
."lib/int/GcmConfig/lib/GcmConfigFactory.php");

31 şas 
	cL™”®es
 
ex‹nds
 
	mModulos
 {

33 
´iv©e
 
	m$‘iqu‘a_šicio
;

34 
´iv©e
 
	m$‘iqu‘a_fš®
;

36 
funùiÚ
 
	$__cÚ¡ruù
() {

38 
·»Á
::
	`__cÚ¡ruù
();

40 
$this
->
‘iqu‘a_šicio
 = '{L{';

41 
$this
->
‘iqu‘a_fš®
 = '}}';

50 
funùiÚ
 
	$´oû§r_‹xto
() {

52 
glob®
 
$gcm
; 
$LG
 ;

54 
$bufãr
 = 
$gcm
->
cÚ‹nido
;

56  
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_šicio
è!=ğ
çl£
 ) {

58 
$pos1
 = 
NULL
;

59 
$pos2
 = 
NULL
;

60 
$¬chivo
 = 
NULL
;

61 
$»m¶az¬
 = 
NULL
;

62 
$¬chivo
 = 
NULL
;

64 
$pos1
 = 
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_šicio
);

65 
$pos2
 = 
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_fš®
, 
$pos1
);

66 
$»m¶az¬
 = 
	`sub¡r
(
$bufãr
, 
$pos1
, 
$pos2
 - $pos1 + 2);

67 
$‘iqu‘a
 = 
	`¡r_»¶aû
(
$this
->
‘iqu‘a_šicio
,'',
$»m¶az¬
);

68 
$‘iqu‘a
 = 
	`¡r_»¶aû
(
$this
->
‘iqu‘a_fš®
,'',$etiqueta);

70 iàĞ
$pos1
 && 
$pos2
 && 
$‘iqu‘a
 && 
$»m¶az¬
 ) {

72 
$‘iqu‘a
 = 
$this
->
	`´oû§_‘iqu‘a
($etiqueta);

74 
$bufãr
 = 
	`¡r_»¶aû
(
$»m¶az¬
,
$‘iqu‘a
,$buffer);

80 
$gcm
->
cÚ‹nido
=
$bufãr
;

82 
	}
}

94 
funùiÚ
 
	$´oû§_‘iqu‘a
(
$‘iqu‘a
) {

96  
	`l™”®
(
$‘iqu‘a
,1) ;

98 
	}
}

110 
funùiÚ
 
·Ãl_l™”®es
(
$e
,
$¬gs
='') {

112 
$this
->
javasüts
('literales.js');

114 
ob_¡¬t
();

115 
	gecho
 '<div id="panelLiterales">';

117 
	gecho
 '</div>';

118 
	g$§lida
 = 
ob_g‘_cÚ‹Ás
(è; 
ob_’d_ş—n
();

120 
	g$·Ãl
 = 
¬¿y
();

121 
	g$·Ãl
['t™ulo'] = 
l™”®
('L™”®es',3).'['.
	gRou‹r
::
$i
.']';

122 
	g$·Ãl
['ocuÉo'] = 
TRUE
;

123 
	g$·Ãl
['subpanel'] ='panelLiterales';

124 
	g$·Ãl
['jajax'] = "?formato=ajax&m=literales&a=devolverLiterales";

125 
	g$·Ãl
['cÚ‹nido'] = 
$§lida
;

127 
	gTemas
::
·Ãl
(
$·Ãl
);

140 
funùiÚ
 
	$–imš¬L™”®
() {

142 
glob®
 
$gcm
;

144 
$idioma
 = 
Rou‹r
::
$i
;

145 
$fe
=
$gcm
->
	`cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
$idioma
.".php";

147 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

148 
$¬r
->
	`d–
(
$_GET
['elemento']);

149 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

151 
echo
 "EËm’tØ[ ".
$_GET
['elemento']." ]ƒliminado";

153 
	}
}

166 
funùiÚ
 
	$devŞv”L™”®es
(
$fe
=
NULL
) {

168 
glob®
 
$gcm
;

171 
$fe
 = 
$gcm
->
	`cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
Rou‹r
::
$i
.".php";

173 iàĞ!
	`fe_exi¡s
(
$fe
) ) {

174 
	`Œigg”_”rÜ
('ArchivØdidioma ['.
$fe
.']‚Øexi¡e', 
E_USER_ERROR
);

175  
FALSE
;

178 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

180 
$§lida
 = '<div id="panelLiterales">';

181 
$§lida
 .= '<br />';

182 
$§lida
 .= '<a class="boton" style="cursor:…ointer;" onclick="javascript:insertarLiteral()" >'

183 .
	`l™”®
('AÃ±adir',3)

185 
$§lida
 .= '<a class="boton" style="cursor:…ointer;" onclick="javascript:filtra()" >'

186 .
	`l™”®
('Filtrar',3)

188 
$§lida
 .= '<br /><br />';

190 iàĞ
$¬r
->
	`v¬ŸbËs
() ) {

192 
	`fÜ—ch
 ( 
$¬r
->
	`v¬ŸbËs
(è
as
 
$key
 => 
$v®Ü
 ) {

194 
$şa£
 = ( 
	`em±y
(
$v®Ü
) ) ? 'subpanelNegativo' : "subpanel" ;

196 
$§lida
 .= '

197 <
p
 
şass
="'.$clase.'">

198 <
a
 
h»f
="javascript:;"

199 
Úşick
="tinyMCE.execCommand(\'mceInsertContent\',false,\'{L{'.$key.'}}\');„eturn false"

200 
t™Ë
="'.$valor.'" >

202 </
a
>

203 <
a
 
¡yË
="fÚt-size: sm®Ër;" 
t™Ë
="Eliminar"

204 
h»f
="javasüt:;" 
Úşick
="eliminarLiteral(\''.str_replace("'","\'",$key).'\')" >

205 [
X
]

206 </
a
>

207 <
a
 
¡yË
="fÚt-size: sm®Ër;" 
t™Ë
="Modificar"

208 
h»f
="javasüt:;" 
Úşick
="modificarLiteral(\''.$key.'\',\''.$valor.'\')" >

209 [
M
]

210 </
a
>

211 </
p
>';

215 
$§lida
 .= '</div>';

217 
echo
 
$§lida
;

219 
	}
}

231 
funùiÚ
 
	$ªyadœL™”®
() {

233 
glob®
 
$gcm
;

235 
$fe
 = 
$gcm
->
	`cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
Rou‹r
::
$i
.".php";

237 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

238 
$¬r
->
	`£t
(
$_GET
['elemento'],$_GET['valor']);

239 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

241 
echo
 "[ ".
$_GET
['–em’to']." ] = [ ".$_GET['v®Ü']." ]ƒÀ[ ".
$fe
." ]";

243 
	}
}

257 
funùiÚ
 
	$modifiÿrL™”®
() {

259 
glob®
 
$gcm
;

261 
$fe
 = 
$gcm
->
	`cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
Rou‹r
::
$i
.".php";

263 
$¬r
 = 
GcmCÚfigFaùÜy
::
	`G‘GcmCÚfig
(
$fe
);

265 
$¬r
->
	`£t
(
$_GET
['elemento'],$_GET['valor']);

267 
$¬r
->
	`gu¬d¬_v¬ŸbËs
();

269 
echo
 "[ ".
$_GET
['–em’to']." ] = [ ".$_GET['v®Ü']." ]ƒÀ[ ".
$fe
." ]";

271 
	}
}

283 
funùiÚ
 
cÚ‹nido_nuevo
(
$e
, 
$¬gs
='') {

285 
$ex‹nsiÚ
 = ( 
$e
 == "postGuardar" ) ? '.html' : '.btml' ;

287 
	g$nomb»_fich”o
 = 
¡r_»¶aû
(
$ex‹nsiÚ
,'',
Rou‹r
::
$c
);

288 
	g$l™”®_fich”o
 = 
¡r_»¶aû
(
$ex‹nsiÚ
,'',
$_POST
['documento']);

292 
	g$cÚts
 = 
ex¶ode
('/',
$l™”®_fich”o
);

293 
	g$l™”®_fich”o
 = 
$cÚts
[
couÁ
($conts)-1];

295 
	g$fe
=
$gcm
->
cÚfig
('idiomas','DœeùÜiØidiomas')."LG_".
	gRou‹r
::
$ii
.".php";

297 
	g$¬r
 = 
GcmCÚfigFaùÜy
::
G‘GcmCÚfig
(
$fe
);

301 
	g$l™Şd
 = 
$¬r
->
g‘
(
$nomb»_fich”o
);

303 iàĞ
em±y
(
$l™Şd
) ) {

305 
	g$¬r
->
£t
(
$nomb»_fich”o
,
$l™”®_fich”o
);

307 
	g$¬r
->
gu¬d¬_v¬ŸbËs
();

311 
glob®
 
	g$LG
;

312 
	g$LG
[
$nomb»_fich”o
]=
¡r¦ashes
(
$l™”®_fich”o
);

	@gcm/modulos/literales/menuAdmin.php

1 <?
	gphp


	@gcm/modulos/menu/config/config.php

1 <?
php


2 
	g$cÚfig
['descartar'][] = 'gdoxygen';

3 
	g$cÚfig
['descartar'][]='thumbnail';

4 
	g$cÚfig
['orden_presentacion'][] = 'inicio@1';

	@gcm/modulos/menu/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['descartar'] = 'Si un‡rchivo o carpeta contiene uno de†os contenidos‡ descartar‚o se incluyenƒnƒl menÃº';

3 
	g$cÚfig_DESC
['orden_presentacion'] = 'Especificar orden de…resentaciÃ³n de†osƒlementos del menÃºƒl formatoƒs item@orden';

	@gcm/modulos/menu/eventos_usuario.php

1 <?
php


13 
	g$ev’tos
['cabecera']['menu_principal'][0] = '';

14 
	g$ev’tos
['columna']['barra_navegacion'][1] = '';

19 
	g$this
->
£t_li¡a_bÏnÿ
('menu','menu_ajax');

20 
	g$this
->
£t_li¡a_bÏnÿ
('menu','menu_ajax_off');

	@gcm/modulos/menu/lib/Menu.php

1 <?
php


26 şas 
	cM’u
 
ex‹nds
 
	mModulos
 {

28 
public
 
	m$desÿ¹¬
;

31 
public
 
	m$sOpciÚes
, 
	m$sEÆaûs
;

34 
public
 
	m$sM’u
;

38 
public
 
	m$SECCIONES
;

42 
	m$³sos_m’u
 = 
¬¿y
() ;

53 
funùiÚ
 
__cÚ¡ruù
(
$sDœeùÜio
=
NULL
, 
$fŒo
="no", 
$SECCIONES
=
Œue
) {

55 
glob®
 
$gcm
 ;

57 
	m·»Á
::
__cÚ¡ruù
() ;

59 
	m$this
->
	mdesÿ¹¬
 = 
$this
->
cÚfig
('descartar');

63 
	m$³sos_cÚfigu¿ciÚ
 = 
$this
->
cÚfig
('orden_presentacion');

65 iàĞ
	m$³sos_cÚfigu¿ciÚ
 ) {

67 
fÜ—ch
 ( 
$³sos_cÚfigu¿ciÚ
 
as
 
$³sos
 ) {

69 
	m$¬¿y
 = 
ex¶ode
('@',
$³sos
);

70 
	m£lf
::
$³sos_m’u
[
$¬¿y
[0]] = $array[1];

77 
	m$this
->
	msOpciÚes
 = 
¬¿y
();

78 
	m$this
->
	msEÆaûs
 = 
¬¿y
();

79 
	m$this
->
	msT™Ës
 = 
¬¿y
();

80 
	m$this
->
	msM’u
 = 
¬¿y
();

81 
	m$this
->
	msDœeùÜio
 = 
$sDœeùÜio
;

82 
	m$this
->
	mSECCIONES
 = 
$SECCIONES
 ;

85 iàĞ
is£t
(
$sDœeùÜio
è&& 
sub¡r
($sDirectorio, -1, 1) != '/' ) {

86 
$this
->
sDœeùÜio
=
$sDœeùÜio
.'/';

90 iàĞ
fe_exi¡s
(
$this
->
sDœeùÜio
è&& 
	m$dœeùÜio
 = 
dœ
($this->sDirectorio) ) {

92 
$¬chivos
 = 
$dœeùÜio
->
»ad
()) {

96 iàĞ! 
em±y
(
$this
->
desÿ¹¬
) ) {

98 
$desÿ¹¬
 = 
FALSE
;

99 
fÜ—ch
 ( 
$this
->
desÿ¹¬
 
as
 
$desÿ¹ado
 ) {

100 iàĞ
¡½os
(
$¬chivos
,
$desÿ¹ado
è!=ğ
FALSE
 ) {

101 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Desÿ¹ado: '.
$¬chivos
. ' cošcidcÚ '.
$desÿ¹ado
);

102 
	m$desÿ¹¬
 = 
TRUE
;

106 iàĞ
	m$desÿ¹¬
 ) {

111 
	m$™em
=
$this
->
sDœeùÜio
.
$¬chivos
;

116 iàĞ
	m$¬chivos
{0} !ğ"." && 
$¬chivos
 != "index.html" ) {

118 ià(
$fŒo
 <> "no") {

120 ià(!
sub¡r_couÁ
(
$¬chivos
,
$fŒo
)==0 || 
is_dœ
(
$™em
)){

124 iàĞ
is_dœ
(
$™em
) ) {

125 
$EËm’tosDœ
[] = 
$¬chivos
;

127 
	m$EËm’tos
[] = 
$¬chivos
;

133 iàĞ
is_dœ
(
$™em
) ) {

134 
	m$EËm’tosDœ
[] = 
$¬chivos
;

136 
	m$EËm’tos
[] = 
$¬chivos
;

144 
	m$gcm
->
»gi¡¿
(
__FILE__
, 
__LINE__
, 'NØ£…uedabrœ dœeùÜio:'.
$this
->
sDœeùÜio
,'DEBUG');

149 iàĞ!
em±y
(
$EËm’tosDœ
) ) {

150 ià(
em±y
(
$EËm’tos
)) {

151 
	m$EËm’tos
 = 
$EËm’tosDœ
;

153 
	m$EËm’tos
 = 
¬¿y_m”ge
(
$EËm’tosDœ
,
$EËm’tos
);

159 ià(
em±y
(
$EËm’tos
)) {

164 
uasÜt
(
$EËm’tos
, 
¬¿y
("Menu", 'ordenar_por_peso'));

166 
fÜ—ch
(
$EËm’tos
 
as
 
$EËm’to
) {

168 ià(
is_dœ
(
$this
->
sDœeùÜio
.
$EËm’to
) ) {

170 iàĞ
	m$SECCIONES
==
çl£
) {  ; }

171 
	m$dœR•Ïû
=
¡r_»¶aû
('Fe/'.
Rou‹r
::
$ii
.'/','',
$this
->
sDœeùÜio
.
$EËm’to
);

174 
	m$EÆaû
 = 
$dœR•Ïû
.'/';

176 
	m$dœR•Ïû
=
¡r_»¶aû
('Fe/'.
Rou‹r
::
$ii
.'/','',
$this
->
sDœeùÜio
);

179 
	m$EÆaû
 = 
$dœR•Ïû
.
$EËm’to
;

181 
	m$OpciÚ
 = 
$EËm’to
;

183 
	m$L™”®
ğ
l™”®
(
$EËm’to
);

184 
	m$T™Ë
 = 
l™”®
(
$EËm’to
.'_title');

185 iàĞ
	m$T™Ë
 =ğ
$EËm’to
.'_title' ) {

186 
$T™Ë
 = '';

190 
	m$this
->
	msOpciÚes
[] = 
$OpciÚ
;

191 
	m$this
->
	msL™”®
[] = 
$L™”®
;

192 
	m$this
->
	msEÆaûs
[] = 
$EÆaû
;

193 
	m$this
->
	msT™Ës
[] = 
$T™Ë
;

196 
	m$this
->
	msM’u
[
$OpciÚ
] = 
$EÆaû
;

205 
funùiÚ
 
	$Üd’¬_pÜ_³so
(
$a
, 
$b
) {

207 
$aPeso
 = ( 
	`is£t
(
£lf
::
$³sos_m’u
[
$a
]) ) ? self::$pesos_menu[$a] : 0 ;

208 
$bPeso
 = ( 
	`is£t
(
£lf
::
$³sos_m’u
[
$b
]) ) ? self::$pesos_menu[$b] : 0 ;

210 ià(
$aPeso
 =ğ
$bPeso
)  1;

211  (
$aPeso
 < 
$bPeso
) ? -1 : 1;

212 
	}
}

226 
funùiÚ
 
	$In£¹aM’u
(
$sAùu®
, 
$iToM’u
) {

229 ià(
	`em±y
(
$this
->
sOpciÚes
)) {

233 
$iToM’u
) {

235 0: 
$this
->
	`M’uPagšas
(
$sAùu®
, "no");

238 1: 
$this
->
	`M’uB¬¿
(
$sAùu®
);

241 2: 
$this
->
	`M’uDe¥ËgabË
(
$sAùu®
);

244 3: 
$this
->
	`M’uPagšas
(
$sAùu®
, "si");

247 4: 
$this
->
	`M’uBÙÚes
(
$sAùu®
, "si");

251 
echo
 "Tipo‚o disponible";

253 
	}
}

266 
funùiÚ
 
	$M’uPagšas
(
$sAùu®
, 
$´šc®
, 
$imag’es
 = 
FALSE
) {

269 
echo
 '<table id="menu" cellspacing="0"><tr>';

271 ià(
$´šc®
=="si") {

273 if("šicio" =ğ
$sAùu®
) {

275 iàĞ
$imag’es
 ) {

277 
echo
 '<td id="m’uOff"><¨h»f="'.
Rou‹r
::
$ba£
.'"™Ë="'.
	`l™”®
('šicio_t™Ë').'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
('', 
TRUE
).'"‡lt="'.literal('inicio').'" /></a></td>';

279 
echo
 '<td id="m’uOff"><¨h»f="'.
Rou‹r
::
$ba£
.'"™Ë="'.
	`l™”®
('inicio_title').'" ><img src=""‡lt="'.literal('inicio').'" /></a></td>';

284 iàĞ
$imag’es
 ) {

285 
echo
 '<td><¨h»f="'.
Rou‹r
::
$ba£
.'"™Ë="'.
	`l™”®
('šicio_t™Ë').'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
('').'"‡lt="'.literal('inicio').'" /></a></td>';

287 
echo
 '<td><¨h»f="'.
Rou‹r
::
$ba£
.'"™Ë="'.
	`l™”®
('inicio_title').'" >'.literal('inicio').'</a></td>';

294 
	`»£t
(
$this
->
sEÆaûs
);

295 
	`»£t
(
$this
->
sT™Ës
);

296 
	`»£t
(
$this
->
sL™”®
);

299 
$EÆaû
 = 
	`cu¼’t
(
$this
->
sEÆaûs
);

300 
$T™Ë
 = 
	`cu¼’t
(
$this
->
sT™Ës
);

301 
$L™”®
 = 
	`cu¼’t
(
$this
->
sL™”®
);

304 
	`fÜ—ch
(
$this
->
sOpciÚes
 
as
 
$OpciÚ
) {

306 iàĞ
	`is_dœ
(
Rou‹r
::
$dd
.
$EÆaû
) ) {

309 if(
$OpciÚ
 =ğ
$sAùu®
) {

312 iàĞ
$imag’es
 ) {

313 
echo
 '<td id="m’uOff"><¨h»f="'.
Rou‹r
::
$ba£
.
$EÆaû
.'"™Ë="'.
	`l™”®
(
$T™Ë
,1).'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
($EÆaû, 
TRUE
).'"‡É="'.
$L™”®
.'" /></a></td>';

315 
echo
 '<td id="m’uOff"><¨h»f="'.
Rou‹r
::
$ba£
.
$EÆaû
.'"™Ë="'.
	`l™”®
(
$T™Ë
,1).'" >'.
$L™”®
.'</td>';

320 iàĞ
$imag’es
 ) {

321 
echo
 '<td id="'.
$OpciÚ
.'"><¨h»f="'.
Rou‹r
::
$ba£
.
$EÆaû
.'"™Ë="'.
	`l™”®
(
$T™Ë
,1).'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
($EÆaû).'"‡É="'.
$L™”®
.'" /></a></td>';

323 
echo
 '<td id="'.
$OpciÚ
.'" ><¨h»f="'.
Rou‹r
::
$ba£
.
$EÆaû
.'"™Ë="'.
	`l™”®
(
$T™Ë
,1).'" >'.
$L™”®
.'</a></td>';

331 
$EÆaû
 = 
	`Ãxt
(
$this
->
sEÆaûs
);

332 
$T™Ë
 = 
	`Ãxt
(
$this
->
sT™Ës
);

333 
$L™”®
 = 
	`Ãxt
(
$this
->
sL™”®
);

338 
echo
 '</tr></table>';

339 
	}
}

344 
funùiÚ
 
	$M’uB¬¿
(
$sAùu®
) {

346 
glob®
 
$gcm
;

349 iàĞ
$sAùu®
 ) {

351 
$aSecciÚes
 = 
	`ex¶ode
('/',
$sAùu®
);

352 
$sAùu®
 = ( 
$aSecciÚes
[
	`couÁ
($aSecciones)-1] ) ? $aSecciones[count($aSecciones)-1] : $aSecciones[count($aSecciones)-2];

353 
$£cciÚ
=
	`l™”®
(
$sAùu®
,1);

357 
$aSecciÚes
 = 
	`¬¿y
();

358 
$£cciÚ
=
	`l™”®
('inicio',1);

362 
$aURL
 = 
	`ex¶ode
('/',
$_SERVER
['REQUEST_URI']);

364 
echo
 "\n<ul>";

365 
	`fÜ—ch
(
$this
->
sM’u
 
as
 
$OpciÚ
 => 
$EÆaû
) {

367 
$aEÆaû
 = 
	`ex¶ode
('/',
$EÆaû
);

370 
$L™”®
=
	`¡r_»¶aû
('.html','',
$OpciÚ
);

372 iàĞ
	`š_¬¿y
(
$OpciÚ
,
$aSecciÚes
) ) {

374 
echo
 "\n<li>";

375 
echo
 "<¨şass='m_Ú' h»f='".
Rou‹r
::
$’Ïû_»Ïtivo
.Rou‹r::
$dœ
.
$EÆaû
."' >";

376 
echo
 '<img src="'.
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`icÚo
('-').'"‡lt="-"/>';

377 
echo
 " </a>";

378 
echo
 "<¨h»f='".
Rou‹r
::
$’Ïû_»Ïtivo
.Rou‹r::
$dœ
.
$EÆaû
."'>";

379 
echo
 
	`l™”®
(
$L™”®
,1);

380 
echo
 '</a></li>';

381 
$subm’u
[
$OpciÚ
] = 
Ãw
 
	`M’u
(
$this
->
sDœeùÜio
.$OpciÚ.'/', '.html', 
Œue
);

382 
$subm’u
[
$OpciÚ
]->
	`In£¹aM’u
(
Rou‹r
::
$s
,1);

386 iàĞ
	`sub¡r
(
$EÆaû
, -5) == '.html' ) {

387 iàĞ
	`¡r_»¶aû
('%20',' ',
$aURL
[
	`couÁ
($aURL)-1]è=ğ
$aEÆaû
[count($aEnlace)-1]) {

388 
echo
 "\n<l˜şass='li¡aOff' >".
	`l™”®
(
$L™”®
,1).'</li>';

390 
echo
 "\n<li><¨h»f='".
Rou‹r
::
$’Ïû_»Ïtivo
.Rou‹r::
$dœ
.
$EÆaû
."'>".
	`l™”®
(
$L™”®
,1).'</a></li>';

393 
echo
 "\n<li>";

394 
echo
 "<¨şass='m_off' h»f='".
Rou‹r
::
$’Ïû_»Ïtivo
.Rou‹r::
$dœ
.
$EÆaû
."'>";

395 
echo
 '<img src="'.
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`icÚo
('+').'"‡lt="+"/>';

396 
echo
 " </a>";

397 
echo
 "<¨h»f='".
Rou‹r
::
$’Ïû_»Ïtivo
.Rou‹r::
$dœ
.
$EÆaû
."'>".
	`l™”®
(
$L™”®
,1);

398 
echo
 '</a></li>';

403 
echo
 "\n</ul>";

405 
	}
}

409 
funùiÚ
 
	$M’uDe¥ËgabË
(
$sAùu®
) {

414 
echo
 '<form‡ction="">'.

420 
	`fÜ—ch
(
$this
->
sM’u
 
as
 
$OpciÚ
 => 
$EÆaû
)

421 if(
$OpciÚ
 =ğ
$sAùu®
)

422 
echo
 '<İtiÚ v®ue="'.
$EÆaû
.

423 '" s–eùed>'.
	`l™”®
(
$OpciÚ
,1).'</option>';

425 
echo
 '<İtiÚ v®ue="'.
$EÆaû
.'">'.
	`l™”®
(
$OpciÚ
,1).'</option>';

427 
echo
 '</select></form>';

428 
	}
}

441 
funùiÚ
 
	$m’u_´šc®_img
() {

443 
echo
 "\n<div id='menu_principal'>";

446 
$m’uPršc®
 = 
Ãw
 
	`M’u
("Fe/".
Rou‹r
::
$ii
."/");

447 
$m’uPršc®
->
	`In£¹aM’u
(
Rou‹r
::
$e¡amos
,4);

449 
echo
 "\n</div> <!-- Acaba menu_principal -->";

451 
	}
}

459 
funùiÚ
 
	$m’u_´šc®
() {

465 
echo
 "\n<div id='menu_principal'>";

468 
$m’uPršc®
 = 
Ãw
 
	`M’u
("Fe/".
Rou‹r
::
$ii
."/");

469 
$m’uPršc®
->
	`In£¹aM’u
(
Rou‹r
::
$e¡amos
,3);

471 
echo
 "\n</div> <!-- Acaba menu_principal -->";

473 
	}
}

479 
funùiÚ
 
	$b¬¿_ÇvegaciÚ
() {

481 
glob®
 
$gcm
;

483 
$this
->
	`javasüts
('menu.js');

485 
	`ob_¡¬t
();

486 
echo
 '<¨h»f="'.
$_SERVER
['PHP_SELF'].'" >'.
	`l™”®
('inicio').'</a>';

487 
echo
 '<div id="barraNavegacion">';

488 
$b¬¿NavegaciÚ
 = 
Ãw
 
	`M’u
("Fe/".
Rou‹r
::
$ii
."/", '.html', 
Œue
);

489 
$b¬¿NavegaciÚ
->
	`In£¹aM’u
(
Rou‹r
::
$s
,1);

490 
echo
 '</div>';

491 
$cÚ‹nido
 = 
	`ob_g‘_cÚ‹Ás
();

492 
	`ob_’d_ş—n
();

495 
$·Ãl
 = 
	`¬¿y
();

496 
$·Ãl
['t™ulo'] = 
	`l™”®
('MenÃº',3);

497 
$·Ãl
['cÚ‹nido'] =
$cÚ‹nido
;

499 
Temas
::
	`·Ãl
(
$·Ãl
);

501 
	}
}

503 
funùiÚ
 
	$m’u_ajax
() {

505 
glob®
 
$gcm
;

507 
	`ob_’d_ş—n
();

510 
$£cciÚes
 = 
	`ex¶ode
('/',
	`com´ob¬_b¬¿
(
Rou‹r
::
$s
,'eliminar'));

511 
$£cciÚ
 = 
$£cciÚes
[
	`couÁ
($secciones)-1];

512 
echo
 "\n<li>";

513 
echo
 "<¨şass='m_Ú' h»f='".
Rou‹r
::
$s
."' >";

514 
echo
 '<img src="'.
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`icÚo
('-').'"‡lt="-"/>';

515 
echo
 " </a>";

516 
echo
 "<¨h»f='".
Rou‹r
::
$s
."'>";

517 
echo
 
	`l™”®
(
$£cciÚ
,1);

518 
echo
 '</a></li>';

519 
$subm’u
 = 
Ãw
 
	`M’u
(
Rou‹r
::
$dd
.Rou‹r::
$s
, '.html', 
Œue
);

520 
$subm’u
->
	`In£¹aM’u
(
Rou‹r
::
$s
,1);

522 
	`ex™
();

524 
	}
}

526 
funùiÚ
 
	$m’u_ajax_off
() {

528 
glob®
 
$gcm
;

530 
	`ob_’d_ş—n
();

532 
$£cciÚes
 = 
	`ex¶ode
('/',
	`com´ob¬_b¬¿
(
Rou‹r
::
$s
,'eliminar'));

533 
$£cciÚ
 = 
$£cciÚes
[
	`couÁ
($secciones)-1];

535 
echo
 "<¨şass='m_off' h»f='".
Rou‹r
::
$s
."' >";

536 
echo
 '<img src="'.
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`icÚo
('+').'"‡lt="+"/>';

537 
echo
 " </a>";

539 
	`ex™
();

540 
	}
}

553 
funùiÚ
 
	$bÙÚ_£cciÚ
(
$£cciÚ
, 
$Ú
 = 
FALSE
) {

555 
$e¡ado
 = ( 
$Ú
 ) ? 'on' : 'off';

557 
$img
 = 
Rou‹r
::
$d
. 
$£cciÚ
.'m’u_'.
$e¡ado
.'.²g'; iàĞ
	`fe_exi¡s
($imgèè Rou‹r::
$ba£
.$img;

558 
$img
 = 
Rou‹r
::
$d
. 
$£cciÚ
.'m’u_'.
$e¡ado
.'.gif'; iàĞ
	`fe_exi¡s
($imgèè Rou‹r::
$ba£
.$img;

559 
$img
 = 
Rou‹r
::
$dd
.
$£cciÚ
.'m’u_'.
$e¡ado
.'.²g'; iàĞ
	`fe_exi¡s
($imgèè Rou‹r::
$ba£
.$img;

560 
$img
 = 
Rou‹r
::
$dd
.
$£cciÚ
.'m’u_'.
$e¡ado
.'.gif'; iàĞ
	`fe_exi¡s
($imgèè Rou‹r::
$ba£
.$img;

562 
$£cciÚ_
 = (
$£cciÚ
)?$seccion:'inicio';

563 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ£ƒncÚŒØbÙÚ d£cciÃ³À·¿ '.
$£cciÚ_
,'ADMIN');

564 
	}
}

576 
funùiÚ
 
	$M’uBÙÚes
(
$sAùu®
, 
$´šc®
) {

578 
echo
 '<ul id="menu_botones_horizontal">';

582 
$t™Ë_šicio
 = ( 
	`l™”®
('inicio_title') != 'inicio_title' ) ?†iteral('inicio_title') : '' ;

583 if("šicio" =ğ
$sAùu®
 || 
	`em±y
(
Rou‹r
::
$s
) ) {

585 
echo
 '<li id="menuOff">';

586 
echo
 '<¨h»f="'.
Rou‹r
::
$ba£
.'"™Ë="'.
$t™Ë_šicio
.'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
('', 
TRUE
).'"‡É="'.
	`l™”®
('inicio').'" /></a>';

590 
echo
 '<li>';

591 
echo
 '<¨h»f="'.
Rou‹r
::
$ba£
.'"™Ë="'.
$t™Ë_šicio
.'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
('').'"‡É="'.
	`l™”®
('inicio').'" /></a>';

597 
$§lida
 = 
FALSE
;

598 
$fich”os_£cciÚ
 = 
	`glob
(
Rou‹r
::
$dd
.'*.html');

599 
$cÚ‹nidos
 = 
	`¬¿y
();

600 
	`fÜ—ch
 ( 
$fich”os_£cciÚ
 
as
 
$fe
 ) {

601 
$cÚ‹nidos
[] = 
	`ba£Çme
(
$fe
,'.html');

603 
	`uasÜt
(
$cÚ‹nidos
, 
	`¬¿y
("Menu", 'ordenar_por_peso'));

605 
	`fÜ—ch
 ( 
$cÚ‹nidos
 
as
 
$nomb»
 ) {

607 
$l™”®
 = 
	`l™”®
(
$nomb»
,1);

608 
$’Ïû
 = 
Rou‹r
::
$ba£
.
$nomb»
.'.html';

609 
$şa£
 = ( 
Rou‹r
::
$c
 =ğ
$nomb»
.'.html' ) ? 'ma_on' : 'ma_off';

611 iàĞ
$nomb»
 != 'index' ) {

613 
$§lida
 .ğ'<l˜şass="'.
$şa£
.'">';

614 iàĞ
Rou‹r
::
$c
 !ğ
$nomb»
.'.html' ) 
$§lida
 .ğ'<¨h»f="'.
$’Ïû
.'">';

615 
$§lida
 .ğ
$l™”®
;

616 iàĞ
Rou‹r
::
$c
 !ğ
$nomb»
.'.html' ) 
$§lida
 .= '</a>';

617 
$§lida
 .= '</li><br />';

623 iàĞ
$§lida
 ) 
echo
 '<ul>'.$salida.'</ul>';

624 
echo
 '</li>';

629 
	`»£t
(
$this
->
sEÆaûs
);

630 
	`»£t
(
$this
->
sT™Ës
);

631 
	`»£t
(
$this
->
sL™”®
);

634 
$EÆaû
 = 
	`cu¼’t
(
$this
->
sEÆaûs
);

635 
$T™Ë
 = 
	`cu¼’t
(
$this
->
sT™Ës
);

636 
$L™”®
 = 
	`cu¼’t
(
$this
->
sL™”®
);

639 
	`fÜ—ch
(
$this
->
sOpciÚes
 
as
 
$OpciÚ
) {

641 iàĞ
	`is_dœ
(
Rou‹r
::
$dd
.
$EÆaû
) ) {

644 if(
$OpciÚ
 =ğ
$sAùu®
) {

646 
echo
 '<li id="menuOff">';

647 
echo
 '<¨h»f="'.
Rou‹r
::
$ba£
.
$EÆaû
.'"™Ë="'.
$T™Ë
.'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
($EÆaû, 
TRUE
).'"‡É="'.
$L™”®
.'" /></a>';

651 
echo
 '<l˜id="'.
$OpciÚ
.'">';

652 
echo
 '<¨h»f="'.
Rou‹r
::
$ba£
.
$EÆaû
.'"™Ë="'.
$T™Ë
.'" ><img src="'.
$this
->
	`bÙÚ_£cciÚ
($EÆaû).'"‡É="'.
$L™”®
.'" /></a>';

658 
$§lida
 = 
FALSE
;

659 
$fich”os_£cciÚ
 = 
	`glob
(
Rou‹r
::
$dd
.
$EÆaû
.'*.html');

660 
$cÚ‹nidos
 = 
	`¬¿y
();

661 
	`fÜ—ch
 ( 
$fich”os_£cciÚ
 
as
 
$fe
 ) {

662 
$cÚ‹nidos
[] = 
	`ba£Çme
(
$fe
,'.html');

664 
	`uasÜt
(
$cÚ‹nidos
, 
	`¬¿y
("Menu", 'ordenar_por_peso'));

666 
	`fÜ—ch
 ( 
$cÚ‹nidos
 
as
 
$nomb»
 ) {

668 
$l™”®
 = 
	`l™”®
(
$nomb»
,1);

669 
$’Ïû
 = 
Rou‹r
::
$ba£
.
$EÆaû
.
$nomb»
.'.html';

670 
$şa£
 = ( 
Rou‹r
::
$c
 =ğ
$nomb»
.'.html' ) ? 'ma_on' : 'ma_off';

672 iàĞ
$nomb»
 != 'index' ) {

674 
$§lida
 .ğ'<l˜şass="'.
$şa£
.'">';

675 iàĞ
Rou‹r
::
$c
 !ğ
$nomb»
.'.html' ) 
$§lida
 .ğ'<¨h»f="'.
$’Ïû
.'">';

676 
$§lida
 .ğ
$l™”®
;

677 iàĞ
Rou‹r
::
$c
 !ğ
$nomb»
.'.html' ) 
$§lida
 .= '</a>';

678 
$§lida
 .= '</li><br />';

684 iàĞ
$§lida
 ) 
echo
 '<ul>'.$salida.'</ul>';

685 
echo
 '</li>';

690 
$EÆaû
 = 
	`Ãxt
(
$this
->
sEÆaûs
);

691 
$T™Ë
 = 
	`Ãxt
(
$this
->
sT™Ës
);

692 
$L™”®
 = 
	`Ãxt
(
$this
->
sL™”®
);

697 ià(
$´šc®
=="si"è
echo
 '</ul>';

700 
	}
}

	@gcm/modulos/metatags/config/config.php

1 <?
php


2 
	g$cÚfig
['title'] = 'Gcm';

3 
	g$cÚfig
['author'] = 'Eduardo MagranÃ©';

4 
	g$cÚfig
['subject'] = 'Gestor de Contenido Gcm';

5 
	g$cÚfig
['description'] = 'Herramienta…ara†a gestiÃ³n de contenido variado';

6 
	g$cÚfig
['keywords'] = 'programaciÃ³n, informÃ¡tica,†inux,…hp, bash, javascript, css,‡jax';

7 
	g$cÚfig
['generator'] = 'vim';

8 
	g$cÚfig
['language'] = 'spanish';

9 
	g$cÚfig
['revisit'] = '1 day';

10 
	g$cÚfig
['distribution'] = 'global';

11 
	g$cÚfig
['robots'] = 'all';

	@gcm/modulos/metatags/config/config_ca.php

1 <?
php


2 
	g$cÚfig_DESC
['Titulo']='Titulo del…royecto';

3 
	g$cÚfig_DESC
['Subtitulo']='Subtitulo del…royecto';

4 
	g$cÚfig_DESC
['Descripcion']='DescripciÃ³n del…royecto,…ara incluirƒn†os metaags';

5 
	g$cÚfig_DESC
['keywords']='Palabras clave…ara†os buscadores separadas…or unƒspacio';

	@gcm/modulos/metatags/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['title']='Titulo del…royecto';

3 
	g$cÚfig_DESC
['author']='Titulo del…royecto';

4 
	g$cÚfig_DESC
['subject']='Subtitulo del…royecto';

5 
	g$cÚfig_DESC
['description']='DescripciÃ³n del…royecto,…ara incluirƒn†os metaags';

6 
	g$cÚfig_DESC
['keywords']='Palabras clave…ara†os buscadores separadas…or comas';

7 
	g$cÚfig_DESC
['generator']='Programa…ara gene';

8 
	g$cÚfig_DESC
['language']='CÃ³digo de†enguajeƒjemplo:ƒs,ƒn';

9 
	g$cÚfig_DESC
['revisit']='Ejemplo 1 day';

10 
	g$cÚfig_DESC
['distribution']='Ejemplo global';

11 
	g$cÚfig_DESC
['robots']='';

	@gcm/modulos/metatags/eventos_usuario.php

1 <?
php


2 
	g$ev’tos
['heads']['presentar_heads_dinamicos'][1] = '';

	@gcm/modulos/metatags/lib/Metatags.php

1 <?
php


38 şas 
	cM‘©ags
 
ex‹nds
 
	mModulos
 {

40 
´iv©e
 
	m$Proyeùo
;

41 
´iv©e
 
	m$T™ulo
;

42 
´iv©e
 
	m$DesüciÚ
;

43 
´iv©e
 
	m$keywÜds
;

48 
funùiÚ
 
	$__cÚ¡ruù
() {

50 
·»Á
::
	`__cÚ¡ruù
();

52 
$this
->
T™ulo
 = $this->
	`cÚfig
('title');

60 
funùiÚ
 
	$´e£Á¬_h—ds_dšamicos
() {

62 
glob®
 
$gcm
;

64 iàĞ
$gcm
->
t™ulo
 ) {

65 
$t™ulo
 = 
$gcm
->
t™ulo
;

66 } 
	`–£if
 ( 
Rou‹r
::
$c
 == 'index.html' || ! Router::$c ) {

67 
$t™ulo
=
Rou‹r
::
$e¡amos
;

68 
$t™ulo
 = 
	`l™”®
($titulo);

70 
$t™ulo
=
	`¡r_»¶aû
('.html','',
Rou‹r
::
$c
);

71 
$t™ulo
 = 
	`l™”®
($titulo);

74 
$t™ulo_·gša
 = ( 
$gcm
->
t™ulo
 ) ? $gcm->t™ulØ: 
$t™ulo
;

76 
$t™ulo
 = 
	`¡r_gs
(
$this
->
T™ulo
.' :: '.
$t™ulo_·gša
);

79 
	`šşude
(
	`dœÇme
(
__FILE__
).'/../config/config.php');

80 iàĞ
	`is_fe
('DATOS/cÚfigu¿ciÚ/m‘©ags/cÚfig.php'èè
	`šşude
('DATOS/configuracion/metatags/config.php');

83 
	`fÜ—ch
 ( 
$cÚfig
 
as
 
$Çme
 => 
$v®Ü
 ) {

85 
echo
 "\n".'<m‘¨Çme="'.
$Çme
.'" cÚ‹Á="'.
$v®Ü
.'" />';

89 
echo
 "\n\n";

91 
	`šşude
 (
	`dœÇme
(
__FILE__
).'/../html/heads.html');

93 
	}
}

	@gcm/modulos/referencias/eventos_admin.php

1 <?
php


2 
	g$ev’tos
['columna']['panel'][10]='';

	@gcm/modulos/referencias/eventos_usuario.php

1 <?
php


3 
	g$ev’tos
['postcontenido']['procesar_texto'][1] = '';

	@gcm/modulos/referencias/lib/Referencias.php

1 <?
php


25 şas 
	cReã»ncŸs
 
ex‹nds
 
	mModulos
 {

27 
´iv©e
 
	m$‘iqu‘a_šicio
;

28 
´iv©e
 
	m$‘iqu‘a_fš®
;

30 
funùiÚ
 
	$__cÚ¡ruù
() {

32 
·»Á
::
	`__cÚ¡ruù
();

34 
$this
->
‘iqu‘a_šicio
 = '{Ref{';

35 
$this
->
‘iqu‘a_fš®
 = '}}';

43 
funùiÚ
 
	$´•roû§_‹xto
() {

45 
$§lida
 = '<div class="panel">';

46 
$§lida
 .= '<span class="tituloPanel">';

47 
$§lida
 .ğ'<¨h»f="javasüt:visu®iz¬(\'ÿja_’Ïûs\')" >'.
	`l™”®
('Enlaces„elacionados').'</a>';

48 
$§lida
 .= '</span>';

49 
$§lida
 .= '<div id="caja_enlaces" class="subpanel_visible">';

50 
$§lida
 .= '<ul>';

51  
$§lida
;

53 
	}
}

61 
funùiÚ
 
	$po¡´oû§_‹xto
() {

63 
$§lida
 = '</ul>';

64 
$§lida
 .= '</div>';

65 
$§lida
 .= '</div>';

67  
$§lida
;

69 
	}
}

75 
funùiÚ
 
	$´oû§r_‹xto
() {

77 
glob®
 
$gcm
;

79 
$bufãr
 = 
	`ob_g‘_cÚ‹Ás
().
$gcm
->
cÚ‹nido
 ;

80 
	`ob_ş—n
();

82 
$num_‘iqu‘a
 = 0;

84  
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_šicio
è!=ğ
çl£
 ) {

86 
$num_‘iqu‘a
++;

87 
$pos1
 = 
NULL
;

88 
$pos2
 = 
NULL
;

89 
$¬chivo
 = 
NULL
;

90 
$»m¶az¬
 = 
NULL
;

91 
$¬chivo
 = 
NULL
;

93 
$pos1
 = 
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_šicio
);

94 
$pos2
 = 
	`¡½os
(
$bufãr
, 
$this
->
‘iqu‘a_fš®
, 
$pos1
);

95 
$»m¶az¬
 = 
	`sub¡r
(
$bufãr
, 
$pos1
, 
$pos2
 - $pos1 + 2);

96 
$‘iqu‘a
 = 
	`¡r_»¶aû
(
$this
->
‘iqu‘a_šicio
,'',
$»m¶az¬
);

97 
$‘iqu‘a
 = 
	`¡r_»¶aû
(
$this
->
‘iqu‘a_fš®
,'',$etiqueta);

99 iàĞ
$pos1
 && 
$pos2
 && 
$‘iqu‘a
 && 
$»m¶az¬
 ) {

101 
$‘iqu‘a
 = 
$this
->
	`´oû§_‘iqu‘a
($‘iqu‘a,
$num_‘iqu‘a
);

102 
$bufãr
 = 
	`¡r_»¶aû
(
$»m¶az¬
,
$‘iqu‘a
,$buffer);

110 iàĞ!
	`em±y
(
$‘iqu‘a
) ) {

112 
$bufãr
 = 
	`¡r_»¶aû
(
$‘iqu‘a
,$‘iqu‘a.
$this
->
	`po¡´oû§_‹xto
(),$buffer);

116 
$gcm
->
cÚ‹nido
=
$bufãr
;

118 
	}
}

131 
funùiÚ
 
	$´oû§_‘iqu‘a
(
$»f
,
$num_‘iqu‘a
) {

133 
$§lida
 = '';

135 iàĞ
$num_‘iqu‘a
 =ğ1 ) 
$§lida
 = 
$this
->
	`´•roû§_‹xto
();

137 iàĞ
	`¡½os
(
$»f
,'href') ) {

138 
$§lida
 .ğ'<li>'.
$»f
.'</li>';

139 } 
	`–£if
 ( 
	`¡½os
(
$»f
,'::') ) {

140 
	`li¡
(
$»f
,
$nomb»
èğ
	`ex¶ode
('::',$ref);

141 
$§lida
 .ğ'<li><¨h»f="'.
$»f
.'">'.
$nomb»
.'</a></li>';

143 
$nomb»
 = 
$»f
;

144 
$§lida
 .ğ'<li><¨h»f="'.
$»f
.'">'.
$nomb»
.'</a></li>';

147  
$§lida
;

149 
	}
}

156 
funùiÚ
 
	$·Ãl
() {

160 iàĞ
Rou‹r
::
$e
 !== 'editar_contenido' && Router::$e !== 'nuevo' ) ;

162 
$·Ãl
 = 
	`¬¿y
();

163 
$·Ãl
['t™ulo'] = 
	`l™”®
('Insertar').' '.literal('referencia');

164 
$·Ãl
['ocuÉo'] = 
TRUE
;

165 
$·Ãl
['href'] = 'javascript:visualizar(\'referencias_form\');';

166 
$·Ãl
['subpanel'] ='referencias_form';

167 
$·Ãl
['contenido'] =

169 
Nomb»
: <
šput
 
ty³
="‹xt" 
Çme
="nombre" />

170 <
br
 />

171 
EÆaû
: <
šput
 
ty³
="‹xt" 
Çme
="enlace" />

172 <
br
 />

173 <
šput
 
ty³
="subm™" 
v®ue
="'.literal('Insertar').'" />

174 </
fÜm
>';

176 
Temas
::
	`·Ãl
(
$·Ãl
);

178 
	}
}

	@gcm/modulos/referencias/menuAdmin.php

1 <?
	gphp


	@gcm/modulos/responsiveslides/eventos_admin.php

1 <?
	gphp


	@gcm/modulos/responsiveslides/eventos_usuario.php

1 <?
	gphp


	@gcm/modulos/responsiveslides/lib/Responsiveslides.php

1 <?
php


15 şas 
	cRe¥Úsive¦ides
 
ex‹nds
 
	mModulos
 {

19 
funùiÚ
 
	$__cÚ¡ruù
() {

21 
·»Á
::
	`__cÚ¡ruù
();

25 
funùiÚ
 
	$¦ide
() {

27 
	}
}

	@gcm/modulos/responsiveslides/menuAdmin.php

1 <?
	gphp


	@gcm/modulos/temas/config/config.php

1 <?
php


2 
	g$cÚfig
['tema_actual']='zen';

	@gcm/modulos/temas/css/colores.php

1 <?
php


4 
	g$cŞÜes
['body-00'] = '#e9eaec';

5 
	g$cŞÜes
['body-01'] = '#161818';

6 
	g$cŞÜes
['body-02'] = 'rgba(254,254,254,1)';

7 
	g$cŞÜes
['body-03'] = 'rgba(252,252,252,1)';

8 
	g$cŞÜes
['body-04'] = 'rgba(219,219,219,1)';

9 
	g$cŞÜes
['body-05'] = 'rgba(129,130,133,1)';

10 
	g$cŞÜes
['body-06'] = '#fff';

11 
	g$cŞÜes
['body-07'] = '#646464';

12 
	g$cŞÜes
['body-08'] = 'rgba(0,0,0,0.3)';

13 
	g$cŞÜes
['body-09'] = 'rgba(0, 0, 0, 0.3)';

14 
	g$cŞÜes
['body-10'] = 'rgba(255, 255, 255, 1)';

15 
	g$cŞÜes
['body-11'] = '#000';

16 
	g$cŞÜes
['body-12'] = '#ddd';

17 
	g$cŞÜes
['body-13'] = '#c3c3c3';

18 
	g$cŞÜes
['body-14'] = '#7c7c7c';

19 
	g$cŞÜes
['body-15'] = '#dd0';

20 
	g$cŞÜes
['body-16'] = 'rgba(255, 255, 255, 0.7)';

21 
	g$cŞÜes
['body-17'] = '#666666';

22 
	g$cŞÜes
['body-18'] = '#eee';

23 
	g$cŞÜes
['menuAdmin-00'] = '#666';

24 
	g$cŞÜes
['menuAdmin-01'] = '#ccc';

25 
	g$cŞÜes
['comentarios-00'] = '#f0e7ca';

26 
	g$cŞÜes
['comentarios-01'] = '#dcd9c5';

27 
	g$cŞÜes
['comentarios-02'] = '#8385b5';

28 
	g$cŞÜes
['comentarios-03'] = '#777';

29 
	g$cŞÜes
['comentarios-04'] = '#789';

30 
	g$cŞÜes
['geshi-00'] = '#222223';

31 
	g$cŞÜes
['geshi-01'] = '#222';

32 
	g$cŞÜes
['geshi-02'] = '#f8f8f8';

33 
	g$cŞÜes
['geshi-03'] = '#202021';

34 
	g$cŞÜes
['geshi-04'] = '#505e80';

35 
	g$cŞÜes
['thickbox-00'] = '#333333';

36 
	g$cŞÜes
['thickbox-01'] = '#ffffff';

37 
	g$cŞÜes
['thickbox-02'] = '#000000';

38 
	g$cŞÜes
['thickbox-03'] = '#525252';

39 
	g$cŞÜes
['thickbox-04'] = '#e8e8e8';

40 
	g$cŞÜes
['botonera-00'] = '#d9e6fc';

41 
	g$cŞÜes
['listado_contenidos-00'] = '#eff0f0';

42 
	g$cŞÜes
['listado_contenidos-01'] = '#2c2f3f';

43 
	g$cŞÜes
['pie-00'] = '#eeeeee';

	@gcm/modulos/temas/eventos_admin.php

1 <?
php


5 iàĞ
	gRou‹r
::
$a
 =ğ'admši¡¿r' && 
Rou‹r
::
$m
 == 'temas' ) {

6 
$ev’tos
['columna']['panel_colores'][1] = '';

	@gcm/modulos/temas/eventos_usuario.php

1 <?
php


24 
	g$ev’tos
['precarga']['inspeccionar_router'][3] = '';

27 
	g$ev’tos
['pie']['pie'][1] = '';

30 
	g$ev’tos
['cabeceraIzquierda']['presentar_titulo'][1]='';

33 
	g$ev’tos
['heads']['incluir_css_head'][5] = '';

36 
	g$ev’tos
['heads']['incluir_javascript_head'][5] = '';

39 
	g$ev’tos
['scripts']['incluir_javascript'][1] = '';

42 
	g$ev’tos
['precarga']['ocultar_contenido_desde_titulo'][10] = '';

	@gcm/modulos/temas/lib/Temas.php

1 <?
php


10 
»quœe_Úû
(
GCM_DIR
.'lib/int/temas/lib/TemaGcm.php');

12 
»quœe_Úû
(
GCM_DIR
.'lib/ext/detectar_navegador/browser_class_inc.php');

59 şas 
	cTemas
 
ex‹nds
 
	mModulos
 {

61 
public
 
	m$¶©afÜma
;

62 
public
 
	m$ÇvegadÜ
;

63 
public
 
	m$v”siÚ
;

65 
´Ùeùed
 
	m$‹ma
;

66 
´Ùeùed
 
	m$fich”os_xdeãùo
;

67 
´Ùeùed
 
	m$fich”os_‹ma
;

68 
´Ùeùed
 
	m$cŞÜes
;

70 
´Ùeùed
 
	m$dœ_modulos
;

71 
´Ùeùed
 
	m$dœ_‹mas
 = 'temasGcm/';

73 
´Ùeùed
 
	m$‹ma_aùu®
;

74 
´Ùeùed
 
	m$dœ_‹ma_aùu®
;

75 
´Ùeùed
 
	m$fich_cŞÜes
;

77 
´iv©e
 
	m$tos_fich”os
 = 
¬¿y
('css','html','js','img','iconos','libjs');

79 
´iv©e
 
	m$T™ulo
;

80 
´iv©e
 
	m$Subt™ulo
;

93 
funùiÚ
 
	$__cÚ¡ruù
() {

95 
glob®
 
$gcm
;

97 
·»Á
::
	`__cÚ¡ruù
();

99 
$‹ma_aùu®
 = 
$gcm
->
‹ma
;

103 iàĞ
	`is£t
(
$_REQUEST
['tema']) ) {

104 
$‹ma_aùu®
 = 
$_REQUEST
['tema'];

105 
$_SESSION
[
$gcm
->
	`cÚfig
('admš','Proyeùo').'_‹ma'] = 
$‹ma_aùu®
;

106 } 
	`–£if
 ( 
	`is£t
(
$_SESSION
[
$gcm
->
	`cÚfig
('admin','Proyecto').'_tema']) ) {

107 
$‹ma_aùu®
 = 
$_SESSION
[
$gcm
->
	`cÚfig
('admin','Proyecto').'_tema'];

110 
$b
 = 
Ãw
 
	`brow£r
();

111 
$bb
 = 
$b
->
	`wh©Brow£r
();

113 
$this
->
ÇvegadÜ
 = 
$bb
['browsertype'];

114 
$this
->
v”siÚ
 = 
$bb
['version'];

115 
$this
->
¶©afÜma
 = 
$bb
['platform'];

117 
$this
->
T™ulo
 = 
$gcm
->
	`cÚfig
('metatags','title');

118 
$this
->
Subt™ulo
 = 
$gcm
->
	`cÚfig
('metatags','subject');

120 
$‹ma_cÚf
 = 
$this
->
	`cÚfig
('tema_actual');

122 
$this
->
‹ma_aùu®
 = ( 
$‹ma_aùu®
 ) ? $‹ma_aùu® : 
$‹ma_cÚf
 ;

123 
$this
->
dœ_‹ma_aùu®
 = ( $this->
‹ma_aùu®
 ) ? $this->
dœ_‹mas
.$this->‹ma_aùu®.'/' : 
FALSE
;

124 
$this
->
dœ_modulos
 = 
GCM_DIR
.'modulos/';

126 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Tem¨aùu®: '.
$this
->
‹ma_aùu®
);

130 iàĞ
	`fe_exi¡s
(
$this
->
dœ_‹ma_aùu®
.'modulos/temas/css/colores.php') ) {

131 
$this
->
fich_cŞÜes
 = $this->
dœ_‹ma_aùu®
.'modulos/temas/css/colores.php';

133 
$this
->
fich_cŞÜes
 = $this->
dœ_modulos
.'temas/css/colores.php';

136 
$this
->
	`cÚŒuœ_li¡a_cŞÜes
();

140 iàĞ! 
	`is_dœ
(
$this
->
dœ_modulos
) ) {

142 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"DœeùÜiØdmodulo [".
$this
->
dœ_modulos
."]‚oƒncontrado",'ADMIN');

146 
$this
->
fich”os_xdeãùo
 = $this->
	`busÿr_fich”o
($this->
dœ_modulos
);

150 iàĞ
	`is_dœ
('modulos') ) {

152 
$fich”os_modulos_´oyeùo
 = 
$this
->
	`busÿr_fich”o
('modulos/');

153 
	`fÜ—ch
 ( 
$this
->
fich”os_xdeãùo
 
as
 
$key
 => 
$v®Ü
 ) {

154 iàĞ
	`is£t
(
$fich”os_modulos_´oyeùo
[
$key
]) ) {

155 
$this
->
fich”os_xdeãùo
[
$key
] = 
	`¬¿y_m”ge
($this->fich”os_xdeãùo[$key],
$fich”os_modulos_´oyeùo
[$key]);

167 iàĞ
	`is_dœ
(
$this
->
dœ_‹ma_aùu®
) ) {

169 
$this
->
fich”os_‹ma
 = $this->
	`busÿr_fich”o
($this->
dœ_‹ma_aùu®
.'modulos/');

173 iàĞ!
	`em±y
(
$this
->
fich”os_‹ma
) ) {

175 
	`fÜ—ch
 ( 
$this
->
fich”os_xdeãùo
 
as
 
$key
 => 
$v®Ü
 ) {

176 iàĞ
	`is£t
(
$this
->
fich”os_‹ma
[
$key
]) ) {

177 
$fich”os
[
$key
] = 
	`¬¿y_m”ge
(
$this
->
fich”os_xdeãùo
[$key],$this->
fich”os_‹ma
[$key]);

179 
$fich”os
[
$key
] = 
$this
->
fich”os_xdeãùo
[$key];

184 
$fich”os
 = 
$this
->
fich”os_xdeãùo
;

187 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Fich”o d–ema: '.
	`d•u¿r
(
$fich”os
));

188 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'CŞÜe d–ema: '.
	`d•u¿r
(
$this
->
cŞÜes
));

189 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Si¡ema: '.
$this
->
¶©afÜma
.' NavegadÜ: '.$this->
ÇvegadÜ
.' V”siÃ³n: '.$this->
v”siÚ
);

191 
$this
->
‹ma
 = 
Ãw
 
	`TemaGcm
(
$fich”os
,$this->
cŞÜes
);

199 
funùiÚ
 
	$cÚŒuœ_li¡a_cŞÜes
() {

201 
	`šşude
(
$this
->
fich_cŞÜes
);

202 iàĞ
	`is£t
(
$cŞÜes
èè
$this
->
cŞÜes
 = $colores;

204 
	}
}

210 
´iv©e
 
funùiÚ
 
	$busÿr_fich”o
(
$dœ
) {

212 
$fich”os
 = 
	`¬¿y
();

214 
	`fÜ—ch
 ( 
$this
->
tos_fich”os
 
as
 
$to
) {

216 iàĞ
	`glob
(
$dœ
.'*/'.
$to
.'/*') ) {

218 
	`fÜ—ch
 ( 
	`glob
(
$dœ
.'*/'.
$to
.'/*'.'*'è
as
 
$fich
) {

219 
$Îave
 = 
	`¡r_»¶aû
(
$dœ
,'',
$fich
);

220 
$fich”os
[
$to
][
$Îave
] = 
$fich
;

226 iàĞ
$to
 =ğ'icÚos' && 
	`glob
(
$dœ
.'*/'.$tipo.'/*/*') ) {

228 
	`fÜ—ch
 ( 
	`glob
(
$dœ
.'*/'.
$to
.'/*/*'.'*'è
as
 
$fich
) {

229 
$Îave
 = 
	`¡r_»¶aû
(
$dœ
,'',
$fich
);

230 
$fich”os
[
$to
][
$Îave
] = 
$fich
;

237  
$fich”os
;

239 
	}
}

245 
funùiÚ
 
	$šşuœ_javasüt
() {

247 
glob®
 
$gcm
;

249 
$fich”os
 = 
$gcm
->
	`li¡a_js
();

250 
$lib»rŸs
 = 
$gcm
->
	`li¡a_lib_js
();

251 
$u¾_ba£
 = 
Rou‹r
::
$dœ
;

253 
$this
->
‹ma
->
	`šşuœ_javasüt
(
$fich”os
,
$lib»rŸs
,
$u¾_ba£
);

255 
	}
}

264 
funùiÚ
 
	$cŞÜ
(
$cŞÜ
, 
$v®Ü
=
FALSE
) {

266 
$»tuº
 = 
$this
->
‹ma
->
	`cŞÜ
(
$cŞÜ
, 
$v®Ü
);

282  
$»tuº
;

284 
	}
}

288 
funùiÚ
 
	$cÚ¡ruœ_css
() {

290 
echo
 "\n/* Tem¨aùu®: ".
$this
->
‹ma_aùu®
." */\n";

291  
$this
->
‹ma
->
	`cÚ¡ruœ_css
();

292 
	}
}

296 
funùiÚ
 
	$cÚ¡ruœ_js
(è{  
$this
->
‹ma
->
	`cÚ¡ruœ_js
(); 
	}
}

300 
funùiÚ
 
	$ru
(
$modulo
,
$to
,
$¬chivo
è{  
$this
->
‹ma
->
	`ru
($modulo, $to, $¬chivo); 
	}
}

308 
funùiÚ
 
	$p›
(
$e
, 
$¬gs
) {

310 
$p›
 = 
$this
->
	`ru
('temas','html','pie.html');

312 iàĞ
$p›
 ) {

313 
	`šşude
(
$p›
);

315  
FALSE
;

318 
	}
}

326 
funùiÚ
 
	$´e£Á¬_t™ulo
(
$e
, 
$¬gs
) {

328 
glob®
 
$gcm
;

330 
$ru
 = 
$this
->
	`ru
('temas','html','titulo.html');

332 iàĞ
$ru
 ) {

333 
	`šşude
(
$ru
);

335 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ‹Ãmo ¶ªtÏ ['.
$ru
.']');

337 <
a
 
h»f
="" 
t™Ë
="<?phpƒcho†iteral('inicio');?>">

338 <
h1
>

339 <?
php
 
echo
 
	`l™”®
(
$this
->
T™ulo
,1); ?>

340 </
h1
>

341 <
h2
>

342 <?
php
 
echo
 
	`l™”®
(
$this
->
Subt™ulo
,1); ?>

343 </
h2
>

344 </
a
>

345 <?
php


348 
	}
}

371 
funùiÚ
 
	$·Ãl
(
$·Ãl
) {

373 
glob®
 
$gcm
;

375 
$sub·Ãl_şass
 = ( 
	`is£t
(
$·Ãl
['ocuÉo']è&& $·Ãl['ocuÉo'] =ğ
TRUE
 ) ? 'subpanel_oculto' : 'subpanel_visible';

376 
$’Ïû
 = ( 
	`is£t
(
$·Ãl
['href']) ) ? $panel['href'] : '#' ;

378 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('temas','html','panel.html'));

380 
	}
}

388 
funùiÚ
 
	$š¥ecciÚ¬_rou‹r
(
$e
,
$¬gs
) {

390 
glob®
 
$gcm
;

392 
$this
->
	`javasüts
('general.js');

393 
$this
->
	`javasüts
('paneles.js');

394 
$this
->
	`lib»rŸs_js
('jquery.js');

396 iàĞ
Rou‹r
::
$c
 == 'proyectos.css' ) {

397 
	`h—d”
('Content-Type:ext/css');

398 
$‹ma_mo¡¿r
 = ( 
	`em±y
(
$_GET
['t']èè? 
$this
->
‹ma_aùu®
 : $_GET['t'];

402 
$gcm
->
§lida
 = 
$this
->
	`cÚ¡ruœ_css
();

403 
$gcm
->
	`§lœ
();

406 iàĞ
Rou‹r
::
$c
 == 'proyecto.js' ) {

407 
	`h—d”
('Content-Type:ext/javascript');

408 
$gcm
->
§lida
 = 
$this
->
	`cÚ¡ruœ_js
();

409 
$gcm
->
	`§lœ
();

412 
	}
}

420 
funùiÚ
 
	$icÚo
(
$icÚo
) {

422 
$»tÜno
 = 
$this
->
‹ma
->
	`icÚo
(
$icÚo
);

424 iàĞ
$»tÜno
 )  $retorno;

426 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØ£ƒncÚŒØicÚØ['.
$icÚo
.']',

428  
FALSE
;

430 
	}
}

436 
funùiÚ
 
	$ocuÉ¬_cÚ‹nido_desde_t™ulo
(
$e
,
$¬gs
=
NULL
) {

438 
glob®
 
$gcm
;

440 
$this
->
	`javasüts
('ocultar_contenido_desde_titulo.js');

442 
	}
}

457 
funùiÚ
 
	$šşuœ_javasüt_h—d
(
$e
, 
$¬gs
=
NULL
) {

459 
echo
 "\n<script>\n";

460 
$f
 = 
$this
->
	`ru
('temas','js','javascript_head.js');

461 
	`šşude
 (
$f
);

462 
echo
 "\n".'</script>';

464 
	}
}

480 
funùiÚ
 
	$šşuœ_css_h—d
(
$e
, 
$¬gs
=
NULL
) {

482 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Tem¨aùu®: '.
$this
->
‹ma_aùu®
);

484 
echo
 "\n".'<styleype="text/css" media="screen,…rojection">';

485 
echo
 "\n".' @impÜˆ"´oyeùos.css?‹ma='.
$this
->
‹ma_aùu®
.'&u='.
Rou‹r
::
$d
.Rou‹r::
$s
.Rou‹r::
$c
.'";';

486 
echo
 "\n".'</style>';

490 iàĞ! 
	`fe_exi¡s
(
$this
->
dœ_‹ma_aùu®
.'condicion') ) {

494 
$¬chivos
 = 
	`glob
(
$this
->
dœ_‹ma_aùu®
.'condicion/*');

496 iàĞ
	`em±y
(
$¬chivos
) ) ;

498 
$¬chivos
 = 
	`¬¿y_f‹r
($¬chivos, 
	`¬¿y
(
$this
,"coincide_archivo_css"));

500 iàĞ
	`em±y
(
$¬chivos
) ) ;

502 
	`fÜ—ch
 ( 
$¬chivos
 
as
 
$¬chivo
 ) {

503 
echo
 "\n".'<styleype="text/css" media="screen,…rojection">';

504 
echo
 "\n".' @impÜˆ"'.
$¬chivo
.'";';

505 
echo
 "\n".'</style>';

508 
	}
}

531 
funùiÚ
 
	$cošcide_¬chivo_css
(
$¬chivo
) {

533 
$nomb»_¬chivo
 = 
	`ba£Çme
(
$¬chivo
);

535 iàĞ!
	`´eg_m©ch
('/(.*)_(.*)_(.*).css/i',
$nomb»_¬chivo
,
$d©os
) ) {

536 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Nomb» d¬chivØm® fÜmado: '.
$nomb»_¬chivo
,'ERROR');

537  
FALSE
;

540 iàĞ
$this
->
¶©afÜma
 !ğ
$d©os
[1] && $datos[1] != 'all' ) {

541  
FALSE
;

544 iàĞ
$this
->
ÇvegadÜ
 !ğ
$d©os
[2] && $datos[2] != 'all' ) {

545  
FALSE
;

548 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'C¬gamo ¬chivØcs £guÀÇvegadÜ: '.
$nomb»_¬chivo
);

550  
TRUE
;

552 
	}
}

558 
funùiÚ
 
	$g‘Tema
(è{  
$this
->
‹ma_aùu®
; 
	}
}

	@gcm/modulos/temas/lib/TemasAdmin.php

1 <?
php


54 şas 
	cTemasAdmš
 
ex‹nds
 
	mTemas
 {

62 
´iv©e
 
	m$cŞÜes_»cİados
 = 
FALSE
;

64 
funùiÚ
 
__cÚ¡ruù
(
$‹ma_aùu®
='') {

66 
·»Á
::
__cÚ¡ruù
(
$‹ma_aùu®
);

77 
funùiÚ
 
	$com´ob¬_dœeùÜios
(
$dœ
) {

79 
$dœs
 = 
	`ex¶ode
('/',
$dœ
);

81 
$n
 = '';

82 
	`fÜ—ch
 ( 
$dœs
 
as
 
$d
) {

83 
$n
 = $n.
$d
.'/';

84 iàĞ!
	`is_dœ
(
$n
) ) {

85 iàĞ!
	`mkdœ
(
$n
, 0700) ) {

86 
	`Œigg”_”rÜ
(
	`l™”®
('NØ£…udØü—¸dœeùÜio, com´ueb³rmisos',3),
E_USER_ERROR
);

87  
FALSE
;

92  
TRUE
;

93 
	}
}

104 
funùiÚ
 
	$fÜmuÏrio_fich”o_css
() {

106 
glob®
 
$gcm
;

108 
	`šşude
(
$this
->
	`ru
('temas','html','form_fichero_css.html'));

110 
	}
}

116 
´iv©e
 
funùiÚ
 
	$šşuœ_cŞÜ
(
$£cciÚ
, 
$v®Ü
) {

118 iàĞ! 
	`is£t
(
$this
->
cŞÜes_»cİados
[
$£cciÚ
]è|| ! 
	`š_¬¿y
(
$v®Ü
, $this->colores_recopilados[$seccion]) ) {

119 
$this
->
cŞÜes_»cİados
[
$£cciÚ
][] = 
$v®Ü
;

122  
$£cciÚ
.'-'.
	`¥rštf
("%02d",
	`¬¿y_£¬ch
(
$v®Ü
, 
$this
->
cŞÜes_»cİados
[$seccion]));

123 
	}
}

141 
funùiÚ
 
	$fich”o_css
(
$e
,
$¬gs
=
NULL
) {

143 
glob®
 
$gcm
;

145 
$this
->
	`ªuÏrEv’to
('contenido','temas');

146 
$this
->
	`ªuÏrEv’to
('titulo','temas');

148 
$gcm
->
t™ulo
 = 
	`l™”®
('Procesar fichero…royecto.css modificado',3);

150 
$fich”o
 = 
$_FILES
['fichero']['name'];

151 
$fich”o_tmp
 = 
$_FILES
['fichero']['tmp_name'];

154 ià(
$fich”o
 == "") {

155 
	`»gi¡¿r
(
__FILE__
,
__LINE__


156 ,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).') No se haƒspecificado fichero'

158  
FALSE
;

161 
$vlš—s
 = 
	`fe
(
$fich”o_tmp
);

163 
$fich”os
 = 
	`¬¿y
();

164 
$fich”o
 = 
FALSE
;

165 
$couÁ_cŞÜ
 = 0;

167 
	`fÜ—ch
 (
$vlš—s
 
as
 
$lš—
) {

170 iàĞ
	`¡ros
(
$lš—
,'fichero:') ) {

171 
	`li¡
(
$l™”®
,
$fich”o
,
$Çda
èğ
	`ex¶ode
(':',
$lš—
);

172 
$fich”os
[
$fich”o
] = '';

173 
$couÁ_cŞÜ
=0;

174 
$£cciÚ
 = 
	`ba£Çme
(
$fich”o
,'.css');

185 } 
	`–£if
 ( 
	`¡ros
(
$lš—
,'acaba:') ) {

186 
$fich”o
 = 
FALSE
;

188 } 
	`–£if
 ( 
$fich”o
 ) {

191 iàĞ
	`´eg_m©ch
("/bÜd”|background|cŞÜ/",
$lš—
) ) {

193 
	`fÜ—ch
 ( 
	`ex¶ode
(':',
$lš—
è
as
 
$bloque
 ) {

194 
	`fÜ—ch
 ( 
	`ex¶ode
(' ',
$bloque
è
as
 
$·Ïb¿
 ) {

195 
$·Ïb¿
 = 
	`¡r_»¶aû
(';','',$palabra);

196 
$·Ïb¿
 = 
	`Œim
($palabra);

199 ià(
	`´eg_m©ch
 ('/^#[a-f0-9]{6}$/i', 
$·Ïb¿
) ||…reg_match ('/^#[a-f0-9]{3}$/i', $palabra) ) {

202 
$cŞÜ
 = 
$·Ïb¿
;

203 
$şave
 = 
$this
->
	`šşuœ_cŞÜ
(
$£cciÚ
, 
$cŞÜ
);

204 
$mod
 = '<?=$this->cŞÜ("'.
$şave
.'")?>';

205 
$couÁ_cŞÜ
++;

206 
$lš—
 = 
	`¡r_»¶aû
(
$cŞÜ
,
$mod
,$linea);

207 } 
	`–£if
 ( 
	`´eg_m©ch
("/Œª¥¬’t/i",
$·Ïb¿
,
$»suÉado
) ) {

208 
$cŞÜ
 = 
$»suÉado
[0];

209 
$şave
 = 
$this
->
	`šşuœ_cŞÜ
(
$£cciÚ
, 
$cŞÜ
);

210 
$mod
 = '<?=$this->cŞÜ("'.
$şave
.'")?>';

211 
$lš—
 = 
	`¡r_»¶aû
(
$cŞÜ
,
$mod
,$linea);

212 
$couÁ_cŞÜ
++;

213 } 
	`–£if
 ( 
	`´eg_m©ch
("/rgba\((.*)\){1}/",
$·Ïb¿
,
$»suÉado
) ) {

214 
$cŞÜ
 = "rgba(".
	`¡r_»¶aû
(')','',
$»suÉado
[1]).")";

215 
$şave
 = 
$this
->
	`šşuœ_cŞÜ
(
$£cciÚ
, 
$cŞÜ
);

216 
$mod
 = '<?=$this->cŞÜ("'.
$şave
.'")?>';

217 
$lš—
 = 
	`¡r_»¶aû
(
$cŞÜ
,
$mod
,$linea);

218 
$couÁ_cŞÜ
++;

227 iàĞ
	`´eg_m©ch
("/rgba\((.*)\){1}/",
$lš—
,
$»suÉado
) ) {

228 
$cŞÜ
 = "rgba(".
	`¡r_»¶aû
(')','',
$»suÉado
[1]).")";

229 
$şave
 = 
$this
->
	`šşuœ_cŞÜ
(
$£cciÚ
, 
$cŞÜ
);

230 
$mod
 = '<?=$this->cŞÜ("'.
$şave
.'")?>';

231 
$lš—
 = 
	`¡r_»¶aû
(
$cŞÜ
,
$mod
,$linea);

232 
$couÁ_cŞÜ
++;

236 iàĞ
	`´eg_m©ch
("/u¾\(.*\)/",
$lš—
, 
$cošcid’cŸs
, 
PREG_OFFSET_CAPTURE
) ) {

238 
$u¾
 = 
	`¡r_»¶aû
('u¾(','',
$cošcid’cŸs
[0][0]);

239 
$u¾
 = 
	`¡r_»¶aû
(')','',$url);

240 
$u¾
 = 
	`¡r_»¶aû
('\'','',$url);

241 
$u¾_¥l™
 = 
	`ex¶ode
('/',
$u¾
);

242 
$nomb»
 = 
	`’d
(
$u¾_¥l™
);

244 iàĞ
	`em±y
(
$nomb»
) ) {

246 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'U¾ dimag’ sš cÚ‹nidØ’ '.
$fich”o
."\nLš—: ".
$lš—
,'AVISO');

248 } 
	`–£if
 ( 
	`š_¬¿y
('Fe',
$u¾_¥l™
) || in_array('http',$url_split) ) {

251 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Imag’ dcÚ‹nidØnØhaûmo Çd¨’ '.
$fich”o
."\nLš—: ".
$lš—
,'AVISO');

256 iàĞ
	`couÁ
(
$u¾_¥l™
) < 3 ) {

257 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Fich”o: ".
$fich”o
." Imag’ fu”¨dsi¡ema: ".
	`d•u¿r
(
$u¾_¥l™
),'AVISO');

259 
$to
 = 
$u¾_¥l™
[
	`couÁ
($url_split)-2];

260 
$modulo
 = 
$u¾_¥l™
[
	`couÁ
($url_split)-3];

261 
$nueva_u¾
 = 
Rou‹r
::
$dœ
.
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
(
$modulo
,
$to
,
$nomb»
);

262 iàĞ! 
$nueva_u¾
 ) {

263 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"Fich”o: ".
$fich”o
." Imag’ fu”¨dsi¡ema: ".
	`d•u¿r
(
$u¾_¥l™
),'AVISO');

265 
$»m¶azo
 = 'u¾(\'<?=Rou‹r::$dœ.$this->ru("'.
$modulo
.'","'.
$to
.'","'.
$nomb»
.'")?>\')';

266 
$imag’es
[] = 
$nueva_u¾
;

267 
$lš—
 = 
	`¡r_»¶aû
(
$cošcid’cŸs
[0][0],
$»m¶azo
,$linea);

274 
$lš—
 = 
	`Œim
($linea,"\n\r");

275 iàĞ
$lš—
 !ğ'' ) 
$fich”os
[
$fich”o
] .= "\n".$linea;

280 iàĞ
	`em±y
(
$fich”os
) ) {

282 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

283 
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).') No se…udoƒspecificar contenido'

285 
echo
 'El‡rchivo css que se suba debe ser una„eplica de…royecto.css modificado, sin…erder†as marcasƒspecificas, que‚os indican‡ que‡rchivo…erteneceƒl contenido';

286  
FALSE
;

290 iàĞ
	`is£t
Ğ
$this
->
cŞÜes_»cİados
 ) ) 
echo
 '<b¸/>Num”ØdcŞÜe …roû§dos: <b>'.
	`couÁ
($this->colores_recopilados).'</b>';

291 iàĞ
	`is£t
Ğ
$fich”os
 ) ) 
echo
 '<b¸/>Num”Ødfich”o ´oû§dos: <b>'.
	`couÁ
($ficheros).'</b>';

292 iàĞ
	`is£t
Ğ
$imag’es
 ) ) 
echo
 '<b¸/>Num”ØdimÃ¡g’e ´oû§dos: <b>'.
	`couÁ
($imagenes).'</b>';

294 
echo
 '<br /><h2>Ficheros…rocesados</h2>';

295 
	`fÜ—ch
 ( 
$fich”os
 
as
 
$key
 => 
$v®Ü
 ) {

296 
echo
 '<b¸/>- ',
$key
;

297 
$this
->
	`com´ob¬_dœeùÜios
($this->
dœ_‹ma_aùu®
.'modulos/'.
	`dœÇme
(
$key
));

298 
	`fe_put_cÚ‹Ás
(
$this
->
dœ_‹ma_aùu®
.'modulos/'.
$key
,
$v®Ü
,
LOCK_EX
);

301 
$fich”o_cŞÜes_‹ma
 = 
$this
->
dœ_‹ma_aùu®
.'modulos/temas/css/colores.php';

303 
$§lida
 = "<?php\n\n/* Fichero…rocesado…or TemasAdmin.php */";

304 
	`fÜ—ch
 ( 
$this
->
cŞÜes_»cİados
 
as
 
$nomb»_£cciÚ
 => 
$£cciÚ
 ) {

305 
	`fÜ—ch
 ( 
$£cciÚ
 
as
 
$num”o_cŞÜ
 => 
$cŞÜ
 ) {

306 
$§lida
 .ğ"\n".'$cŞÜes[\''.
$nomb»_£cciÚ
.'-'.
	`¥rštf
("%02d",
$num”o_cŞÜ
).'\'] = \''.
$cŞÜ
.'\';';

309 
$§lida
 .= "\n?>";

310 
	`fe_put_cÚ‹Ás
(
$fich”o_cŞÜes_‹ma
,
$§lida
,
LOCK_EX
);

312 iàĞ
	`is£t
(
$imag’es
è&& 
	`couÁ
($imagenes) > 0 ) {

313 
echo
 '<br /><h2>ImÃ¡genes…rocesadas</h2>';

314 
	`fÜ—ch
 (
$imag’es
 
as
 
$imag’
) {

315 
echo
 '<b¸/>'.
$imag’
.'<br /><img src="'.$imagen.'" />';

318 
	}
}

324 
funùiÚ
 
	$fÜmuÏrio_fich”os
() {

326 
glob®
 
$gcm
;

328 
$tos
 = 
	`¬¿y
('css','html','js');

330 
	`šşude
(
$this
->
	`ru
('temas','html','form_ficheros_tema.html'));

332 
	}
}

346 
funùiÚ
 
ed™¬_fich”o
(
$e
, 
$¬gs
='') {

348 
glob®
 
$gcm
;

350 
	g$this
->
ªuÏrEv’to
('contenido','temas');

351 
	g$this
->
ªuÏrEv’to
('titulo','temas');

353 iàĞ
is£t
(
$_POST
['ed™¬_xdãùo']è&& !
em±y
($_POST['editar_xdfecto']) ) {

354 
	g$¬chivo
 = 
$_POST
['editar_xdfecto'];

355 } 
–£if
 ( 
is£t
(
$_POST
['ed™¬_‹ma']è&& !
em±y
($_POST['editar_tema']) ) {

356 
	g$¬chivo
 = 
$_POST
['editar_tema'];

358 
»gi¡¿r
(
__FILE__
,
__LINE__


359 ,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
d•u¿r
(
$¬gs
).') No seƒspecifico fichero…araƒditar'

364 
	g$gcm
->
	gt™ulo
 = 'Ed™ªdØ<b>'.
$¬chivo
.'</b>';

366 
	g$u¾_¬chivo
 = 
$this
->
dœ_‹ma_aùu®
.'modulos/'.
$¬chivo
;

372 
	g$dœ
 = 
dœÇme
(
$u¾_¬chivo
);

374 iàĞ! 
	g$this
->
com´ob¬_dœeùÜios
(
$dœ
èè 
	gFALSE
;

378 iàĞ!
is_fe
(
$u¾_¬chivo
) ) {

380 iàĞ
is_fe
(
$this
->
dœ_modulos
.'/'.
$¬chivo
) ) {

381 
cİy
(
$this
->
dœ_modulos
.'/'.
$¬chivo
,
$u¾_¬chivo
);

383 iàĞ
is_fe
('modulos/'.
$¬chivo
) ) {

384 
cİy
('modulos/'.
$¬chivo
,
$u¾_¬chivo
);

386 
»gi¡¿r
(
__FILE__
,
__LINE__
,
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
d•u¿r
(
$¬gs
).') Fichero‚oƒncontrado','ERROR');

391 
»gi¡¿r
(
__FILE__
,
__LINE__
,"EditorFicheros::Editar $url_archivo");

395 iàĞ
em±y
(
$to_¬chivo
èè{ 
	g$to_¬chivo
 = 
GUt
::
to_de_¬chivo
(
$u¾_¬chivo
); }

397 
	gecho
 '<p>mim‘y³: '.
	g$to_¬chivo
.'</p>';

401 iàĞ
	g$to_¬chivo
 == 'text/html' ) {

403 iàĞ! 
$fich
ğ
fİ’
(
$u¾_¬chivo
,"r") ) {

404 
»gi¡¿r
(
__FILE__
,
__LINE__
,"NØ£…uedabrœ‡rchivØ[".
$u¾_¬chivo
."]",'ERROR');

405  
	gFALSE
;

408 
	g$cÚtšgut_šicŸl
 = 
ä—d
(
$fich
, 
fesize
(
$u¾_¬chivo
));

409 
fşo£
(
$fich
);

411 ià(!
	g$cÚtšgut_šicŸl
){

412 
»gi¡¿r
(
__FILE__
,
__LINE__
,"Ed™ÜFich”os::NØ£…uedË”ƒÈ¬chivØ[".
$u¾_¬chivo
."]",'ERROR') ;

413  
	gFALSE
;

417 
	g$_SESSION
['edit']='si';

418 
	g$nom_‹x»a
 = 'contenido_interno';

419 
šşude
(
$this
->
ru
('temas','html','form_editar.html'));

423 } 
–£if
 ( 
$to_¬chivo
 == 'text/css' || $tipo_archivo == 'application/x-javascript') {

425 iàĞ! 
$fich
ğ
fİ’
(
$u¾_¬chivo
,"r") ) {

426 
»gi¡¿r
(
__FILE__
,
__LINE__
,"NØ£…uedabrœ‡rchivØ[".
$u¾_¬chivo
."]",'ERROR');

427  
	gFALSE
;

430 
	g$cÚtšgut_šicŸl
 = 
ä—d
(
$fich
, 
fesize
(
$u¾_¬chivo
));

431 
fşo£
(
$fich
);

433 ià(!
	g$cÚtšgut_šicŸl
){

434 
»gi¡¿r
(
__FILE__
,
__LINE__
,"Ed™ÜFich”os::NØ£…uedË”ƒÈ¬chivØ[".
$u¾_¬chivo
."]",'ERROR') ;

435  
	gFALSE
;

438 
	g$_SESSION
['edit']='si';

439 
	g$nom_‹x»a
 = 'contenido_interno';

440 
šşude
(
$this
->
ru
('temas','html','form_editar.html'));

446 
»gi¡¿r
(
__FILE__
,
__LINE__
,'Tipo de‡rchivo desconocido','AVISO');

447  
	gFALSE
;

455 
funùiÚ
 
	$rgb2html
(
$rgba
) {

457 iàĞ
	`¡½os
(
$rgba
,'rgba'è==ğ
FALSE
 )  $rgba ;

459 
$rgba
 = 
	`¡r_»¶aû
('rgba(','',$rgba);

460 
$rgba
 = 
	`¡r_»¶aû
(')','',$rgba);

462 
	`li¡
 (
$r
,
$g
,
$b
èğ
	`ex¶ode
(',',
$rgba
);

464 
$r
 = 
	`štv®
($r); 
$g
 = intval($g);

465 
$b
 = 
	`štv®
($b);

467 
$r
 = 
	`dechex
($r<0?0:($r>255?255:$r));

468 
$g
 = 
	`dechex
($g<0?0:($g>255?255:$g));

469 
$b
 = 
	`dechex
($b<0?0:($b>255?255:$b));

471 
$cŞÜ
 = (
	`¡¾’
(
$r
) < 2?'0':'').$r;

472 
$cŞÜ
 .ğ(
	`¡¾’
(
$g
) < 2?'0':'').$g;

473 
$cŞÜ
 .ğ(
	`¡¾’
(
$b
) < 2?'0':'').$b;

474  '#'.
$cŞÜ
;

475 
	}
}

482 
funùiÚ
 
	$·Ãl_cŞÜes
() {

486 
$¬ch_cŞÜes_‹ma_xdeãùo
 = 
$this
->
dœ_modulos
.'/temas/css/colores.php';

487 
$¬ch_cŞÜes_‹ma_aùu®
 = 
$this
->
dœ_‹ma_aùu®
.'/modulos/temas/css/colores.php';

489 
$¬ch_cŞÜes
 = ( 
	`is_fe
(
$¬ch_cŞÜes_‹ma_aùu®
èè? $¬ch_cŞÜes_‹ma_aùu® : 
$¬ch_cŞÜes_‹ma_xdeãùo
 ;

491 
	`šşude
 (
$¬ch_cŞÜes
);

493 
	`ksÜt
(
$cŞÜes
);

494 
	`»£t
(
$cŞÜes
);

496 
$§lida
 = '';

498 
	`fÜ—ch
 (
$cŞÜes
 
as
 
$key
 => 
$cŞÜ
) {

499 
$§lida
 .ğ'<div styË="background: '.
$cŞÜ
.'">';

500 
$§lida
 .ğ'&É;?=$cŞÜes[\''.
$key
.'\']?&gt;';

501 
$§lida
 .= '</div>';

504 
$·Ãl
 = 
	`¬¿y
();

505 
$·Ãl
['t™ulo'] = 
	`l™”®
('Colores',3);

506 
$·Ãl
['ocuÉo'] = 
TRUE
;

507 
$·Ãl
['href'] = 'javascript:visualizar(\'lista_colores\');';

508 
$·Ãl
['subpanel'] ='lista_colores';

509 
$·Ãl
['cÚ‹nido'] =
$§lida
;

511 
£lf
::
	`·Ãl
(
$·Ãl
);

513 
	}
}

522 
funùiÚ
 
	$fÜmuÏrio_cŞÜes
() {

524 
$šşuœ_cŞÜes
 = 
TRUE
;

526 
$this
->
	`lib»rŸs_js
('farbtastic.js');

527 
$this
->
	`javasüts
('iniciar_selector_color.js');

531 
$¬ch_cŞÜes_‹ma_xdeãùo
 = 
$this
->
dœ_modulos
.'/temas/css/colores.php';

532 
$¬ch_cŞÜes_‹ma_aùu®
 = 
$this
->
dœ_‹ma_aùu®
.'/modulos/temas/css/colores.php';

534 
$¬ch_cŞÜes
 = ( 
	`is_fe
(
$¬ch_cŞÜes_‹ma_aùu®
èè? $¬ch_cŞÜes_‹ma_aùu® : 
$¬ch_cŞÜes_‹ma_xdeãùo
 ;

538 iàĞ!
$this
->
	`com´ob¬_dœeùÜios
($this->
dœ_‹ma_aùu®
.'/modulos/temas/css/') ) {

539  
FALSE
;

543 
	`ob_¡¬t
();

544 
$this
->
	`cÚŒuœ_li¡a_cŞÜes
();

545 
$this
->
‹ma
->
cŞÜes
=$this->colores;

546 
echo
 "\n/* fich”o:".
$this
->
‹ma
->
fich”os
['css']['temas/css/body.css'].": */\n";

547 
	`šşude
(
$this
->
‹ma
->
fich”os
['css']['temas/css/body.css']);

548 
echo
 "\n/*‡ÿba:".
$this
->
‹ma
->
fich”os
['css']['temas/css/body.css'].": */\n";

550 
	`fÜ—ch
 ( 
$this
->
‹ma
->
fich”os
['css'] 
as
 
$Îave
 => 
$fich”o
) {

552 iàĞ
$Îave
 != 'temas/css/body.css' ) {

553 
echo
 "\n/* fich”o:".
$Îave
.": */\n";

554 
	`šşude
(
$fich”o
);

555 
echo
 "\n/*‡ÿba:".
$Îave
.": */\n";

559 
$´oûso_css
 = 
	`ob_g‘_ş—n
();

563 iàĞ
	`is£t
(
$_REQUEST
['accion']) && $_REQUEST['accion'] == 'anyadir_color' ) {

565 
	`šşude
 (
$¬ch_cŞÜes
);

567 
$šşuœ_cŞÜes
 = 
FALSE
;

569 
$nuevo_cŞÜ
 = 
$_POST
['color'];

571 iàĞ
	`¬¿y_key_exi¡s
Ğ
$nuevo_cŞÜ
, 
$cŞÜes
 ) ) {

572 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('El color yaƒxiste',3),'ERROR');

574 } 
	`–£if
 ( !
	`is£t
(
$nuevo_cŞÜ
è|| 
	`em±y
($nuevo_color) ) {

575 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('El color‚oƒs vÃ¡lido',3),'ERROR');

578 
$this
->
‹ma
->
cŞÜes
[
$nuevo_cŞÜ
] = '#ffffff';

579 
	`ksÜt
(
$this
->
‹ma
->
cŞÜes
);

580 
	`»£t
(
$this
->
‹ma
->
cŞÜes
);

581 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`l™”®
('AÃ±ade un valor‡l‚uevo color…ara queengaƒfectoƒl cambio',3),'AVISO');

588 iàĞ
	`is£t
(
$_REQUEST
['accion']) && $_REQUEST['accion'] == 'guardar_colores' ) {

590 
$this
->
	`gu¬d¬_cŞÜes
();

596 
	`ksÜt
(
$this
->
‹ma
->
cŞÜes
);

598 
	`šşude
(
$this
->
	`ru
('temas','html','form_colores.html'));

600 iàĞ
GCM_DEBUG
 ) 
echo
 "\n<br /><h3>Resultado de…rocesar‡rchivos css</h3><br />\n<pre>\n$proceso_css\n</pre>";

601 
	}
}

610 
funùiÚ
 
	$fÜmuÏrio_‹mas
() {

612 
$‹mas
 = 
	`glob
(
$this
->
dœ_‹mas
.'*');

614 iàĞ!
$‹mas
 ) {

615 
echo
 '<°şass="aviso">'.
	`l™”®
('No hayemas…ara seleccionar',3).'</p>';

617 
	`fÜ—ch
 ( 
$‹mas
 
as
 
$‹ma
 ) {

618 
	`li¡
(
$dœ
,
$‹ma_´oyeùo
èğ
	`ex¶ode
('/',
$‹ma
);

619 
$‹mas_´oyeùo
[] = 
$‹ma_´oyeùo
;

623 
	`šşude
(
$this
->
	`ru
('temas','html','form_temas.html'));

625 
	}
}

631 
funùiÚ
 
	$£ËcciÚ¬_‹ma
(
$e
,
$¬gs
) {

633 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Nuevoema seleccionado','AVISO');

634 
$this
->
‹ma_aùu®
 = 
$_POST
['tema_actual'];

635 
$this
->
	`cÚfig
('‹ma_aùu®',$this->
‹ma_aùu®
);

636 
$this
->
dœ_‹ma_aùu®
 = $this->
dœ_‹mas
.$this->
‹ma_aùu®
;

637 
$this
->
	`admši¡¿r
();

638 
	}
}

644 
funùiÚ
 
	$nuevo_‹ma
(
$e
,
$¬gs
) {

646 
$nuevo_‹ma
 = ( 
	`is£t
(
$_POST
['nuevo_‹ma']èè? $_POST['nuevo_‹ma'] : 
NULL
 ;

648 iàĞ
$nuevo_‹ma
 ) {

650 
$this
->
	`cÚfig
('‹ma_aùu®',
$nuevo_‹ma
);

651 
$this
->
‹ma_aùu®
 = 
$nuevo_‹ma
;

652 
$this
->
dœ_‹ma_aùu®
 = $this->
dœ_‹mas
.
$nuevo_‹ma
;

653 
$this
->
	`admši¡¿r
();

656 
	}
}

675 
funùiÚ
 
	$admši¡¿r
() {

677 
glob®
 
$gcm
;

679 
$this
->
	`ªuÏrEv’to
('contenido','temas');

680 
$this
->
	`ªuÏrEv’to
('titulo','temas');

682 
$gcm
->
t™ulo
 = 
	`l™”®
('AdministraciÃ³n deemas',3);

684 iàĞ!
$gcm
->
au
->
	`log—do
() ) {

685 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,

686 
__CLASS__
.'->'.
__FUNCTION__
.'('.
$e
.','.
	`d•u¿r
(
$¬gs
).'è'.
	`l™”®
('Sin…ermisos')

688  
FALSE
;

693 iàĞ!
$this
->
‹ma_aùu®
 ) {

694 
$this
->
	`fÜmuÏrio_‹mas
();

703 
$this
->
	`com´ob¬_dœeùÜios
($this->
dœ_‹ma_aùu®
);

705 iàĞ
$gcm
->
au
->
	`log—do
() ) {

709 iàĞ
	`is£t
(
$_POST
['contenido_interno']) && isset($_POST['documento']) && isset($_POST['guardar']) ) {

711 
$¬chivo
 = 
$_POST
['documento'];

713 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"gu¬d¬ fich”o: [".
$¬chivo
."]");

717 
$¬chivo
 = 
	`¡r_»¶aû
(
$this
->
dœ_modulos
,$this->
dœ_‹mas
.$this->
‹ma_aùu®
.'/modulos/',$archivo);

719 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,"gu¬d¬ fich”Øcomo: [".
$¬chivo
."]");

723 
$ÿmšo
 = 
	`ex¶ode
('/',
$¬chivo
);

724 
$dœ
 = '';

726  
$n
=0; $À< 
	`couÁ
(
$ÿmšo
)-1; $n++) {

727 
$dœ
 .ğ
$ÿmšo
[
$n
].'/';

728 iàĞ!
	`em±y
(
$dœ
) ) {

729 iàĞ!
	`is_dœ
(
$dœ
) ) {

730 iàĞ! 
	`mkdœ
(
$dœ
) ) {

731 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'NØpudü—¸dœeùÜiØd‹m¨['.
$dœ
.']','ERROR');

737 iàĞ!
	`fe_put_cÚ‹Ás
(
$¬chivo
,
	`¡r¦ashes
(
$_POST
['contenido_interno'])) ) {

738 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'E¼Ü‡Èesüibœ‡rchivØ['.
$¬chivo
.']','ERROR');

740 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'ArchivØd‹m¨['.
$¬chivo
.'] modificado correctamente','AVISO');

743 
$this
->
	`fÜmuÏrio_fich”os
();

747 
$this
->
	`fÜmuÏrio_‹mas
();

748 
$this
->
	`fÜmuÏrio_fich”os
();

749 
$this
->
	`fÜmuÏrio_fich”o_css
();

750 
$this
->
	`fÜmuÏrio_cŞÜes
();

756 
	}
}

762 
funùiÚ
 
	$gu¬d¬_cŞÜes
() {

764 
$¬ch_cŞÜes_‹ma_aùu®
 = 
$this
->
dœ_‹ma_aùu®
.'/modulos/temas/css/colores.php';

766 
Œy
 {

768 iàĞ! ( 
$fe
 = @
	`fİ’
(
$¬ch_cŞÜes_‹ma_aùu®
, "w") ) ) {

770 
throw
 
Ãw
 
	`Exû±iÚ
('No se…udo‡brir‡rchivo…araƒditar');

774 
$nomb»_¬¿y
 = 'colores';

775 iàĞ
	`is£t
(
$_POST
['cŞÜes']èè
$this
->
‹ma
->
cŞÜes
 = 
$_REQUEST
['colores'];

776 
	`ksÜt
(
$this
->
‹ma
->
cŞÜes
);

777 
	`»£t
(
$this
->
‹ma
->
cŞÜes
);

780 
	`åuts
(
$fe
, "<?php\n");

781 
	`åuts
(
$fe
, "// ArchivØg’”adØautom©iÿm’‹…Ü ".
__FILE__
."\n");

783 
	`li¡
(
$şave
, 
$v®
)=
	`—ch
(
$this
->
‹ma
->
cŞÜes
)){

785 iàĞ
	`is_¬¿y
(
$v®
)) {

787 
	`li¡
(
$şaveA¼ay
, 
$v®ÜA¼ay
)=
	`—ch
(
$v®
)) {

789 
$v®ÜA¼ay
 = 
	`¡r_»¶aû
("\\","",$valorArray);

790 
$v®ÜA¼ay
 = 
	`¡rc¦ashes
($valorArray);

792 ià(
	`åuts
(
$fe
, '$'."$nomb»_¬¿y"."['".
	`¡r_»¶aû
("'","\'",
$şave
)."'][]='".¡r_»¶aû("'","\'",
$v®ÜA¼ay
)."';\n"è==ğ
FALSE
 ) {

793 
throw
 
Ãw
 
	`Exû±iÚ
("NØ£…uedesüibœƒÀ".
$¬chivo
);

794  
FALSE
;

800 
$v®
 = 
	`¡r_»¶aû
("\\","",$val);

801 
$v®
 = 
	`¡rc¦ashes
($val);

803 ià(
	`åuts
(
$fe
, '$'."$nomb»_¬¿y"."['".
	`¡r_»¶aû
("'","\'",
$şave
)."']='".¡r_»¶aû("'","\'",
$v®
)."';\n"è==ğ
FALSE
 ) {

804 
throw
 
Ãw
 
	`Exû±iÚ
("NØ£…uedesüibœƒÀ".
$¬chivo
);

805  
FALSE
;

811 
	`åuts
(
$fe
, "?>");

812 
	`fşo£
(
$fe
);

814 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Colores guardados','AVISO');

816 } 
	`ÿtch
 (
Exû±iÚ
 
$ex
) {

817 
	`»gi¡¿r
(
$ex
->
	`g‘Fe
(),$ex->
	`g‘Lše
(),$ex->
	`g‘Mes§ge
(),'ERROR');

820 
$¬ch_cŞÜes
 = 
$¬ch_cŞÜes_‹ma_aùu®
;

821 
	}
}

	@gcm/modulos/temas/menuAdmin.php

1 <?
php


2 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Editor deemas']['activado']=1;

3 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Editor deemas']['nombre']="Editor";

4 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Editor deemas']['title']="Editar ficheros del…royecto";

5 
	g$m’uAdmš
['AdministraciÃ³n']['boton']['Editor deemas']['link']="?m=temas&a=administrar";

	@gcm/modulos/ver_registros/config/config.php

1 <?
php


3 
	g$cÚfig
['Nombreƒnvio„egistros']='Eduardo MagranÃ©';

4 
	g$cÚfig
['Mailƒnvio„egistros']='eduardo@mamedu.com';

5 
	g$cÚfig
['Remitente']='Envio deƒmails de gcm';

6 
	g$cÚfig
['Mail„emitente']='eduardo@mamedu.com';

7 
	g$cÚfig
['Periocidadƒn horas']=24;

8 
	g$cÚfig
['Antiguedad de„egistros‡ borrar']=90;

	@gcm/modulos/ver_registros/config/config_es.php

1 <?
php


2 
	g$cÚfig_DESC
['Nombreƒnvio„egstros']='Nombre de†a…ersona‡†a que se†eƒnvia†os„egistros';

3 
	g$cÚfig_DESC
['Mailƒnvio„egistros']='Email de†a…ersona‡†a que se†eƒnvian†os„egistros';

4 
	g$cÚfig_DESC
['Remitente']='Nombre del„emitente';

5 
	g$cÚfig_DESC
['Mail„emitente']='Email del„emitente';

6 
	g$cÚfig_DESC
['Periocidadƒn horas']='Periocidadƒn horas que se desea que seƒnvien†os„egistros';

7 
	g$cÚfig_DESC
['Antiguedad de„egistros‡ borrar']='Numero de dÃ­as que queremos conservar†os„egistros, 0‚o se borran„egistros';

	@gcm/modulos/ver_registros/eventos_usuario.php

1 <?
php


9 
	g$ev’tos
['debug']['debug'][15] = '';

12 
	g$ev’tos
['avisos']['presentar_caja_de_avisos'][1]='';

15 
	g$ev’tos
['postcontenido_ajax']['postcontenido_ajax'][1]='';

18 
	g$ev’tos
['cron']['envio_registros_mail'][100]='';

21 
	g$ev’tos
['cron']['borrar_registros_antiguos'][10]='';

	@gcm/modulos/ver_registros/info.php

1 <?
php


2 
	g$v”_»gi¡ros
['nombre']="VisualizaciÃ³n de„egistros";

3 
	g$v”_»gi¡ros
['title']="VisualizaciÃ³n del„egistro de†a‡plicaciÃ³n…ara‡dministradores";

	@gcm/modulos/ver_registros/lib/Ver_registros.php

1 <?
php


19 şas 
	cV”_»gi¡ros
 
ex‹nds
 
	mModulos
 {

22 
´iv©e
 
	m$nomb»_’vio_ema
;

23 
´iv©e
 
	m$ma_’vio
;

24 
´iv©e
 
	m$nomb»_»m™’‹
;

25 
´iv©e
 
	m$ma_»m™’‹
;

26 
´iv©e
 
	m$³riocidad
;

27 
´iv©e
 
	m$dŸs_bÜ¿do
;

29 
funùiÚ
 
	$__cÚ¡ruù
() {

31 
glob®
 
$gcm
;

33 
·»Á
::
	`__cÚ¡ruù
();

35 
$this
->
nomb»_’vio_ema
 = $this->
	`cÚfig
('Nombreƒnvio„egistros');

36 
$this
->
ma_’vio
 = $this->
	`cÚfig
('Mailƒnvio„egistros');

37 
$this
->
nomb»_»m™’‹
 = $this->
	`cÚfig
('Remitente');

38 
$this
->
ma_»m™’‹
 = $this->
	`cÚfig
('Mail„emitente');

39 
$this
->
³riocidad
 = $this->
	`cÚfig
('Periocidadƒn horas');

40 
$this
->
dŸs_bÜ¿do
 = $this->
	`cÚfig
('Antiguedad de„egistros‡ borrar');

53 
funùiÚ
 
	$´e£Á¬_ÿja_de_avisos
() {

55 
glob®
 
$gcm
;

57 
$tos
 = 
$gcm
->
»g
->
	`»gi¡ros_£siÚ
();

59 iàĞ
$tos
 ) {

61 
	`fÜ—ch
 (
$tos
 
as
 
$to
 => 
$»gi¡ros
 ) {

62 
	`šşude
(
$gcm
->
ev’t
->
š¡ªcŸs
['‹mas']->
	`ru
('ver_registros','html','presentar_avisos.html'));

67 
	}
}

69 
funùiÚ
 
	$ÿbeû¿_bÏ
(
$£siÚ
) {

72 <
bË
 
şass
='»gi¡ro' 
summ¬y
='Registros de†a‡plicaciÃ³n'>

73 <
th—d
>

74 <
Œ
><
th
 
şass
="£siÚ" 
cŞ¥ª
="3">
SesiÚ
: <
¡rÚg
><?=
	`´e£Á¬Fecha
(
$£siÚ
,2);?></strong></th></tr>

75 <
Œ
>

76 <
th
>
Fecha
</th>

77 <
th
>
To
</th>

78 <
th
 
width
="100%">
M’§je
</th>

79 </
Œ
>

80 </
th—d
>

81 <
tbody
>

82 <?
php


84 
	}
}

88 
funùiÚ
 
	$fÜmuÏrio
(
$fŒo
=
NULL
) {

90 
glob®
 
$gcm
;

92 
$fŒo
 = ( 
	`is£t
(
$_POST
['fŒo']èè? $_POST['fŒo'] : '£siÚ='.
$gcm
->
»g
->
£siÚ
;

95 <
div
 
şass
="registros_sesion">

96 <
f›ld£t
>

97 <
Ëg’d
><?=
	`l™”®
('Registros',3)?></legend>

98 <
div
 
şass
="ayuda">

99 
Podemos
 
fŒ¬
 
pÜ
 
id
, 
£siÚ
, 
ãcha
, 
	`to
 ('ERROR','AVISO','ADMIN','DEBUG'), 
fich”o
, 
m’§je


100 <
br
 />

101 
Ejem¶os
:

102 <
ul
>

103 <
li
>
£siÚ
>100 
AND
 
to
='ERROR' 
ORDER
 
BY
 
id
 
desc
</li>

104 <
li
>
m’§je
 
LIKE
 "%ERROR%"</li>

105 </
ul
>

106 </
div
>

107 <
fÜm
 
Çme
='fÜm_v”_»gi¡ros' 
aùiÚ
='' 
m‘hod
='po¡' 
ÚSubm™
='javascript: visualizar_registros(this,"<?=$gcm->reg->sesion?>");„eturn false;'>

108 <
f›ld£t
>

109 <
Ëg’d
><?
php
 
echo
 
	`l™”®
('Filtro',3);?></legend>

110 <
šput
 
ty³
="‹xt" 
¡yË
='width:98%;' 
Çme
='fŒo' 
v®ue
="<?phpƒcho $filtro; ?>">

111 </
f›ld£t
>

112 <
šput
 
ty³
='hidd’' 
Çme
='m' 
v®ue
='ver_registros' />

113 <
šput
 
ty³
='hidd’' 
Çme
='a' 
v®ue
='registros_ajax' />

114 <
šput
 
ty³
='hidd’' 
Çme
='fÜm©o' 
v®ue
='ajax' />

115 <
br
 />

116 <
br
 />

117 <
šput
 
ty³
='submit' />

118 </
fÜm
>

119 <
div
 
id
='caja_registro_<?=$gcm->reg->sesion?>'>

120 </
f›ld£t
>

121 <?
php


124 iàĞ
	`is£t
(
$_POST
['filtro']) ) {

125 
$this
->
	`bÏ_»gi¡ros
(
$fŒo
);

128 
echo
 '</div></div>';

130 
	}
}

144 
funùiÚ
 
	$bÏ_»gi¡ros
(
$fŒo
=
NULL
, 
$¬¿y
=NULL) {

146 
glob®
 
$gcm
;

148 iàĞ
GCM_DEBUG
 || 
$gcm
->
au
->
	`log—do
()) {

150 iàĞ
$¬¿y
 ) {

154 
$»gi¡ros
 = 
$¬¿y
;

156 } 
	`–£if
 ( ! 
$fŒo
 ) {

158 
$»gi¡ros
 = 
$gcm
->
»g
->
	`v”_»gi¡ros
();

162 
$»gi¡ros
 = 
$gcm
->
»g
->
	`v”_»gi¡ros
(
NULL
,
$fŒo
);

166 iàĞ!
	`is_¬¿y
(
$»gi¡ros
è|| 
	`couÁ
($registros) < 1 ) {

167 
echo
 "<div class='aviso'>Sin„egistros</div>";

168  
FALSE
;

171 
$cÚ
 = 0;

172 
	`»£t
(
$»gi¡ros
);

173  
	`cu¼’t
(
$»gi¡ros
) ) {

174 
$»gi¡ro
 = 
	`cu¼’t
(
$»gi¡ros
);

175 
	`li¡
(
$id
,
$£siÚ
,
$ãcha
,
$to
,
$fich”o
,
$lš—
,
$m’§je
,
$desüciÚ
èğ
$»gi¡ro
;

176 
$»suÉado
[
$cÚ
]['id'] = 
$id
;

177 
$»suÉado
[
$cÚ
]['£siÚ'] = 
$£siÚ
;

178 
$»suÉado
[
$cÚ
]['ãcha'] = 
$ãcha
;

179 
$»suÉado
[
$cÚ
]['to'] = 
$to
;

180 
$»suÉado
[
$cÚ
]['fich”o'] = 
$fich”o
;

181 
$»suÉado
[
$cÚ
]['lš—'] = 
$lš—
;

182 
$»suÉado
[
$cÚ
]['m’§je'] = 
$m’§je
;

184 
$cÚ
++;

185 
	`Ãxt
(
$»gi¡ros
);

188 
	`»quœe_Úû
(
GCM_DIR
.'lib/int/array2table/lib/Array2table.php');

191 
$İciÚes
 = 
	`¬¿y
 ('ocuÉ¬_id' => 
TRUE
,'table_id' => 'table');

194 
$¬¿y2bË
 = 
Ãw
 
	`A¼ay2bË
();

195 
$¬¿y2bË
->
	`g’”¬_bÏ
(
$»suÉado
, 
$İciÚes
);

197 
$gcm
->
	`add_lib_js
('temas', 'jquery.dataTables.js');

202  
FALSE
;

204 
	}
}

212 
funùiÚ
 
	$»gi¡ros_ajax
() {

214 iàĞ! 
GCM_DEBUG
 && !
	`³rmiso
('v”_»gi¡ros',
NULL
,
FALSE
,FALSE) ) {

215 
echo
 '<°şass="”rÜ">'.
	`l™”®
('Sin…ermisos').'</p>';

216  
FALSE
;

219 
$fŒo
 = ( 
	`is£t
(
$_GET
['filtro']) ) ? $_GET['filtro'] : '';

221 
$this
->
	`bÏ_»gi¡ros
(
$fŒo
);

224 <
süt
>

225 
	`$
(
docum’t
).
	`»ady
(
	`funùiÚ
() {

226 
	`$
('#bË').
	`d©aTabË
();

228 </
süt
>

229 <?
php


230 
	`ex™
();

231 
	}
}

235 
funùiÚ
 
	$debug
() {

237 
glob®
 
$gcm
;

239 iàĞ! 
GCM_DEBUG
 ) {

241 
echo
 '<!-- debug -->';

245 
$this
->
	`javasüts
('ver_registros.js');

249 iàĞ
$_POST
 ) { 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`d•u¿r
($_POST,'Post','POST')); }

250 iàĞ
$_GET
 ) { 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`d•u¿r
($_GET,'Get','GET')); }

251 iàĞ
$_SESSION
 ) { 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`d•u¿r
($_SESSION,'Session')); }

253 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,
	`d•u¿r
(
$_SERVER
,'SERVER'));

255 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,
	`d•u¿r
(
$gcm
->
ev’t
->
ubiÿciÚes
,'Ubicaciones'));

258 
	`ob_¡¬t
();

259 
echo
 '<br />';

260 
$this
->
	`bÏ_»gi¡ros
(
NULL
,
$gcm
->
»g
->
»gi¡ros
);

261 
$§lida
 = 
	`ob_g‘_cÚ‹Ás
();

262 
	`ob_’d_ş—n
();

264 iàĞ
$§lida
 ) {

266 
	`»quœe_Úû
(
GCM_DIR
.'/modulos/editar/lib/Editar.php');

268 
Temas
::
	`·Ãl
Ğ
	`¬¿y
Ğ't™ulo' => 
	`l™”®
('Registros',3).' '.literal('de').' '.literal('pÃ¡gina‡ctual'),

269 'ocuÉo' => 
TRUE
,

270 'h»f' => 'javasüt:visu®iz¬(\'v”_»gi¡ros_'.
$gcm
->
»g
->
£siÚ
.'\');',

271 'sub·Ãl' => 'v”_»gi¡ros_'.
$gcm
->
»g
->
£siÚ
,

272 'cÚ‹nido' => 
$§lida
) );

275 
	}
}

284 
funùiÚ
 
	$po¡cÚ‹nido_ajax
(
$e
, 
$¬gs
) {

287 <
süt
>

288 
	`·ÃËs
();

289 </
süt
>

290 <?
php


292 
	}
}

300 
funùiÚ
 
	$visu®iz¬
() {

302 
glob®
 
$gcm
;

304 
$gcm
->
	`add_lib_js
('temas', 'jquery.dataTables.js');

306 
$this
->
	`javasüts
('ver_registros.js');

308 
$gcm
->
ev’t
->
	`ªuÏr
('titulo','ver_registros');

309 
$gcm
->
ev’t
->
	`ªuÏr
('contenido','ver_registros');

310 
$gcm
->
t™ulo
 = 
	`l™”®
('Registros');

312 
$this
->
	`fÜmuÏrio
();

314 
	}
}

322 
funùiÚ
 
	$’vio_»gi¡ros_ma
(
$e
, 
$¬gs
=
FALSE
) {

324 
glob®
 
$gcm
;

327 
$ãcha_³riocidad
 = 
	`time
(è- ( 
$this
->
³riocidad
 * 60 * 60 );

329 
$fŒo
 = 'ãch¨> '.
$ãcha_³riocidad
.' ORDER BY id desc';

331 
$»gi¡ros
 = 
$gcm
->
»g
->
	`v”_»gi¡ros
(
NULL
,
$fŒo
);

333 iàĞ!
	`is_¬¿y
(
$»gi¡ros
è|| 
	`couÁ
($registros) < 1 ) {

334 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Sin„egistros‡ƒnviar');

338 
$»suÉado
 = '<pre>

340 0: 
id


341 1: 
£siÚ


342 2: 
ãcha


343 3: 
to


344 4: 
fich”o


345 5: 
lš—


346 6: 
m’§je


347 7: 
desüciÚ


349 
$»suÉado
 .ğ'<´e>'.
	`d•u¿r
(
$»gi¡ros
).'</pre>';

353 
$¬gs
['cu”po'] = 
$»suÉado
;

354 
$¬gs
['asuÁo'] = 'Regi¡ro ’ '.
$gcm
->
	`cÚfig
('admin','Proyecto');

355 
$¬gs
['ma'] = 
$this
->
ma_’vio
;

356 
$¬gs
['nomb»_de¡š©¬io'] = 
$this
->
nomb»_’vio_ema
;

357 
$¬gs
['nomb»_»m™’‹'] = 
$this
->
nomb»_»m™’‹
;

358 
$¬gs
['ma_»m™’‹'] = 
$this
->
ma_»m™’‹
;

360 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Enviamosƒmail con†os„egistros');

362 
$gcm
->
ev’t
->
	`Ïnz¬_acciÚ_modulo
('’vioma','’vŸr_ema',
$e
, 
$¬gs
);

363 
	}
}

369 
funùiÚ
 
	$bÜ¿r_»gi¡ros_ªtiguos
(
$e
, 
$¬gs
=
FALSE
) {

371 
glob®
 
$gcm
;

373 iàĞ
$this
->
dŸs_bÜ¿do
 == 0 ) ;

375 
$§lida
 = 
$gcm
->
»g
->
	`bÜ¿do_»gi¡ros_ªtiguos
(
$this
->
dŸs_bÜ¿do
);

377 iàĞ
$§lida
 ==ğ
FALSE
 ) {

378 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'Errorƒnƒl borrado de„egistros','ERROR');

380 
	`»gi¡¿r
(
__FILE__
,
__LINE__
,'BÜ¿dØd»gi¡ro cÚ mÃ¡ d'.
$this
->
dŸs_bÜ¿do
.' dÃ­as','ADMIN');

383 
	}
}

	@gcm/modulos/ver_registros/menuAdmin.php

1 <?
php


2 
	g$m’uAdmš
['Seguimiento']['boton']['Registros']['activado']=1;

3 
	g$m’uAdmš
['Seguimiento']['boton']['Registros']['title']="VisualizaciÃ³n de†os„egistros de†a‡plicaciÃ³n";

4 
	g$m’uAdmš
['Seguim›Áo']['bÙÚ']['Regi¡ros']['lšk']=
Rou‹r
::
$ba£
.'v”_»gi¡ros/visu®iz¬/'.Rou‹r::
$u¾
;

	@gcm/modulos/widgets/eventos_usuario.php

1 <?
php


2 
	g$ev’tos
['columnaDerecha']['widget_con_panel'][10]='widget=Noticias';

3 
	g$ev’tos
['columnaDerecha']['widget_con_panel'][11]='widget=Enlacesƒxternos';

	@gcm/modulos/widgets/index.php

1 <?
php


16 iàĞ
	g$e
 ) {

20 
	g$dœ_widg‘s
 = 'DATOS/modulos/widg‘s/'.
$e
.'/';

22 iàĞ
is_dœ
(
$dœ_widg‘s
è==ğ
TRUE
 ) {

24 
$dœ
=
dœ
(
$dœ_widg‘s
);

26 
	g$fich_w
 = 
$dœ
->
»ad
()) {

28 iàĞ
$fich_w
[0] !== '.' ) {

30 
$fich”o_widg‘
=
$dœ_widg‘s
.
$fich_w
;

31 
li¡
(
$nomb»_widg‘
, 
$ex‹nsiÚ
èğ
ex¶ode
('.',
$fich_w
);

32 
	g$nomb»_widg‘
 = 
qu™¬Utf8
(
$nomb»_widg‘
);

34 iàĞ
	g$e
 == 'columna' ) {

36 <
div
 
şass
="panel">

37 <
¥ª
 
şass
="tituloPanel">

38 <
a
 
h»f
="javascript:visualizar('caja_<?=$nombre_widget;?>');">

39 <?=
l™”®
(
$nomb»_widg‘
)?>

40 </
a
>

41 </
¥ª
>

42 <
div
 
id
="ÿja_<?=$nomb»_widg‘;?>" 
şass
="subpanel_visible">

43 <?
php
 
šşude
(
$fich”o_widg‘
); ?>

44 </
	gdiv
>

45 </
	gdiv
>

46 <?
	gphp


48 
šşude
(
$fich”o_widg‘
);

	@gcm/modulos/widgets/lib/Widgets.php

1 <?
php


24 şas 
	cWidg‘s
 
ex‹nds
 
	mModulos
 {

28 
´iv©e
 
	m$dœ_widg‘s
 = 'DATOS/modulos/widgets/';

30 
funùiÚ
 
	$__cÚ¡ruù
() {

32 
·»Á
::
	`__cÚ¡ruù
();

36 
funùiÚ
 
	$´e£Áa_widg‘
(
$e
,
$widg‘
=
NULL
) {

38 
glob®
 
$gcm
;

40 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'P»£Á¬ widg‘ '.
$widg‘
);

42 
$nomArchivo
 = 
$this
->
dœ_widg‘s
.
$widg‘
.'.php';

44 iàĞ
	`fe_exi¡s
(
$nomArchivo
) ) {

45 
$§lida
 = 
	`fe_g‘_cÚ‹Ás
(
$nomArchivo
);

46  
$§lida
;

49 
$gcm
->
	`»gi¡¿
(
__FILE__
,
__LINE__
,'NØ£ƒncÚŒØwidg‘ ['.
$widg‘
.']','ERROR');

51  
FALSE
;

53 
	}
}

55 
funùiÚ
 
	$widg‘_cÚ_·Ãl
(
$e
,
$¬gs
=
NULL
) {

57 
$¬gs
 = 
	`»cog”_·¿m‘ros
($args);

59 
$widg‘
 = 
$¬gs
['widget'];

61 
$cÚ‹nido
 = 
$this
->
	`´e£Áa_widg‘
(
$e
,
$widg‘
);

63 iàĞ
$cÚ‹nido
 ) {

66 <
div
 
şass
="panel">

67 <
¥ª
 
şass
="tituloPanel">

68 <
a
 
h»f
="javascript:visualizar('caja_<?=$widget;?>');">

69 <?=
	`l™”®
(
$widg‘
)?>

70 </
a
>

71 </
¥ª
>

72 <
div
 
id
="ÿja_<?=$widg‘;?>" 
şass
="sub·Ãl_visibË" 
¡yË
="text-align:†eft;">

73 <?
php
 
echo
 
$cÚ‹nido
; ?>

74 </
div
>

75 </
div
>

76 <?
php


80 
	}
}

	@plantillas/index-modulos.php

1 <?
php


14 
»quœe_Úû
(
dœÇme
(
__FILE__
).'/lib/Modulo.php');

15 iàĞ! 
	g$modulo
 ) $modulØğ
Ãw
 
Modulo
();

16 
	g$modulo
->
$a
(
$¬gs
);

	@plantillas/modulos/eventos_admin.php

1 <?
	gphp


	@plantillas/modulos/eventos_usuario.php

1 <?
	gphp


	@plantillas/modulos/lib/modulo.php

1 <?
php


15 
	gşass
 {
	gmodulo
} 
ex‹nds
 
	gModulos
 {

19 
funùiÚ
 
__cÚ¡ruù
() {

21 
	g·»Á
::
__cÚ¡ruù
();

	@plantillas/modulos/menuAdmin.php

1 <?
	gphp


	@plantillas/php_clase.php

14 
	gşass
 <
Nomb»
 
de
 
Ï
 
	gşa£
> {

	@plantillas/php_fichero.php

1 <?
	gphp


	@plantillas/php_function.php

12 
funùiÚ
 
	$nomb»
() {

14 
	}
}

	@plantillas/php_metodo.php

12 
funùiÚ
 
	$nomb»
() {

14 
	}
}

	@proyecto/DATOS/conf/estadisticas.php

1 <?
PHP


6 
	g$e¡adi¡iÿs
['EXCLUIR_REFERENCIA'][]="localhost";

9 
	g$e¡adi¡iÿs
['EXCLUIR_CONTADOR'][]='localhost';

	@proyecto/DATOS/conf/modulos.php

1 <?
php


2 
	g$MODULOS_ACTIVOS
[]="subirimagen";

	@proyecto/DATOS/configuracion/admin/config.php

1 <?
php


3 
	g$cÚfig
['Idioma…or defecto']='es';

4 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='cache_http';

5 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='comentarios';

6 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='descargables';

7 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='indexador';

8 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='referencias';

9 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='widgets';

10 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='aplicar_SEO';

11 
	g$cÚfig
['MÃ³dulos‡ctivados'][]='literales';

12 
	g$cÚfig
['Palabra secreta…ara depurar']='debug';

13 
	g$cÚfig
['Proyecto']='proyecto';

14 
	g$cÚfig
['Sufijo…ara base de datos']='proyecto_';

15 
	g$cÚfig
['bd_conexion']='sqlite:DATOS/proyecto.db';

16 
	g$cÚfig
['bd_pass']='';

17 
	g$cÚfig
['bd_usuario']='';

	@proyecto/DATOS/configuracion/admin/config_es.php

1 <?
php


3 
	g$cÚfig_DESC
['ConexiÃ³n con base de datos (PDO)']='En caso deener un servidor de base de datos,‡Ã±adirƒl driver‡ utlizar…ara PDO';

4 
	g$cÚfig_DESC
['ContraseÃ±a base de datos']='ContraseÃ±a…ara servidor de base de datos';

5 
	g$cÚfig_DESC
['Idioma…or defecto']='Idioma…redeterminado';

6 
	g$cÚfig_DESC
['MÃ³dulos‡ctivados']='DesactivaciÃ³n de mÃ³dulos';

7 
	g$cÚfig_DESC
['Palabra secreta…ara depurar']='AÃ±adiendo†a…alabra seleccionada‡†a url (?<palabra_secreta>=1), se inicia sesiÃ³n de depuraciÃ³n, con un cero seermina';

8 
	g$cÚfig_DESC
['Proyecto']='Dominio del…royecto';

9 
	g$cÚfig_DESC
['Sufijo…ara base de datos']='ProducciÃ³n: Nos…ermite diferenciar†asablas de†os diferentes…royectosƒn una misma base de datos';

10 
	g$cÚfig_DESC
['Usuario base de datos']='Usuario…araƒl servidor de base de datos';

11 
	g$cÚfig_DESC
['bd_conexion']='ProducciÃ³n: Driver‡ usar…ara conexiÃ³n con base de datos (PDO). Ejemplos sqlite:/DATOS/proyecto.db o mysql:dbname=gcm';

12 
	g$cÚfig_DESC
['bd_pass']='ProducciÃ³n: ContraseÃ±a…ara servidor de base de datos,ƒn caso de sqlite‚oƒs‚ecesario';

13 
	g$cÚfig_DESC
['bd_usuario']='ProducciÃ³n: Usuario…araƒl servidor de base de datos,ƒn caso de utilizar sqlite‚oƒs‚ecesario';

	@proyecto/DATOS/configuracion/comentarios/config.php

1 <?
php


6 
	g$cÚfig
['mod”aciÃ³n'] = 
Œue
;

	@proyecto/DATOS/configuracion/contenidos/config.php

1 <?
php


6 
	g$cÚfig
['sistema'] = 'Files';

7 
	g$cÚfig
['descartar'][] = 'gdoxygen';

	@proyecto/DATOS/configuracion/idiomas/LG_ca.php

1 <?
php


3 
	g$LG_ÿ
['Comorata gcm†as imÃ¡genes']='comommmmmmmm';

4 
	g$LG_ÿ
['Documentacion']='DocumentaciÃ³n';

5 
	g$LG_ÿ
['Forzar_eventos_por_omision']='Forzarƒventos…or omisiÃ³n';

6 
	g$LG_ÿ
['ca']='CatalÃ ';

7 
	g$LG_ÿ
['es']='Castellano';

8 
	g$LG_ÿ
['ing']='';

9 
	g$LG_ÿ
['inicio']='Inici';

10 
	g$LG_ÿ
['Instalacion']='InstalaciÃ³n';

11 
	g$LG_ÿ
['A_falta_de_un_script_de_instalacion_pasos_a_seguir_para_realizarla']='A falta de un script de instalaciÃ³n…asos‡ seguir…ara„ealizarla';

	@proyecto/DATOS/configuracion/idiomas/LG_es.php

1 <?
php


3 
	g$LG_es
['Anyadir_javascript_desde_un_modulo']='AÃ±adir javascript desde†os mÃ³dulos';

4 
	g$LG_es
['April']='Abril';

5 
	g$LG_es
['CSS_o_Como_cambiar_el_aspecto_de_tu_proyecto']='Apariencia';

6 
	g$LG_es
['Cache_http']='Cache http';

7 
	g$LG_es
['Como_crear_un_modulo']='Como crear un mÃ³dulo';

8 
	g$LG_es
['Conexion_entre_modulos']='ConexiÃ³nƒntre mÃ³dulos';

9 
	g$LG_es
['Configuracion_para_modulos']='ConfiguraciÃ³n…ara mÃ³dulos';

10 
	g$LG_es
['Debug']='';

11 
	g$LG_es
['December']='Diciembre';

12 
	g$LG_es
['Desarrollo']='';

13 
	g$LG_es
['Documentacion']='DocumentaciÃ³n';

14 
	g$LG_es
['Ejemplo_de_documento']='Ejemplo de documento';

15 
	g$LG_es
['Ejemplo_de_uso_de_GcmConfig']='Ejemplo de uso de GcmConfig';

16 
	g$LG_es
['Entrada_de_prueba']='Entrada de…rueba';

17 
	g$LG_es
['Eventos']='';

18 
	g$LG_es
['GCM']='';

19 
	g$LG_es
['Gestor de Contenido Mamedu']='';

20 
	g$LG_es
['Instalar']='Instalar';

21 
	g$LG_es
['Literales']='';

22 
	g$LG_es
['Modificar secciones definidasƒn†a…lantilla dinamicamente']='';

23 
	g$LG_es
['Modulos']='MÃ³dulos';

24 
	g$LG_es
['November']='Noviembre';

25 
	g$LG_es
['Paginador_con_ajax']='Paginador con‡jax';

26 
	g$LG_es
['Permisos']='';

27 
	g$LG_es
['Permisos borrador']='';

28 
	g$LG_es
['Plantillas']='Plantillas';

29 
	g$LG_es
['Presentacion']='PresentaciÃ³n';

30 
	g$LG_es
['Probando_contenido']='Probando contenido';

31 
	g$LG_es
['Referencias']='Referencias';

32 
	g$LG_es
['Seccion']='SecciÃ³n';

33 
	g$LG_es
['Seccions']='Secciones';

34 
	g$LG_es
['Sistema_de_plantillas']='Sistema de…lantillas';

35 
	g$LG_es
['Sistema_de_registros']='Sistema de„egistros';

36 
	g$LG_es
['Subir imagen‡ ']='Subir una imagen';

37 
	g$LG_es
['Subseccion_de_prueba']='SubsecciÃ³n de…rueba';

38 
	g$LG_es
['Tema_diferente_para_administracion']='Tema diferente…ara‡dministraciÃ³n';

39 
	g$LG_es
['Trabajando_con_imagenes']=' Trabajando con imagenes';

40 
	g$LG_es
['Tratar_las_diferencias_entre_navegadores']='Tratar†as diferenciasƒntre‚avegadores';

41 
	g$LG_es
['Tratar_las_diferencias_entre_navegadores2']='Tratar†as diferenciasƒntre‚avegadores';

42 
	g$LG_es
['documento_nuevo']='Documento‚uevo';

43 
	g$LG_es
['eliminar']='';

44 
	g$LG_es
['es']='Castellano';

45 
	g$LG_es
['gcm']='';

46 
	g$LG_es
['inicio']='Inicio';

47 
	g$LG_es
['iniciot']='Pagina de inicio';

48 
	g$LG_es
['literales']='';

49 
	g$LG_es
['probando']='';

50 
	g$LG_es
['probando‚uevo']='';

51 
	g$LG_es
['seccion con otro‚ombre2']='';

52 
	g$LG_es
['seccion‚ueva']='';

53 
	g$LG_es
['secciÃ³n']='';

54 
	g$LG_es
['sin_traduccion']='No se haƒncontradoraducciÃ³n deƒste documento†e…resentamosƒl original';

55 
	g$LG_es
['tema']='';

56 
	g$LG_es
['tema_nuevo']='tema‚uevo';

57 
	g$LG_es
['tiny_mce']='';

58 
	g$LG_es
['Temas']='Temas';

59 
	g$LG_es
['Cambio_de_tema_al_vuelo']='Cambio deema‡l vuelo';

60 
	g$LG_es
['A_falta_de_un_script_de_instalacion_pasos_a_seguir_para_realizarla']='A falta de un script de instalaciÃ³n,…asos‡ seguir';

61 
	g$LG_es
['Instalacion']='';

62 
	g$LG_es
['Tests_-_Creacion_de_test_sobre_modulos']='Tests - CreaciÃ³n deest sobre mÃ³dulos';

63 
	g$LG_es
['Tests,_Creacion_de_test_sobre_modulos']='Tests, CreaciÃ³n deest sobre mÃ³dulos';

64 
	g$LG_es
['proyecto']='';

65 
	g$LG_es
['SEO']='SEO';

66 
	g$LG_es
['DocumentaciÃ³n del framework']='';

67 
	g$LG_es
['Gcm']='';

68 
	g$LG_es
['Gestor de Contenido Gcm']='';

69 
	g$LG_es
['DocumentaciÃ³n…ara Gcm']='';

70 
	g$LG_es
['lib']='';

71 
	g$LG_es
['libjs']='';

72 
	g$LG_es
['js']='';

73 
	g$LG_es
['php']='';

74 
	g$LG_es
['thumbnail']='';

75 
	g$LG_es
['Seccion_de_prueba']='SecciÃ³n de…rueba';

76 
	g$LG_es
['Entrada_de_prueba_2']='Entrada de…rueba 2';

77 
	g$LG_es
['Una_mas']='Una mÃ¡s';

78 
	g$LG_es
['index']='index';

79 
	g$LG_es
['TinyTable']='';

80 
	g$LG_es
['Sustitucion_en_enlaces_en_caso_de_ser_llamados_mediante_ajax']='Sustitucionƒnƒnlacesƒn caso de ser†lamados mediante‡jax';

81 
	g$LG_es
['Modificar_secciones_definidas_en_la_plantilla_dinamicamente']='Modificar secciones definidasƒn†a…lantilla dinamicamente';

82 
	g$LG_es
['Evitar_reenvios_a_formulario_al_actualizar_una_pagina']='Evitar„eenvios‡ formulario‡l‡ctualizar una…agina';

83 
	g$LG_es
['Pagina_de_registro']='Pagina de„egistro';

84 
	g$LG_es
['Forzar_eventos_por_omision']='';

85 
	g$LG_es
['Crud']='Crud';

86 
	g$LG_es
['crud']='crud';

	@proyecto/DATOS/configuracion/idiomas/LG_ing.php

1 <?
	gphp


	@proyecto/DATOS/configuracion/idiomas/config.php

1 <?
php


3 
	g$cÚfig
['Idioma…or defecto']='es';

4 
	g$cÚfig
['Idiomas‡ctivados'][]='ca';

5 
	g$cÚfig
['Idiomas‡ctivados'][]='es';

6 
	g$cÚfig
['Directorio idiomas'] = 'DATOS/configuracion/idiomas/';

	@proyecto/DATOS/configuracion/idiomas/config_es.php

1 <?
php


3 
	g$cÚfig_DESC
['Idioma…or defecto']='Idioma…redeterminado';

	@proyecto/DATOS/configuracion/indexador/config.php

1 <?
php


2 
	g$cÚfig
['maxLong'] = 200;

	@proyecto/DATOS/configuracion/menu/config.php

1 <?
php


3 
	g$cÚfig
['descartar'][]='gdoxygen';

4 
	g$cÚfig
['descartar'][]='thumbnail';

5 
	g$cÚfig
['orden_presentacion'][] = 'inicio@1';

	@proyecto/DATOS/configuracion/menu/config_es.php

1 <?
php


3 
	g$cÚfig_DESC
['descartar']='Si un‡rchivo o carpeta contiene uno de†os contenidos‡ descartar‚o se incluyenƒnƒl menÃº';

	@proyecto/DATOS/configuracion/metatags/config.php

1 <?
php


3 
	g$cÚfig
['title']='Gcm';

4 
	g$cÚfig
['author']='https://plus.google.com/u/0/105169074373021028303/posts';

5 
	g$cÚfig
['subject']='DocumentaciÃ³n…ara Gcm';

6 
	g$cÚfig
['description']='Herramienta…ara†a gestiÃ³n de contenido variado';

7 
	g$cÚfig
['keywords']='programaciÃ³n, informÃ¡tica,†inux,…hp, bash, javascript, css,‡jax';

8 
	g$cÚfig
['generator']='vim';

9 
	g$cÚfig
['language']='spanish';

10 
	g$cÚfig
['revisit']='1 day';

11 
	g$cÚfig
['distribution']='global';

12 
	g$cÚfig
['robots']='all';

	@proyecto/DATOS/configuracion/metatags/config_es.php

1 <?
php


3 
	g$cÚfig_DESC
['Titulo']='Titulo del…royecto';

4 
	g$cÚfig_DESC
['Subtitulo']='Subtitulo del…royecto';

5 
	g$cÚfig_DESC
['keywords']='Palabras clave…ara†os buscadores separadas…or comas';

6 
	g$cÚfig_DESC
['title']='Titulo del…royecto';

7 
	g$cÚfig_DESC
['author']='Titulo del…royecto';

8 
	g$cÚfig_DESC
['subject']='Subtitulo del…royecto';

9 
	g$cÚfig_DESC
['description']='DescripciÃ³n del…royecto,…ara incluirƒn†os metaags';

10 
	g$cÚfig_DESC
['generator']='Programa…ara gene';

11 
	g$cÚfig_DESC
['language']='CÃ³digo de†enguajeƒjemplo:ƒs,ƒn';

12 
	g$cÚfig_DESC
['revisit']='Ejemplo 1 day';

13 
	g$cÚfig_DESC
['distribution']='Ejemplo global';

	@proyecto/DATOS/configuracion/temas/config.php

1 <?
php


3 
	g$cÚfig
['tema_actual']='proyecto';

	@proyecto/DATOS/constantes/GCM_CONS.php

1 <?
php


2 
	g$GCM_CONS
['ejemplo1']='Ejemplo1 de constante';

3 
	g$GCM_CONS
['ejemplo2']='Ejemplo2 de constante';

4 
	g$GCM_CONS
['ejemplo_tres']='ejemplores…ara';

5 
	g$GCM_CONS
['ejemplo_4']='Este unƒjemplo';

	@proyecto/DATOS/constantes/GCM_CONS_ca.php

1 <?
php


2 
	g$GCM_CONS_DESC
['ejemplo1']='Ejemplo1 de constantƒn catala';

3 
	g$GCM_CONS_DESC
['ejemplo2']='Ejemplo2 de constante';

4 
	g$GCM_CONS_DESC
['ejemplo_tres']='e3 conƒspacios y‡cÃ©ntÃ²s';

	@proyecto/DATOS/constantes/GCM_CONS_es.php

1 <?
php


2 
	g$GCM_CONS_DESC
['ejemplo1']='Ejemplo1 de constante';

3 
	g$GCM_CONS_DESC
['ejemplo2']='Ejemplo2 de constante';

4 
	g$GCM_CONS_DESC
['ejemplo_tres']='e3 conƒspacios y‡cÃ©ntÃ²s';

5 
	g$GCM_CONS_DESC
['ejemplo_4']='ejemplo_4';

	@proyecto/DATOS/eventos/admin/eventos_admin.php

1 <?
php


3 
	g$ev’tos
['menuadmin']['presentar_menu_administrativo'][1]='';

4 
	g$ev’tos
['infoserver']['infoserver'][1]='';

5 
	g$ev’tos
['test']['ejecutar_tests_modulos'][1]='';

9 
	g$ev’tos
['precarga']['activar_tema_admin'][1]='';

12 iàĞ! 
	g$gcm
->
cÚfig
('admin','configuracion_confirmada') ) {

14 
	g$ev’tos
['precontenido']['confirmar_configuracion'][1]='';

	@proyecto/DATOS/eventos/admin/eventos_usuario.php

1 <?
php


3 
	g$ev’tos
['menuadmin']['menuadmin_sin_login'][1]='';

4 
	g$ev’tos
['columna']['panel_login'][10]='';

5 
	g$ev’tos
['registro']['formulario_registro'][10]='';

	@proyecto/DATOS/eventos/aplicar_SEO/eventos_admin.php

1 <?
php


30 
	g$ev’tos
['seo']['seo'][1] = "";

	@proyecto/DATOS/eventos/aplicar_SEO/eventos_usuario.php

1 <?
	gphp


	@proyecto/DATOS/eventos/cache_http/eventos_admin.php

1 <?
	gphp


	@proyecto/DATOS/eventos/cache_http/eventos_usuario.php

1 <?
php


29 
	g$ev’tos
['precarga']['alInicio'][1] = '';

30 
	g$ev’tos
['postcarga']['alFinal'][1] = '';

31 
	g$ev’tos
['borrar_cache']['borrar'][1] = 'todo';

	@proyecto/DATOS/eventos/comentarios/eventos_admin.php

1 <?
	gphp


	@proyecto/DATOS/eventos/comentarios/eventos_usuario.php

1 <?
php


12 
	g$ev’tos
['columna']['ultimos'][6]='';

15 
	g$ev’tos
['postcontenido']['presentar_comentarios'][3]='';

18 
	g$ev’tos
['postcontenido']['formulario'][4]='';

21 
	g$ev’tos
['modifiÿr_com’rio']['modifiÿr'][1] = ( 
is£t
(
$_REQUEST
['id']èè? $_REQUEST['id'] : 
NULL
 ;

	@proyecto/DATOS/eventos/contenidos/eventos_admin.php

1 <?
php


13 
	g$ev’tos
['guardar_como_borrador']['guardar'][10]='';

16 
	g$ev’tos
['postguardar_como_borrador']['enrutar'][100]='';

22 
	g$ev’tos
['publicar_borrador']['ejecutar_mover'][1]='';

25 
	g$ev’tos
['postpublicar_borrador']['enrutar'][100]='';

28 
	g$ev’tos
['actualizar_contenido']['guardar'][1]='';

31 
	g$ev’tos
['postactualizar_contenido']['enrutar'][100]='';

34 
	g$ev’tos
['borrar']['borrar'][1]='';

37 
	g$ev’tos
['ejecutar_borrar']['ejecutar_borrar'][1]='';

40 
	g$ev’tos
['postejecutar_borrar']['enrutar'][100]='';

43 
	g$ev’tos
['nueva_seccion']['nueva_seccion'][1]='';

46 
	g$ev’tos
['ejecutar_nueva_seccion']['ejecutar_nueva_seccion'][1]='';

49 
	g$ev’tos
['postejecutar_nueva_seccion']['enrutar'][100]='';

55 
	g$ev’tos
['guardar_como']['guardar_como'][1]='';

61 
	g$ev’tos
['vertodo']['vertodo'][1]='';

64 
	g$ev’tos
['traducir']['editar'][1]='';

67 
	g$ev’tos
['ejecutar_traducir']['guardar'][1]='';

70 
	g$ev’tos
['postejecutar_traducir']['enrutar'][100]='';

73 
	g$ev’tos
['mover']['mover'][1]='';

76 
	g$ev’tos
['ejecutar_mover']['ejecutar_mover'][1]='';

79 
	g$ev’tos
['postejecutar_mover']['enrutar'][100]='';

82 
	g$ev’tos
['mover_seccion']['mover_seccion'][1]='';

85 
	g$ev’tos
['ejecutar_mover_seccion']['ejecutar_mover_seccion'][1]='';

88 
	g$ev’tos
['postejecutar_mover_seccion']['enrutar'][100]='';

91 
	g$ev’tos
['nuevo']['nuevo'][1]='';

94 
	g$ev’tos
['ejecutar_nuevo']['guardar'][1]='';

97 
	g$ev’tos
['postejecutar_nuevo']['enrutar'][100]='';

100 
	g$ev’tos
['editar_contenido']['editar'][1]='';

	@proyecto/DATOS/eventos/contenidos/eventos_usuario.php

1 <?
php


10 
	g$ev’tos
['contenido']['contenido'][1]='';

13 
	g$ev’tos
['titulo']['titulo'][1]='';

16 
	g$ev’tos
['titulo_articulo']['titulo_articulo'][1]='';

19 
	g$ev’tos
['pie_articulo']['pie_articulo'][1]='';

22 
	g$ev’tos
['contenido_dinamico']['listar_contenido_seccion'][5]='';

25 
	g$ev’tos
['subcabecera']['camino'][2]='';

28 
	g$ev’tos
['precarga']['comprobar_permisos'][1]='';

31 
	g$ev’tos
['contenido_ajax']['contenido_ajax'][1]='';

34 
	g$ev’tos
['sin_contenido']['sin_contenido'][1]='';

37 
	g$ev’tos
['sin_seccion']['sin_seccion'][1]='';

	@proyecto/DATOS/eventos/descargables/eventos_usuario.php

1 <?
php


2 iàĞ!
is£t
(
$_SESSION
['ed™']è|| 
	g$_SESSION
['edit'] != 'si' ) {

3 
$ev’tos
['postcontenido']['procesar_texto'][1] = '';

5 
	g$ev’tos
['precarga']['presenta_contenido'][1] = '';

6 
	g$ev’tos
['postcontenido']['lista_descargables'][1] = '';

	@proyecto/DATOS/eventos/editar/eventos_admin.php

1 <?
php


11 
	g$ev’tos
['editar_contenido']['editor_web'][10]='';

12 
	g$ev’tos
['traducir']['editor_web'][10]='';

13 
	g$ev’tos
['nuevo']['editor_web'][10]='';

	@proyecto/DATOS/eventos/enviomail/eventos_admin.php

1 <?
php


7 
	g$ev’tos
['columna']['formulario']['10']='';

8 
	g$ev’tos
['enviar_email_error']['enviar_email_error'][1]='';

	@proyecto/DATOS/eventos/idiomas/eventos_usuario.php

1 <?
php


5 
	g$ev’tos
['precarga']['seleccion_idioma'][1] = '';

6 
	g$ev’tos
['precarga']['definir_idioma'][2] = '';

7 
	g$ev’tos
['cabeceraDerecha']['selector_idiomas'][1] = '';

	@proyecto/DATOS/eventos/imagenes/eventos_admin.php

1 <?
php


2 
	g$ev’tos
['columna']['formulario'][3] = '';

	@proyecto/DATOS/eventos/imagenes/eventos_usuario.php

1 <?
php


19 
	g$ev’tos
['postcontenido']['imagenes2thickbox'][3] = '';

	@proyecto/DATOS/eventos/indexador/eventos_admin.php

1 <?
php


2 
	g$ev’tos
['postejecutar_borrar']['borrar_archivo_pdo'][1] = '';

3 
	g$ev’tos
['postejecutar_nuevo']['indexar_archivo_pdo'][1] = '' ;

4 
	g$ev’tos
['postactualizar_contenido']['indexar_archivo_pdo'][1] = '';

5 
	g$ev’tos
['postejecutar_mover']['borrar_archivo_pdo'][1] = '';

6 
	g$ev’tos
['postejecutar_mover']['indexar_archivo_pdo'][2] = '';

7 
	g$ev’tos
['postpublicar_borrador']['indexar_archivo_pdo'][2] = '';

8 
	g$ev’tos
['postejecutar_mover_seccion']['cambio_ruta_seccion'][2] = '';

9 
	g$ev’tos
['reindexar']['reindexar'][1] = '';

10 
	g$ev’tos
['reindexado_completo']['reindexado_completo'][1] = '';

11 
	g$ev’tos
['indexar']['indexado'][1] = '';

	@proyecto/DATOS/eventos/indexador/eventos_usuario.php

1 <?
php


2 
	g$ev’tos
['cabeceraDerecha']['formulario_busqueda'][1]='';

3 
	g$ev’tos
['cŞumÇ']['uÉimas_’Œadas'][5]="num=4&£cciÚ=".
Rou‹r
::
$s
."&formato=1";

4 
	g$ev’tos
['contenido_dinamico']['contenido_dinamico'][1]='';

6 
	g$ev’tos
['buscar']['presentar_busquedas'][1]='';

8 
	g$ev’tos
['indexar']['indexado'][3] = '';

	@proyecto/DATOS/eventos/literales/eventos_admin.php

1 <?
php


19 
	g$ev’tos
['columna']['panel_literales'][5] = '';

	@proyecto/DATOS/eventos/literales/eventos_usuario.php

1 <?
php


20 iàĞ!
is£t
(
$_SESSION
['ed™']è|| 
	g$_SESSION
['edit'] != 'si' ) {

21 
$ev’tos
['postcontenido']['procesar_texto'][1] = '';

	@proyecto/DATOS/eventos/menu/eventos_usuario.php

1 <?
php


13 
	g$ev’tos
['cabecera']['menu_principal'][0] = '';

14 
	g$ev’tos
['columna']['barra_navegacion'][1] = '';

19 
	g$this
->
£t_li¡a_bÏnÿ
('menu','menu_ajax');

	@proyecto/DATOS/eventos/metatags/eventos_usuario.php

1 <?
php


2 
	g$ev’tos
['heads']['presentar_heads_dinamicos'][1] = '';

	@proyecto/DATOS/eventos/referencias/eventos_admin.php

1 <?
php


2 
	g$ev’tos
['columna']['panel'][10]='';

	@proyecto/DATOS/eventos/referencias/eventos_usuario.php

1 <?
php


3 
	g$ev’tos
['postcontenido']['procesar_texto'][1] = '';

	@proyecto/DATOS/eventos/temas/eventos_admin.php

1 <?
php


5 iàĞ
	gRou‹r
::
$a
 =ğ'admši¡¿r' && 
Rou‹r
::
$m
 == 'temas' ) {

6 
$ev’tos
['columna']['panel_colores'][1] = '';

	@proyecto/DATOS/eventos/temas/eventos_usuario.php

1 <?
php


24 
	g$ev’tos
['precarga']['inspeccionar_router'][3] = '';

27 
	g$ev’tos
['pie']['pie'][1] = '';

30 
	g$ev’tos
['cabeceraIzquierda']['presentar_titulo'][1]='';

33 
	g$ev’tos
['heads']['incluir_css_head'][5] = '';

36 
	g$ev’tos
['heads']['incluir_javascript_head'][5] = '';

39 
	g$ev’tos
['scripts']['incluir_javascript'][1] = '';

42 
	g$ev’tos
['precarga']['ocultar_contenido_desde_titulo'][10] = '';

	@proyecto/DATOS/eventos/ver_registros/eventos_usuario.php

1 <?
php


9 
	g$ev’tos
['debug']['debug'][15] = '';

12 
	g$ev’tos
['avisos']['presentar_caja_de_avisos'][1]='';

15 
	g$ev’tos
['postcontenido_ajax']['postcontenido_ajax'][1]='';

18 
	g$ev’tos
['cron']['envio_registros_mail'][100]='';

21 
	g$ev’tos
['cron']['borrar_registros_antiguos'][10]='';

	@proyecto/DATOS/eventos/widgets/eventos_usuario.php

1 <?
php


2 
	g$ev’tos
['columnaDerecha']['widget_con_panel'][10]='widget=Noticias';

3 
	g$ev’tos
['columnaDerecha']['widget_con_panel'][11]='widget=Enlacesƒxternos';

	@proyecto/DATOS/modulos/widgets/Enlaces.php

1 <
iäame
 
	g¤c
="h‰p://sh¬e.xm¬ks.com/fŞd”/iäame/oN3OZ5CCup" 
width
="200px" 
height
="240px" 
süŞlšg
="no" 
äamebÜd”
="0"></iframe>

2 <
iäame
 
¤c
="h‰p://sh¬e.xm¬ks.com/fŞd”/iäame/QÉPDYcd2A" 
width
="200px" 
height
="240px;" 
süŞlšg
="no" 
äamebÜd”
="0"></iframe>

	@proyecto/DATOS/modulos/widgets/Noticias.php

1 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="https://www.google.com/reader/ui/publisher-es.js"></script>

2 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="https://www.google.com/reader/public/javascript/user/03196777891250716063/state/com.google/broadcast?n=5&callback=GRC_p(%7Bc%3A%22-%22%2Ct%3A%22%22%2Cs%3A%22false%22%2Cb%3A%22false%22%7D)%3Bnew%20GRC"></script>

	@proyecto/index.php

1 <?
php


25 
d©e_deçuÉ_timezÚe_£t
('Europe/Madrid');

34 
DEFINE
('GCM_DIR','../../gcm/gcm/');

36 
»quœe
(
GCM_DIR
.'inicio.php');

	@
1
.
1
/usr/include
228
9397
docs/doxygen/html/search-config.php
docs/doxygen/html/search-functions.php
docs/doxygen/html/search-opensearch.php
docs/doxygen/html/search.php
gcm/DATOS/config/administradores/administradores.php
gcm/DATOS/config/administradores/administradores_es.php
gcm/DATOS/idiomas/GCM_LG_ca.php
gcm/DATOS/idiomas/GCM_LG_en.php
gcm/DATOS/idiomas/GCM_LG_es.php
gcm/DATOS/idiomas/GCM_LG_fr.php
gcm/DATOS/idiomas/estadisticas_es.php
gcm/includes/blank.php
gcm/includes/login.php
gcm/inicio.php
gcm/js/formulario.js.php
gcm/lib/int/GcmConfig/lib/Config.php
gcm/lib/int/GcmConfig/lib/GcmConfig.php
gcm/lib/int/GcmConfig/lib/GcmConfigFactory.php
gcm/lib/int/GcmConfig/lib/GcmConfigGui.php
gcm/lib/int/GcmConfig/test/GcmConfigFactoryTest.php
gcm/lib/int/GcmConfig/test/GcmConfigGuiTest.php
gcm/lib/int/GcmConfig/test/GcmConfigTest.php
gcm/lib/int/GcmConfig/test/PhpTestGcmConfigGui.php
gcm/lib/int/GcmConfig/test/phpTestGcmConfig.php
gcm/lib/int/GcmPDO/lib/GcmPDO.php
gcm/lib/int/GcmPDO/lib/paginarPDO.php
gcm/lib/int/array2table/lib/Array2table.php
gcm/lib/int/autentificacion/lib/Autentificacion.php
gcm/lib/int/autentificacion/test/AutentificacionTest.php
gcm/lib/int/captcha/captcha.php
gcm/lib/int/databoundobject/lib/Crud.php
gcm/lib/int/databoundobject/lib/DataBoundObject.php
gcm/lib/int/databoundobject/lib/Formulario.php
gcm/lib/int/formato/lib/Formato.php
gcm/lib/int/galeria/lib/Galeria.php
gcm/lib/int/galeria/lib/ImagenesAbstract.php
gcm/lib/int/galeria/lib/ImagenesTablaArchivo.php
gcm/lib/int/galeria/lit/lit_ca.php
gcm/lib/int/galeria/lit/lit_es.php
gcm/lib/int/gcm/lib/Eventos.php
gcm/lib/int/gcm/lib/GUtil.php
gcm/lib/int/gcm/lib/Gcm.php
gcm/lib/int/gcm/lib/Modulos.php
gcm/lib/int/gcm/lib/Plantilla.php
gcm/lib/int/gcm/lib/Router.php
gcm/lib/int/gcm/lib/helpers.php
gcm/lib/int/gcm/test/EventosTest.php
gcm/lib/int/gcm/test/RouterTest.php
gcm/lib/int/gcm_imagen.php
gcm/lib/int/idiomas/lib/IdiomasCore.php
gcm/lib/int/mimetypes.php
gcm/lib/int/registro/Registro.php
gcm/lib/int/registro/RegistroFactory.php
gcm/lib/int/registro/RegistroFactoryTest.php
gcm/lib/int/registro/RegistroTest.php
gcm/lib/int/rst2html/lib/Rst2html.php
gcm/lib/int/solicitud/lib/Restricciones.php
gcm/lib/int/solicitud/lib/RestriccionesFallidas.php
gcm/lib/int/solicitud/lib/Solicitud.php
gcm/lib/int/solicitud/lib/constantes.php
gcm/lib/int/temas/lib/TemaGcm.php
gcm/lib/int/temas/lib/TemaGcmTest.php
gcm/modulos/admin/config/config.php
gcm/modulos/admin/config/config_es.php
gcm/modulos/admin/eventos_admin.php
gcm/modulos/admin/eventos_usuario.php
gcm/modulos/admin/lib/Admin.php
gcm/modulos/admin/lib/AdminAdmin.php
gcm/modulos/admin/menuAdmin.php
gcm/modulos/admin/modelos/usuarios.php
gcm/modulos/aplicar_SEO/eventos_admin.php
gcm/modulos/aplicar_SEO/eventos_usuario.php
gcm/modulos/aplicar_SEO/lib/Aplicar_SEO.php
gcm/modulos/aplicar_SEO/menuAdmin.php
gcm/modulos/cache_http/eventos_admin.php
gcm/modulos/cache_http/eventos_usuario.php
gcm/modulos/cache_http/lib/Cache_http.php
gcm/modulos/cache_http/menuAdmin.php
gcm/modulos/comentarios/config/config.php
gcm/modulos/comentarios/config/config_es.php
gcm/modulos/comentarios/eventos_admin.php
gcm/modulos/comentarios/eventos_usuario.php
gcm/modulos/comentarios/lib/Comentarios.php
gcm/modulos/comentarios/lib/ComentariosAdmin.php
gcm/modulos/comentarios/menuAdmin.php
gcm/modulos/comentarios/modelos/comentarios_dbo.php
gcm/modulos/contenidos/config/config.php
gcm/modulos/contenidos/config/config_es.php
gcm/modulos/contenidos/eventos_admin.php
gcm/modulos/contenidos/eventos_usuario.php
gcm/modulos/contenidos/lib/ContenidoColeccion.php
gcm/modulos/contenidos/lib/Contenidos.php
gcm/modulos/contenidos/lib/ContenidosAbstract.php
gcm/modulos/contenidos/lib/ContenidosFiles.php
gcm/modulos/contenidos/menuAdmin.php
gcm/modulos/contenidos/test/ContenidoTest.php
gcm/modulos/descargables/config.php
gcm/modulos/descargables/eventos_usuario.php
gcm/modulos/descargables/lib/Descargables.php
gcm/modulos/editar/eventos_admin.php
gcm/modulos/editar/lib/Editar.php
gcm/modulos/editar/menuAdmin.php
gcm/modulos/enviomail/eventos_admin.php
gcm/modulos/enviomail/lib/Enviomail.php
gcm/modulos/gdoxygen/eventos_admin.php
gcm/modulos/gdoxygen/eventos_usuario.php
gcm/modulos/gdoxygen/lib/Gdoxygen.php
gcm/modulos/gdoxygen/lib/search_doxygen.php
gcm/modulos/idiomas/config/config.php
gcm/modulos/idiomas/config/config_es.php
gcm/modulos/idiomas/eventos_usuario.php
gcm/modulos/idiomas/info.php
gcm/modulos/idiomas/lib/Idiomas.php
gcm/modulos/idiomas/menuAdmin.php
gcm/modulos/imagenes/config/config.php
gcm/modulos/imagenes/config/config_ca.php
gcm/modulos/imagenes/config/config_es.php
gcm/modulos/imagenes/eventos_admin.php
gcm/modulos/imagenes/eventos_usuario.php
gcm/modulos/imagenes/lib/Imagenes.php
gcm/modulos/imagenes/lib/ImagenesAdmin.php
gcm/modulos/imagenes/lib/UploadHandler.php
gcm/modulos/imagenes/lib/presentar_galeria.php
gcm/modulos/imagenes/menuAdmin.php
gcm/modulos/indexador/config/config.php
gcm/modulos/indexador/config/config_es.php
gcm/modulos/indexador/eventos_admin.php
gcm/modulos/indexador/eventos_usuario.php
gcm/modulos/indexador/info.php
gcm/modulos/indexador/lib/Indexador.php
gcm/modulos/indexador/menuAdmin.php
gcm/modulos/literales/eventos_admin.php
gcm/modulos/literales/eventos_usuario.php
gcm/modulos/literales/lib/Literales.php
gcm/modulos/literales/menuAdmin.php
gcm/modulos/menu/config/config.php
gcm/modulos/menu/config/config_es.php
gcm/modulos/menu/eventos_usuario.php
gcm/modulos/menu/lib/Menu.php
gcm/modulos/metatags/config/config.php
gcm/modulos/metatags/config/config_ca.php
gcm/modulos/metatags/config/config_es.php
gcm/modulos/metatags/eventos_usuario.php
gcm/modulos/metatags/lib/Metatags.php
gcm/modulos/referencias/eventos_admin.php
gcm/modulos/referencias/eventos_usuario.php
gcm/modulos/referencias/lib/Referencias.php
gcm/modulos/referencias/menuAdmin.php
gcm/modulos/responsiveslides/eventos_admin.php
gcm/modulos/responsiveslides/eventos_usuario.php
gcm/modulos/responsiveslides/lib/Responsiveslides.php
gcm/modulos/responsiveslides/menuAdmin.php
gcm/modulos/temas/config/config.php
gcm/modulos/temas/css/colores.php
gcm/modulos/temas/eventos_admin.php
gcm/modulos/temas/eventos_usuario.php
gcm/modulos/temas/lib/Temas.php
gcm/modulos/temas/lib/TemasAdmin.php
gcm/modulos/temas/menuAdmin.php
gcm/modulos/ver_registros/config/config.php
gcm/modulos/ver_registros/config/config_es.php
gcm/modulos/ver_registros/eventos_usuario.php
gcm/modulos/ver_registros/info.php
gcm/modulos/ver_registros/lib/Ver_registros.php
gcm/modulos/ver_registros/menuAdmin.php
gcm/modulos/widgets/eventos_usuario.php
gcm/modulos/widgets/index.php
gcm/modulos/widgets/lib/Widgets.php
plantillas/index-modulos.php
plantillas/modulos/eventos_admin.php
plantillas/modulos/eventos_usuario.php
plantillas/modulos/lib/modulo.php
plantillas/modulos/menuAdmin.php
plantillas/php_clase.php
plantillas/php_fichero.php
plantillas/php_function.php
plantillas/php_metodo.php
proyecto/DATOS/conf/estadisticas.php
proyecto/DATOS/conf/modulos.php
proyecto/DATOS/configuracion/admin/config.php
proyecto/DATOS/configuracion/admin/config_es.php
proyecto/DATOS/configuracion/comentarios/config.php
proyecto/DATOS/configuracion/contenidos/config.php
proyecto/DATOS/configuracion/idiomas/LG_ca.php
proyecto/DATOS/configuracion/idiomas/LG_es.php
proyecto/DATOS/configuracion/idiomas/LG_ing.php
proyecto/DATOS/configuracion/idiomas/config.php
proyecto/DATOS/configuracion/idiomas/config_es.php
proyecto/DATOS/configuracion/indexador/config.php
proyecto/DATOS/configuracion/menu/config.php
proyecto/DATOS/configuracion/menu/config_es.php
proyecto/DATOS/configuracion/metatags/config.php
proyecto/DATOS/configuracion/metatags/config_es.php
proyecto/DATOS/configuracion/temas/config.php
proyecto/DATOS/constantes/GCM_CONS.php
proyecto/DATOS/constantes/GCM_CONS_ca.php
proyecto/DATOS/constantes/GCM_CONS_es.php
proyecto/DATOS/eventos/admin/eventos_admin.php
proyecto/DATOS/eventos/admin/eventos_usuario.php
proyecto/DATOS/eventos/aplicar_SEO/eventos_admin.php
proyecto/DATOS/eventos/aplicar_SEO/eventos_usuario.php
proyecto/DATOS/eventos/cache_http/eventos_admin.php
proyecto/DATOS/eventos/cache_http/eventos_usuario.php
proyecto/DATOS/eventos/comentarios/eventos_admin.php
proyecto/DATOS/eventos/comentarios/eventos_usuario.php
proyecto/DATOS/eventos/contenidos/eventos_admin.php
proyecto/DATOS/eventos/contenidos/eventos_usuario.php
proyecto/DATOS/eventos/descargables/eventos_usuario.php
proyecto/DATOS/eventos/editar/eventos_admin.php
proyecto/DATOS/eventos/enviomail/eventos_admin.php
proyecto/DATOS/eventos/idiomas/eventos_usuario.php
proyecto/DATOS/eventos/imagenes/eventos_admin.php
proyecto/DATOS/eventos/imagenes/eventos_usuario.php
proyecto/DATOS/eventos/indexador/eventos_admin.php
proyecto/DATOS/eventos/indexador/eventos_usuario.php
proyecto/DATOS/eventos/literales/eventos_admin.php
proyecto/DATOS/eventos/literales/eventos_usuario.php
proyecto/DATOS/eventos/menu/eventos_usuario.php
proyecto/DATOS/eventos/metatags/eventos_usuario.php
proyecto/DATOS/eventos/referencias/eventos_admin.php
proyecto/DATOS/eventos/referencias/eventos_usuario.php
proyecto/DATOS/eventos/temas/eventos_admin.php
proyecto/DATOS/eventos/temas/eventos_usuario.php
proyecto/DATOS/eventos/ver_registros/eventos_usuario.php
proyecto/DATOS/eventos/widgets/eventos_usuario.php
proyecto/DATOS/modulos/widgets/Enlaces.php
proyecto/DATOS/modulos/widgets/Noticias.php
proyecto/index.php

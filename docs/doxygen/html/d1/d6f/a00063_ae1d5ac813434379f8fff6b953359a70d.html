<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gcm: Solicitud\TestConstraints</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />

<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="../../search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="gcm"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gcm
   &#160;<span id="projectnumber">3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generado por Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Buscar');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Página&#160;principal</span></a></li>
      <li><a href="../../pages.html"><span>Páginas&#160;relacionadas</span></a></li>
      <li><a href="../../modules.html"><span>Módulos</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Estructuras&#160;de&#160;Datos</span></a></li>
      <li><a href="../../files.html"><span>Archivos</span></a></li>
      <li><a href="../../dirs.html"><span>Directorios</span></a></li>
      <li><a href="../../examples.html"><span>Ejemplos</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="../../search.php" method="get">
              <img id="MSearchSelect" src="../../search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Buscar" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../d1/d6f/a00063.html">Solicitud</a>      </li>
    </ul>
  </div>
</div>
<div class="contents">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a051e9380cfe35e08442cd58cbb0fd978.html#a051e9380cfe35e08442cd58cbb0fd978">__construct</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_ae2d4b54e43c139e258d50eb32b41571c.html#ae2d4b54e43c139e258d50eb32b41571c">AddConstraint</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_ab9bb9d6ec6c744c9e1265493ef462c5c.html#ab9bb9d6ec6c744c9e1265493ef462c5c">GetConstraintFailures</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a60edeb531b901d82571a7ce6741d0e96.html#a60edeb531b901d82571a7ce6741d0e96">GetCookies</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a291a7c940e2fa323031f79d0da84e9e4.html#a291a7c940e2fa323031f79d0da84e9e4">GetGetVariables</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a08eff9d39dfa2089cc08bf1b33f5d6fb.html#a08eff9d39dfa2089cc08bf1b33f5d6fb">GetOriginalRequestObjectFollowingConstraintFailure</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a68ef82e90436b26105c8608383e816cd.html#a68ef82e90436b26105c8608383e816cd">GetParameters</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_ac7415558b1bce5a8eb2e66975f8f13de.html#ac7415558b1bce5a8eb2e66975f8f13de">GetParameterValue</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a0af59b035a03a989b2ee2a7db1f24b5f.html#a0af59b035a03a989b2ee2a7db1f24b5f">GetPostVariables</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a563cbb0ad56b58e51ddb4c768a5de82a.html#a563cbb0ad56b58e51ddb4c768a5de82a">IsRedirectFollowingConstraintFailure</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_aea8a3a6e3cc6264172bd70c9520574f7.html#aea8a3a6e3cc6264172bd70c9520574f7">SetConstraintFailureDefaultRedirectTargetURL</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a5b9a6c208a16eef28b46a083e5d59ba5.html#a5b9a6c208a16eef28b46a083e5d59ba5">SetConstraintFailureRedirectTargetURL</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a4fa700b4a55acb6306b4715c9a7e5855.html#a4fa700b4a55acb6306b4715c9a7e5855">SetRedirectOnConstraintFailure</a></td></tr>
          <tr><td class="navtab"><a class="qindexHL" href="../../d1/d6f/a00063_ae1d5ac813434379f8fff6b953359a70d.html#ae1d5ac813434379f8fff6b953359a70d">TestConstraints</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="../../d1/d6f/a00063_a9f775c201d1345ce6f90eb32e8ddc9f3.html#a9f775c201d1345ce6f90eb32e8ddc9f3">valor_parametro</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top" class="mempage">
<a class="anchor" id="ae1d5ac813434379f8fff6b953359a70d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d6f/a00063_ae1d5ac813434379f8fff6b953359a70d.html#ae1d5ac813434379f8fff6b953359a70d">TestConstraints</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prueba cada restricción una a una y toma de cualquier fallo rellenando la variable miembro GetConstraintFailures. </p>
<p>Si _blRedirectOnConstraintFailure se estable a true, se redirige automáticamente a la URL apropiada, tras enviar primero una cookie temporal que ses una representación del objeto '<a class="el" href="../../d1/d6f/a00063.html" title="Recoger solicitud venga de GET, POST o Cookies.">Solicitud</a>' actual. </p>

<p>Definición en la línea <a class="el" href="../../d5/da7/a00144_source.html#l00295">295</a> del archivo <a class="el" href="../../d5/da7/a00144_source.html">Solicitud.php</a>.</p>

<p>Referenciado por <a class="el" href="../../d5/da7/a00144_source.html#l00464">GetConstraintFailures()</a>.</p>
<div class="fragment"><pre class="fragment">                              {

      $this-&gt;_blHasRunConstraintTests = <span class="keyword">true</span>;
      $anyFail = <span class="keyword">false</span>;

      <span class="keywordflow">for</span> ($i=0; $i&lt;=<span class="keyword">sizeof</span>($this-&gt;_arObjParameterMethodConstraintHash) -1; $i++) {

         $strThisParameter = 
            $this-&gt;_arObjParameterMethodConstraintHash[$i] [<span class="stringliteral">&quot;PARAMETER&quot;</span>];
         $intThisMethod = $this-&gt;_arObjParameterMethodConstraintHash[$i][<span class="stringliteral">&quot;METHOD&quot;</span>];
         $objThisConstraint = 
            $this-&gt;_arObjParameterMethodConstraintHash[$i] [<span class="stringliteral">&quot;CONSTRAINT&quot;</span>];
         $varActualValue = <span class="stringliteral">&quot;&quot;</span>;
         <span class="keywordflow">if</span> ($intThisMethod == ENTRADAS_COOKIE) {
            $varActualValue = $this-&gt;_arCookieVars[$strThisParameter];
         };
         <span class="keywordflow">if</span> ($intThisMethod == ENTRADAS_GET) {
            $varActualValue = $this-&gt;_arGetVars[$strThisParameter];
         };
         <span class="keywordflow">if</span> ($intThisMethod == ENTRADAS_POST) {
            $varActualValue = $this-&gt;_arPostVars[$strThisParameter];
         };
         $intConstraintType = $objThisConstraint-&gt;GetConstraintType();
         $strConstraintOperand = $objThisConstraint-&gt;GetConstraintOperand();
         $thisFail = <span class="keyword">false</span>;
         $objFailureObject = <span class="keyword">new</span> <a class="code" href="../../d7/df7/a00058.html">RestriccionesFallidas</a>($strThisParameter, 
            $intThisMethod, $objThisConstraint);

         <span class="keywordflow">switch</span> ($intConstraintType) {

         <span class="keywordflow">case</span> RT_MAIL:
            <span class="keywordflow">if</span>(! eregi(<span class="stringliteral">&quot;^([_a-z0-9-]+)(\.[_a-z0-9-]+)*@([a-z0-9-]+)(\.[a-z0-9-]+)*(\.[a-z]{2,4})$&quot;</span>, (<span class="keywordtype">string</span>)$varActualValue)) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;El email no parece valido&#39;</span>);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> <a class="code" href="../../d5/d4e/a00141_ab78166469618b355c2fa7ae4fb5682a4.html#ab78166469618b355c2fa7ae4fb5682a4" title="Restricciones.">RT_LONG_MIN</a>:
            <span class="keywordflow">if</span> (strlen((<span class="keywordtype">string</span>)$varActualValue) &lt; (integer) $strConstraintOperand) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; su longitud es menor a &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_LONG_MAX:
            <span class="keywordflow">if</span> (strlen((<span class="keywordtype">string</span>)$varActualValue) &gt; (integer) $strConstraintOperand) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; su longitud es mayor a &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_CARACTERES_PERMITIDOS:
            <span class="keywordflow">for</span> ($j=0; $j&lt;=strlen($varActualValue)-1; $j++) {
               $thisChar = substr($varActualValue, $j, 1);
               <span class="keywordflow">if</span> (strpos($strConstraintOperand, $thisChar) === <span class="keyword">false</span>) {
                  $thisFail = <span class="keyword">true</span>;
                  registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; con caracteres no permitidos&#39;</span>);
               };
            };
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_CARACTERES_NO_PERMITIDOS:
            <span class="keywordflow">for</span> ($j=0; $j&lt;=strlen($varActualValue)-1; $j++) {
               $thisChar = substr($varActualValue, $j, 1);
               <span class="keywordflow">if</span> (!(strpos($strConstraintOperand, $thisChar) === <span class="keyword">false</span>)) {
                  $thisFail = <span class="keyword">true</span>;
                  registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; con caracteres no permitidos&#39;</span>);
               };
            };
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_MENOR_QUE:
            <span class="keywordflow">if</span> ($varActualValue &gt;= $strConstraintOperand) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; menor a &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_MAYOR_QUE:
            <span class="keywordflow">if</span> ($varActualValue &lt;= $strConstraintOperand) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; mayor a &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_IGUAL_QUE:
            <span class="keywordflow">if</span> ($varActualValue != $strConstraintOperand) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; igual que &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_NO_IGUAL:
            <span class="keywordflow">if</span> ($varActualValue == $strConstraintOperand) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; no es igual a &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_PASA_EXPRESION_REGULAR:
            <span class="keywordflow">if</span> (!(preg_match($strConstraintOperand, $varActualValue))) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; pasa exp &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_NO_PASA_EXPRESION_REGULAR:
            <span class="keywordflow">if</span> (preg_match($strConstraintOperand, $varActualValue)) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; no pasa exp&#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_NO_ES_NUMERO:
            <span class="keywordflow">if</span> ( ! is_numeric($varActualValue) ) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; menor a &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         <span class="keywordflow">case</span> RT_REQUERIDO:
            <span class="keywordflow">if</span> ( ! isset($varActualValue) || empty($varActualValue) ) {
               $thisFail = <span class="keyword">true</span>;
               registrar(__FILE__,__LINE__,$strThisParameter.<span class="stringliteral">&#39; es requerido &#39;</span>.$strConstraintOperand);
               }
            <span class="keywordflow">break</span>;

         };

         <span class="keywordflow">if</span> ($thisFail) {
            $anyFail = <span class="keyword">true</span>;
            $this-&gt;_arObjConstraintFailure[] = $objFailureObject;
         };

      };

      <span class="keywordflow">if</span> ($anyFail) {

         <span class="keywordflow">if</span> ($this-&gt;_blRedirectOnConstraintFailure) {

            $targetURL = $_SERVER[<span class="stringliteral">&quot;PHP_SELF&quot;</span>];
            <span class="keywordflow">if</span> (!$targetURL) {
               $targetURL = $this-&gt;_strConstraintFailureDefaultRedirectTargetURL;
            };
            <span class="keywordflow">if</span> ($this-&gt;_strConstraintFailureRedirectTargetURL) {
               $targetURL = $this-&gt;_strConstraintFailureRedirectTargetURL;
            };
            <span class="keywordflow">if</span> ($targetURL) {
               $objToSerialize = $this;
               $strSerialization = serialize($objToSerialize);
               <span class="comment">//setcookie (&quot;phprqcOriginalRequestObject&quot;, $strSerialization, time() + 3600,&#39;/&#39;);</span>
               $_SESSION[<span class="stringliteral">&#39;RESPUESTA_ERRONEA&#39;</span>] = $strSerialization;
               header(<span class="stringliteral">&quot;Location: $targetURL&quot;</span>);
               exit(0);
            };
         };
      };
      <span class="keywordflow">return</span>(!($anyFail));  <span class="comment">// Returns TRUE if all tests passed, otherwise returns</span>
      <span class="comment">//  FALSE</span>
   }
</pre></div>
</div>
</div>
    </td>
  </tr>
</table>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generado el Jueves, 22 de Noviembre de 2012 18:21:37 para gcm por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>

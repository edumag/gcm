<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gcm: Fichero Fuente gcm/modulos/contenidos/lib/ContenidosAbstract.php</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />

<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="../../search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="gcm"/>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gcm
   &#160;<span id="projectnumber">3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generado por Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Buscar');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Página&#160;principal</span></a></li>
      <li><a href="../../pages.html"><span>Páginas&#160;relacionadas</span></a></li>
      <li><a href="../../modules.html"><span>Módulos</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Estructuras&#160;de&#160;Datos</span></a></li>
      <li class="current"><a href="../../files.html"><span>Archivos</span></a></li>
      <li><a href="../../dirs.html"><span>Directorios</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="../../search.php" method="get">
              <img id="MSearchSelect" src="../../search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Buscar" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>Lista&#160;de&#160;archivos</span></a></li>
      <li><a href="../../globals.html"><span>Globales</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../dir_7220247a7eb7348af0158c165feaa73e.html">gcm</a>      </li>
      <li class="navelem"><a class="el" href="../../dir_68a9a62338f056989803ab8fbb9b88d5.html">modulos</a>      </li>
      <li class="navelem"><a class="el" href="../../dir_564572b1ce5d7fe7ca8c92124076e676.html">contenidos</a>      </li>
      <li class="navelem"><a class="el" href="../../dir_1c57f582eabe266eb86264e5b75dfa55.html">lib</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">ContenidosAbstract.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">/**</span>
<a name="l00004"></a>00004 <span class="comment"> * @file      Contenidos.php</span>
<a name="l00005"></a>00005 <span class="comment"> * @brief     Clase abstracta para ContenidosFile y ContenidosPDO</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * @author    Eduardo Magrané </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * @internal</span>
<a name="l00010"></a>00010 <span class="comment"> *   Created  15/04/10</span>
<a name="l00011"></a>00011 <span class="comment"> *  Revision  SVN $Id: Contenidos.php 373 2010-10-08 14:41:09Z eduardo $</span>
<a name="l00012"></a>00012 <span class="comment"> * Copyright  Copyright (c) 2010, Eduardo Magrané</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This source code is released for free distribution under the terms of the</span>
<a name="l00015"></a>00015 <span class="comment"> * GNU General Public License as published by the Free Software Foundation.</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keywordflow">if</span> ( defined(<span class="stringliteral">&#39;GCM_DIR&#39;</span>) === FALSE ) define(<span class="stringliteral">&#39;GCM_DIR&#39;</span>,dirname(__FILE__).<span class="stringliteral">&#39;/../../../&#39;</span>);
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">/** Utiles de Gcm */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 require_once(GCM_DIR.<span class="stringliteral">&#39;lib/int/gcm/lib/GUtil.php&#39;</span>);
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">/** Contenidos</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> * Clase para manejar el contenido</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> * @package Contenidos Gestión de contenido</span>
<a name="l00029"></a>00029 <span class="comment"> * @author Eduardo Magrané</span>
<a name="l00030"></a>00030 <span class="comment"> * @version 0.1</span>
<a name="l00031"></a>00031 <span class="comment"> * </span>
<a name="l00032"></a>00032 <span class="comment"> */</span>
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="../../d1/d2b/a00018.html">00034</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="../../d1/d2b/a00018.html">ContenidosAbstract</a> <span class="keyword">extends</span> <a class="code" href="../../d2/dee/a00049.html" title="Interface para los módulos.">Modulos</a> {
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="../../d1/d2b/a00018_abd2b45b666af079d421f8e12509c1381.html#abd2b45b666af079d421f8e12509c1381">00036</a>    <span class="keyword">public</span> <a class="code" href="../../d1/d2b/a00018_abd2b45b666af079d421f8e12509c1381.html#abd2b45b666af079d421f8e12509c1381" title="Archivos o directorios a descartar.">$descartar</a>;                          <span class="comment">///&lt; Archivos o directorios a descartar</span>
<a name="l00037"></a>00037 <span class="comment"></span>
<a name="l00038"></a><a class="code" href="../../d1/d2b/a00018_a095c5d389db211932136b53f25f39685.html#a095c5d389db211932136b53f25f39685">00038</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a095c5d389db211932136b53f25f39685.html#a095c5d389db211932136b53f25f39685" title="Iniciamón módulos.">__construct</a>() { 
<a name="l00039"></a>00039 
<a name="l00040"></a>00040       <a class="code" href="../../d1/d2b/a00018_a095c5d389db211932136b53f25f39685.html#a095c5d389db211932136b53f25f39685" title="Iniciamón módulos.">parent::__construct</a>(); 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042       $this-&gt;descartar = $this-&gt;<a class="code" href="../../d2/dee/a00049_a841e8831c531eb620a850d7cbbfe1acc.html#a841e8831c531eb620a850d7cbbfe1acc" title="Añadir o modificar elemento de configuración.">config</a>(<span class="stringliteral">&#39;descartar&#39;</span>);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044       }
<a name="l00045"></a>00045 <span class="comment"></span>
<a name="l00046"></a>00046 <span class="comment">   /** guardar el contenido */</span>
<a name="l00047"></a>00047    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a79b72ba8b6228dd2595664afd7bac04f.html#a79b72ba8b6228dd2595664afd7bac04f" title="guardar el contenido">guardar_contenido</a>($url, $contenido);
<a name="l00048"></a>00048 <span class="comment"></span>
<a name="l00049"></a>00049 <span class="comment">   /** devolver contenido de documento */</span>
<a name="l00050"></a>00050    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a01a699ecec56f859e4f3f8d9c9711d26.html#a01a699ecec56f859e4f3f8d9c9711d26" title="devolver contenido de documento">getContenido</a>($ruta);
<a name="l00051"></a>00051 <span class="comment"></span>
<a name="l00052"></a>00052 <span class="comment">   /** devolver titulo de contenido */</span>
<a name="l00053"></a>00053    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_add12a2bc5514d2d8b3c3cd4438996e06.html#add12a2bc5514d2d8b3c3cd4438996e06" title="devolver titulo de contenido">devolver_titulo</a>($url=NULL);
<a name="l00054"></a>00054 <span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment">   /** Verificar sección */</span>
<a name="l00056"></a>00056    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a9c2786dcc3c14a4478e58e72b84a345a.html#a9c2786dcc3c14a4478e58e72b84a345a" title="Verificar sección.">verificar_seccion</a>($url);
<a name="l00057"></a>00057 <span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">   /** Crear un array con el contenido de una sección */</span>
<a name="l00059"></a>00059    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a842918bba92db505b4dfe3dafe6f771d.html#a842918bba92db505b4dfe3dafe6f771d" title="Crear un array con el contenido de una sección.">seccion_matriz</a>($seccion);
<a name="l00060"></a>00060 <span class="comment"></span>
<a name="l00061"></a>00061 <span class="comment">   /** Ejecutar nueva sección */</span>
<a name="l00062"></a>00062    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a6a2d1f11dabb8fa3d49df41c74047398.html#a6a2d1f11dabb8fa3d49df41c74047398" title="Ejecutar nueva sección.">crear_nueva_seccion</a>($ruta);
<a name="l00063"></a>00063 <span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">   /** Verificar contenido */</span>
<a name="l00065"></a>00065    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a204ead297701bbc21223cc8f461b1d29.html#a204ead297701bbc21223cc8f461b1d29" title="Verificar contenido.">verificar_contenido</a>($ruta);
<a name="l00066"></a>00066 <span class="comment"></span>
<a name="l00067"></a>00067 <span class="comment">   /** Borrar contenido */</span>
<a name="l00068"></a>00068    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_ad94330a261474ba3bffd728aacafb99b.html#ad94330a261474ba3bffd728aacafb99b" title="Borrar contenido.">borrar_contenido</a>($ruta);
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">   /** Renombrar sección */</span>
<a name="l00071"></a>00071    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a70ea7c6bbb1b8a01e6d063512e83abd7.html#a70ea7c6bbb1b8a01e6d063512e83abd7" title="Renombrar sección.">renombrar_seccion</a>($ruta_origen, $ruta_destino);
<a name="l00072"></a>00072 <span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">   /** Devolver fecha de modificación de contenido */</span>
<a name="l00074"></a>00074    <span class="keyword">abstract</span> <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_ab8a2be3d77cb89d08d44bf35abd56c62.html#ab8a2be3d77cb89d08d44bf35abd56c62" title="Devolver fecha de modificación de contenido.">getFechaActualizacion</a>($ruta);
<a name="l00075"></a>00075 <span class="comment"></span>
<a name="l00076"></a>00076 <span class="comment">   /**</span>
<a name="l00077"></a>00077 <span class="comment">    * Guardar como </span>
<a name="l00078"></a>00078 <span class="comment">    *</span>
<a name="l00079"></a>00079 <span class="comment">    * Presentamos formulario de sección, formulario de nombre con boton</span>
<a name="l00080"></a>00080 <span class="comment">    * de &#39;guardar&#39; y de &#39;borrador&#39;.</span>
<a name="l00081"></a>00081 <span class="comment">    *</span>
<a name="l00082"></a>00082 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00083"></a>00083 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00084"></a>00084 <span class="comment">    */</span>
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="../../d1/d2b/a00018_a0e91bfea485405797b687ce9f0503e47.html#a0e91bfea485405797b687ce9f0503e47">00086</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a0e91bfea485405797b687ce9f0503e47.html#a0e91bfea485405797b687ce9f0503e47" title="Guardar como.">guardar_como</a>($e, $args) {
<a name="l00087"></a>00087 
<a name="l00088"></a>00088       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00093"></a>00093       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00094"></a>00094       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Guardar como&#39;</span>,3);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       $contenido = $this-&gt;<a class="code" href="../../d1/d2b/a00018_ab42ac597dbea13af15e4e50092cdef3c.html#ab42ac597dbea13af15e4e50092cdef3c" title="Metodo activado para el evento contenido.">devolver_contenido</a>($gcm-&gt;seleccionado[0]);
<a name="l00097"></a>00097       $titulo = $this-&gt;<a class="code" href="../../d1/d2b/a00018_add12a2bc5514d2d8b3c3cd4438996e06.html#add12a2bc5514d2d8b3c3cd4438996e06" title="devolver titulo de contenido">devolver_titulo</a>($gcm-&gt;seleccionado);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_guardar_como.html&#39;</span>));
<a name="l00100"></a>00100 
<a name="l00101"></a>00101       }
<a name="l00102"></a>00102 <span class="comment"></span>
<a name="l00103"></a>00103 <span class="comment">   /**</span>
<a name="l00104"></a>00104 <span class="comment">    * Borrar</span>
<a name="l00105"></a>00105 <span class="comment">    *</span>
<a name="l00106"></a>00106 <span class="comment">    * Comprobar que es lo que se desea borrar y presentar lista con</span>
<a name="l00107"></a>00107 <span class="comment">    * el contenido a borrar con boton de confirmación que nos llevara</span>
<a name="l00108"></a>00108 <span class="comment">    * al evento &#39;ejecutar_borrado&#39;</span>
<a name="l00109"></a>00109 <span class="comment">    *</span>
<a name="l00110"></a>00110 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00111"></a>00111 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00112"></a>00112 <span class="comment">    */</span>
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="../../d1/d2b/a00018_a4cd208bd5924186bcd702e52b81b0004.html#a4cd208bd5924186bcd702e52b81b0004">00114</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a4cd208bd5924186bcd702e52b81b0004.html#a4cd208bd5924186bcd702e52b81b0004" title="Borrar.">borrar</a>($e, $args) {
<a name="l00115"></a>00115 
<a name="l00116"></a>00116       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118       global <a class="code" href="../../df/d5d/a00084_a546a5e7bea120c9a754f586c26764075.html#a546a5e7bea120c9a754f586c26764075" title="Literales de gcm.">$GCM_LG</a>, <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a> ;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00121"></a>00121       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Confirmar lista de contenidos a borrar&#39;</span>);
<a name="l00122"></a>00122       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124       <span class="comment">/* Relación de cosas afectadas por el borrado de una sección:</span>
<a name="l00125"></a>00125 <span class="comment">       *</span>
<a name="l00126"></a>00126 <span class="comment">       * buscar todo el contenido afectado por el borrado incluyendo el de otros idiomas.</span>
<a name="l00127"></a>00127 <span class="comment">       */</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129       $contenidos_borrar = $this-&gt;<a class="code" href="../../d1/d2b/a00018_a842918bba92db505b4dfe3dafe6f771d.html#a842918bba92db505b4dfe3dafe6f771d" title="Crear un array con el contenido de una sección.">seccion_matriz</a>($gcm-&gt;seleccionado);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131       <span class="keywordflow">if</span> ( empty($contenidos_borrar)  ) {
<a name="l00132"></a>00132 
<a name="l00133"></a>00133          registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;No existe contenido seleccionado para borrar&#39;</span>,<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00134"></a>00134          <span class="keywordflow">return</span> FALSE;
<a name="l00135"></a>00135          }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_borrar.html&#39;</span>));
<a name="l00138"></a>00138 
<a name="l00139"></a>00139       }
<a name="l00140"></a>00140 <span class="comment"></span>
<a name="l00141"></a>00141 <span class="comment">   /**</span>
<a name="l00142"></a>00142 <span class="comment">    * editar</span>
<a name="l00143"></a>00143 <span class="comment">    *</span>
<a name="l00144"></a>00144 <span class="comment">    * Presentamos formulario para editar contenido.</span>
<a name="l00145"></a>00145 <span class="comment">    *</span>
<a name="l00146"></a>00146 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00147"></a>00147 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00148"></a>00148 <span class="comment">    */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="../../d1/d2b/a00018_ad1f824b8d4040650108e00fde0a22728.html#ad1f824b8d4040650108e00fde0a22728">00150</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_ad1f824b8d4040650108e00fde0a22728.html#ad1f824b8d4040650108e00fde0a22728" title="editar">editar</a>($e, $args) {
<a name="l00151"></a>00151 
<a name="l00152"></a>00152       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158       $contenido = $this-&gt;<a class="code" href="../../d1/d2b/a00018_ab42ac597dbea13af15e4e50092cdef3c.html#ab42ac597dbea13af15e4e50092cdef3c" title="Metodo activado para el evento contenido.">devolver_contenido</a>();
<a name="l00159"></a>00159 
<a name="l00160"></a>00160       <span class="keywordflow">switch</span>($e) {
<a name="l00161"></a>00161 
<a name="l00162"></a>00162          <span class="keywordflow">case</span> <span class="stringliteral">&#39;traducir&#39;</span>:
<a name="l00163"></a>00163             $titulo = $this-&gt;<a class="code" href="../../d1/d2b/a00018_add12a2bc5514d2d8b3c3cd4438996e06.html#add12a2bc5514d2d8b3c3cd4438996e06" title="devolver titulo de contenido">devolver_titulo</a>();
<a name="l00164"></a>00164             $evento = <span class="stringliteral">&#39;ejecutar_traducir&#39;</span>;
<a name="l00165"></a>00165             $boton  = <span class="stringliteral">&#39;Traducir&#39;</span>;
<a name="l00166"></a>00166             <span class="keywordflow">break</span>;
<a name="l00167"></a>00167          <span class="keywordflow">default</span>:
<a name="l00168"></a>00168             $evento = <span class="stringliteral">&#39;actualizar_contenido&#39;</span>;
<a name="l00169"></a>00169             $boton  = <span class="stringliteral">&#39;Guardar&#39;</span>;
<a name="l00170"></a>00170             <span class="keywordflow">break</span>;
<a name="l00171"></a>00171          }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_editar.html&#39;</span>));
<a name="l00174"></a>00174 
<a name="l00175"></a>00175       }
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">   /**</span>
<a name="l00178"></a>00178 <span class="comment">    * Mover o cambiar de nombre</span>
<a name="l00179"></a>00179 <span class="comment">    *</span>
<a name="l00180"></a>00180 <span class="comment">    * Presentamos formulario de secciones y formulario para el titulo.</span>
<a name="l00181"></a>00181 <span class="comment">    * con boton de evento &#39;ejecutar_mover&#39;.</span>
<a name="l00182"></a>00182 <span class="comment">    *</span>
<a name="l00183"></a>00183 <span class="comment">    * Añadimos en el formularios campo oculto _POST[&#39;original&#39;] con url </span>
<a name="l00184"></a>00184 <span class="comment">    * de contenido original que se mueve para poderlo utilizar en los módulos.</span>
<a name="l00185"></a>00185 <span class="comment">    *</span>
<a name="l00186"></a>00186 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00187"></a>00187 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00188"></a>00188 <span class="comment">    */</span>
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="../../d1/d2b/a00018_af6dbfe8acf929f072b84bd5bd43af893.html#af6dbfe8acf929f072b84bd5bd43af893">00190</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_af6dbfe8acf929f072b84bd5bd43af893.html#af6dbfe8acf929f072b84bd5bd43af893" title="Mover o cambiar de nombre.">mover</a>($e, $args) {
<a name="l00191"></a>00191 
<a name="l00192"></a>00192       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196       $contenido = $this-&gt;<a class="code" href="../../d1/d2b/a00018_ab42ac597dbea13af15e4e50092cdef3c.html#ab42ac597dbea13af15e4e50092cdef3c" title="Metodo activado para el evento contenido.">devolver_contenido</a>($gcm-&gt;seleccionado[0]);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198       $titulo = $this-&gt;<a class="code" href="../../d1/d2b/a00018_add12a2bc5514d2d8b3c3cd4438996e06.html#add12a2bc5514d2d8b3c3cd4438996e06" title="devolver titulo de contenido">devolver_titulo</a>($gcm-&gt;seleccionado[0]);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200       $gcm-&gt;router-&gt;inicia($gcm-&gt;seleccionado[0]);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00203"></a>00203       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00204"></a>00204       $gcm-&gt;titulo = $titulo;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_mover.html&#39;</span>));
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       }
<a name="l00209"></a>00209 <span class="comment"></span>
<a name="l00210"></a>00210 <span class="comment">   /**</span>
<a name="l00211"></a>00211 <span class="comment">    * Contenido nuevo</span>
<a name="l00212"></a>00212 <span class="comment">    *</span>
<a name="l00213"></a>00213 <span class="comment">    * Presentar formulario de secciones, de título, de contenido y boton de &#39;ejecutar_nuevo&#39;</span>
<a name="l00214"></a>00214 <span class="comment">    *</span>
<a name="l00215"></a>00215 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00216"></a>00216 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00217"></a>00217 <span class="comment">    */</span>
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="../../d1/d2b/a00018_a53c79fb30c99548c2fc3096119a56d48.html#a53c79fb30c99548c2fc3096119a56d48">00219</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a53c79fb30c99548c2fc3096119a56d48.html#a53c79fb30c99548c2fc3096119a56d48" title="Contenido nuevo.">nuevo</a>($e, $args) {
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227       $titulo = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00228"></a>00228       $contenido = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_nuevo.html&#39;</span>));
<a name="l00231"></a>00231 
<a name="l00232"></a>00232       }
<a name="l00233"></a>00233 <span class="comment"></span>
<a name="l00234"></a>00234 <span class="comment">   /**</span>
<a name="l00235"></a>00235 <span class="comment">    * Presentar contenido</span>
<a name="l00236"></a>00236 <span class="comment">    *</span>
<a name="l00237"></a>00237 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00238"></a>00238 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00239"></a>00239 <span class="comment">    */</span>
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="../../d1/d2b/a00018_a255122ce979887ec179cfb898787e1c6.html#a255122ce979887ec179cfb898787e1c6">00241</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a255122ce979887ec179cfb898787e1c6.html#a255122ce979887ec179cfb898787e1c6" title="Presentar contenido.">contenido</a>($e, $args) {
<a name="l00242"></a>00242 
<a name="l00243"></a>00243       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247       <span class="comment">/* Si se pide en otro idioma que no es el predeterminado y no lo tenemos */</span>
<a name="l00248"></a>00248 
<a name="l00249"></a>00249       <span class="keywordflow">if</span> ( <a class="code" href="../../d4/de8/a00061_a8c1c864e7f0c6e71717c038396765bb8.html#a8c1c864e7f0c6e71717c038396765bb8" title="En caso de pedirse un texto en idioma no predeterminado y no tenerlo.">Router::$sin_traduccion</a> ) {
<a name="l00250"></a>00250          registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&#39;Contenido pendiente de traducción&#39;</span>,3),<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00251"></a>00251          }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       $contenido = $this-&gt;<a class="code" href="../../d1/d2b/a00018_ab42ac597dbea13af15e4e50092cdef3c.html#ab42ac597dbea13af15e4e50092cdef3c" title="Metodo activado para el evento contenido.">devolver_contenido</a>(<a class="code" href="../../d4/de8/a00061_a23c42e7d231a63025b55e4eb7e3d4c99.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Url del contenido que se pide.">Router::$f</a>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       <span class="comment">// si el formato es ajax deberiamos convertir los enlaces relativos en absolutos</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257       <span class="keywordflow">if</span> ( <a class="code" href="../../d4/de8/a00061_a5972ce25233a2f1fcd6d68a139b28f71.html#a5972ce25233a2f1fcd6d68a139b28f71" title="Formato de presentación, ejemplo html, ajax, rss, etc...">Router::$formato</a> == <span class="stringliteral">&#39;ajax&#39;</span>  ) {
<a name="l00258"></a>00258 
<a name="l00259"></a>00259          $base = dirname(<a class="code" href="../../d4/de8/a00061_acf215f34a917d014776ce684a9ee8909.html#acf215f34a917d014776ce684a9ee8909" title="Url que nos llega.">Router::$url</a>).<span class="charliteral">&#39;/&#39;</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261          $buffer = $contenido;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263          $patron = <span class="stringliteral">&#39;/src=[&quot;\&#39;](.*?)[&quot;\&#39;]/&#39;</span>;
<a name="l00264"></a>00264          $sustitucion = <span class="stringliteral">&#39;src=&quot;&#39;</span>.$base.<span class="stringliteral">&#39;${1}&quot;&#39;</span>;
<a name="l00265"></a>00265          $buffer = preg_replace($patron, $sustitucion, $buffer,-1,$numero);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267          registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.<a class="code" href="../../db/d57/a00112_a7031d9d8dc6290aa33d665d7daced6c8.html#a7031d9d8dc6290aa33d665d7daced6c8" title="Formatemaos salida de array.">depurar</a>($args).<span class="stringliteral">&#39;) Numero de sustituciones: &#39;</span>.$numero );
<a name="l00268"></a>00268          $gcm-&gt;contenido=$buffer;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270       } <span class="keywordflow">else</span> {
<a name="l00271"></a>00271          echo $contenido;
<a name="l00272"></a>00272          }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274       }
<a name="l00275"></a>00275 <span class="comment"></span>
<a name="l00276"></a>00276 <span class="comment">   /**</span>
<a name="l00277"></a>00277 <span class="comment">    * Sin Contenido</span>
<a name="l00278"></a>00278 <span class="comment">    *</span>
<a name="l00279"></a>00279 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00280"></a>00280 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00281"></a>00281 <span class="comment">    */</span>
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="../../d1/d2b/a00018_a9dc91ab436cb166ae1675159521e5ddb.html#a9dc91ab436cb166ae1675159521e5ddb">00283</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a9dc91ab436cb166ae1675159521e5ddb.html#a9dc91ab436cb166ae1675159521e5ddb" title="Sin Contenido.">sin_contenido</a>($e, $args) {
<a name="l00284"></a>00284 
<a name="l00285"></a>00285       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Sin Contenido&#39;</span>,3);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       $ruta = $gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;temas&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;sin_contenido.html&#39;</span>);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293       registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&#39;Contenido&#39;</span>).<span class="stringliteral">&#39; [&#39;</span>.<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>.<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>.<span class="stringliteral">&#39;] &#39;</span>.literal(<span class="stringliteral">&#39;no encontrado&#39;</span>,3),<span class="stringliteral">&#39;ERROR&#39;</span>);
<a name="l00294"></a>00294       <span class="keywordflow">return</span>;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296       <span class="keywordflow">if</span> ( $ruta ) {
<a name="l00297"></a>00297          include($ruta);
<a name="l00298"></a>00298       } <span class="keywordflow">else</span> {
<a name="l00299"></a>00299          registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&#39;Contenido no encontrado&#39;</span>,3),<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00300"></a>00300          }
<a name="l00301"></a>00301       
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303 <span class="comment"></span>
<a name="l00304"></a>00304 <span class="comment">   /**</span>
<a name="l00305"></a>00305 <span class="comment">    * Sin Sección</span>
<a name="l00306"></a>00306 <span class="comment">    *</span>
<a name="l00307"></a>00307 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00308"></a>00308 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00309"></a>00309 <span class="comment">    */</span>
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="../../d1/d2b/a00018_aff151220743101aa7ce8a7b614d2e478.html#aff151220743101aa7ce8a7b614d2e478">00311</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_aff151220743101aa7ce8a7b614d2e478.html#aff151220743101aa7ce8a7b614d2e478" title="Sin Sección.">sin_seccion</a>($e, $args) {
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317       <span class="comment">// Comprobar que tenemos los directorios base creados</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319       <span class="keywordflow">if</span> ( file_exists(<a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>) ) {
<a name="l00320"></a>00320          $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Sin sección&#39;</span>,3);
<a name="l00321"></a>00321          registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&#39;Sección&#39;</span>,3).<span class="stringliteral">&#39; [&#39;</span>.<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>.<span class="stringliteral">&#39;] &#39;</span>.literal(<span class="stringliteral">&#39;no encontrada&#39;</span>,3),<span class="stringliteral">&#39;ERROR&#39;</span>);
<a name="l00322"></a>00322       } <span class="keywordflow">else</span> {
<a name="l00323"></a>00323          registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&#39;Creamos directorio para contenido&#39;</span>,3).<span class="stringliteral">&#39; [&#39;</span>.<a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>.<span class="charliteral">&#39;]&#39;</span>,<span class="stringliteral">&#39;ERROR&#39;</span>);
<a name="l00324"></a>00324          <a class="code" href="../../db/d57/a00112_a64a0dcf7a28d2b6acb2ee72e6b9b27b9.html#a64a0dcf7a28d2b6acb2ee72e6b9b27b9" title="Creación de un directorio y sus subdirectorios si es necesario.">mkdir_recursivo</a>(<a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>);
<a name="l00325"></a>00325          }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       <span class="keywordflow">return</span>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329       $ruta = $gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;temas&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;sin_seccion.html&#39;</span>);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       <span class="keywordflow">if</span> ( $ruta ) {
<a name="l00332"></a>00332          include($ruta);
<a name="l00333"></a>00333       } <span class="keywordflow">else</span> {
<a name="l00334"></a>00334          registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&#39;Sección no encontrada&#39;</span>,3),<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00335"></a>00335          }
<a name="l00336"></a>00336       
<a name="l00337"></a>00337       }
<a name="l00338"></a>00338 <span class="comment"></span>
<a name="l00339"></a>00339 <span class="comment">   /**</span>
<a name="l00340"></a>00340 <span class="comment">    * Presentar titulo</span>
<a name="l00341"></a>00341 <span class="comment">    *</span>
<a name="l00342"></a>00342 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00343"></a>00343 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00344"></a>00344 <span class="comment">    */</span>
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="../../d1/d2b/a00018_ad038b7f11180f11835db17c460257c30.html#ad038b7f11180f11835db17c460257c30">00346</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_ad038b7f11180f11835db17c460257c30.html#ad038b7f11180f11835db17c460257c30" title="Presentar titulo.">titulo</a>($e, $args) {
<a name="l00347"></a>00347 
<a name="l00348"></a>00348       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350       $this-&gt;<a class="code" href="../../d1/d2b/a00018_a00b468dfbc4c6523b9e68c65731c8268.html#a00b468dfbc4c6523b9e68c65731c8268" title="Título de artículo.">titulo_articulo</a>();
<a name="l00351"></a>00351       }
<a name="l00352"></a>00352 <span class="comment"></span>
<a name="l00353"></a>00353 <span class="comment">   /**</span>
<a name="l00354"></a>00354 <span class="comment">    * camino, presentar recorrido desde el inicio hasta el documento actual </span>
<a name="l00355"></a>00355 <span class="comment">    * con los enlaces a cada sección</span>
<a name="l00356"></a>00356 <span class="comment">    *</span>
<a name="l00357"></a>00357 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00358"></a>00358 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00359"></a>00359 <span class="comment">    */</span>
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="../../d1/d2b/a00018_a72ec6b32fc5d5e4d60d98a09fa190852.html#a72ec6b32fc5d5e4d60d98a09fa190852">00361</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a72ec6b32fc5d5e4d60d98a09fa190852.html#a72ec6b32fc5d5e4d60d98a09fa190852" title="camino, presentar recorrido desde el inicio hasta el documento actual con los enlaces a cada sección...">camino</a>($e , $args=NULL) {
<a name="l00362"></a>00362 
<a name="l00363"></a>00363       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367       <span class="comment">// $camino = ( $url  ) ? $url : Router::$s;</span>
<a name="l00368"></a>00368       $camino = explode(<span class="charliteral">&#39;/&#39;</span>,<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;camino.html&#39;</span>));
<a name="l00371"></a>00371 
<a name="l00372"></a>00372       }
<a name="l00373"></a>00373 <span class="comment"></span>
<a name="l00374"></a>00374 <span class="comment">   /**</span>
<a name="l00375"></a>00375 <span class="comment">    * Crear una nueva sección</span>
<a name="l00376"></a>00376 <span class="comment">    *</span>
<a name="l00377"></a>00377 <span class="comment">    * Presentamos formularios para seleccionar sección y el de titulo de sección</span>
<a name="l00378"></a>00378 <span class="comment">    * y boton de &#39;ejecutar_nueva_seccion&#39;</span>
<a name="l00379"></a>00379 <span class="comment">    *</span>
<a name="l00380"></a>00380 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00381"></a>00381 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00382"></a>00382 <span class="comment">    */</span>
<a name="l00383"></a>00383 
<a name="l00384"></a><a class="code" href="../../d1/d2b/a00018_a030b2e550c244b2a638182129aa95f7b.html#a030b2e550c244b2a638182129aa95f7b">00384</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a030b2e550c244b2a638182129aa95f7b.html#a030b2e550c244b2a638182129aa95f7b" title="Crear una nueva sección.">nueva_seccion</a>($e, $args) {
<a name="l00385"></a>00385 
<a name="l00386"></a>00386       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00389"></a>00389 
<a name="l00390"></a>00390       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00391"></a>00391       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00392"></a>00392       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Nueva sección&#39;</span>);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_nueva_seccion.html&#39;</span>));
<a name="l00395"></a>00395 
<a name="l00396"></a>00396       }
<a name="l00397"></a>00397 <span class="comment"></span>
<a name="l00398"></a>00398 <span class="comment">   /**</span>
<a name="l00399"></a>00399 <span class="comment">    * Mover o renombrar sección</span>
<a name="l00400"></a>00400 <span class="comment">    *</span>
<a name="l00401"></a>00401 <span class="comment">    * Se presenta formulario para selecccionar donde se mueve la sección y formulario</span>
<a name="l00402"></a>00402 <span class="comment">    * de nombre de sección. Con boton de accion=ejecutar_mover_seccion</span>
<a name="l00403"></a>00403 <span class="comment">    *</span>
<a name="l00404"></a>00404 <span class="comment">    * @param $e evento que llama al metodo</span>
<a name="l00405"></a>00405 <span class="comment">    * @param $args Argumentos con formato &quot;num=7&amp;seccion=&quot;.Router::$s.&quot;&amp;formato=1&quot;</span>
<a name="l00406"></a>00406 <span class="comment">    */</span>
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="../../d1/d2b/a00018_a83c92f710466a71e6df64c69b2da4974.html#a83c92f710466a71e6df64c69b2da4974">00408</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a83c92f710466a71e6df64c69b2da4974.html#a83c92f710466a71e6df64c69b2da4974" title="Mover o renombrar sección.">mover_seccion</a>($e, $args) {
<a name="l00409"></a>00409 
<a name="l00410"></a>00410       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.$args.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00415"></a>00415       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00416"></a>00416       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Mover o renombrar sección&#39;</span>);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       $titulo_seccion = <a class="code" href="../../db/d57/a00112_a6ab4ae106b6ebf5769bc3390aa8ac287.html#a6ab4ae106b6ebf5769bc3390aa8ac287" title="comprobar_barra()">comprobar_barra</a>(basename(<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>),<span class="stringliteral">&#39;eliminar&#39;</span>);
<a name="l00419"></a>00419       $titulo_seccion = literal($titulo_seccion);
<a name="l00420"></a>00420       <span class="comment">// Descartamos mover sobre la misma sección</span>
<a name="l00421"></a>00421       $seccion_descartada = <a class="code" href="../../db/d57/a00112_a6ab4ae106b6ebf5769bc3390aa8ac287.html#a6ab4ae106b6ebf5769bc3390aa8ac287" title="comprobar_barra()">comprobar_barra</a>(<a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>.str_replace($titulo_seccion,<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>));
<a name="l00422"></a>00422       $seccion_seleccionada = FALSE;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_mover_seccion.html&#39;</span>));
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       }
<a name="l00427"></a>00427 <span class="comment"></span>
<a name="l00428"></a>00428 <span class="comment">   /**</span>
<a name="l00429"></a>00429 <span class="comment">    * enrutar</span>
<a name="l00430"></a>00430 <span class="comment">    *</span>
<a name="l00431"></a>00431 <span class="comment">    * Una vez realizados todas las acciones sobre cambios en el contenido</span>
<a name="l00432"></a>00432 <span class="comment">    * nos vamos a la pagina nueva.</span>
<a name="l00433"></a>00433 <span class="comment">    *</span>
<a name="l00434"></a>00434 <span class="comment">    * Por ejemplo en caso de un cambio de nombre al recargar la página daria un error</span>
<a name="l00435"></a>00435 <span class="comment">    * por no encontrar el contenido. Con este sistema permitimos que haya dos pasos:</span>
<a name="l00436"></a>00436 <span class="comment">    *</span>
<a name="l00437"></a>00437 <span class="comment">    * 1) el cambio de nombre del contenido y</span>
<a name="l00438"></a>00438 <span class="comment">    * 2) la recarga de la página para que vaya al nuevo contenido.</span>
<a name="l00439"></a>00439 <span class="comment">    *</span>
<a name="l00440"></a>00440 <span class="comment">    * Entre el paso 1 y 2 los módulos pueden realizar sus acciones pertinentes.</span>
<a name="l00441"></a>00441 <span class="comment">    *</span>
<a name="l00442"></a>00442 <span class="comment">    * Con este sistema evitamos que al recargar la página se repitan acciones indeseadas.</span>
<a name="l00443"></a>00443 <span class="comment">    *</span>
<a name="l00444"></a>00444 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00445"></a>00445 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00446"></a>00446 <span class="comment">    */</span>
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="../../d1/d2b/a00018_a3081755673df482563a2d743e696cea5.html#a3081755673df482563a2d743e696cea5">00448</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a3081755673df482563a2d743e696cea5.html#a3081755673df482563a2d743e696cea5" title="enrutar">enrutar</a>($e, $args) {
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452       registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;Enrutar desde evento: [&#39;</span>.$e.<span class="charliteral">&#39;]&#39;</span>);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454       <span class="comment">/* SI estamos en debug no enrutamos para poder tener a mono los mensajes </span>
<a name="l00455"></a>00455 <span class="comment">       * de la aplicación </span>
<a name="l00456"></a>00456 <span class="comment">       */</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       <span class="keywordflow">if</span> ( GCM_DEBUG ) {
<a name="l00459"></a>00459          <span class="comment">//registrar(__FILE__,__LINE__,&#39;Enrutar desde evento: [&#39;.$e.&#39;] Desde debug no enrutamos &lt;a href=&quot;&#39;.Router::$dir.Router::$url.&#39;?mens=&#39;.$gcm-&gt;reg-&gt;sesion.&#39;&quot;&gt;[enrutar]&lt;/a&gt;&#39;,&#39;ADMIN&#39;);</span>
<a name="l00460"></a>00460          echo <span class="stringliteral">&#39;&lt;div class=&quot;aviso&quot;&gt;Enrutar desde evento: [&#39;</span>.$e.<span class="stringliteral">&#39;] Desde debug no enrutamos &lt;a href=&quot;&#39;</span>.<a class="code" href="../../d4/de8/a00061_a1659f0a629d408e0f849dbe4ee061e62.html#a1659f0a629d408e0f849dbe4ee061e62" title="Base de url relativa al directorio.">Router::$dir</a>.Router::$url.<span class="stringliteral">&#39;?mens=&#39;</span>.$gcm-&gt;reg-&gt;sesion.<span class="stringliteral">&#39;&quot;&gt;[enrutar]&lt;/a&gt;&lt;/div&gt;&#39;</span>;
<a name="l00461"></a>00461          <span class="keywordflow">return</span>;
<a name="l00462"></a>00462          }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 
<a name="l00465"></a>00465       <span class="keywordflow">switch</span> ($e) {
<a name="l00466"></a>00466 
<a name="l00467"></a>00467          <span class="keywordflow">case</span> <span class="stringliteral">&#39;postejecutar_borrar&#39;</span>:
<a name="l00468"></a>00468 
<a name="l00469"></a>00469             $url = <a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>.Router::$c;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471             <span class="comment">/* Si la pagina actual ha sido una de las borradas subimos arriba */</span>
<a name="l00472"></a>00472 
<a name="l00473"></a>00473             <span class="keywordflow">while</span> ( ! file_exists($url) ) {
<a name="l00474"></a>00474                <span class="keywordflow">if</span> ( $url == <span class="stringliteral">&#39;&#39;</span> || $url == <span class="charliteral">&#39;/&#39;</span>  ) {
<a name="l00475"></a>00475                   $url=<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>;
<a name="l00476"></a>00476                   <span class="keywordflow">break</span>;
<a name="l00477"></a>00477                   }
<a name="l00478"></a>00478                $secs = explode(<span class="charliteral">&#39;/&#39;</span>,$url);
<a name="l00479"></a>00479                <span class="keywordflow">if</span> ( isset($secs[count($secs)-1])  ) {
<a name="l00480"></a>00480                   unset($secs[count($secs)-1]);
<a name="l00481"></a>00481                } <span class="keywordflow">else</span> {
<a name="l00482"></a>00482                   $url = <a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>;
<a name="l00483"></a>00483                   <span class="keywordflow">break</span>;
<a name="l00484"></a>00484                   }
<a name="l00485"></a>00485                $url = implode(<span class="charliteral">&#39;/&#39;</span>,$secs);
<a name="l00486"></a>00486                }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488             $url = str_replace(<a class="code" href="../../d4/de8/a00061_a0cf5dd496d9f5ff1edf00d234771dcfe.html#a0cf5dd496d9f5ff1edf00d234771dcfe" title="Directorio con idioma actual.">Router::$d</a>,<span class="stringliteral">&#39;&#39;</span>,$url);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490             $gcm-&gt;router-&gt;inicia($url);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492             header (<span class="stringliteral">&quot;Location:&quot;</span>.<a class="code" href="../../d4/de8/a00061_a1659f0a629d408e0f849dbe4ee061e62.html#a1659f0a629d408e0f849dbe4ee061e62" title="Base de url relativa al directorio.">Router::$dir</a>.<a class="code" href="../../d4/de8/a00061_acf215f34a917d014776ce684a9ee8909.html#acf215f34a917d014776ce684a9ee8909" title="Url que nos llega.">Router::$url</a>);
<a name="l00493"></a>00493             exit();
<a name="l00494"></a>00494             <span class="keywordflow">break</span>;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496          <span class="keywordflow">default</span>:
<a name="l00497"></a>00497             header (<span class="stringliteral">&quot;Location:&quot;</span>.<a class="code" href="../../d4/de8/a00061_a1659f0a629d408e0f849dbe4ee061e62.html#a1659f0a629d408e0f849dbe4ee061e62" title="Base de url relativa al directorio.">Router::$dir</a>.Router::$url);
<a name="l00498"></a>00498             exit();
<a name="l00499"></a>00499             <span class="keywordflow">break</span>;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501          }
<a name="l00502"></a>00502       }
<a name="l00503"></a>00503 <span class="comment"></span>
<a name="l00504"></a>00504 <span class="comment">   /** Actualizar contenido</span>
<a name="l00505"></a>00505 <span class="comment">    *</span>
<a name="l00506"></a>00506 <span class="comment">    * Guardar documento </span>
<a name="l00507"></a>00507 <span class="comment">    *</span>
<a name="l00508"></a>00508 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00509"></a>00509 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00510"></a>00510 <span class="comment">    */</span>
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="../../d1/d2b/a00018_a081a5a215f13ad85be3ff21168cbb69b.html#a081a5a215f13ad85be3ff21168cbb69b">00512</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a081a5a215f13ad85be3ff21168cbb69b.html#a081a5a215f13ad85be3ff21168cbb69b" title="Actualizar contenido.">guardar</a>($e, $args) {
<a name="l00513"></a>00513 
<a name="l00514"></a>00514       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.<a class="code" href="../../db/d57/a00112_a7031d9d8dc6290aa33d665d7daced6c8.html#a7031d9d8dc6290aa33d665d7daced6c8" title="Formatemaos salida de array.">depurar</a>($args).<span class="charliteral">&#39;)&#39;</span>);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518       <a class="code" href="../../db/d57/a00112_a5056a3ee6f23afd1d1585b8185b746f3.html#a5056a3ee6f23afd1d1585b8185b746f3" title="Determinar si tiene un rol con los permisos especificados para la acción.">permiso</a>(<span class="stringliteral">&#39;editar_contenido&#39;</span>);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520       $contenido = $_POST[<span class="stringliteral">&#39;areaTexto&#39;</span>];
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       <span class="keywordflow">switch</span>($e) {
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a>00525          <span class="keywordflow">case</span> <span class="stringliteral">&#39;ejecutar_traducir&#39;</span>:
<a name="l00526"></a>00526 
<a name="l00527"></a>00527             $this-&gt;<a class="code" href="../../d1/d2b/a00018_a6a2d1f11dabb8fa3d49df41c74047398.html#a6a2d1f11dabb8fa3d49df41c74047398" title="Ejecutar nueva sección.">crear_nueva_seccion</a>(<a class="code" href="../../d4/de8/a00061_a0cf5dd496d9f5ff1edf00d234771dcfe.html#a0cf5dd496d9f5ff1edf00d234771dcfe" title="Directorio con idioma actual.">Router::$d</a>.<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529             $titulo = $_POST[<span class="stringliteral">&#39;titulo&#39;</span>];
<a name="l00530"></a>00530             $nombre_contenido = $this-&gt;<a class="code" href="../../d1/d2b/a00018_add12a2bc5514d2d8b3c3cd4438996e06.html#add12a2bc5514d2d8b3c3cd4438996e06" title="devolver titulo de contenido">devolver_titulo</a>();
<a name="l00531"></a>00531             $destino = <a class="code" href="../../d4/de8/a00061_a0cf5dd496d9f5ff1edf00d234771dcfe.html#a0cf5dd496d9f5ff1edf00d234771dcfe" title="Directorio con idioma actual.">Router::$d</a>.Router::$s.$nombre_contenido;
<a name="l00532"></a>00532             <span class="keywordflow">if</span> ( substr_count($destino,<span class="stringliteral">&quot;.html&quot;</span>) == 0) $destino .=  <span class="stringliteral">&quot;.html&quot;</span>;
<a name="l00533"></a>00533             $mens = literal(<span class="stringliteral">&#39;Contenido traducido&#39;</span>,3);
<a name="l00534"></a>00534             <span class="keywordflow">break</span>;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536          <span class="keywordflow">case</span> <span class="stringliteral">&#39;guardar_como_borrador&#39;</span>:
<a name="l00537"></a>00537 
<a name="l00538"></a>00538             $titulo = $_POST[<span class="stringliteral">&#39;titulo&#39;</span>];
<a name="l00539"></a>00539             $nombre_contenido = <a class="code" href="../../d8/d41/a00038_a1bc35227366d73c2bc2017c66d1076f2.html#a1bc35227366d73c2bc2017c66d1076f2" title="Para evitar guardar los nombres de los ficheros con acentos y otras cosas que pueda producir que no f...">GUtil::textoplano</a>($titulo);
<a name="l00540"></a>00540             $contenido = $_POST[<span class="stringliteral">&#39;areaTexto&#39;</span>];
<a name="l00541"></a>00541             $destino = $gcm-&gt;seleccionado[0].<span class="charliteral">&#39;/&#39;</span>.$nombre_contenido;
<a name="l00542"></a>00542             <span class="keywordflow">if</span> ( substr_count($destino,<span class="stringliteral">&quot;.html&quot;</span>) == 0) $destino =  str_replace(<span class="stringliteral">&#39;.html&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$destino);
<a name="l00543"></a>00543             <span class="keywordflow">if</span> ( substr_count($destino,<span class="stringliteral">&quot;.btml&quot;</span>) == 0) $destino .=  <span class="stringliteral">&quot;.btml&quot;</span>;
<a name="l00544"></a>00544             $mens = literal(<span class="stringliteral">&#39;Borrador añadido&#39;</span>,3);
<a name="l00545"></a>00545             <span class="keywordflow">break</span>;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547          <span class="keywordflow">case</span> <span class="stringliteral">&#39;ejecutar_nuevo&#39;</span>:
<a name="l00548"></a>00548 
<a name="l00549"></a>00549             $titulo = $_POST[<span class="stringliteral">&#39;titulo&#39;</span>];
<a name="l00550"></a>00550             $nombre_contenido = <a class="code" href="../../d8/d41/a00038_a1bc35227366d73c2bc2017c66d1076f2.html#a1bc35227366d73c2bc2017c66d1076f2" title="Para evitar guardar los nombres de los ficheros con acentos y otras cosas que pueda producir que no f...">GUtil::textoplano</a>($_POST[<span class="stringliteral">&#39;titulo&#39;</span>]);
<a name="l00551"></a>00551             $destino = $_POST[<span class="stringliteral">&#39;seleccionado&#39;</span>][0].<span class="charliteral">&#39;/&#39;</span>.$nombre_contenido;
<a name="l00552"></a>00552             <span class="keywordflow">if</span> ( substr_count($destino,<span class="stringliteral">&quot;.html&quot;</span>) == 0) $destino .=  <span class="stringliteral">&quot;.html&quot;</span>;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554             <span class="comment">/* Nuevo: verificar que no haya contenido existente */</span>
<a name="l00555"></a>00555 
<a name="l00556"></a>00556             <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="../../d1/d2b/a00018_a204ead297701bbc21223cc8f461b1d29.html#a204ead297701bbc21223cc8f461b1d29" title="Verificar contenido.">verificar_contenido</a>($destino)  ) {
<a name="l00557"></a>00557                registrar(__FILE__,__LINE__,literal(
<a name="l00558"></a>00558                   <span class="stringliteral">&#39;Ya existe contenido con este nombre&#39;</span>)
<a name="l00559"></a>00559                   .<span class="charliteral">&#39; &#39;</span>.literal(<span class="stringliteral">&#39;Se debe cambiar el nombre&#39;</span>)
<a name="l00560"></a>00560                  , <span class="stringliteral">&#39;AVISO&#39;</span>); 
<a name="l00561"></a>00561                $this-&gt;<a class="code" href="../../d1/d2b/a00018_a3fb03d144cfd7a1ce89bfc72e09cb082.html#a3fb03d144cfd7a1ce89bfc72e09cb082" title="Si se encuentra contenido con el mismo nombre a la hora de guardar esta función presguntara que se de...">existe_contenido</a>($contenido, $titulo);
<a name="l00562"></a>00562                <span class="keywordflow">return</span> FALSE;
<a name="l00563"></a>00563                }
<a name="l00564"></a>00564             $mens = literal(<span class="stringliteral">&#39;Contenido añadido&#39;</span>,3);
<a name="l00565"></a>00565             <span class="keywordflow">break</span>;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567          <span class="keywordflow">case</span> <span class="stringliteral">&#39;actualizar_contenido&#39;</span>:
<a name="l00568"></a>00568 
<a name="l00569"></a>00569             $destino = $gcm-&gt;seleccionado[0];
<a name="l00570"></a>00570             $mens = literal(<span class="stringliteral">&#39;Contenido actualizado&#39;</span>,3);
<a name="l00571"></a>00571             <span class="keywordflow">break</span>;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573          <span class="keywordflow">default</span>:
<a name="l00574"></a>00574 
<a name="l00575"></a>00575             $destino = <a class="code" href="../../d4/de8/a00061_aab3fe4237c8eed37504f28f8541c9c79.html#aab3fe4237c8eed37504f28f8541c9c79" title="prefijo para el enlace relativo, para tener en cuenta si acaba la url con barra o sin ella...">Router::$enlace_relativo</a>.Router::$d.Router::$url;
<a name="l00576"></a>00576             <span class="keywordflow">if</span> ( substr_count($destino,<span class="stringliteral">&quot;.html&quot;</span>) == 0) $destino .=  <span class="stringliteral">&quot;.html&quot;</span>;
<a name="l00577"></a>00577             $mens = literal(<span class="stringliteral">&#39;Contenido guardado&#39;</span>,3);
<a name="l00578"></a>00578             <span class="keywordflow">break</span>;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580          }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00583"></a>00583       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00584"></a>00584       $gcm-&gt;titulo = ( isset($titulo) ) ? stripslashes($titulo) : literal(<span class="stringliteral">&#39;Guardar contenido&#39;</span>,3);
<a name="l00585"></a>00585       $gcm-&gt;contenido = stripslashes($contenido);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587       <span class="keywordflow">if</span> ( ! $this-&gt;<a class="code" href="../../d1/d2b/a00018_a79b72ba8b6228dd2595664afd7bac04f.html#a79b72ba8b6228dd2595664afd7bac04f" title="guardar el contenido">guardar_contenido</a>($destino, $contenido) ) {
<a name="l00588"></a>00588 
<a name="l00589"></a>00589          registrar(__FILE__,__LINE__,
<a name="l00590"></a>00590             literal(<span class="stringliteral">&#39;Error&#39;</span>).<span class="charliteral">&#39; &#39;</span>.literal(<span class="stringliteral">&#39;guardando contenido&#39;</span>).<span class="stringliteral">&#39;: &#39;</span>.$destino,<span class="stringliteral">&#39;ERROR&#39;</span>);
<a name="l00591"></a>00591          <span class="keywordflow">return</span> FALSE;
<a name="l00592"></a>00592       } <span class="keywordflow">else</span> {
<a name="l00593"></a>00593          registrar(__FILE__,__LINE__,$mens,<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595          <span class="comment">/* Si tenemos un nuevo literal lo añadimos */</span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597          <span class="keywordflow">if</span> ( isset($titulo) &amp;&amp; !empty($titulo) &amp;&amp; isset($nombre_contenido) ) {
<a name="l00598"></a>00598             literal($nombre_contenido,1,$titulo);
<a name="l00599"></a>00599             }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601          }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603       $gcm-&gt;router-&gt;inicia($destino);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605       }
<a name="l00606"></a>00606 <span class="comment"></span>
<a name="l00607"></a>00607 <span class="comment">   /**</span>
<a name="l00608"></a>00608 <span class="comment">    * Si se encuentra contenido con el mismo nombre a la hora de guardar</span>
<a name="l00609"></a>00609 <span class="comment">    * esta función presguntara que se desea hacer, cambiar el nombre, sobrescribir, etc...</span>
<a name="l00610"></a>00610 <span class="comment">    *</span>
<a name="l00611"></a>00611 <span class="comment">    * @todo Presentar secciones para poder seleccionar otra donde guardar.</span>
<a name="l00612"></a>00612 <span class="comment">    *</span>
<a name="l00613"></a>00613 <span class="comment">    * @author Eduardo Magrané</span>
<a name="l00614"></a>00614 <span class="comment">    * @version 1.0</span>
<a name="l00615"></a>00615 <span class="comment">    * @param $contenido a grabar</span>
<a name="l00616"></a>00616 <span class="comment">    * @param $f Nombre del archivo</span>
<a name="l00617"></a>00617 <span class="comment">    *</span>
<a name="l00618"></a>00618 <span class="comment">    */</span>
<a name="l00619"></a>00619 
<a name="l00620"></a><a class="code" href="../../d1/d2b/a00018_a3fb03d144cfd7a1ce89bfc72e09cb082.html#a3fb03d144cfd7a1ce89bfc72e09cb082">00620</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a3fb03d144cfd7a1ce89bfc72e09cb082.html#a3fb03d144cfd7a1ce89bfc72e09cb082" title="Si se encuentra contenido con el mismo nombre a la hora de guardar esta función presguntara que se de...">existe_contenido</a>($contenido, $titulo){
<a name="l00621"></a>00621 
<a name="l00622"></a>00622       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624       $contenido = <a class="code" href="../../db/d57/a00112_a1d441db55e5822df3209dc11e79eee6b.html#a1d441db55e5822df3209dc11e79eee6b" title="Limpiamos el texto preparandolo para ser guardado o presentado.">limpiarContenido</a>($contenido);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00627"></a>00627       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00628"></a>00628       $gcm-&gt;titulo = $titulo;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;form_nuevo.html&#39;</span>));
<a name="l00631"></a>00631       <span class="comment">// include ($gcm-&gt;event-&gt;instancias[&#39;temas&#39;]-&gt;ruta(&#39;contenidos&#39;,&#39;html&#39;,&#39;form_existe_contenido.html&#39;));</span>
<a name="l00632"></a>00632 
<a name="l00633"></a>00633       }
<a name="l00634"></a>00634 <span class="comment"></span>
<a name="l00635"></a>00635 <span class="comment">   /** ver todo</span>
<a name="l00636"></a>00636 <span class="comment">    *</span>
<a name="l00637"></a>00637 <span class="comment">    * Presentamos todo el contenido en forma de arbol para facilitar la </span>
<a name="l00638"></a>00638 <span class="comment">    * administración del mismo.</span>
<a name="l00639"></a>00639 <span class="comment">    *</span>
<a name="l00640"></a>00640 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00641"></a>00641 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00642"></a>00642 <span class="comment">    */</span>
<a name="l00643"></a>00643 
<a name="l00644"></a><a class="code" href="../../d1/d2b/a00018_a715f2087e18419b2b50f71f26b741060.html#a715f2087e18419b2b50f71f26b741060">00644</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a715f2087e18419b2b50f71f26b741060.html#a715f2087e18419b2b50f71f26b741060" title="ver todo">vertodo</a>($e, $args=NULL) {
<a name="l00645"></a>00645 
<a name="l00646"></a>00646       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00649"></a>00649       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00650"></a>00650       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Listado completo de contenido&#39;</span>,3);
<a name="l00651"></a>00651 
<a name="l00652"></a>00652       $path              = <span class="stringliteral">&quot;File&quot;</span>;
<a name="l00653"></a>00653       $accion            = <span class="stringliteral">&quot;editar_doc&quot;</span>;
<a name="l00654"></a>00654       $path_seleccionado = <a class="code" href="../../d4/de8/a00061_a0cf5dd496d9f5ff1edf00d234771dcfe.html#a0cf5dd496d9f5ff1edf00d234771dcfe" title="Directorio con idioma actual.">Router::$d</a>.Router::$s;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       include ($gcm-&gt;event-&gt;instancias[<span class="stringliteral">&#39;temas&#39;</span>]-&gt;ruta(<span class="stringliteral">&#39;contenidos&#39;</span>,<span class="stringliteral">&#39;html&#39;</span>,<span class="stringliteral">&#39;vertodo.html&#39;</span>));
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       }
<a name="l00659"></a>00659 <span class="comment"></span>
<a name="l00660"></a>00660 <span class="comment">   /** </span>
<a name="l00661"></a>00661 <span class="comment">    * Ejecutar el cambio de nombre de contenido o de ubicación</span>
<a name="l00662"></a>00662 <span class="comment">    *</span>
<a name="l00663"></a>00663 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00664"></a>00664 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00665"></a>00665 <span class="comment">    */</span>
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="../../d1/d2b/a00018_af2b76ca39aa458e17d1a79f4d00f8b68.html#af2b76ca39aa458e17d1a79f4d00f8b68">00667</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_af2b76ca39aa458e17d1a79f4d00f8b68.html#af2b76ca39aa458e17d1a79f4d00f8b68" title="Ejecutar el cambio de nombre de contenido o de ubicación.">ejecutar_mover</a>($e, $args=NULL) {
<a name="l00668"></a>00668 
<a name="l00669"></a>00669       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.<a class="code" href="../../db/d57/a00112_a7031d9d8dc6290aa33d665d7daced6c8.html#a7031d9d8dc6290aa33d665d7daced6c8" title="Formatemaos salida de array.">depurar</a>($args).<span class="charliteral">&#39;)&#39;</span>);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673       <span class="keywordflow">switch</span>($e) {
<a name="l00674"></a>00674 
<a name="l00675"></a>00675          <span class="keywordflow">case</span> <span class="stringliteral">&#39;publicar_borrador&#39;</span>:
<a name="l00676"></a>00676 
<a name="l00677"></a>00677             $origen = <a class="code" href="../../d4/de8/a00061_a23c42e7d231a63025b55e4eb7e3d4c99.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Url del contenido que se pide.">Router::$f</a>;
<a name="l00678"></a>00678             $destino = str_replace(<span class="stringliteral">&#39;.btml&#39;</span>,<span class="stringliteral">&#39;.html&#39;</span>,$origen);
<a name="l00679"></a>00679             $titulo_contenido = str_replace(<span class="stringliteral">&#39;.btml&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>);
<a name="l00680"></a>00680             $mens = literal(<span class="stringliteral">&#39;Borrador publicado&#39;</span>,3);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682             <span class="keywordflow">break</span>;
<a name="l00683"></a>00683 
<a name="l00684"></a>00684          <span class="keywordflow">default</span>:
<a name="l00685"></a>00685             $origen = $_POST[<span class="stringliteral">&#39;origen&#39;</span>];
<a name="l00686"></a>00686             $titulo = $_POST[<span class="stringliteral">&#39;titulo&#39;</span>];
<a name="l00687"></a>00687             $titulo_contenido = <a class="code" href="../../d8/d41/a00038_a1bc35227366d73c2bc2017c66d1076f2.html#a1bc35227366d73c2bc2017c66d1076f2" title="Para evitar guardar los nombres de los ficheros con acentos y otras cosas que pueda producir que no f...">GUtil::textoplano</a>($_POST[<span class="stringliteral">&#39;titulo&#39;</span>]);
<a name="l00688"></a>00688             $destino = $gcm-&gt;seleccionado[0].<span class="charliteral">&#39;/&#39;</span>.$titulo_contenido;
<a name="l00689"></a>00689             <span class="keywordflow">if</span> ( substr_count($destino,<span class="stringliteral">&quot;.html&quot;</span>) == 0) $destino .=  <span class="stringliteral">&quot;.html&quot;</span>;
<a name="l00690"></a>00690             $mens = literal(<span class="stringliteral">&#39;Contenido renombrado o movido&#39;</span>,3);
<a name="l00691"></a>00691             <span class="keywordflow">break</span>;
<a name="l00692"></a>00692          }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694       <span class="keywordflow">if</span> ( $this-&gt;mover_contenido($origen, $destino) ) {
<a name="l00695"></a>00695          registrar(__FILE__,__LINE__,$mens,<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00696"></a>00696          literal($titulo_contenido,1,$titulo);
<a name="l00697"></a>00697          $gcm-&gt;memoria[<span class="stringliteral">&#39;destino&#39;</span>] = $destino;
<a name="l00698"></a>00698          $gcm-&gt;memoria[<span class="stringliteral">&#39;origen&#39;</span>] = $origen;
<a name="l00699"></a>00699          $gcm-&gt;memoria[<span class="stringliteral">&#39;titulo_contenido&#39;</span>] = $titulo_contenido;
<a name="l00700"></a>00700          $gcm-&gt;router-&gt;inicia($destino);
<a name="l00701"></a>00701       } <span class="keywordflow">else</span> {
<a name="l00702"></a>00702          <span class="keywordflow">return</span> FALSE;
<a name="l00703"></a>00703          }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705       }
<a name="l00706"></a>00706 <span class="comment"></span>
<a name="l00707"></a>00707 <span class="comment">   /** </span>
<a name="l00708"></a>00708 <span class="comment">    * Ejecutar mover sección </span>
<a name="l00709"></a>00709 <span class="comment">    *</span>
<a name="l00710"></a>00710 <span class="comment">    * Guardamos en $gcm-&gt;memoria[&#39;seccion_movida&#39;] la sección movida</span>
<a name="l00711"></a>00711 <span class="comment">    * para que otros módulos puedan tenerla en cuenta.</span>
<a name="l00712"></a>00712 <span class="comment">    *</span>
<a name="l00713"></a>00713 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00714"></a>00714 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00715"></a>00715 <span class="comment">    */</span>
<a name="l00716"></a>00716 
<a name="l00717"></a><a class="code" href="../../d1/d2b/a00018_ad28129da7279cde0047f2b950cb608e9.html#ad28129da7279cde0047f2b950cb608e9">00717</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_ad28129da7279cde0047f2b950cb608e9.html#ad28129da7279cde0047f2b950cb608e9" title="Ejecutar mover sección.">ejecutar_mover_seccion</a>($e, $args=NULL) {
<a name="l00718"></a>00718 
<a name="l00719"></a>00719       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.<a class="code" href="../../db/d57/a00112_a7031d9d8dc6290aa33d665d7daced6c8.html#a7031d9d8dc6290aa33d665d7daced6c8" title="Formatemaos salida de array.">depurar</a>($args).<span class="charliteral">&#39;)&#39;</span>);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00724"></a>00724       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00725"></a>00725       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Renombrando o moviendo sección&#39;</span>,3);
<a name="l00726"></a>00726 
<a name="l00727"></a>00727       <span class="keywordflow">if</span> ( count($gcm-&gt;seleccionado) &gt; 1 ) {
<a name="l00728"></a>00728          registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;Solo se puede seleccionar una sección, cogemos la primera como válida&#39;</span>,<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00729"></a>00729          }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731       $literal = $_POST[<span class="stringliteral">&#39;titulo_seccion&#39;</span>];
<a name="l00732"></a>00732       $nombre_seccion = <a class="code" href="../../d8/d41/a00038_a1bc35227366d73c2bc2017c66d1076f2.html#a1bc35227366d73c2bc2017c66d1076f2" title="Para evitar guardar los nombres de los ficheros con acentos y otras cosas que pueda producir que no f...">GUtil::textoplano</a>($literal);
<a name="l00733"></a>00733       $seccion_nueva = ( $gcm-&gt;seleccionado[0] ) ? $gcm-&gt;seleccionado[0] : <a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>.Router::$s; 
<a name="l00734"></a>00734       $seccion_nueva = <a class="code" href="../../db/d57/a00112_a6ab4ae106b6ebf5769bc3390aa8ac287.html#a6ab4ae106b6ebf5769bc3390aa8ac287" title="comprobar_barra()">comprobar_barra</a>($seccion_nueva).$nombre_seccion;
<a name="l00735"></a>00735       $ruta_origen = <a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>.Router::$s;
<a name="l00736"></a>00736       $gcm-&gt;memoria[<span class="stringliteral">&#39;seccion_movida&#39;</span>] = <a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738       <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="../../d1/d2b/a00018_a70ea7c6bbb1b8a01e6d063512e83abd7.html#a70ea7c6bbb1b8a01e6d063512e83abd7" title="Renombrar sección.">renombrar_seccion</a>($ruta_origen,$seccion_nueva) ) {
<a name="l00739"></a>00739          registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;Cambio de nombre realizado&#39;</span>,<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00740"></a>00740          literal($nombre_seccion,1,$literal);
<a name="l00741"></a>00741       } <span class="keywordflow">else</span> {
<a name="l00742"></a>00742          registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;Error al renombrar sección&#39;</span>,<span class="stringliteral">&#39;ERROR&#39;</span>);
<a name="l00743"></a>00743          <span class="keywordflow">return</span> FALSE;
<a name="l00744"></a>00744          }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746       $gcm-&gt;router-&gt;inicia($seccion_nueva);
<a name="l00747"></a>00747 
<a name="l00748"></a>00748       }
<a name="l00749"></a>00749 <span class="comment"></span>
<a name="l00750"></a>00750 <span class="comment">   /** </span>
<a name="l00751"></a>00751 <span class="comment">    * Ejecutar nueva sección </span>
<a name="l00752"></a>00752 <span class="comment">    *</span>
<a name="l00753"></a>00753 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00754"></a>00754 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00755"></a>00755 <span class="comment">    */</span>
<a name="l00756"></a>00756 
<a name="l00757"></a><a class="code" href="../../d1/d2b/a00018_a8ac311074681948c57c59d7d77327a43.html#a8ac311074681948c57c59d7d77327a43">00757</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a8ac311074681948c57c59d7d77327a43.html#a8ac311074681948c57c59d7d77327a43" title="Ejecutar nueva sección.">ejecutar_nueva_seccion</a>($e, $args=NULL) {
<a name="l00758"></a>00758 
<a name="l00759"></a>00759       registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$e.<span class="charliteral">&#39;,&#39;</span>.<a class="code" href="../../db/d57/a00112_a7031d9d8dc6290aa33d665d7daced6c8.html#a7031d9d8dc6290aa33d665d7daced6c8" title="Formatemaos salida de array.">depurar</a>($args).<span class="charliteral">&#39;)&#39;</span>);
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00764"></a>00764       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00765"></a>00765       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Nueva sección&#39;</span>);
<a name="l00766"></a>00766 
<a name="l00767"></a>00767       $seccion_madre = $gcm-&gt;seleccionado[0];
<a name="l00768"></a>00768       $seccion_nueva = <a class="code" href="../../d8/d41/a00038_a1bc35227366d73c2bc2017c66d1076f2.html#a1bc35227366d73c2bc2017c66d1076f2" title="Para evitar guardar los nombres de los ficheros con acentos y otras cosas que pueda producir que no f...">GUtil::textoplano</a>($_POST[<span class="stringliteral">&#39;titulo_seccion&#39;</span>]);
<a name="l00769"></a>00769       $literal_nuevo = $_POST[<span class="stringliteral">&#39;titulo_seccion&#39;</span>];
<a name="l00770"></a>00770       $ruta_nueva_seccion = <a class="code" href="../../db/d57/a00112_a6ab4ae106b6ebf5769bc3390aa8ac287.html#a6ab4ae106b6ebf5769bc3390aa8ac287" title="comprobar_barra()">comprobar_barra</a>($seccion_madre).$seccion_nueva;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772       <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="../../d1/d2b/a00018_a6a2d1f11dabb8fa3d49df41c74047398.html#a6a2d1f11dabb8fa3d49df41c74047398" title="Ejecutar nueva sección.">crear_nueva_seccion</a>($ruta_nueva_seccion) ) {
<a name="l00773"></a>00773          $mens=<span class="stringliteral">&quot;Nueva sección creada [&quot;</span>.literal($seccion_nueva,1,$literal_nuevo).<span class="charliteral">&#39;]&#39;</span>;
<a name="l00774"></a>00774          registrar(__FILE__,__LINE__,$mens,<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00775"></a>00775          $gcm-&gt;router-&gt;inicia($ruta_nueva_seccion);
<a name="l00776"></a>00776       } <span class="keywordflow">else</span> {
<a name="l00777"></a>00777          <span class="keywordflow">return</span> FALSE;
<a name="l00778"></a>00778          }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780       }
<a name="l00781"></a>00781 <span class="comment"></span>
<a name="l00782"></a>00782 <span class="comment">   /**</span>
<a name="l00783"></a>00783 <span class="comment">    * Ejecutar borrado de contenido seleccionado</span>
<a name="l00784"></a>00784 <span class="comment">    *</span>
<a name="l00785"></a>00785 <span class="comment">    * La lista de archivos a borrar puede ser o $_POST[&#39;archivo&#39;] o un array desde $_POST[&#39;seccion&#39;]</span>
<a name="l00786"></a>00786 <span class="comment">    *</span>
<a name="l00787"></a>00787 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00788"></a>00788 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00789"></a>00789 <span class="comment">    */</span>
<a name="l00790"></a>00790 
<a name="l00791"></a><a class="code" href="../../d1/d2b/a00018_a6684212eb58581bac8b1ae81f1fa129b.html#a6684212eb58581bac8b1ae81f1fa129b">00791</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a6684212eb58581bac8b1ae81f1fa129b.html#a6684212eb58581bac8b1ae81f1fa129b" title="Ejecutar borrado de contenido seleccionado.">ejecutar_borrar</a>($e, $args=NULL) {
<a name="l00792"></a>00792 
<a name="l00793"></a>00793       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;contenido&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00796"></a>00796       $gcm-&gt;event-&gt;anular(<span class="stringliteral">&#39;titulo&#39;</span>,<span class="stringliteral">&#39;contenidos&#39;</span>);
<a name="l00797"></a>00797       $gcm-&gt;titulo = literal(<span class="stringliteral">&#39;Borrado de contenido&#39;</span>,3);
<a name="l00798"></a>00798 
<a name="l00799"></a>00799       <span class="keywordflow">foreach</span> ( $gcm-&gt;seleccionado as $item ) {
<a name="l00800"></a>00800 
<a name="l00801"></a>00801          <span class="keywordflow">if</span> ( is_dir($item) ) {
<a name="l00802"></a>00802 
<a name="l00803"></a>00803             <span class="keywordflow">if</span> ( !$this-&gt;eliminarDirectorio($item) ) {
<a name="l00804"></a>00804                trigger_error(literal(<span class="stringliteral">&#39;Directorio&#39;</span>).<span class="stringliteral">&#39;: &#39;</span>.$item.<span class="charliteral">&#39; &#39;</span>.literal(<span class="stringliteral">&#39;No se pudo borrar&#39;</span>), E_USER_ERROR);
<a name="l00805"></a>00805                }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807          } <span class="keywordflow">else</span> {
<a name="l00808"></a>00808             
<a name="l00809"></a>00809             <span class="comment">/* Comprobamos que exista ya que puede haber sido borrado al borrarse el </span>
<a name="l00810"></a>00810 <span class="comment">             * directorio</span>
<a name="l00811"></a>00811 <span class="comment">             */</span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             <span class="keywordflow">if</span> ( !$this-&gt;<a class="code" href="../../d1/d2b/a00018_a204ead297701bbc21223cc8f461b1d29.html#a204ead297701bbc21223cc8f461b1d29" title="Verificar contenido.">verificar_contenido</a>($item) || !$this-&gt;<a class="code" href="../../d1/d2b/a00018_ad94330a261474ba3bffd728aacafb99b.html#ad94330a261474ba3bffd728aacafb99b" title="Borrar contenido.">borrar_contenido</a>($item) ) {
<a name="l00814"></a>00814                <span class="keywordflow">if</span> ( count($gcm-&gt;seleccionado) == 1 &amp;&amp; !$this-&gt;verificar_contenido($item) ) {
<a name="l00815"></a>00815                   registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&quot;No existe contenido a borrar&quot;</span>,3),<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00816"></a>00816                   }
<a name="l00817"></a>00817                }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819             }
<a name="l00820"></a>00820          }
<a name="l00821"></a>00821 
<a name="l00822"></a>00822       <a class="code" href="../../db/d57/a00112_ac34bd8d344b3c4dea60eefaf01927893.html#ac34bd8d344b3c4dea60eefaf01927893" title="convertir array en lista">array_lista</a>($gcm-&gt;seleccionado,NULL,FALSE);
<a name="l00823"></a>00823       registrar(__FILE__,__LINE__,literal(<span class="stringliteral">&quot;Contenido borrado&quot;</span>,3),<span class="stringliteral">&#39;AVISO&#39;</span>);
<a name="l00824"></a>00824       }
<a name="l00825"></a>00825 <span class="comment"></span>
<a name="l00826"></a>00826 <span class="comment">   /**</span>
<a name="l00827"></a>00827 <span class="comment">    * Metodo activado para el evento contenido</span>
<a name="l00828"></a>00828 <span class="comment">    *</span>
<a name="l00829"></a>00829 <span class="comment">    * @param $e     Evento que recibimos de Eventos</span>
<a name="l00830"></a>00830 <span class="comment">    * @param $args  Argumentos posibles</span>
<a name="l00831"></a>00831 <span class="comment">    */</span>
<a name="l00832"></a>00832 
<a name="l00833"></a><a class="code" href="../../d1/d2b/a00018_ab42ac597dbea13af15e4e50092cdef3c.html#ab42ac597dbea13af15e4e50092cdef3c">00833</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_ab42ac597dbea13af15e4e50092cdef3c.html#ab42ac597dbea13af15e4e50092cdef3c" title="Metodo activado para el evento contenido.">devolver_contenido</a>($url=NULL) {
<a name="l00834"></a>00834 
<a name="l00835"></a>00835       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       $url = ( $url ) ? $url : <a class="code" href="../../d4/de8/a00061_a23c42e7d231a63025b55e4eb7e3d4c99.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Url del contenido que se pide.">Router::$f</a>;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839       <span class="comment">/* Comprobar sección */</span>
<a name="l00840"></a>00840 
<a name="l00841"></a>00841       <span class="keywordflow">if</span> ( ! $this-&gt;<a class="code" href="../../d1/d2b/a00018_a9c2786dcc3c14a4478e58e72b84a345a.html#a9c2786dcc3c14a4478e58e72b84a345a" title="Verificar sección.">verificar_seccion</a>(<a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>.<a class="code" href="../../d4/de8/a00061_a50b05cf2e02ef0b67fcad97106dd7634.html#a50b05cf2e02ef0b67fcad97106dd7634" title="Sección.">Router::$s</a>) ) {                                     
<a name="l00842"></a>00842          registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$url.<span class="stringliteral">&#39;) No existe el documento lanzamos evento sincontenido&#39;</span>);
<a name="l00843"></a>00843          $gcm-&gt;event-&gt;lanzarEvento(<span class="stringliteral">&#39;sin_seccion&#39;</span>);
<a name="l00844"></a>00844          <span class="keywordflow">return</span> FALSE;
<a name="l00845"></a>00845          }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847       <span class="comment">/* Comprobar contenido */</span>
<a name="l00848"></a>00848 
<a name="l00849"></a>00849       <span class="keywordflow">if</span> ( <a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a> &amp;&amp; <a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a> != <span class="stringliteral">&#39;index.html&#39;</span> &amp;&amp; ! $this-&gt;<a class="code" href="../../d1/d2b/a00018_a204ead297701bbc21223cc8f461b1d29.html#a204ead297701bbc21223cc8f461b1d29" title="Verificar contenido.">verificar_contenido</a>(<a class="code" href="../../d4/de8/a00061_a53c89bcf51a9d61cb1c76b91e42aac4e.html#a53c89bcf51a9d61cb1c76b91e42aac4e" title="Directorio con idioma por defecto.">Router::$dd</a>.Router::$s.<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>) ) {
<a name="l00850"></a>00850          registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$url.<span class="stringliteral">&#39;) No existe el documento lanzamos evento sincontenido&#39;</span>);
<a name="l00851"></a>00851          $gcm-&gt;event-&gt;lanzarEvento(<span class="stringliteral">&#39;sin_contenido&#39;</span>);
<a name="l00852"></a>00852          <span class="keywordflow">return</span> FALSE;
<a name="l00853"></a>00853          }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855       <span class="comment">/* Comprobar existencia de archivo */</span>
<a name="l00856"></a>00856 
<a name="l00857"></a>00857 
<a name="l00858"></a>00858       <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="../../d1/d2b/a00018_a204ead297701bbc21223cc8f461b1d29.html#a204ead297701bbc21223cc8f461b1d29" title="Verificar contenido.">verificar_contenido</a>($url) ) {
<a name="l00859"></a>00859 
<a name="l00860"></a>00860          <span class="keywordflow">return</span> $this-&gt;<a class="code" href="../../d1/d2b/a00018_a01a699ecec56f859e4f3f8d9c9711d26.html#a01a699ecec56f859e4f3f8d9c9711d26" title="devolver contenido de documento">getContenido</a>($url);
<a name="l00861"></a>00861 
<a name="l00862"></a>00862       } elseif ( Router::$c == <span class="stringliteral">&#39;index.html&#39;</span> ) {
<a name="l00863"></a>00863 
<a name="l00864"></a>00864          registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$url.<span class="stringliteral">&#39;) Estamos en uns sección sin index.html, lanzamos contenido_dinamico&#39;</span>);
<a name="l00865"></a>00865          $gcm-&gt;event-&gt;lanzarEvento(<span class="stringliteral">&#39;contenido_dinamico&#39;</span>);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867       } <span class="keywordflow">else</span> {
<a name="l00868"></a>00868 
<a name="l00869"></a>00869          registrar(__FILE__,__LINE__,__CLASS__.<span class="stringliteral">&#39;-&gt;&#39;</span>.__FUNCTION__.<span class="charliteral">&#39;(&#39;</span>.$url.<span class="stringliteral">&#39;) No existe fichero [&#39;</span>.$url.<span class="charliteral">&#39;]&#39;</span>);
<a name="l00870"></a>00870          <span class="keywordflow">return</span> FALSE;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872          }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874       }
<a name="l00875"></a>00875 <span class="comment"></span>
<a name="l00876"></a>00876 <span class="comment">   /**</span>
<a name="l00877"></a>00877 <span class="comment">    * Título de artículo</span>
<a name="l00878"></a>00878 <span class="comment">    */</span>
<a name="l00879"></a>00879 
<a name="l00880"></a><a class="code" href="../../d1/d2b/a00018_a00b468dfbc4c6523b9e68c65731c8268.html#a00b468dfbc4c6523b9e68c65731c8268">00880</a>    <span class="keyword">function</span> <a class="code" href="../../d1/d2b/a00018_a00b468dfbc4c6523b9e68c65731c8268.html#a00b468dfbc4c6523b9e68c65731c8268" title="Título de artículo.">titulo_articulo</a>() {
<a name="l00881"></a>00881 
<a name="l00882"></a>00882       global <a class="code" href="../../df/d5d/a00084_a19a0c049e76bf73f0a16f04e31cfbe86.html#a19a0c049e76bf73f0a16f04e31cfbe86" title="Instancia de Gcm.">$gcm</a>;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884       $esBorrador = FALSE;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886       <span class="keywordflow">if</span> ( <a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a> == <span class="stringliteral">&#39;index.html&#39;</span> || ! <a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a> ) {
<a name="l00887"></a>00887          $titulo=<a class="code" href="../../d4/de8/a00061_a65c95b6917e9fdcead66313c9faa5942.html#a65c95b6917e9fdcead66313c9faa5942" title="Nombre de la sección actual.">Router::$estamos</a>;
<a name="l00888"></a>00888       } <span class="keywordflow">else</span> {
<a name="l00889"></a>00889 
<a name="l00890"></a>00890          <span class="keywordflow">if</span> ( stripos(<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>,<span class="stringliteral">&#39;.html&#39;</span>) ) {
<a name="l00891"></a>00891             $titulo=str_replace(<span class="stringliteral">&#39;.html&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>);
<a name="l00892"></a>00892          } elseif ( stripos(<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>,<span class="stringliteral">&#39;.btml&#39;</span>) ) {
<a name="l00893"></a>00893             $titulo=str_replace(<span class="stringliteral">&#39;.btml&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<a class="code" href="../../d4/de8/a00061_ab73d7f4f2dae233dd561e7fdaab3a77b.html#ab73d7f4f2dae233dd561e7fdaab3a77b" title="Contenido.">Router::$c</a>);
<a name="l00894"></a>00894             }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896          <span class="keywordflow">try</span> {
<a name="l00897"></a>00897             <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="../../d1/d2b/a00018_a204ead297701bbc21223cc8f461b1d29.html#a204ead297701bbc21223cc8f461b1d29" title="Verificar contenido.">verificar_contenido</a>(<a class="code" href="../../d4/de8/a00061_a23c42e7d231a63025b55e4eb7e3d4c99.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Url del contenido que se pide.">Router::$f</a>) !== FALSE) {
<a name="l00898"></a>00898                $fecha = <a class="code" href="../../db/d57/a00112_ab944511ceeabc802c80f4943fbd6e0e2.html#ab944511ceeabc802c80f4943fbd6e0e2" title="presentarFecha">presentarFecha</a>($this-&gt;<a class="code" href="../../d1/d2b/a00018_ab8a2be3d77cb89d08d44bf35abd56c62.html#ab8a2be3d77cb89d08d44bf35abd56c62" title="Devolver fecha de modificación de contenido.">getFechaActualizacion</a>(<a class="code" href="../../d4/de8/a00061_a23c42e7d231a63025b55e4eb7e3d4c99.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Url del contenido que se pide.">Router::$f</a>),1,<span class="stringliteral">&#39;unix&#39;</span>);
<a name="l00899"></a>00899             } <span class="keywordflow">else</span> {
<a name="l00900"></a>00900                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;El contendo no existe [ &#39;</span>.<a class="code" href="../../d4/de8/a00061_a23c42e7d231a63025b55e4eb7e3d4c99.html#a23c42e7d231a63025b55e4eb7e3d4c99" title="Url del contenido que se pide.">Router::$f</a>.<span class="stringliteral">&#39; ]&#39;</span>);
<a name="l00901"></a>00901             }
<a name="l00902"></a>00902          } <span class="keywordflow">catch</span> (Exception $ex) {
<a name="l00903"></a>00903             registrar(__FILE__,__LINE__,<span class="stringliteral">&#39;No se pudo recoger fecha: &#39;</span>.$ex-&gt;getMessage(),<span class="stringliteral">&#39;ADMIN&#39;</span>);
<a name="l00904"></a>00904             }
<a name="l00905"></a>00905          }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907       $titulo = ( isset($titulo) ) ? literal($titulo,1) : NULL;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909       <span class="keywordflow">if</span> ( $gcm-&gt;au-&gt;logeado() ) {
<a name="l00910"></a>00910 
<a name="l00911"></a>00911          <span class="keywordflow">if</span> ( <a class="code" href="../../d4/de8/a00061_ad837fd69f5921416cf6f2a2f90caf890.html#ad837fd69f5921416cf6f2a2f90caf890" title="Saber si el contenido es un borrador.">Router::$esBorrador</a> ) $titulo = <span class="stringliteral">&#39;&lt;b title=&quot;&#39;</span>.literal(<span class="stringliteral">&#39;Borrador&#39;</span>).<span class="stringliteral">&#39;&quot;&gt;(B)&lt;/b&gt; &#39;</span>.$titulo;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913          }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915       include(dirname(__FILE__).<span class="stringliteral">&#39;/../html/titulo_articulo.html&#39;</span>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917       }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 
<a name="l00921"></a>00921    }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 ?&gt;
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generado el Martes, 26 de Febrero de 2013 10:38:38 para gcm por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>

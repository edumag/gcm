var wooCounter,wooLangTmp=$("body").attr("lang"),wooLang=wooLangTmp==undefined||wooLangTmp==""?"en":wooLangTmp,wooFlyingMenu,wooBubble,maxTop,radius=44,currentScoring=0,finalScoring=0,isPaidReview=false,isInsideReview=false,desktopScreenshot="",chartsId=0,chartsData=new Array(),chartsObject=new Array(),criteriumsLoading=new Array(),currentWebsite,ajaxLoadingLeft=0,savingToken,ajaxObjects,checkCompetitorsPhase=false,competitorUrl,competitorToCheck=false,currentCompetitorNbr=0,reportId=0,fetchs=new Array(),fetchsData=new Array(),pusher,puChanel=false,wooFormBackup,wooLcCounters=new Array();var baseUrl="/"+wooLang+"/",dataUrl="/tplmapper.php",projectDataUrl=baseUrl+"project/data",keySuggestUrl=baseUrl+"project/ajaxkeywordssuggest",lcDetailsLoad=baseUrl+"project/lcdetails",todoAutoCheckUrl=baseUrl+"todo/todoac",todoSaveUrl=baseUrl+"todo/save",faqSuggestUrl=baseUrl+"faqs/ajaxsearch",reportSaveUrl=baseUrl+"report/save",shortUrl=baseUrl+"report/shorturl";function jsLoadEnd(){$(window).trigger("scroll");$(".hide-on-load").removeClass("hide-on-load");updateAllWooHighChartsHeight()}function killRequest(){for(var a=0;a<ajaxObjects.length;a++){ajaxObjects[a].abort()}}function stripAccent(d){var c=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}];for(var b=0,a=c.length;b<a;b++){d=d.replace(c[b].re,c[b].ch)}return d}function split(a){return a.split(/,\s*/)}function extractLast(a){return split(a).pop()}function bindLeave(){$(window).on("beforeunload",function(a){killRequest();saveReport()})}function convertSerializedArrayToHash(b){var d={};for(var c=0;c<b.length;c++){d[b[c].name]=b[c].value}return d}function hashDiff(b,a){var c="";for(k in b){if(b[k]==a[k]){delete a[k]}else{if(b[k]==1){a[k]="0"}}}for(k in a){if(a[k]){c+="&"+k+"="+encodeURIComponent(a[k])}}return c}function scrollTo(c,a){var b=$(c).offset().top;bodyelem=$("html,body");if($.browser.safari){bodyelem=$("body")}bodyelem.stop().animate({scrollTop:b},a)}function SelectText(b){var d=document;var e=d.getElementById(b);if(d.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(e);a.select()}else{if(window.getSelection){var c=window.getSelection();var a=document.createRange();a.selectNodeContents(e);c.removeAllRanges();c.addRange(a)}}}function formatMomentJs(c){var a=new Date(),b=a.getTimezoneOffset();if(c==undefined){c="LLL"}$(".moment").each(function(){var d=$(this),e=moment(d.text(),"YYYY-MM-DD HH:mm:ss").subtract("m",b);if(d.hasClass("no-hour")){c="MMM D"}d.text(e.format(c)).removeClass("moment")})}function createMultipleAC(a,b){a.on("keydown",function(c){if(c.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active){c.preventDefault()}}).autocomplete({minLength:0,source:function(d,c){c($.ui.autocomplete.filter(b,extractLast(d.term)))},focus:function(){return false},select:function(f,d){a.addClass("acSelect");var c=split(this.value);c.pop();c.push(d.item.value);c.push("");this.value=c.join(", ");return false},open:function(d,c){a.addClass("autocomplete-open")},close:function(d,c){a.removeClass("autocomplete-open")}})}function getScoreIn(c,d,a,b){c=c.replace("http://www.","");c=c.replace("https://www.","");c=c.replace("http://","");c=c.replace("https://","");a=a?"&paid=1":"";$.ajax({type:"GET",data:"key=9718067451b92665a02b0c460d502fa2e6c0e4b4"+a+"&callback=?",url:"http://score.woorank.com/site/"+c,async:true,context:d,dataType:"jsonp",success:function(e){var f=e.rank;if(b){f=Math.round(f)}else{f=Math.round(f*10)/10}$(this).text(f)}})}function getCompetitorsScore(){$("#dashboard-competitors .competitors .url").each(function(){getScoreIn($(this).text(),$(this).siblings(".score"),true,true)})}function getRelatedScore(){$("#criterium-related_websites tbody td:nth-child(3)").each(function(){var a=$(this).siblings(":nth-child(2)").find("a").attr("href");getScoreIn(a,$(this),$("#dashboard-get-pdf").length>0,false)})}function bindDropDown(){$(".dropdown .dropdown-menu a").off("click").on("click",function(f){f.preventDefault();f.stopPropagation();var c=$(this),b=c.attr("href"),a=c.text(),d=c.parents(".dropdown");d.find(".dropdown-value").val(b).trigger("change");d.find(".dropdown-toggle span").text(a);d.removeClass("open")})}function wooAccordion(a){var b=$(".woo-accordion");if(a){b.accordion("destroy")}b.find("a").on("click",function(d){var c=$(this).attr("href");if(c!=undefined&&c!="#"&&c!=""){d.stopPropagation()}});b.accordion({collapsible:true,icons:false,autoHeight:false,active:false})}function calculTopBars(){if($("#dashboard-bars").length>0){var b=$("#green-bar-counter"),d=$("#orange-bar-counter"),g=$("#red-bar-counter"),c=$(".criterium.result-1").length,a=$(".criterium.result-2").length,e=$(".criterium.result-3").length,f=c+a+e;b.find(".count").text(c);d.find(".count").text(a);g.find(".count").text(e);if(f>0){b.find(".percent").stop().animate({width:(100/f*c)+"%"},500);d.find(".percent").stop().animate({width:(100/f*a)+"%"},500);g.find(".percent").stop().animate({width:(100/f*e)+"%"},500)}else{$("#green-bar-counter .percent, #orange-bar-counter .percent, #red-bar-counter .percent").css("width","0%")}}}function calculTopPriorities(){var b=new Array();$(".criterium.result-2, .criterium.result-3").each(function(){var c=$(this);if(c.find(".criterium-quicktips").length>0){var e=c.hasClass(".criterium.result-2")?0.7:1,d=parseFloat(c.find(".prio-score").text())*e;b.push({imp:d,id:c.attr("id"),tips:c.find(".criterium-quicktips").text()})}});$(".prio-score, .criterium-quicktips").remove();b.sort(function(d,c){return d.imp-c.imp});b.reverse();for(var a=0;a<5;a++){if(b[a]){$("#report-priorities ol").append('<a href="#'+b[a].id+'"><li id="quick-win-'+(a+1)+'" quick-wins">'+b[a].tips+"</li></a>")}}$("#report-priorities ol a").on("click",function(c){c.preventDefault();scrollTo($($(this).attr("href")),500)});$("#report-priorities").delay(300).slideDown(600)}function loadProjectData(a){$(a+".to-load").each(function(){var b=$(this),d=b.find(">form"),c=d.serialize();$.ajax({type:"POST",data:c,cache:false,url:projectDataUrl,dataType:"html",context:b,success:function(f){var e=$(this),i=e.find(">form"),h=i.find(".push-event"),l=h.attr("for"),j=h.text(),g="wait-"+j;if(f=="0"){e.find(".load-box").html($("#pending-workers").html());if(!puChanel){pusher=new Pusher(puAppId);puChanel=pusher.subscribe("project_"+l)}e.addClass(g);puChanel.bind(j,function(m){puChanel.unbind(j);loadProjectData("."+g)})}else{e.html(f).removeClass("to-load");checkWooChart(false);checkWooLatestChanges(e);$(".woo-tooltip, .simple-tooltip").tooltip({delay:{show:400,hide:100}});$(".to-popover").each(function(p){var m=$(this),n=m.next(".popover-data"),o=n.html();n.remove();m.popover({delay:{show:400,hide:100},content:o,trigger:"hover",animation:false}).removeClass("to-popover")})}}})})}function initReportGeneration(){currentWebsite=$("#dashboard-site h1 a").attr("title");getCriteriumData("criterium-loading")}function getCriteriumData(a){if($("."+a).length>0&&!checkCompetitorsPhase){bindLeave()}ajaxObjects=new Array();$("."+a).each(function(){var d=$(this);d.find("span.crit-score-pond").remove();var e=d.find("input.id").attr("value");if(savingToken==null){savingToken=d.find("a.api-url-href").attr("title")}var c="";if(checkCompetitorsPhase){c="criterium="+e+"&lang="+wooLang+"&site="+competitorUrl+"&token="+savingToken+"&competitor=1"}else{c="criterium="+e+"&lang="+wooLang+"&site="+encodeURIComponent(stripAccent(currentWebsite))+"&token="+savingToken;if(d.find(".accept-comp").length>0){c+="&acceptcomp=1"}}c+=ispaidReview?"&tmpl=2":"&tmpl=1";ajaxLoadingLeft++;var b=$.ajax({type:"GET",data:c,cache:false,url:dataUrl,context:d,dataType:"html",error:function(f,h,g){noCriteriumData($(this),f,h,g)},statusCode:{203:function(f){var g=JSON.parse(f);fetchCriteriumData(g.postback,$(this))},200:function(f){receiveCriteriumData($(this),f)}}});ajaxObjects.push(b)})}function receiveCriteriumData(c,b){ajaxLoadingLeft--;if(!checkCompetitorsPhase){var a=c.attr("id");c.replaceWith(b);$("#"+a+" .simple-tooltip").tooltip({delay:{show:400,hide:100}});updateWooCounter();checkWooChart(false);calculTopBars();wooMaps()}else{if(b!=""){c.append(b);c.find(".competitors-data:last-child").addClass("data-for-comp-"+currentCompetitorNbr);checkCompetitorCharts(false)}}checkEmptyModule();if(ajaxLoadingLeft==0&&checkCompetitorsPhase){startNextCompetitorGeneration()}else{if(ajaxLoadingLeft==0){saveReport()}}}function checkEmptyModule(){$("#report-content>.module").each(function(){var a=$(this),c=a.children(".criterium");if(c.length==0){var b=a.hide().index();$("#report-navigation>a[href="+b+"]").hide()}})}function noCriteriumData(c,a,d,b){if(!checkCompetitorsPhase){c.remove()}else{c.append($("#competitor-no-data").html());c.find(".competitors-data:last-child").addClass("data-for-comp-"+currentCompetitorNbr).find("h4").append(competitorUrl)}ajaxLoadingLeft--;if(ajaxLoadingLeft==0&&checkCompetitorsPhase){startNextCompetitorGeneration()}else{if(ajaxLoadingLeft==0){saveReport()}}}function fetchCriteriumData(c,b){var a=fetchs.length+1;fetchs[a]=0;fetchsData[a]=new Array();for(url in c){$.ajax({type:"GET",dataType:"jsonp",url:c[url],context:b,success:function(d){fetchsData[a][c[url]]=$.toJSON(d);fetchs[a]--;if(fetchs[a]==0){postCriteriumDataBack(url,fetchsData[a],$(this))}},error:function(d,f,e){fetchsData[a][c[url]]="";fetchs[a]--;if(fetchs[a]==0){postCriteriumDataBack(url,fetchsData[a],$(this))}}});fetchs[a]++}}function postCriteriumDataBack(a,c,b){var g="";if(checkCompetitorsPhase){g=b.parent().attr("id")}else{g=b.attr("id")}g=g.replace("criterium-","");var j=g;var e="postback=1&criterium="+j+"&lang="+wooLang+"&site="+currentWebsite+"&token="+savingToken;if(checkCompetitorsPhase){e="postback=1&criterium="+j+"&lang="+wooLang+"&site="+competitorUrl+"&token="+savingToken+"&competitor=1"}var d=1;var f="";for(a in c){if(d>1){f+="&"}f+="postbackdata["+d+"][url]="+encodeURIComponent(a);f+="&postbackdata["+d+"][data]="+encodeURIComponent(c[a]);d++}var h=$.ajax({type:"POST",data:f,cache:false,url:dataUrl+"?"+e,context:b,dataType:"html",error:function(i,m,l){noCriteriumData($(this),i,m,l)},statusCode:{203:function(i){receiveCriteriumData($(this),"")},200:function(i){receiveCriteriumData($(this),i)}}});ajaxObjects.push(h)}function saveReport(){$.ajax({type:"POST",data:"site="+currentWebsite+"&token="+savingToken,cache:false,url:reportSaveUrl,async:true,dataType:"json",success:function(a){if(a.result){desktopScreenshot=a.screenshot}if(isInsideReview){finalScoring=parseFloat(a.rank);setInsideRank(finalScoring)}else{finalScoring=Math.round(parseFloat(a.rank)*10);wooCounter.animate({arc:[finalScoring,1000,radius]},1000,"<>");Piecon.setProgress(Math.round(finalScoring/10))}reportId=a.id;$('#dashboard-get-pdf input[name="id"]').attr("value",reportId);if($("#dashboard-competitors").length>0){initReportCompetitorGeneration()}else{$("#dashboard").trigger("generationComplete")}}});$(window).off("beforeunload")}function initReportCompetitorGeneration(){checkCompetitorsPhase=true;competitorToCheck=new Array();$("#dashboard-competitors .url").each(function(){competitorToCheck.push($(this).text())});if(competitorToCheck.length==0){abordCompetitorGeneration()}else{initCompetitorCharts();startNextCompetitorGeneration()}}function abordCompetitorGeneration(){$("#dashboard").trigger("generationComplete")}function startNextCompetitorGeneration(){if(competitorUrl!=undefined){saveCompetitor()}if(competitorToCheck.length>0){currentCompetitorNbr++;competitorUrl=competitorToCheck.shift();getCriteriumData("criterium-loading-comp")}else{$("#dashboard").trigger("generationComplete")}}function saveCompetitor(){$.ajax({type:"POST",data:"site="+competitorUrl+"&token="+savingToken+"&id="+reportId,cache:false,url:reportSaveUrl,async:true,dataType:"html",success:function(){updateAllWooHighChartsHeight()}})}function initWooCounter(){var b=96,a=Raphael("holder",b,b),e={stroke:"#fff","stroke-width":8},d=$("#score-value");a.customAttributes.arc=function(o,l){var p,h=360/l*o,m=(90-h)*Math.PI/180,n=(b/2)+radius*Math.cos(m),j=(b/2)-radius*Math.sin(m),i="hsb(".concat(0.0444+(0.2361*(o/l)),", 1 , .75)"),g=""+(Math.round(o)/10),f=g.split(".");if(f[1]){d.html(f[0]+"<span class='decimal'>."+f[1]+"</span>")}else{d.html(f[0])}if(l==o){p=[["M",(b/2),(b/2)-radius],["A",radius,radius,0,1,1,(b/2),(b/2)-radius]]}else{p=[["M",(b/2),(b/2)-radius],["A",radius,radius,0,+(h>180),1,n,j]]}return{path:p,stroke:i}};var c=d.text();if(c){wooCounter=a.path().attr(e).attr({arc:[c*10,1000,radius]}).translate(1,0)}else{wooCounter=a.path().attr(e).attr({arc:[1000,1000,radius]}).translate(1,0)}Piecon.setOptions({color:"#315D86",background:"#ddd",shadow:"#fff",fallback:false});Piecon.setProgress(Math.round(c))}function setInsideRank(c){if(isInsideReview){var b="e";if(c>=70){b="aplus"}else{if(c>=60){b="a"}else{if(c>=50){b="b"}else{if(c>=40){b="c"}else{if(c>=30){b="d"}}}}}var a=b.replace("plus",'<span class="plus">+</span>');$("#dashboard-rank").removeClass("hidden").addClass("rank-"+b).find("#rank-value").html(a)}}function updateWooCounter(){if(!isInsideReview){$("span.crit-score-pond").each(function(){var a=parseFloat($(this).text());currentScoring+=a*10;wooCounter.animate({arc:[currentScoring,1000,radius]},1000,"<>");$(this).remove();Piecon.setProgress(Math.round(currentScoring/10))})}}function initCompetitorCharts(){if($("#dashboard-competitors").length>0){$(".criterium-competitor-container").removeClass("hidden");$("#criterium-social_impact .criterium-competitor-container").addClass("main-chart-parent").prepend('<div class="chart-container comparative-comp-chart-container chartify-me"><ul class="value" title="'+currentWebsite+'"></ul></div>');chartsData.specialChartData=new Array();$("#criterium-social_impact .criterium-content .competitor-to-process>p").each(function(){chartsData.specialChartData.push(parseInt($(this).find("span:last-child").text()))});if($("#criterium-adwords_traffic .criterium-competitor-container").length>0){$("#criterium-adwords_traffic .criterium-competitor-container").addClass("main-chart-parent").prepend('<div class="chart-container bar-comp-chart-container chartify-me"><ul class="value" title="'+currentWebsite+'"><li>'+chartsObject[$("#criterium-adwords_traffic .criterium-content .chart-container").attr("id")].series[0].data[0].y+"</li></ul></div>")}if($("#criterium-backlinks_counter .criterium-competitor-container").length>0){$("#criterium-backlinks_counter .criterium-competitor-container").addClass("main-chart-parent").prepend('<div class="chart-container bar-comp-chart-container chartify-me"><ul class="value" title="'+currentWebsite+'"><li>'+chartsObject[$("#criterium-backlinks_counter .criterium-content .chart-container").attr("id")].series[0].data[0].y+"</li></ul></div>")}}}function checkCompetitorCharts(a){$(".competitor-hide").remove();$(".criterium-check-comp .criterium-competitor-container .competitor-to-process").each(function(){var b=$(this),e=$(this).parents(".criterium-check-comp");b.append('<ul class="value" title="'+b.parents(".competitors-data").find(".competitor-head h4").text()+'"></ul>');var c=b.find("ul.value");switch(e.attr("id")){case"criterium-social_impact":var d=0;b.addClass("chart-container comparative-comp-chart-container chartify-me").find(">p").each(function(){var f=$(this),h=parseInt(chartsData.specialChartData[d]),g=parseInt(f.find("span:last-child").text()),i=0;if(h==0){if(g!=0){i=100000}}else{i=Math.round((g/h)*100)}i-=100;if(i>200){i=200}c.append("<li>"+i+"</li>");f.remove();d++});break;case"criterium-adwords_traffic":b.addClass("chart-container bar-comp-chart-container chartify-me");c.append(b.find(".pie-chart-container ul:first-child").html());b.find(">div").remove();break;case"criterium-backlinks_counter":b.addClass("chart-container bar-comp-chart-container chartify-me");c.append(b.find(".bar-chart-container ul:first-child").html());b.find(">div").remove();break}});checkWooChart(true)}function cleanWooCharts(){if($("#criterium-adwords_traffic .criterium-content .pie-chart-container ul:first-child li").text()=="0"){$("#criterium-adwords_traffic").remove()}}function checkWooChart(b){cleanWooCharts();var a=b?".criterium-competitor-container .chartify-me":".criterium-content .chartify-me,\n        #project-content .active .active>.chartify-me, \n        #project-content .active .active tr td>.chartify-me, \n        #project-content #keywords-table .chartify-me, \n        .debug-chart-container .chartify-me, \n        #project-content #social-content .active .active>.chartify-me \n \n        #project-content #uptime-content .active .active>.chartify-me";$(a).each(function(){var f=$(this),d=new Array(),e=0,g="unknow",o="generate-chart-id-"+chartsId,u=null,r=null,v=99999999,p=0;if(f.parents("#criterium-top_ranking_keywords").length>0){f.remove();return}chartsId++;f.attr("id",o).removeClass("chartify-me");if(f.hasClass("pie-chart-container")||f.hasClass("big-pie-chart-container")||f.hasClass("bar-chart-container")||f.hasClass("line-chart-container")||f.hasClass("trend-chart-container")||f.hasClass("revert-trend-chart-container")||f.hasClass("littletrend-chart-container")||f.hasClass("revert-littletrend-chart-container")||f.hasClass("comparative-comp-chart-container")||f.hasClass("nbar-comp-chart-container")||f.hasClass("bar-comp-chart-container")||f.hasClass("genderage-chart-container")||f.hasClass("column-chart-container")){f.find(".value").each(function(){var x=$(this),j=x.attr("title"),i=x.attr("stack"),y=false,z=new Array();x.find("li").each(function(){var B=$(this),A=B.text()=="null"?null:parseFloat(B.text()),E=B.attr("class"),G=false;y=y?y:A;if(r==null){if(A<0){r=false}else{if(A<10){r=0}else{if(A!=null){if(A<v){v=A}if(A>p){p=A}}}}}if(E!=undefined&&E.match("date-")){E=E.replace("date-","");var D=E.slice(0,4),F=E.slice(4,6),C=E.length==8?E.slice(6,8):0;G=Date.UTC(D,F-1,C)}if(G){z.push([G,A])}else{z.push(A)}e+=A!=null?A:0});if(x.hasClass("stacked")){d.push({name:j,data:z,stack:i})}else{d.push({name:j,data:z,y:y})}});u=f.find(".max").text();if(r==null){if((p/v)>21){r=0}else{r=false}}}else{if(f.hasClass("geo-chart-container")){var h=parseInt(f.find(".nbr-rows").text()),q=f.find("tr:first-child th").first().text(),w=f.find("tr:nth-child(2) th").first().text();g="world";e=h;d=new google.visualization.DataTable();d.addRows(h);d.addColumn("string",q);d.addColumn("number",w);f.find("table").each(function(){var i=$(this);d.setValue(parseInt(i.find("tr:first-child td:nth-child(2)").text()),parseInt(i.find("tr:first-child td:nth-child(3)").text()),i.find("tr:first-child td:nth-child(4)").text());d.setValue(parseInt(i.find("tr:nth-child(2) td:nth-child(2)").text()),parseInt(i.find("tr:nth-child(2) td:nth-child(3)").text()),parseFloat(i.find("tr:nth-child(2) td:nth-child(4)").text()))})}else{if(f.hasClass("absolute-geo-chart-container")){var h=parseInt(f.find(".nbr-rows").text());q=f.find("tr:first-child th").first().text(),w=f.find("tr:nth-child(2) th").first().text();g=f.find(".region").text();e=h;d=new google.visualization.DataTable();d.addRows(h);d.addColumn("string",q);d.addColumn("number",w);var t=0;f.find("table").each(function(){var i=$(this);d.setValue(t,0,i.find(".name").text());d.setValue(t,1,parseInt(i.find(".val").text()));t++})}else{f.remove();return}}}chartsData[chartsId]=d;if(f.hasClass("pie-chart-container")){g="pie";u=e}else{if(f.hasClass("big-pie-chart-container")){g="bpie";u=e}else{if(f.hasClass("bar-chart-container")){g="bar"}else{if(f.hasClass("line-chart-container")){g="spline"}else{if(f.hasClass("trend-chart-container")){g="trend"}else{if(f.hasClass("genderage-chart-container")){g="genderage"}else{if(f.hasClass("revert-trend-chart-container")){for(var t in d){d[t].y=1000/d[t].y;for(var s in d[t].data){if(d[t].data[s]==null){continue}d[t].data[s]=1000/d[t].data[s]}}g="trend"}else{if(f.hasClass("littletrend-chart-container")){g="ltrend"}else{if(f.hasClass("revert-littletrend-chart-container")){for(var t in d){d[t].y=1000/d[t].y;for(var s in d[t].data){d[t].data[s]=1000/d[t].data[s]}}g="ltrend"}else{if(f.hasClass("geo-chart-container")||f.hasClass("absolute-geo-chart-container")){wooGeoCharts(o,d,g,f);return}else{if(f.hasClass("comparative-comp-chart-container")){g="comparative"}else{if(f.hasClass("bar-comp-chart-container")){g="bar"}else{if(f.hasClass("nbar-comp-chart-container")){for(t in d){for(s in d[t].data){d[t].data[s]=1/d[t].data[s]}}g="nbar"}else{if(f.hasClass("column-chart-container")){g="column"}}}}}}}}}}}}}}if(f.hasClass("comparative-comp-chart-container")||f.hasClass("bar-comp-chart-container")||f.hasClass("nbar-comp-chart-container")){if(f.parents(".criterium-competitor-container").find(".main-chart-container").length>0){updateWooHighCharts("add",f.parents(".criterium-competitor-container").find(".main-chart-container"),d);f.remove();return}else{f.addClass("main-chart-container")}}if(g=="pie"&&e==0){return}var c=f.hasClass("chart-no-decimal");var l=parseFloat(f.attr("data-min-range"));if(f.hasClass("percent-chart")){u=100.9}var n=false;if(f.hasClass("special-small-chart")){n=true}var m=false;if(f.closest("#generate-chart-id-0").length>0){m=true}wooHighCharts(g,o,d,u,r,c,l,n,m)})}function wooGeoCharts(h,d,e,b){var c=490,a=300;if(b.hasClass("absolute-geo-chart-container")){c=680;a=305}var f={width:c,height:a,region:e,datalessRegionColor:"#dddddd",colorAxis:{colors:["#999999","#315d86"]},enableRegionInteractivity:false,legend:{textStyle:{color:"#333333",fontSize:11,fontName:"Open Sans"}}},g=new google.visualization.GeoChart(document.getElementById(h));g.draw(d,f)}function wooHighCharts(h,l,a,m,e,i,d,b,c){switch(h){case"pie":chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:h,height:100},colors:typeof c=="undefined"||!c?["#315d86","#ddd","#aaa","#999"]:["#315d86","#6a93ba","#ddd","#aaa"],legend:{align:"left",verticalAlign:"top",layout:"vertical",margin:0,floating:true,x:108,y:-17,labelFormatter:function(){return this.name+"  ( "+this.y+"% )"}},plotOptions:{pie:{allowPointSelect:false,cursor:"default",shadow:false,borderColor:null,showInLegend:true,center:[38,38],size:96,dataLabels:{enabled:false}}},series:[{type:h,data:a}]});break;case"bpie":chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:"pie",height:300},plotOptions:{pie:{shadow:false,borderColor:null,showInLegend:true,dataLabels:{enabled:false}}},series:[{type:"pie",data:a}]});break;case"nbar":if(!m||m==""||m<50){m=null}var g=90+a.length*30;chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:"bar",height:g},xAxis:{title:{text:null},labels:{enabled:false},minPadding:0.05,maxPadding:0.05,lineWidth:0,tickWidth:0},yAxis:{title:{text:null},min:0,max:m,opposite:true,endOnTick:false,maxPadding:0.02,labels:{overflow:"justify",formatter:function(){return this.value==0?"âˆž":Math.round(1/this.value)}}},tooltip:{formatter:function(){return this.y>1?""+this.series.name+": "+this.y:""+this.series.name+": "+(1/this.y)}},legend:{borderWidth:null},plotOptions:{bar:{groupPadding:0,borderColor:null,id:l,shadow:false,dataLabels:{enabled:true,color:"#fff",align:"right",x:-12,overflow:"justify",formatter:function(){return this.y>1?this.y:(1/this.y)+"th"}}}},series:a});break;case"bar":if(!m||m==""||m<50){m=null}var g=90+a.length*30;chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:h,height:g,spacingTop:0},xAxis:{title:{text:null},labels:{enabled:false},minPadding:0.05,maxPadding:0.05,lineWidth:0,tickWidth:0},yAxis:{title:{text:null},min:0,max:m,opposite:true,endOnTick:false,maxPadding:0.02,labels:{overflow:"justify",enabled:false}},legend:{borderWidth:null,reversed:true},plotOptions:{bar:{groupPadding:0,borderColor:null,id:l,shadow:false,pointWidth:24,dataLabels:{enabled:true,color:"#fff",align:"right",x:-10,overflow:"justify",formatter:function(){var n=this.y;if(m==100){n+="%"}return n}}}},series:a});break;case"comparative":chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:"bar",height:700},colors:["#b1e5e6","#569596","#2a494a","#888888"],xAxis:{title:{text:null},minPadding:0.05,maxPadding:0.05,lineWidth:0,tickWidth:0,categories:["fb_likes","fb_shares","fb_comm","tw_bl","li_shares","digg","delicious","stumbled_upon","plus_one"],labels:{formatter:function(){switch(this.value){case"fb_likes":return'<img src="/assets/img/css/facebook_l.png" />&nbsp;';break;case"fb_shares":return'<img src="/assets/img/css/facebook_s.png" />&nbsp;';break;case"fb_comm":return'<img src="/assets/img/css/facebook_c.png" />&nbsp;';break;case"tw_bl":return'<img src="/assets/img/css/twitter_b.png" />&nbsp;';break;case"li_shares":return'<img src="/assets/img/css/linkedin_s.png" />&nbsp;';break;case"digg":return'<img src="/assets/img/css/digg_e.png" />&nbsp;';break;case"delicious":return'<img src="/assets/img/css/delicious_b.png" />&nbsp;';break;case"stumbled_upon":return'<img src="/assets/img/css/stumbleupon.png" />&nbsp;';break;case"plus_one":return'<img src="/assets/img/css/google_p.png" />&nbsp;';break;default:return this.value;break}},useHTML:true}},yAxis:{title:{text:null},min:0,opposite:true,endOnTick:false,maxPadding:0.02,max:230,min:-120,gridLineColor:null,plotLines:[{color:"#A0C5E5",width:1,value:0}],labels:{formatter:function(){if(this.value==0){return""+currentWebsite}return""},style:{fontSize:"11px",color:"#315d86"}}},legend:{borderWidth:null},plotOptions:{bar:{animation:false,borderColor:null,id:l,shadow:false,dataLabels:{enabled:true,overflow:"justify",formatter:function(){if(this.y==0){return""}else{if(this.y==200){return">"+this.y+"%"}else{if(this.y>0){return"+"+this.y+"%"}}}return this.y+"%"}}}}});break;case"spline":if(e===false){e=null}chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:h,height:typeof b=="undefined"||b==false?325:160,marginRight:0,marginLeft:36},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b"},lineColor:null,lineWidth:0,tickWidth:0,minPadding:0.05,maxPadding:0.05},yAxis:{alternateGridColor:"#f7f7f7",lineColor:null,lineWidth:0,minPadding:0.05,maxPadding:0.1,minRange:typeof d!="undefined"?d:0.01,endOnTick:false,min:e,max:m==""?null:m,allowDecimals:typeof i!="undefined"?!i:false,labels:{formatter:function(){var n=this.value;if(m==100.9){n+="%"}if(n>=1000&&n<1000000){n=Math.floor(n/1000);n+="k"}else{if(n>=1000000){n=Math.floor(n/1000000);n+="M"}}return n}}},legend:{enabled:a.length>1,align:"left",verticalAlign:"top",margin:0,floating:true,x:36},tooltip:{enabled:true},plotOptions:{spline:{groupPadding:0,borderColor:null,stickyTracking:false,marker:{enabled:true,symbol:"circle",radius:2,states:{hover:{radius:3}}},shadow:false}},series:a});break;case"genderage":chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,type:"column",height:325},xAxis:{categories:["13-17","18-24","25-34","35-44","45-54","55-64","65+"],lineColor:null,lineWidth:0,tickWidth:0,minPadding:0.05,maxPadding:0.05},yAxis:{alternateGridColor:"#f7f7f7",lineColor:null,lineWidth:0,minPadding:0.05,maxPadding:0.1,endOnTick:false,labels:{formatter:function(){return Math.abs(this.value)}}},legend:{align:"left",verticalAlign:"top",margin:0,floating:true,x:36},tooltip:{enabled:true,formatter:function(){var n="<b>"+this.x+"</b>";$.each(this.points,function(p,o){n+="<br/>"+o.series.name+" : "+Math.abs(o.y)});return n},shared:true},plotOptions:{column:{stacking:"normal",groupPadding:0.2,pointWidth:25,borderColor:null,shadow:false}},series:a});break;case"ltrend":var j=32;var f=true;case"trend":if(!j){var j=20}chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:"areaspline",height:j,marginRight:0,marginLeft:0,marginTop:0,marginBottom:1},xAxis:{type:"datetime",labels:{enabled:false},gridLineWidth:0,lineColor:"#999",lineWidth:f?0:1,tickWidth:0,minPadding:0.01,maxPadding:0.08},yAxis:{labels:{enabled:false},gridLineWidth:0,lineColor:"#999",lineWidth:f?0:1,minPadding:0.01,maxPadding:0.08,endOnTick:false},legend:{enabled:false},tooltip:{enabled:false},plotOptions:{areaspline:{groupPadding:0,borderColor:null,id:l,shadow:false,marker:{enabled:false},states:{hover:{enabled:false}},fillOpacity:0.2,pointInterval:24*3600*1000}},series:a});break;case"column":chartsObject[l]=new Highcharts.Chart({chart:{renderTo:l,defaultSeriesType:h,height:typeof b=="undefined"||b==false?325:160,marginRight:0,marginLeft:36},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b"},lineColor:null,lineWidth:0,tickWidth:0,minPadding:0.05,maxPadding:0.05},yAxis:{alternateGridColor:"#f7f7f7",lineColor:null,lineWidth:0,minPadding:0.05,maxPadding:0.1,minRange:typeof d!="undefined"?d:0.1,endOnTick:false,min:e,max:typeof m!="undefined"&&m!=""?m:undefined,allowDecimals:typeof i!="undefined"?!i:false,labels:{formatter:function(){var q=this.value<=0.01?0:this.value;var n,o,p;n=Math.floor(q/60);o=Math.floor(q)%60;p=Math.floor((q-n*60-o)*60);if(n>0){return n+"h"}else{if(o>0){return o+"m"}else{if(p>0){return p+"s"}else{return q}}}}}},legend:{enabled:a.length>1,align:"left",verticalAlign:"top",margin:0,floating:true,x:36},tooltip:{enabled:true,formatter:function(){var r=this.y<=0.01?0:this.y;var n,p,q;n=Math.floor(r/60);p=Math.floor(r)%60;q=Math.floor((r-n*60-p)*60);var o="";o+=n>0?" "+n+"h":"";o+=p>0?" "+p+"m":"";o+=q>0?" "+q+"s":"";if(o.length==0){o="0"}return""+Highcharts.dateFormat("%e. %b %Y",this.x)+" : "+o}},series:a,plotOptions:{column:{borderWidth:0,shadow:false,color:"#C4392F"}}});break;default:console.log("----------------------------");console.log("- Unrecongnised chart type -");console.log("----------------------------");console.log("type : "+h);console.log("type : "+l);console.log(a);console.log("max : "+m);console.log("----------------------------");return;break}}function updateWooHighCharts(b,a,c){switch(b){case"add":chartsObject[a.attr("id")].addSeries(c[0]);break}}function updateAllWooHighChartsHeight(){for(var c in chartsObject){var a=chartsObject[c].chartHeight,d=chartsObject[c].chartWidth,b=chartsObject[c].series.length;if(a<(70+(b*30))){chartsObject[c].setSize(d,(90+(b*30)),false)}}}function initWooFlyingMenu(a){wooFlyingMenu=$("#left-panel>nav").first();$(window).on("scroll",function(){if(window.scrollY>100){wooFlyingMenu.css("position","fixed").css("top","30px");var b=a;$(".module").each(function(){var c=$(this).offset().top;if(c<=window.scrollY+20){b++}else{return false}});if(b>a){wooFlyingMenu.find("a").removeClass("current");wooFlyingMenu.find("a:nth-child("+b+")").addClass("current")}else{if(!wooFlyingMenu.find("a.score").hasClass("current")){wooFlyingMenu.find("a").removeClass("current");wooFlyingMenu.find("a.score").addClass("current")}}}else{wooFlyingMenu.css("position","relative").css("top","0")}});wooFlyingMenu.find("a").on("click",function(d){d.preventDefault();var b=$(this).attr("href");if(isNaN(parseInt(b))){var c=$(b)}else{var c=$(".module").eq(b)}scrollTo(c,500)})}function initWysiwyg(){$(".direct-jwysiwyg").each(function(){wooWysiwyg($(this))});$(".jwysiwyg").on("wysiwyg",function(){var a=$(this);a.parent().fadeIn(100).parent().css("height","235").find(".trash-button, .save-button").css("opacity",1);wooWysiwyg(a);a.wysiwyg("document").blur(function(){checkEdited()});a.on("detroy-wysiwyg",function(){$(this).wysiwyg("destroy")})})}function checkEdited(){$("iframe").each(function(){var a=$(this);if(a.hasClass("default-text")){a.parents(".ui-accordion-content").prev().find(".icon-pencil").addClass("default")}else{a.parents(".ui-accordion-content").prev().find(".icon-pencil").removeClass("default")}})}function templateAjaxSaving(f,e){var b=$("form.box.current"),a=convertSerializedArrayToHash(b.serializeArray()),c=hashDiff(f,a);if(c!=""){var d="id="+$("form.box.current .template-id").val()+"&ajaxSave=1"+c;wooFormBackup=convertSerializedArrayToHash($("form.box.current").serializeArray());$("form.box.current .saving-box").removeClass("hidden");$.ajax({type:"POST",data:d,cache:false,url:b.attr("action"),async:true,success:function(g){if(e){b.submit()}else{$("form.box.current .saving-box").addClass("hidden")}}})}else{if(e){b.submit()}}}function wooWysiwyg(a){a.wysiwyg({rmUnusedControls:true,controls:{bold:{visible:true},italic:{visible:true},underline:{visible:true},createLink:{visible:true},insertOrderedList:{visible:true},insertUnorderedList:{visible:true}},events:{click:function(){a.wysiwyg("setContent","#%blank%#")}},css:"/assets/css/inc/wysiwyg.css"})}function initVideoModalBinding(){var a=(navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?true:false);$(".video-modal").live("click",function(){var b=$(this),f=b.attr("id"),e="&autoplay=1&color=white&controls=1&iv_load_policy=3&modestbranding=1&theme=light&rel=0&showinfo=0",h={allowScriptAccess:"always"};_gaq.push(["_trackEvent","Todo","videoPlay",f]);if(b.attr("start")!=undefined){var i=b.attr("start"),g=i.split(":");if(g.length>1){i=(g[0]*60)+minSec[1]}e+="&start="+i}if(b.attr("end")!=undefined){var d=b.attr("end"),c=d.split(":");if(c.length>1){d=(c[0]*60)+c[1]}e+="&end="+d}if(a){$("#video-modal .ytplayer-container").html('<iframe id="iframeplayer" type="text/html" width="818" height="460" src="http://www.youtube.com/embed/'+f+"?enablejsapi=1&playerapiid=ytplayer"+e+'" frameborder="0"></iframe>')}else{swfobject.embedSWF("http://www.youtube.com/v/"+f+"?enablejsapi=1&playerapiid=ytplayer"+e,"ytplayer","818","460","8",null,null,h)}});$("#video-modal").on("hidden",function(){$(this).find(".ytplayer-container").html('<div id="ytplayer"><p>Video</p></div>')})}function initImgModalBinding(){$(".img-modal").live("click",function(){var a=$(this),b=a.attr("href");_gaq.push(["_trackEvent","Todo","ImageShown",b]);$("#img-modal #img-container").html('<img src="'+b+'"/>')});$("#img-modal").on("hidden",function(){$(this).find("#img-container").html("<p>Image</p>")})}function initWooRightBubble(){wooBubble=$("#right-bubble");maxTop=($("#right-panel").offset().top)+10;wooRightBubbleChange(false);initVideoModalBinding();initImgModalBinding();return wooBubble}function wooRightBubbleChange(b,g){if(b){wooBubble.attr("rel","#"+b)}else{wooBubble.hide()}if(g){wooBubble.find(".content .inner").html(g);wooBubble.find(".video-modal").each(function(){var h=$(this),i=h.attr("id");h.attr("href","#").css("background-image","url(/assets/img/ythumb/"+i+".png)").html('<span class="play"></span>')});wooBubble.find(".img-modal").each(function(){var h=$(this),i=h.attr("id");h.css("background-image","url(/assets/img/ithumb/"+i+".png)").html('<span class="view"></span>')})}if($(wooBubble.attr("rel")).length>0){var c=$("#right-panel").height(),d=maxTop+c,f=wooBubble.find(".pointer"),a=wooBubble.height(),e=$(wooBubble.attr("rel")).offset().top;if(e+a<d){wooBubble.animate({top:e-maxTop+"px"},function(){if(b){wooBubble.fadeIn(100)}});f.css("top","23px")}else{wooBubble.animate({top:(c-a)+"px"},function(){if(b){wooBubble.fadeIn(100)}});f.css("top",((e-maxTop)-(c-a)+23)+"px")}}else{wooBubble.hide()}}function getCountryCode(a){return typeof countries[a]!="undefined"?countries[a].toLowerCase():null}var mapColors={0:"#cad6e0",10:"#9fbad4",20:"#8fadc9",30:"#7ea0bf",40:"#779cbf",50:"#6c94ba",60:"#5d88b0",70:"#517da6",80:"#46729c",90:"#3c6891",100:"#325e87"};function getColorCode(a,b){a=Math.floor(a*b/10)*10;return mapColors[a]}function wooMaps(){$(".woomap").each(function(a,b){wooMap($(b))})}function wooMap(f){if(f.hasClass("yuhuu-mapped")){return}var e=f.find(".country-info");var c=[];var l=0;for(var g=0;g<e.length;++g){var o=$(e[g]);var a=getCountryCode(o.find(".name").html()),h=o.find(".percent").html();if(a!=null){c[a]=h;l=Math.max(l,h)}}var n=[];for(var d in c){n[d]=getColorCode(c[d],100/l)}f.predata=c;f.max=l;f.html("");f.vectorMap({map:"world_en",backgroundColor:"#fff",color:"#E4E4E4",colors:n,borderColor:"#fff",borderWidth:1,borderOpacity:1,hoverColor:"#294c6e",selectedColor:"#294c6e",enableZoom:false,onLabelShow:function(r,i,q){var p="~ 0";if(typeof f.predata[q]!="undefined"){p=f.predata[q]}i.text(i.text()+" : "+p+"%")}});f.bind("regionClick.jqvmap",function(p,i,q){p.preventDefault();console.log(p)});f.after("<span class='scale'></span>");var b=f.next(".scale");b.append("<span class='scale-start'>"+Math.floor(f.max/10)+"</span>");b.append("<span class='scale-items'></span>");var j=b.find(".scale-items");for(var g=0;g<=100;g+=10){j.append("<span class='scale-item'></span>");var m=j.find(".scale-item:last-child");m.css("background",mapColors[g])}b.append("<span class='scale-end'>"+Math.ceil(f.max)+"</span>");f.height(f.height()+40+"px");f.addClass("yuhuu-mapped")}var re_weburl=new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/[^\\s]*)?$","i");function validateURL(a){return re_weburl.test(a)}function checkWooLatestChanges(b){var a=80;b.find(".lc.percent").each(function(){var d=$(this),g=37,f=d.attr("id"),i=parseInt(d.find(".val").text()),e=Raphael("holder-"+f),h={stroke:"#fff","stroke-width":6};e.customAttributes.arc=function(o){var q,n=o<0?-1:1,m=n<0?"rgb(160, 6, 29)":"rgb(60, 126, 20)";o*=n;o=o>=1000?999.99:o;var p=n==1?0.36*o:360-(0.36*o),l=(90-p)*Math.PI/180,j=(a/2)+g*Math.cos(l),r=(a/2)-g*Math.sin(l);if(n==-1){q=[["M",a/2,(a/2)-g],["A",g,g,0,+(p<180),0,j,r]]}else{q=[["M",a/2,(a/2)-g],["A",g,g,0,+(p>180),1,j,r]]}return{path:q,stroke:m}};if(i){wooLcCounters[f]=e.path().attr(h).attr({arc:[i*10,g]})}});var c=new Date();b.find(".lc-moment").each(function(){var d=$(this),f=d.text(),e;if(f.match("week")){var h=f.split("#"),g="";e=moment(h[1],"YYYY-MM-DD");g+=e.format("MMM D")+" - ";e=moment(h[2],"YYYY-MM-DD");g+=e.format("MMM D");d.text(g)}else{if(f.length==10){e=moment(f,"YYYY-MM-DD");d.text(e.format("MMM D"))}else{if(f.length==7){e=moment(f,"YYYY-MM");d.text(e.format("MMMM"))}}}})};